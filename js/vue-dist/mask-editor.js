var _m=Object.defineProperty;var Qu=e=>{throw TypeError(e)};var Sm=(e,t,n)=>t in e?_m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var g=(e,t,n)=>Sm(e,typeof t!="symbol"?t+"":t,n),Uo=(e,t,n)=>t.has(e)||Qu("Cannot "+n);var w=(e,t,n)=>(Uo(e,t,"read from private field"),n?n.call(e):t.get(e)),Z=(e,t,n)=>t.has(e)?Qu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),q=(e,t,n,r)=>(Uo(e,t,"write to private field"),r?r.call(e,n):t.set(e,n),n),Yn=(e,t,n)=>(Uo(e,t,"access private method"),n);var Ju=(e,t,n,r)=>({set _(s){q(e,t,s,n)},get _(){return w(e,t,r)}});import{r as k,c as Ce,d as eo,w as Cn,e as zm,g as km,o as Mm,u as B,a as Pm,n as Im,m as Ro,b as Et,f as et,h as Ie,i as Qn,j as C,k as Ul,l as ms,t as Fe,p as dt,q as Ua,F as mh,s as yh,v as ws,x as Bm,y as Em,z as pi,_ as Am,A as Om,B as Um}from"./assets/_plugin-vue_export-helper.js";function Rm(e){return arguments.length===0?[]:Array.isArray(e)?e:[e]}function Cm(e,t){if(!Number.isInteger(t)||t<=0)throw new Error("Size must be an integer greater than zero.");const n=Math.ceil(e.length/t),r=Array(n);for(let s=0;s<n;s++){const i=s*t,a=i+t;r[s]=e.slice(i,a)}return r}function At(e){return Array.isArray(e)?e:Array.from(e)}function Vm(e){return Number.isSafeInteger(e)&&e>=0}function Y(e){return e!=null&&typeof e!="function"&&Vm(e.length)}function Lm(e,t=1){return t=Math.max(Math.floor(t),0),t===0||!Y(e)?[]:Cm(At(e),t)}function Fm(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];r&&t.push(r)}return t}function Gm(e){return Y(e)?Fm(Array.from(e)):[]}function to(e,t=1){const n=[],r=Math.floor(t),s=(i,a)=>{for(let o=0;o<i.length;o++){const l=i[o];Array.isArray(l)&&a<r?s(l,a+1):n.push(l)}};return s(e,0),n}function Nm(...e){return to(e)}function ue(e){return e}function nr(e){return e==="__proto__"}function qi(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}function lr(e){var t;return typeof e=="string"||typeof e=="symbol"?e:Object.is((t=e==null?void 0:e.valueOf)==null?void 0:t.call(e),-0)?"-0":String(e)}function me(e){if(e==null)return"";if(typeof e=="string")return e;if(Array.isArray(e))return e.map(me).join(",");const t=String(e);return t==="0"&&Object.is(Number(e),-0)?"-0":t}function Mn(e){if(Array.isArray(e))return e.map(lr);if(typeof e=="symbol")return[e];e=me(e);const t=[],n=e.length;if(n===0)return t;let r=0,s="",i="",a=!1;for(e.charCodeAt(0)===46&&(t.push(""),r++);r<n;){const o=e[r];i?o==="\\"&&r+1<n?(r++,s+=e[r]):o===i?i="":s+=o:a?o==='"'||o==="'"?i=o:o==="]"?(a=!1,t.push(s),s=""):s+=o:o==="["?(a=!0,s&&(t.push(s),s="")):o==="."?s&&(t.push(s),s=""):s+=o,r++}return s&&t.push(s),t}function It(e,t,n){if(e==null)return n;switch(typeof t){case"string":{if(nr(t))return n;const r=e[t];return r===void 0?qi(t)?It(e,Mn(t),n):n:r}case"number":case"symbol":{typeof t=="number"&&(t=lr(t));const r=e[t];return r===void 0?n:r}default:{if(Array.isArray(t))return Dm(e,t,n);if(Object.is(t==null?void 0:t.valueOf(),-0)?t="-0":t=String(t),nr(t))return n;const r=e[t];return r===void 0?n:r}}}function Dm(e,t,n){if(t.length===0)return n;let r=e;for(let s=0;s<t.length;s++){if(r==null||nr(t[s]))return n;r=r[t[s]]}return r===void 0?n:r}function Dn(e){return function(t){return It(t,e)}}function ln(e){return e!==null&&(typeof e=="object"||typeof e=="function")}function Yi(e){return e==null||typeof e!="object"&&typeof e!="function"}function mt(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}function Rl(e,t,n){return typeof n!="function"?Rl(e,t,()=>{}):Qo(e,t,function r(s,i,a,o,l,u){const c=n(s,i,a,o,l,u);return c!==void 0?!!c:Qo(s,i,r,u)},new Map)}function Qo(e,t,n,r){if(t===e)return!0;switch(typeof t){case"object":return jm(e,t,n,r);case"function":return Object.keys(t).length>0?Qo(e,{...t},n,r):mt(e,t);default:return ln(e)?typeof t=="string"?t==="":!0:mt(e,t)}}function jm(e,t,n,r){if(t==null)return!0;if(Array.isArray(t))return gh(e,t,n,r);if(t instanceof Map)return Wm(e,t,n,r);if(t instanceof Set)return qm(e,t,n,r);const s=Object.keys(t);if(e==null)return s.length===0;if(s.length===0)return!0;if(r!=null&&r.has(t))return r.get(t)===e;r==null||r.set(t,e);try{for(let i=0;i<s.length;i++){const a=s[i];if(!Yi(e)&&!(a in e)||t[a]===void 0&&e[a]!==void 0||t[a]===null&&e[a]!==null||!n(e[a],t[a],a,e,t,r))return!1}return!0}finally{r==null||r.delete(t)}}function Wm(e,t,n,r){if(t.size===0)return!0;if(!(e instanceof Map))return!1;for(const[s,i]of t.entries()){const a=e.get(s);if(n(a,i,s,e,t,r)===!1)return!1}return!0}function gh(e,t,n,r){if(t.length===0)return!0;if(!Array.isArray(e))return!1;const s=new Set;for(let i=0;i<t.length;i++){const a=t[i];let o=!1;for(let l=0;l<e.length;l++){if(s.has(l))continue;const u=e[l];let c=!1;if(n(u,a,i,e,t,r)&&(c=!0),c){s.add(l),o=!0;break}}if(!o)return!1}return!0}function qm(e,t,n,r){return t.size===0?!0:e instanceof Set?gh([...e],[...t],n,r):!1}function Cl(e,t){return Rl(e,t,()=>{})}function Ii(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}function Or(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const no="[object RegExp]",Ls="[object String]",Xi="[object Number]",Zi="[object Boolean]",Fs="[object Arguments]",ro="[object Symbol]",so="[object Date]",io="[object Map]",ao="[object Set]",Vl="[object Array]",Ym="[object Function]",oo="[object ArrayBuffer]",vi="[object Object]",Xm="[object Error]",lo="[object DataView]",Ll="[object Uint8Array]",Fl="[object Uint8ClampedArray]",Gl="[object Uint16Array]",Nl="[object Uint32Array]",Zm="[object BigUint64Array]",Dl="[object Int8Array]",jl="[object Int16Array]",Wl="[object Int32Array]",Hm="[object BigInt64Array]",ql="[object Float32Array]",Yl="[object Float64Array]";function Xl(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Km(e,t){return br(e,void 0,e,new Map,t)}function br(e,t,n,r=new Map,s=void 0){const i=s==null?void 0:s(e,t,n,r);if(i!==void 0)return i;if(Yi(e))return e;if(r.has(e))return r.get(e);if(Array.isArray(e)){const a=new Array(e.length);r.set(e,a);for(let o=0;o<e.length;o++)a[o]=br(e[o],o,n,r,s);return Object.hasOwn(e,"index")&&(a.index=e.index),Object.hasOwn(e,"input")&&(a.input=e.input),a}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const a=new RegExp(e.source,e.flags);return a.lastIndex=e.lastIndex,a}if(e instanceof Map){const a=new Map;r.set(e,a);for(const[o,l]of e)a.set(o,br(l,o,n,r,s));return a}if(e instanceof Set){const a=new Set;r.set(e,a);for(const o of e)a.add(br(o,void 0,n,r,s));return a}if(typeof Buffer<"u"&&Buffer.isBuffer(e))return e.subarray();if(Xl(e)){const a=new(Object.getPrototypeOf(e)).constructor(e.length);r.set(e,a);for(let o=0;o<e.length;o++)a[o]=br(e[o],o,n,r,s);return a}if(e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const a=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return r.set(e,a),mn(a,e,n,r,s),a}if(typeof File<"u"&&e instanceof File){const a=new File([e],e.name,{type:e.type});return r.set(e,a),mn(a,e,n,r,s),a}if(typeof Blob<"u"&&e instanceof Blob){const a=new Blob([e],{type:e.type});return r.set(e,a),mn(a,e,n,r,s),a}if(e instanceof Error){const a=new e.constructor;return r.set(e,a),a.message=e.message,a.name=e.name,a.stack=e.stack,a.cause=e.cause,mn(a,e,n,r,s),a}if(e instanceof Boolean){const a=new Boolean(e.valueOf());return r.set(e,a),mn(a,e,n,r,s),a}if(e instanceof Number){const a=new Number(e.valueOf());return r.set(e,a),mn(a,e,n,r,s),a}if(e instanceof String){const a=new String(e.valueOf());return r.set(e,a),mn(a,e,n,r,s),a}if(typeof e=="object"&&Qm(e)){const a=Object.create(Object.getPrototypeOf(e));return r.set(e,a),mn(a,e,n,r,s),a}return e}function mn(e,t,n=e,r,s){const i=[...Object.keys(t),...Ii(t)];for(let a=0;a<i.length;a++){const o=i[a],l=Object.getOwnPropertyDescriptor(e,o);(l==null||l.writable)&&(e[o]=br(t[o],o,n,r,s))}}function Qm(e){switch(Or(e)){case Fs:case Vl:case oo:case lo:case Zi:case so:case ql:case Yl:case Dl:case jl:case Wl:case io:case Xi:case vi:case no:case ao:case Ls:case ro:case Ll:case Fl:case Gl:case Nl:return!0;default:return!1}}function wh(e){return br(e,void 0,e,new Map,void 0)}function ur(e){return e=wh(e),t=>Cl(t,e)}function Zl(e,t){return Km(e,(n,r,s,i)=>{const a=t==null?void 0:t(n,r,s,i);if(a!==void 0)return a;if(typeof e=="object")switch(Object.prototype.toString.call(e)){case Xi:case Ls:case Zi:{const o=new e.constructor(e==null?void 0:e.valueOf());return mn(o,e),o}case Fs:{const o={};return mn(o,e),o.length=e.length,o[Symbol.iterator]=e[Symbol.iterator],o}default:return}})}function Bi(e){return Zl(e)}const Jm=/^(?:0|[1-9]\d*)$/;function Gs(e,t=Number.MAX_SAFE_INTEGER){switch(typeof e){case"number":return Number.isInteger(e)&&e>=0&&e<t;case"symbol":return!1;case"string":return Jm.test(e)}}function Ns(e){return e!==null&&typeof e=="object"&&Or(e)==="[object Arguments]"}function Hl(e,t){let n;if(Array.isArray(t)?n=t:typeof t=="string"&&qi(t)&&(e==null?void 0:e[t])==null?n=Mn(t):n=[t],n.length===0)return!1;let r=e;for(let s=0;s<n.length;s++){const i=n[s];if((r==null||!Object.hasOwn(r,i))&&!((Array.isArray(r)||Ns(r))&&Gs(i)&&i<r.length))return!1;r=r[i]}return!0}function cr(e,t){switch(typeof e){case"object":{Object.is(e==null?void 0:e.valueOf(),-0)&&(e="-0");break}case"number":{e=lr(e);break}}return t=Bi(t),function(n){const r=It(n,e);return r===void 0?Hl(n,e):t===void 0?r===void 0:Cl(r,t)}}function ie(e){if(e==null)return ue;switch(typeof e){case"function":return e;case"object":return Array.isArray(e)&&e.length===2?cr(e[0],e[1]):ur(e);case"string":case"symbol":case"number":return Dn(e)}}function ey(e,t){if(e==null)return{};const n=Y(e)?Array.from(e):Object.values(e),r=ie(t??void 0),s=Object.create(null);for(let i=0;i<n.length;i++){const a=n[i],o=r(a);s[o]=(s[o]??0)+1}return s}function uo(e,t){const n=new Set(t);return e.filter(r=>!n.has(r))}function Ur(e){return typeof e=="object"&&e!==null}function be(e){return Ur(e)&&Y(e)}function ty(e,...t){if(!be(e))return[];const n=At(e),r=[];for(let s=0;s<t.length;s++){const i=t[s];be(i)&&r.push(...Array.from(i))}return uo(n,r)}function co(e){return e[e.length-1]}function Vr(e){if(Y(e))return co(At(e))}function ny(e,t,n){const r=new Set(t.map(s=>n(s)));return e.filter(s=>!r.has(n(s)))}function fo(e){const t=[];for(let n=0;n<e.length;n++){const r=e[n];if(be(r))for(let s=0;s<r.length;s++)t.push(r[s])}return t}function vh(e,...t){if(!be(e))return[];const n=Vr(t),r=fo(t);return be(n)?uo(Array.from(e),r):ny(Array.from(e),r,ie(n))}function ry(e,t,n){return e.filter(r=>t.every(s=>!n(r,s)))}function xh(e,...t){if(!be(e))return[];const n=Vr(t),r=fo(t);return typeof n=="function"?ry(Array.from(e),r,n):uo(Array.from(e),r)}function sy(e,t){return t=Math.max(t,0),e.slice(t)}function Rr(e){return typeof e=="symbol"||e instanceof Symbol}function tt(e){return Rr(e)?NaN:Number(e)}function er(e){return e?(e=tt(e),e===1/0||e===-1/0?(e<0?-1:1)*Number.MAX_VALUE:e===e?e:0):e===0?e:0}function nt(e){const t=er(e),n=t%1;return n?t-n:t}function iy(e,t=1,n){return Y(e)?(t=n?1:nt(t),sy(At(e),t)):[]}function ay(e,t){return t=Math.min(-t,0),t===0?e.slice():e.slice(0,t)}function oy(e,t=1,n){return Y(e)?(t=n?1:nt(t),ay(At(e),t)):[]}function fa(e,t){for(let n=e.length-1;n>=0;n--)if(!t(e[n],n,e))return e.slice(0,n+1);return[]}function ly(e,t=ue){return Y(e)?uy(Array.from(e),t):[]}function uy(e,t){switch(typeof t){case"function":return fa(e,(n,r,s)=>!!t(n,r,s));case"object":if(Array.isArray(t)&&t.length===2){const n=t[0],r=t[1];return fa(e,cr(n,r))}else return fa(e,ur(t));case"symbol":case"number":case"string":return fa(e,Dn(t))}}function ha(e,t){const n=e.findIndex((r,s,i)=>!t(r,s,i));return n===-1?[]:e.slice(n)}function cy(e,t=ue){return Y(e)?fy(At(e),t):[]}function fy(e,t){switch(typeof t){case"function":return ha(e,(n,r,s)=>!!t(n,r,s));case"object":if(Array.isArray(t)&&t.length===2){const n=t[0],r=t[1];return ha(e,cr(n,r))}else return ha(e,ur(t));case"number":case"symbol":case"string":return ha(e,Dn(t))}}function Lr(e,t,n=1){if(t==null&&(t=e,e=0),!Number.isInteger(n)||n===0)throw new Error("The step value must be a non-zero integer.");const r=Math.max(Math.ceil((t-e)/n),0),s=new Array(r);for(let i=0;i<r;i++)s[i]=e+i*n;return s}function Jo(e,t=ue){if(!e)return e;const n=Y(e)||Array.isArray(e)?Lr(0,e.length):Object.keys(e);for(let r=0;r<n.length;r++){const s=n[r],i=e[s];if(t(i,s,e)===!1)break}return e}function ec(e,t=ue){if(!e)return e;const n=Y(e)?Lr(0,e.length):Object.keys(e);for(let r=n.length-1;r>=0;r--){const s=n[r],i=e[s];if(t(i,s,e)===!1)break}return e}function Ln(e,t,n){return ln(n)&&(typeof t=="number"&&Y(n)&&Gs(t)&&t<n.length||typeof t=="string"&&t in n)?mt(n[t],e):!1}function hy(e,t,n){if(!e)return!0;n&&Ln(e,t,n)&&(t=void 0),t||(t=ue);let r;switch(typeof t){case"function":{r=t;break}case"object":{if(Array.isArray(t)&&t.length===2){const s=t[0],i=t[1];r=cr(s,i)}else r=ur(t);break}case"symbol":case"number":case"string":r=Dn(t)}if(!Y(e)){const s=Object.keys(e);for(let i=0;i<s.length;i++){const a=s[i],o=e[a];if(!r(o,a,e))return!1}return!0}for(let s=0;s<e.length;s++)if(!r(e[s],s,e))return!1;return!0}function py(e,t,n=0,r=e.length){const s=e.length,i=Math.max(n>=0?n:s+n,0),a=Math.min(r>=0?r:s+r,s);for(let o=i;o<a;o++)e[o]=t;return e}function ho(e){return typeof e=="string"||e instanceof String}function dy(e,t,n=0,r=e?e.length:0){return Y(e)?ho(e)?e:(n=Math.floor(n),r=Math.floor(r),n||(n=0),r||(r=0),py(e,t,n,r)):[]}function bh(e,t=ue){if(!e)return[];if(t=ie(t),!Array.isArray(e)){const s=[],i=Object.keys(e),a=Y(e)?e.length:i.length;for(let o=0;o<a;o++){const l=i[o],u=e[l];t(u,l,e)&&s.push(u)}return s}const n=[],r=e.length;for(let s=0;s<r;s++){const i=e[s];t(i,s,e)&&n.push(i)}return n}function my(e,t=ue,n=0){if(!e)return;n<0&&(n=Math.max(e.length+n,0));const r=ie(t);if(!Array.isArray(e)){const s=Object.keys(e);for(let i=n;i<s.length;i++){const a=s[i],o=e[a];if(r(o,a,e))return o}return}return e.slice(n).find(r)}function yy(e,t,n=0){if(!e)return-1;n<0&&(n=Math.max(e.length+n,0));const r=Array.from(e).slice(n);let s=-1;switch(typeof t){case"function":{s=r.findIndex(t);break}case"object":{if(Array.isArray(t)&&t.length===2){const i=t[0],a=t[1];s=r.findIndex(cr(i,a))}else s=r.findIndex(ur(t));break}case"number":case"symbol":case"string":s=r.findIndex(Dn(t))}return s===-1?-1:s+n}function gy(e,t=ue,n){if(!e)return;const r=Array.isArray(e)?e.length:Object.keys(e).length;n=nt(n??r-1),n<0?n=Math.max(r+n,0):n=Math.min(n,r-1);const s=ie(t);if(!Array.isArray(e)){const i=Object.keys(e);for(let a=n;a>=0;a--){const o=i[a],l=e[o];if(s(l,o,e))return l}return}return e.slice(0,n+1).findLast(s)}function wy(e,t=ue,n=e?e.length-1:0){if(!e)return-1;n<0?n=Math.max(e.length+n,0):n=Math.min(n,e.length-1);const r=At(e).slice(0,n+1);switch(typeof t){case"function":return r.findLastIndex(t);case"object":if(Array.isArray(t)&&t.length===2){const s=t[0],i=t[1];return r.findLastIndex(cr(s,i))}else return r.findLastIndex(ur(t));case"number":case"symbol":case"string":return r.findLastIndex(Dn(t))}}function vy(e){return e[0]}function tc(e){if(Y(e))return vy(At(e))}function Hi(e,t=1){const n=[],r=Math.floor(t);if(!Y(e))return n;const s=(i,a)=>{for(let o=0;o<i.length;o++){const l=i[o];a<r&&(Array.isArray(l)||l!=null&&l[Symbol.isConcatSpreadable]||l!==null&&typeof l=="object"&&Object.prototype.toString.call(l)==="[object Arguments]")?Array.isArray(l)?s(l,a+1):s(Array.from(l),a+1):n.push(l)}};return s(Array.from(e),0),n}function po(e,t=1){return Hi(e,t)}function Ra(e,t){if(!e)return[];const n=Y(e)||Array.isArray(e)?Lr(0,e.length):Object.keys(e),r=ie(t??ue),s=new Array(n.length);for(let i=0;i<n.length;i++){const a=n[i],o=e[a];s[i]=r(o,a,e)}return s}function rr(e){return e==null}function xy(e,t){if(rr(e))return[];const n=rr(t)?Ra(e):Ra(e,t);return po(n,1)}function Kl(e,t=ue,n=1){if(e==null)return[];const r=ie(t),s=Ra(e,r);return Hi(s,n)}function by(e,t){return Kl(e,t,1/0)}function $y(e){return po(e,1/0)}function Ty(e,t){const n={};for(let r=0;r<e.length;r++){const s=e[r],i=t(s);Object.hasOwn(n,i)||(n[i]=[]),n[i].push(s)}return n}function _y(e,t){if(e==null)return{};const n=Y(e)?Array.from(e):Object.values(e),r=ie(t??ue);return Ty(n,r)}function Sy(e,t,n,r){if(e==null)return!1;if(r||!n?n=0:n=nt(n),ho(e))return n>e.length||t instanceof RegExp?!1:(n<0&&(n=Math.max(0,e.length+n)),e.includes(t,n));if(Array.isArray(e))return e.includes(t,n);const s=Object.keys(e);n<0&&(n=Math.max(0,s.length+n));for(let i=n;i<s.length;i++){const a=Reflect.get(e,s[i]);if(mt(a,t))return!0}return!1}function zy(e,t,n){if(!Y(e))return-1;if(Number.isNaN(t)){n=n??0,n<0&&(n=Math.max(0,e.length+n));for(let r=n;r<e.length;r++)if(Number.isNaN(e[r]))return r;return-1}return Array.from(e).indexOf(t,n)}function ky(e){return e.slice(0,-1)}function My(e){return Y(e)?ky(Array.from(e)):[]}function Py(e,t){const n=new Set(t);return e.filter(r=>n.has(r))}function qs(e){return[...new Set(e)]}function Iy(...e){if(e.length===0)return[];if(!be(e[0]))return[];let t=qs(Array.from(e[0]));for(let n=1;n<e.length;n++){const r=e[n];if(!be(r))return[];t=Py(t,Array.from(r))}return t}function Co(e,t,n){const r=new Set(t.map(n));return e.filter(s=>r.has(n(s)))}function $h(e,...t){if(!be(e))return[];const n=co(t);if(n===void 0)return Array.from(e);let r=qs(Array.from(e));const s=be(n)?t.length:t.length-1;for(let i=0;i<s;++i){const a=t[i];if(!be(a))return[];be(n)?r=Co(r,Array.from(a),ue):typeof n=="function"?r=Co(r,Array.from(a),o=>n(o)):typeof n=="string"&&(r=Co(r,Array.from(a),Dn(n)))}return r}function By(e,t,n){return e.filter(r=>t.some(s=>n(r,s)))}function Ql(e){return Y(e)?qs(Array.from(e)):[]}function Th(e,...t){if(e==null)return[];const n=Vr(t);let r=mt,s=Ql;typeof n=="function"&&(r=n,s=Ey,t.pop());let i=s(Array.from(e));for(let a=0;a<t.length;++a){const o=t[a];if(o==null)return[];i=By(i,Array.from(o),r)}return i}function Ey(e){const t=[],n=new Set;for(let r=0;r<e.length;r++){const s=e[r];n.has(s)||(t.push(s),n.add(s))}return t}function Fr(e){return typeof e=="function"}function Ay(e,t,...n){if(rr(e))return[];const r=Y(e)?Array.from(e):Object.values(e),s=[];for(let i=0;i<r.length;i++){const a=r[i];if(Fr(t)){s.push(t.apply(a,n));continue}const o=It(a,t);let l=a;if(Array.isArray(t)){const u=t.slice(0,-1);u.length>0&&(l=It(a,u))}else if(typeof t=="string"&&t.includes(".")){const c=t.split(".").slice(0,-1).join(".");l=It(a,c)}s.push(o==null?void 0:o.apply(l,n))}return s}function Oy(e,t){return Y(e)?Array.from(e).join(t):""}function _h(e,t=ue,n){if(!e)return n;let r,s=0;Y(e)?(r=Lr(0,e.length),n==null&&e.length>0&&(n=e[0],s+=1)):(r=Object.keys(e),n==null&&(n=e[r[0]],s+=1));for(let i=s;i<r.length;i++){const a=r[i],o=e[a];n=t(n,o,a,e)}return n}function Uy(e,t){if(!Y(e)&&!Ur(e))return{};const n=ie(t??ue);return _h(e,(r,s)=>{const i=n(s);return r[i]=s,r},{})}function Ry(e,t,n){if(!Y(e)||e.length===0)return-1;const r=e.length;let s=n??r-1;if(n!=null&&(s=s<0?Math.max(r+s,0):Math.min(s,r-1)),Number.isNaN(t)){for(let i=s;i>=0;i--)if(Number.isNaN(e[i]))return i}return Array.from(e).lastIndexOf(t,s)}function Cy(e,t=0){if(!(!be(e)||e.length===0))return t=nt(t),t<0&&(t+=e.length),e[t]}function nc(e){return typeof e=="symbol"?1:e===null?2:e===void 0?3:e!==e?4:0}const Vy=(e,t,n)=>{if(e!==t){const r=nc(e),s=nc(t);if(r===s&&r===0){if(e<t)return n==="desc"?1:-1;if(e>t)return n==="desc"?-1:1}return n==="desc"?s-r:r-s}return 0},Ly=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Fy=/^\w*$/;function mo(e,t){return Array.isArray(e)?!1:typeof e=="number"||typeof e=="boolean"||e==null||Rr(e)?!0:typeof e=="string"&&(Fy.test(e)||!Ly.test(e))||t!=null&&Object.hasOwn(t,e)}function Sh(e,t,n,r){if(e==null)return[];n=r?void 0:n,Array.isArray(e)||(e=Object.values(e)),Array.isArray(t)||(t=t==null?[null]:[t]),t.length===0&&(t=[null]),Array.isArray(n)||(n=n==null?[]:[n]),n=n.map(l=>String(l));const s=(l,u)=>{let c=l;for(let f=0;f<u.length&&c!=null;++f)c=c[u[f]];return c},i=(l,u)=>u==null||l==null?u:typeof l=="object"&&"key"in l?Object.hasOwn(u,l.key)?u[l.key]:s(u,l.path):typeof l=="function"?l(u):Array.isArray(l)?s(u,l):typeof u=="object"?u[l]:u,a=t.map(l=>(Array.isArray(l)&&l.length===1&&(l=l[0]),l==null||typeof l=="function"||Array.isArray(l)||mo(l)?l:{key:l,path:Mn(l)}));return e.map(l=>({original:l,criteria:a.map(u=>i(u,l))})).slice().sort((l,u)=>{for(let c=0;c<a.length;c++){const f=Vy(l.criteria[c],u.criteria[c],n[c]);if(f!==0)return f}return 0}).map(l=>l.original)}function Gy(e,t=ue){if(!e)return[[],[]];const n=Y(e)?e:Object.values(e);t=ie(t);const r=[],s=[];for(let i=0;i<n.length;i++){const a=n[i];t(a)?r.push(a):s.push(a)}return[r,s]}function zh(e,t){const n=new Set(t);let r=0;for(let s=0;s<e.length;s++)if(!n.has(e[s])){if(!Object.hasOwn(e,s)){delete e[r++];continue}e[r++]=e[s]}return e.length=r,e}function Ny(e,...t){return zh(e,t)}function Dy(e,t=[]){return zh(e,Array.from(t))}function jy(e,t,n){const r=ie(n),s=new Set(Array.from(t).map(a=>r(a)));let i=0;for(let a=0;a<e.length;a++){const o=r(e[a]);if(!s.has(o)){if(!Object.hasOwn(e,a)){delete e[i++];continue}e[i++]=e[a]}}return e.length=i,e}function Wy(e,t){const n=e.length;t==null&&(t=Array(n));for(let r=0;r<n;r++)t[r]=e[r];return t}function qy(e,t,n){if((e==null?void 0:e.length)==null||(t==null?void 0:t.length)==null)return e;e===t&&(t=Wy(t));let r=0;n==null&&(n=(a,o)=>mt(a,o));const s=Array.isArray(t)?t:Array.from(t),i=s.includes(void 0);for(let a=0;a<e.length;a++){if(a in e){s.some(l=>n(e[a],l))||(e[r++]=e[a]);continue}i||delete e[r++]}return e.length=r,e}function kh(e,...t){if(t.length===0)return[];const n=[];for(let s=0;s<t.length;s++){const i=t[s];if(!Y(i)||ho(i)){n.push(i);continue}for(let a=0;a<i.length;a++)n.push(i[a])}const r=[];for(let s=0;s<n.length;s++)r.push(It(e,n[s]));return r}function Ca(e,t){if(e==null)return!0;switch(typeof t){case"symbol":case"number":case"object":{if(Array.isArray(t))return rc(e,t);if(typeof t=="number"?t=lr(t):typeof t=="object"&&(Object.is(t==null?void 0:t.valueOf(),-0)?t="-0":t=String(t)),nr(t))return!1;if((e==null?void 0:e[t])===void 0)return!0;try{return delete e[t],!0}catch{return!1}}case"string":{if((e==null?void 0:e[t])===void 0&&qi(t))return rc(e,Mn(t));if(nr(t))return!1;try{return delete e[t],!0}catch{return!1}}}}function rc(e,t){const n=t.length===1?e:It(e,t.slice(0,-1)),r=t[t.length-1];if((n==null?void 0:n[r])===void 0)return!0;if(nr(r))return!1;try{return delete n[r],!0}catch{return!1}}function sr(e){return Array.isArray(e)}function Yy(e,...t){const n=po(t,1);if(!e)return Array(n.length);const r=kh(e,n),s=n.map(i=>Gs(i,e.length)?Number(i):i).sort((i,a)=>a-i);for(const i of new Set(s)){if(Gs(i,e.length)){Array.prototype.splice.call(e,i,1);continue}if(mo(i,e)){delete e[lr(i)];continue}const a=sr(i)?i:Mn(i);Ca(e,a)}return r}function Xy(e,t=ue,n){if(!e)return n;let r,s;Y(e)?(r=Lr(0,e.length).reverse(),n==null&&e.length>0?(n=e[e.length-1],s=1):s=0):(r=Object.keys(e).reverse(),n==null?(n=e[r[0]],s=1):s=0);for(let i=s;i<r.length;i++){const a=r[i],o=e[a];n=t(n,o,a,e)}return n}function Jl(e){if(typeof e!="function")throw new TypeError("Expected a function");return function(...t){return!e.apply(this,t)}}function Zy(e,t=ue){return bh(e,Jl(ie(t)))}function Hy(e,t){const n=e.slice(),r=[];let s=0;for(let i=0;i<e.length;i++){if(t(e[i],i,n)){r.push(e[i]);continue}if(!Object.hasOwn(e,i)){delete e[s++];continue}e[s++]=e[i]}return e.length=s,r}function Ky(e,t=ue){return Hy(e,ie(t))}function Qy(e){return e==null?e:e.reverse()}function sc(e){const t=Math.floor(Math.random()*e.length);return e[t]}function Jy(e){if(e!=null)return Y(e)?sc(At(e)):sc(Object.values(e))}function Mh(e,t){if(t==null&&(t=e,e=0),e>=t)throw new Error("Invalid input: The maximum value must be greater than the minimum value.");return Math.random()*(t-e)+e}function Ph(e,t){return Math.floor(Mh(e,t))}function eg(e,t){if(t>e.length)throw new Error("Size must be less than or equal to the length of array.");const n=new Array(t),r=new Set;for(let s=e.length-t,i=0;s<e.length;s++,i++){let a=Ph(0,s+1);r.has(a)&&(a=s),r.add(a),n[i]=e[a]}return n}function tg(e,t,n){return n==null?Math.min(e,t):Math.min(Math.max(e,t),n)}function Ds(e,t,n){return Number.isNaN(t)&&(t=0),Number.isNaN(n)&&(n=0),tg(e,t,n)}function ng(e){return e instanceof Map}function Ih(e){return ng(e)}function eu(e){return e==null?[]:Y(e)||Ih(e)?Array.from(e):typeof e=="object"?Object.values(e):[]}function rg(e,t,n){const r=eu(e);return(n?Ln(e,t,n):t===void 0)?t=1:t=Ds(nt(t),0,r.length),eg(r,t)}function Vo(e){const t=e.slice();for(let n=t.length-1;n>=1;n--){const r=Math.floor(Math.random()*(n+1));[t[n],t[r]]=[t[r],t[n]]}return t}function Bh(e){return e==null?[]:Object.values(e)}function yo(e){return e==null}function sg(e){return yo(e)?[]:sr(e)?Vo(e):Y(e)?Vo(Array.from(e)):Ur(e)?Vo(Bh(e)):[]}function ig(e){return rr(e)?0:e instanceof Map||e instanceof Set?e.size:Object.keys(e).length}function ag(e,t,n){if(!Y(e))return[];const r=e.length;n===void 0?n=r:typeof n!="number"&&Ln(e,t,n)&&(t=0,n=r),t=nt(t),n=nt(n),t<0?t=Math.max(r+t,0):t=Math.min(t,r),n<0?n=Math.max(r+n,0):n=Math.min(n,r);const s=Math.max(n-t,0),i=new Array(s);for(let a=0;a<s;++a)i[a]=e[t+a];return i}function og(e,t,n){if(!e)return!1;n!=null&&(t=void 0),t==null&&(t=ue);const r=Array.isArray(e)?e:Object.values(e);switch(typeof t){case"function":{if(!Array.isArray(e)){const s=Object.keys(e);for(let i=0;i<s.length;i++){const a=s[i],o=e[a];if(t(o,a,e))return!0}return!1}for(let s=0;s<e.length;s++)if(t(e[s],s,e))return!0;return!1}case"object":if(Array.isArray(t)&&t.length===2){const s=t[0],i=t[1],a=cr(s,i);if(Array.isArray(e)){for(let o=0;o<e.length;o++)if(a(e[o]))return!0;return!1}return r.some(a)}else{const s=ur(t);if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(s(e[i]))return!0;return!1}return r.some(s)}case"number":case"symbol":case"string":{const s=Dn(t);if(Array.isArray(e)){for(let i=0;i<e.length;i++)if(s(e[i]))return!0;return!1}return r.some(s)}}}function lg(e,...t){const n=t.length;return n>1&&Ln(e,t[0],t[1])?t=[]:n>2&&Ln(t[0],t[1],t[2])&&(t=[t[0]]),Sh(e,to(t),["asc"])}function Va(e){return e===null}function el(e){return e===void 0}function Gr(e){return e}function tl(e){return Number.isNaN(e)}const ug=4294967295,cg=ug-1;function tu(e,t,n=Gr,r){if(yo(e)||e.length===0)return 0;let s=0,i=e.length;const a=ie(n),o=a(t),l=tl(o),u=Va(o),c=Rr(o),f=el(o);for(;s<i;){let h;const d=Math.floor((s+i)/2),p=a(e[d]),y=!el(p),T=Va(p),z=!tl(p),U=Rr(p);l?h=r||z:f?h=z&&(r||y):u?h=z&&y&&(r||!T):c?h=z&&y&&!T&&(r||!U):T||U?h=!1:h=r?p<=o:p<o,h?s=d+1:i=d}return Math.min(i,cg)}function Eh(e){return typeof e=="symbol"}function nu(e){return typeof e=="number"||e instanceof Number}const fg=4294967295,hg=fg>>>1;function Ah(e,t){if(rr(e))return 0;let n=0,r=e.length;if(nu(t)&&t===t&&r<=hg){for(;n<r;){const s=n+r>>>1,i=e[s];!Va(i)&&!Eh(i)&&i<t?n=s+1:r=s}return r}return tu(e,t,s=>s)}function pg(e,t){if(!(e!=null&&e.length))return-1;const n=Ah(e,t);return n<e.length&&mt(e[n],t)?n:-1}function Oh(e,t,n){return tu(e,t,n,!0)}const dg=4294967295,mg=dg>>>1;function Uh(e,t){if(rr(e))return 0;let n=e.length;if(!nu(t)||Number.isNaN(t)||n>mg)return Oh(e,t,s=>s);let r=0;for(;r<n;){const s=r+n>>>1,i=e[s];!Va(i)&&!Eh(i)&&i<=t?r=s+1:n=s}return n}function yg(e,t){if(!(e!=null&&e.length))return-1;const n=Uh(e,t)-1;return n>=0&&mt(e[n],t)?n:-1}function gg(e){return e.slice(1)}function wg(e){return Y(e)?gg(At(e)):[]}function vg(e,t,n){return t=t===void 0?1:nt(t),e.slice(0,t)}function xg(e,t=1,n){return t=n?1:nt(t),t<1||!Y(e)?[]:vg(At(e),t)}function bg(e,t,n){return t=t===void 0?1:nt(t),t<=0||e.length===0?[]:e.slice(-t)}function $g(e,t=1,n){return t=n?1:nt(t),t<=0||!Y(e)?[]:bg(At(e),t)}function Tg(e){return(...t)=>!e(...t)}function _g(e,t){if(!be(e))return[];const n=At(e),r=n.findLastIndex(Tg(ie(t??ue)));return n.slice(r+1)}function Sg(e,t){if(!be(e))return[];const n=At(e),r=n.findIndex(Jl(ie(t??Gr)));return r===-1?n:n.slice(0,r)}function zg(...e){const t=e.filter(be),n=Kl(t,r=>Array.from(r),1);return qs(n)}function Rh(e,t){const n=new Map;for(let r=0;r<e.length;r++){const s=e[r],i=t(s);n.has(i)||n.set(i,s)}return Array.from(n.values())}function nl(...e){const t=co(e),n=fo(e);return be(t)||t==null?qs(n):Rh(n,ie(t))}function Ch(e,t){const n=[];for(let r=0;r<e.length;r++){const s=e[r];n.every(a=>!t(a,s))&&n.push(s)}return n}function rl(...e){const t=co(e),n=fo(e);return be(t)||t==null?qs(n):Ch(n,t)}function kg(e,t=ue){return be(e)?Rh(Array.from(e),ie(t)):[]}function Mg(e,t){return Y(e)?typeof t=="function"?Ch(Array.from(e),t):Ql(Array.from(e)):[]}function sl(e){let t=0;for(let r=0;r<e.length;r++)e[r].length>t&&(t=e[r].length);const n=new Array(t);for(let r=0;r<t;r++){n[r]=new Array(e.length);for(let s=0;s<e.length;s++)n[r][s]=e[s][r]}return n}function Vh(e){return!be(e)||!e.length?[]:(e=sr(e)?e:Array.from(e),e=e.filter(t=>be(t)),sl(e))}function Pg(e,t){if(!be(e)||!e.length)return[];const n=sr(e)?sl(e):sl(Array.from(e,s=>Array.from(s)));if(!t)return n;const r=new Array(n.length);for(let s=0;s<n.length;s++){const i=n[s];r[s]=t(...i)}return r}function Ig(e,...t){return uo(e,t)}function Bg(e,...t){return be(e)?Ig(Array.from(e),...t):[]}function Eg(...e){const t=new Map;for(let r=0;r<e.length;r++){const s=e[r];if(!be(s))continue;const i=new Set(eu(s));for(const a of i)t.has(a)?t.set(a,t.get(a)+1):t.set(a,1)}const n=[];for(const[r,s]of t)s===1&&n.push(r);return n}function Lh(e,t,n=1,{partialWindows:r=!1}={}){if(!Number.isInteger(t))throw new Error("Size must be a positive integer.");if(n<=0||!Number.isInteger(n))throw new Error("Step must be a positive integer.");const s=[],i=r?e.length:e.length-t+1;for(let a=0;a<i;a+=n)s.push(e.slice(a,a+t));return s}function Ag(...e){const t=Vr(e);let n=ue;!be(t)&&t!=null&&(n=ie(t),e=e.slice(0,-1));const r=e.filter(be),s=nl(...r,n),i=Lh(r,2).map(([a,o])=>$h(a,o,n));return vh(s,nl(...i,n),n)}function Og(...e){const t=Vr(e);let n=(a,o)=>a===o;typeof t=="function"&&(n=t,e=e.slice(0,-1));const r=e.filter(be),s=rl(...r,n),i=Lh(r,2).map(([a,o])=>Th(a,o,n));return xh(s,rl(...i,n),n)}function Fh(...e){let t=0;for(let s=0;s<e.length;s++)e[s].length>t&&(t=e[s].length);const n=e.length,r=Array(t);for(let s=0;s<t;++s){const i=Array(n);for(let a=0;a<n;++a)i[a]=e[a][s];r[s]=i}return r}function Ug(...e){return e.length?Fh(...e.filter(t=>be(t))):[]}const ru=(e,t,n)=>{const r=e[t];(!(Object.hasOwn(e,t)&&mt(r,n))||n===void 0&&!(t in e))&&(e[t]=n)};function Rg(e=[],t=[]){const n={};for(let r=0;r<e.length;r++)ru(n,e[r],t[r]);return n}function go(e,t,n,r){if(e==null&&!ln(e))return e;let s;mo(t,e)?s=[t]:Array.isArray(t)?s=t:s=Mn(t);const i=n(It(e,s));let a=e;for(let o=0;o<s.length&&a!=null;o++){const l=lr(s[o]);if(nr(l))continue;let u;if(o===s.length-1)u=i;else{const c=a[l],f=r==null?void 0:r(c,l,e);u=f!==void 0?f:ln(c)?c:Gs(s[o+1])?[]:{}}ru(a,l,u),a=a[l]}return e}function su(e,t,n){return go(e,t,()=>n,()=>{})}function Cg(e,t){const n={};if(!Y(e))return n;Y(t)||(t=[]);const r=Fh(Array.from(e),Array.from(t));for(let s=0;s<r.length;s++){const[i,a]=r[s];i!=null&&su(n,i,a)}return n}function Vg(...e){let t=e.pop();if(Fr(t)||(e.push(t),t=void 0),!(e!=null&&e.length))return[];const n=Vh(e);return t==null?n:n.map(r=>t(...r))}function Lg(e,t){if(typeof t!="function")throw new TypeError("Expected a function");return e=nt(e),function(...n){if(--e<1)return t.apply(this,n)}}function Fg(e,t){return function(...n){return e.apply(this,n.slice(0,t))}}function Gh(e,t=e.length,n){return n&&(t=e.length),(Number.isNaN(t)||t<0)&&(t=0),Fg(e,t)}function Nh(e,...t){try{return e(...t)}catch(n){return n instanceof Error?n:new Error(n)}}function Gg(e,t){if(typeof t!="function")throw new TypeError("Expected a function");let n;return e=nt(e),function(...r){return--e>0&&(n=t.apply(this,r)),e<=1&&t&&(t=void 0),n}}function iu(e,t,...n){const r=function(...s){const i=[];let a=0;for(let o=0;o<n.length;o++){const l=n[o];l===iu.placeholder?i.push(s[a++]):i.push(l)}for(let o=a;o<s.length;o++)i.push(s[o]);return this instanceof r?new e(...i):e.apply(t,i)};return r}const Ng=Symbol("bind.placeholder");iu.placeholder=Ng;function au(e,t,...n){const r=function(...s){const i=[];let a=0;for(let o=0;o<n.length;o++){const l=n[o];l===au.placeholder?i.push(s[a++]):i.push(l)}for(let o=a;o<s.length;o++)i.push(s[o]);return this instanceof r?new e[t](...i):e[t].apply(e,i)};return r}const Dg=Symbol("bindKey.placeholder");au.placeholder=Dg;function Ki(e,t=e.length,n){t=n?e.length:t,t=Number.parseInt(t,10),(Number.isNaN(t)||t<1)&&(t=0);const r=function(...s){const i=s.filter(o=>o===Ki.placeholder),a=s.length-i.length;return a<t?Dh(e,t-a,s):this instanceof r?new e(...s):e.apply(this,s)};return r.placeholder=ou,r}function Dh(e,t,n){function r(...s){const i=s.filter(o=>o===Ki.placeholder),a=s.length-i.length;return s=jg(s,n),a<t?Dh(e,t-a,s):this instanceof r?new e(...s):e.apply(this,s)}return r.placeholder=ou,r}function jg(e,t){const n=[];let r=0;for(let s=0;s<t.length;s++){const i=t[s];i===Ki.placeholder&&r<e.length?n.push(e[r++]):n.push(i)}for(let s=r;s<e.length;s++)n.push(e[s]);return n}const ou=Symbol("curry.placeholder");Ki.placeholder=ou;function js(e,t=e.length,n){t=n?e.length:t,t=Number.parseInt(t,10),(Number.isNaN(t)||t<1)&&(t=0);const r=function(...s){const i=s.filter(o=>o===js.placeholder),a=s.length-i.length;return a<t?jh(e,t-a,s):this instanceof r?new e(...s):e.apply(this,s)};return r.placeholder=lu,r}function jh(e,t,n){function r(...s){const i=s.filter(o=>o===js.placeholder),a=s.length-i.length;return s=Wg(s,n),a<t?jh(e,t-a,s):this instanceof r?new e(...s):e.apply(this,s)}return r.placeholder=lu,r}function Wg(e,t){const n=t.filter(a=>a===js.placeholder).length,r=Math.max(e.length-n,0),s=[];let i=0;for(let a=0;a<r;a++)s.push(e[i++]);for(let a=0;a<t.length;a++){const o=t[a];o===js.placeholder&&i<e.length?s.push(e[i++]):s.push(o)}return s}const lu=Symbol("curryRight.placeholder");js.placeholder=lu;function qg(e,t,{signal:n,edges:r}={}){let s,i=null;const a=r!=null&&r.includes("leading"),o=r==null||r.includes("trailing"),l=()=>{i!==null&&(e.apply(s,i),s=void 0,i=null)},u=()=>{o&&l(),d()};let c=null;const f=()=>{c!=null&&clearTimeout(c),c=setTimeout(()=>{c=null,u()},t)},h=()=>{c!==null&&(clearTimeout(c),c=null)},d=()=>{h(),s=void 0,i=null},p=()=>{l()},y=function(...T){if(n!=null&&n.aborted)return;s=this,i=T;const z=c==null;f(),a&&z&&l()};return y.schedule=f,y.cancel=d,y.flush=p,n==null||n.addEventListener("abort",d,{once:!0}),y}function uu(e,t=0,n={}){typeof n!="object"&&(n={});const{leading:r=!1,trailing:s=!0,maxWait:i}=n,a=Array(2);r&&(a[0]="leading"),s&&(a[1]="trailing");let o,l=null;const u=qg(function(...h){o=e.apply(this,h),l=null},t,{edges:a}),c=function(...h){return i!=null&&(l===null&&(l=Date.now()),Date.now()-l>=i)?(o=e.apply(this,h),l=Date.now(),u.cancel(),u.schedule(),o):(u.apply(this,h),o)},f=()=>(u.flush(),o);return c.cancel=u.cancel,c.flush=f,c}function Yg(e,...t){if(typeof e!="function")throw new TypeError("Expected a function");return setTimeout(e,1,...t)}function Xg(e,t,...n){if(typeof e!="function")throw new TypeError("Expected a function");return setTimeout(e,tt(t)||0,...n)}function Zg(e){return function(...t){return e.apply(this,t.reverse())}}function Wh(...e){return function(...t){let n=e.length?e[0].apply(this,t):t[0];for(let r=1;r<e.length;r++)n=e[r].call(this,n);return n}}function Hg(...e){const t=to(e,1);if(t.some(n=>typeof n!="function"))throw new TypeError("Expected a function");return Wh(...t)}function Kg(...e){return Wh(...e.reverse())}function Qg(...e){const t=to(e,1);if(t.some(n=>typeof n!="function"))throw new TypeError("Expected a function");return Kg(...t)}function wo(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");const n=function(...s){const i=t?t.apply(this,s):s[0],a=n.cache;if(a.has(i))return a.get(i);const o=e.apply(this,s);return n.cache=a.set(i,o)||a,o},r=wo.Cache||Map;return n.cache=new r,n}wo.Cache=Map;function Jg(e=0){return function(...t){return t.at(nt(e))}}function ew(e){let t=!1,n;return function(...r){return t||(t=!0,n=e(...r)),n}}function tw(e){return ew(e)}function nw(e,...t){if(typeof e!="function")throw new TypeError("Expected a function");const n=t.flat();return function(...r){const s=Math.min(r.length,n.length),i=[...r];for(let a=0;a<s;a++){const o=ie(n[a]??ue);i[a]=o.call(this,r[a])}return e.apply(this,i)}}function rw(e,t,...n){const r=function(...s){let i=0;const a=n.slice().map(l=>l===t?s[i++]:l),o=s.slice(i);return e.apply(this,a.concat(o))};return e.prototype&&(r.prototype=Object.create(e.prototype)),r}function cu(e,...t){return rw(e,cu.placeholder,...t)}cu.placeholder=Symbol("compat.partial.placeholder");function sw(e,t,...n){const r=function(...s){const i=n.filter(c=>c===t).length,a=Math.max(s.length-i,0),o=s.slice(0,a);let l=a;const u=n.slice().map(c=>c===t?s[l++]:c);return e.apply(this,o.concat(u))};return e.prototype&&(r.prototype=Object.create(e.prototype)),r}function fu(e,...t){return sw(e,fu.placeholder,...t)}fu.placeholder=Symbol("compat.partialRight.placeholder");function iw(e,...t){const n=Hi(t);return function(...r){const s=n.map(i=>r[i]).slice(0,r.length);for(let i=s.length;i<r.length;i++)s.push(r[i]);return e.apply(this,s)}}function aw(e,t=e.length-1){return function(...n){const r=n.slice(t),s=n.slice(0,t);for(;s.length<t;)s.push(void 0);return e.apply(this,[...s,r])}}function ow(e,t=e.length-1){return t=Number.parseInt(t,10),(Number.isNaN(t)||t<0)&&(t=e.length-1),aw(e,t)}function lw(e,t=0){return t=Number.parseInt(t,10),(Number.isNaN(t)||t<0)&&(t=0),function(...n){const r=n[t],s=n.slice(0,t);return r&&s.push(...r),e.apply(this,s)}}function uw(e,t=0,n={}){const{leading:r=!0,trailing:s=!0}=n;return uu(e,t,{leading:r,maxWait:t,trailing:s})}function cw(e){return Gh(e,1)}function fw(e,t){return function(...n){return(Fr(t)?t:ue).apply(this,[e,...n])}}function hw(e,t){return e===void 0&&t===void 0?0:e===void 0||t===void 0?e??t:(typeof e=="string"||typeof t=="string"?(e=me(e),t=me(t)):(e=tt(e),t=tt(t)),e+t)}function hu(e,t,n=0){if(t=Number(t),Object.is(t,-0)&&(t="-0"),n=Math.min(Number.parseInt(n,10),292),n){const[r,s=0]=t.toString().split("e");let i=Math[e](+`${r}e${Number(s)+n}`);Object.is(i,-0)&&(i="-0");const[a,o=0]=i.toString().split("e");return+`${a}e${Number(o)-n}`}return Math[e](Number(t))}function pw(e,t=0){return hu("ceil",e,t)}function dw(e,t){return e===void 0&&t===void 0?1:e===void 0||t===void 0?e??t:(typeof e=="string"||typeof t=="string"?(e=me(e),t=me(t)):(e=tt(e),t=tt(t)),e/t)}function mw(e,t=0){return hu("floor",e,t)}function yw(e,t,n){if(n==null&&(n=t,t=0),t>=n)throw new Error("The maximum value must be greater than the minimum value.");return t<=e&&e<n}function gw(e,t,n){return t||(t=0),n!=null&&!n&&(n=0),t!=null&&typeof t!="number"&&(t=Number(t)),n==null&&t===0||(n!=null&&typeof n!="number"&&(n=Number(n)),n!=null&&t>n&&([t,n]=[n,t]),t===n)?!1:yw(e,t,n)}function ww(e){if(!e||e.length===0)return;let t;for(let n=0;n<e.length;n++){const r=e[n];r==null||Number.isNaN(r)||typeof r=="symbol"||(t===void 0||r>t)&&(t=r)}return t}function vw(e,t){if(e.length===0)return;let n=e[0],r=t(n);for(let s=1;s<e.length;s++){const i=e[s],a=t(i);a>r&&(r=a,n=i)}return n}function xw(e,t){if(e!=null)return vw(Array.from(e),ie(t??ue))}function qh(e,t){if(!e||!e.length)return 0;t!=null&&(t=ie(t));let n;for(let r=0;r<e.length;r++){const s=t?t(e[r]):e[r];s!==void 0&&(n===void 0?n=s:n+=s)}return n}function Yh(e){return qh(e)}function bw(e){const t=e?e.length:0;return t===0?NaN:Yh(e)/t}function $w(e,t){let n=0;for(let r=0;r<e.length;r++)n+=t(e[r],r);return n}function Tw(e,t){return $w(e,n=>t(n))/e.length}function _w(e,t){return e==null?NaN:Tw(Array.from(e),ie(t??ue))}function Sw(e){if(!e||e.length===0)return;let t;for(let n=0;n<e.length;n++){const r=e[n];r==null||Number.isNaN(r)||typeof r=="symbol"||(t===void 0||r<t)&&(t=r)}return t}function zw(e,t){if(e.length===0)return;let n=e[0],r=t(n);for(let s=1;s<e.length;s++){const i=e[s],a=t(i);a<r&&(r=a,n=i)}return n}function kw(e,t){if(e!=null)return zw(Array.from(e),ie(t??ue))}function Mw(e,t){return e===void 0&&t===void 0?1:e===void 0||t===void 0?e??t:(typeof e=="string"||typeof t=="string"?(e=me(e),t=me(t)):(e=tt(e),t=tt(t)),e*t)}function Pw(e,t=0,n){return n&&(t=0),Number.parseInt(e,t)}function Iw(...e){let t=0,n=1,r=!1;switch(e.length){case 1:{typeof e[0]=="boolean"?r=e[0]:n=e[0];break}case 2:typeof e[1]=="boolean"?(n=e[0],r=e[1]):(t=e[0],n=e[1]);case 3:typeof e[2]=="object"&&e[2]!=null&&e[2][e[1]]===e[0]?(t=0,n=e[0],r=!1):(t=e[0],n=e[1],r=e[2])}return typeof t!="number"&&(t=Number(t)),typeof n!="number"&&(t=Number(n)),t||(t=0),n||(n=0),t>n&&([t,n]=[n,t]),t=Ds(t,-Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),n=Ds(n,-Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER),t===n?t:r?Mh(t,n+1):Ph(t,n+1)}function Bw(e,t,n){n&&typeof n!="number"&&Ln(e,t,n)&&(t=n=void 0),e=er(e),t===void 0?(t=e,e=0):t=er(t),n=n===void 0?e<t?1:-1:er(n);const r=Math.max(Math.ceil((t-e)/(n||1)),0),s=new Array(r);for(let i=0;i<r;i++)s[i]=e,e+=n;return s}function Ew(e,t,n){n&&typeof n!="number"&&Ln(e,t,n)&&(t=n=void 0),e=er(e),t===void 0?(t=e,e=0):t=er(t),n=n===void 0?e<t?1:-1:er(n);const r=Math.max(Math.ceil((t-e)/(n||1)),0),s=new Array(r);for(let i=r-1;i>=0;i--)s[i]=e,e+=n;return s}function Aw(e,t=0){return hu("round",e,t)}function Ow(e,t){return e===void 0&&t===void 0?0:e===void 0||t===void 0?e??t:(typeof e=="string"||typeof t=="string"?(e=me(e),t=me(t)):(e=tt(e),t=tt(t)),e-t)}function ic(e){if(!e||typeof e!="object")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype||Object.getPrototypeOf(t)===null?Object.prototype.toString.call(e)==="[object Object]":!1}function Xh(e,t,n){return di(e,t,void 0,void 0,void 0,void 0,n)}function di(e,t,n,r,s,i,a){const o=a(e,t,n,r,s,i);if(o!==void 0)return o;if(typeof e==typeof t)switch(typeof e){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return e===t;case"number":return e===t||Object.is(e,t);case"function":return e===t;case"object":return xi(e,t,i,a)}return xi(e,t,i,a)}function xi(e,t,n,r){if(Object.is(e,t))return!0;let s=Or(e),i=Or(t);if(s===Fs&&(s=vi),i===Fs&&(i=vi),s!==i)return!1;switch(s){case Ls:return e.toString()===t.toString();case Xi:{const l=e.valueOf(),u=t.valueOf();return mt(l,u)}case Zi:case so:case ro:return Object.is(e.valueOf(),t.valueOf());case no:return e.source===t.source&&e.flags===t.flags;case Ym:return e===t}n=n??new Map;const a=n.get(e),o=n.get(t);if(a!=null&&o!=null)return a===t;n.set(e,t),n.set(t,e);try{switch(s){case io:{if(e.size!==t.size)return!1;for(const[l,u]of e.entries())if(!t.has(l)||!di(u,t.get(l),l,e,t,n,r))return!1;return!0}case ao:{if(e.size!==t.size)return!1;const l=Array.from(e.values()),u=Array.from(t.values());for(let c=0;c<l.length;c++){const f=l[c],h=u.findIndex(d=>di(f,d,void 0,e,t,n,r));if(h===-1)return!1;u.splice(h,1)}return!0}case Vl:case Ll:case Fl:case Gl:case Nl:case Zm:case Dl:case jl:case Wl:case Hm:case ql:case Yl:{if(typeof Buffer<"u"&&Buffer.isBuffer(e)!==Buffer.isBuffer(t)||e.length!==t.length)return!1;for(let l=0;l<e.length;l++)if(!di(e[l],t[l],l,e,t,n,r))return!1;return!0}case oo:return e.byteLength!==t.byteLength?!1:xi(new Uint8Array(e),new Uint8Array(t),n,r);case lo:return e.byteLength!==t.byteLength||e.byteOffset!==t.byteOffset?!1:xi(new Uint8Array(e),new Uint8Array(t),n,r);case Xm:return e.name===t.name&&e.message===t.message;case vi:{if(!(xi(e.constructor,t.constructor,n,r)||ic(e)&&ic(t)))return!1;const u=[...Object.keys(e),...Ii(e)],c=[...Object.keys(t),...Ii(t)];if(u.length!==c.length)return!1;for(let f=0;f<u.length;f++){const h=u[f],d=e[h];if(!Object.hasOwn(t,h))return!1;const p=t[h];if(!di(d,p,h,e,t,n,r))return!1}return!0}default:return!1}}finally{n.delete(e),n.delete(t)}}function Zh(){}function Uw(e,t){return Xh(e,t,Zh)}function Rw(...e){}function pu(e){return typeof Buffer<"u"&&Buffer.isBuffer(e)}function du(e){const t=e==null?void 0:e.constructor,n=typeof t=="function"?t.prototype:Object.prototype;return e===n}function Nr(e){return Xl(e)}function mu(e,t){if(e=nt(e),e<1||!Number.isSafeInteger(e))return[];const n=new Array(e);for(let r=0;r<e;r++)n[r]=typeof t=="function"?t(r):r;return n}function fr(e){if(Y(e))return Cw(e);const t=Object.keys(Object(e));return du(e)?t.filter(n=>n!=="constructor"):t}function Cw(e){const t=mu(e.length,s=>`${s}`),n=new Set(t);pu(e)&&(n.add("offset"),n.add("parent")),Nr(e)&&(n.add("buffer"),n.add("byteLength"),n.add("byteOffset"));const r=Object.keys(e).filter(s=>!n.has(s));return Array.isArray(e)?[...t,...r]:[...t.filter(s=>Object.hasOwn(e,s)),...r]}function Vw(e,...t){for(let n=0;n<t.length;n++)Lw(e,t[n]);return e}function Lw(e,t){const n=fr(t);for(let r=0;r<n.length;r++){const s=n[r];(!(s in e)||!mt(e[s],t[s]))&&(e[s]=t[s])}}function Pn(e){if(e==null)return[];switch(typeof e){case"object":case"function":return Y(e)?Gw(e):du(e)?Fw(e):La(e);default:return La(Object(e))}}function La(e){const t=[];for(const n in e)t.push(n);return t}function Fw(e){return La(e).filter(n=>n!=="constructor")}function Gw(e){const t=mu(e.length,s=>`${s}`),n=new Set(t);pu(e)&&(n.add("offset"),n.add("parent")),Nr(e)&&(n.add("buffer"),n.add("byteLength"),n.add("byteOffset"));const r=La(e).filter(s=>!n.has(s));return Array.isArray(e)?[...t,...r]:[...t.filter(s=>Object.hasOwn(e,s)),...r]}function ac(e,...t){for(let n=0;n<t.length;n++)Nw(e,t[n]);return e}function Nw(e,t){const n=Pn(t);for(let r=0;r<n.length;r++){const s=n[r];(!(s in e)||!mt(e[s],t[s]))&&(e[s]=t[s])}}function oc(e,...t){let n=t[t.length-1];typeof n=="function"?t.pop():n=void 0;for(let r=0;r<t.length;r++)Dw(e,t[r],n);return e}function Dw(e,t,n){const r=Pn(t);for(let s=0;s<r.length;s++){const i=r[s],a=e[i],o=t[i],l=(n==null?void 0:n(a,o,i,e,t))??o;(!(i in e)||!mt(a,l))&&(e[i]=l)}}function jw(e,...t){let n=t[t.length-1];typeof n=="function"?t.pop():n=void 0;for(let r=0;r<t.length;r++)Ww(e,t[r],n);return e}function Ww(e,t,n){const r=fr(t);for(let s=0;s<r.length;s++){const i=r[s],a=e[i],o=t[i],l=(n==null?void 0:n(a,o,i,e,t))??o;(!(i in e)||!mt(a,l))&&(e[i]=l)}}function il(e){if(Yi(e))return e;const t=Or(e);if(!qw(e))return{};if(sr(e)){const r=Array.from(e);return e.length>0&&typeof e[0]=="string"&&Object.hasOwn(e,"index")&&(r.index=e.index,r.input=e.input),r}if(Nr(e)){const r=e,s=r.constructor;return new s(r.buffer,r.byteOffset,r.length)}if(t===oo)return new ArrayBuffer(e.byteLength);if(t===lo){const r=e,s=r.buffer,i=r.byteOffset,a=r.byteLength,o=new ArrayBuffer(a),l=new Uint8Array(s,i,a);return new Uint8Array(o).set(l),new DataView(o)}if(t===Zi||t===Xi||t===Ls){const r=e.constructor,s=new r(e.valueOf());return t===Ls?Xw(s,e):Lo(s,e),s}if(t===so)return new Date(Number(e));if(t===no){const r=e,s=new RegExp(r.source,r.flags);return s.lastIndex=r.lastIndex,s}if(t===ro)return Object(Symbol.prototype.valueOf.call(e));if(t===io){const r=e,s=new Map;return r.forEach((i,a)=>{s.set(a,i)}),s}if(t===ao){const r=e,s=new Set;return r.forEach(i=>{s.add(i)}),s}if(t===Fs){const r=e,s={};return Lo(s,r),s.length=r.length,s[Symbol.iterator]=r[Symbol.iterator],s}const n={};return Zw(n,e),Lo(n,e),Yw(n,e),n}function qw(e){switch(Or(e)){case Fs:case Vl:case oo:case lo:case Zi:case so:case ql:case Yl:case Dl:case jl:case Wl:case io:case Xi:case vi:case no:case ao:case Ls:case ro:case Ll:case Fl:case Gl:case Nl:return!0;default:return!1}}function Lo(e,t){for(const n in t)Object.hasOwn(t,n)&&(e[n]=t[n])}function Yw(e,t){const n=Object.getOwnPropertySymbols(t);for(let r=0;r<n.length;r++){const s=n[r];Object.prototype.propertyIsEnumerable.call(t,s)&&(e[s]=t[s])}}function Xw(e,t){const n=t.valueOf().length;for(const r in t)Object.hasOwn(t,r)&&(Number.isNaN(Number(r))||Number(r)>=n)&&(e[r]=t[r])}function Zw(e,t){const n=Object.getPrototypeOf(t);n!==null&&typeof t.constructor=="function"&&Object.setPrototypeOf(e,n)}function Hw(e,t){if(!t)return il(e);const n=t(e);return n!==void 0?n:il(e)}function Kw(e,t){const n=ln(e)?Object.create(e):{};if(t!=null){const r=fr(t);for(let s=0;s<r.length;s++){const i=r[s],a=t[i];ru(n,i,a)}}return n}function Fa(e,...t){e=Object(e);const n=Object.prototype;let r=t.length;const s=r>2?t[2]:void 0;s&&Ln(t[0],t[1],s)&&(r=1);for(let i=0;i<r;i++){if(rr(t[i]))continue;const a=t[i],o=Object.keys(a);for(let l=0;l<o.length;l++){const u=o[l],c=e[u];(c===void 0||!Object.hasOwn(e,u)&&mt(c,n[u]))&&(e[u]=a[u])}}return e}function Fn(e){var n;if(typeof e!="object"||e==null)return!1;if(Object.getPrototypeOf(e)===null)return!0;if(Object.prototype.toString.call(e)!=="[object Object]"){const r=e[Symbol.toStringTag];return r==null||!((n=Object.getOwnPropertyDescriptor(e,Symbol.toStringTag))!=null&&n.writable)?!1:e.toString()===`[object ${r}]`}let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function Qw(e,...t){e=Object(e);for(let n=0;n<t.length;n++){const r=t[n];r!=null&&vo(e,r,new WeakMap)}return e}function vo(e,t,n){for(const r in t){const s=t[r],i=e[r];if(i===void 0||!Object.hasOwn(e,r)){e[r]=Jw(s,n);continue}n.get(s)!==i&&ev(i,s,n)}}function Jw(e,t){if(t.has(e))return t.get(e);if(Fn(e)){const n={};return t.set(e,n),vo(n,e,t),n}return e}function ev(e,t,n){if(Fn(e)&&Fn(t)){n.set(t,e),vo(e,t,n);return}Array.isArray(e)&&Array.isArray(t)&&(n.set(t,e),tv(e,t,n))}function tv(e,t,n){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++)Fn(e[s])&&Fn(t[s])&&vo(e[s],t[s],n);for(let s=r;s<t.length;s++)e.push(t[s])}function nv(e,t){return Object.keys(e).find(r=>t(e[r],r,e))}function rv(e,t){if(!ln(e))return;const n=ie(t??Gr);return nv(e,n)}function sv(e,t){if(!ln(e))return;const n=ie(t??Gr);return Object.keys(e).findLast(s=>n(e[s],s,e))}function iv(e,t=ue){if(e==null)return e;for(const n in e)if(t(e[n],n,e)===!1)break;return e}function av(e,t=ue){if(e==null)return e;const n=[];for(const r in e)n.push(r);for(let r=n.length-1;r>=0;r--){const s=n[r];if(t(e[s],s,e)===!1)break}return e}function ov(e,t=ue){if(e==null)return e;const n=Object(e),r=fr(e);for(let s=0;s<r.length;++s){const i=r[s];if(t(n[i],i,n)===!1)break}return e}function lv(e,t=ue){if(e==null)return e;const n=Object(e),r=fr(e);for(let s=r.length-1;s>=0;--s){const i=r[s];if(t(n[i],i,n)===!1)break}return e}function uv(e){if(!Y(e))return{};const t={};for(let n=0;n<e.length;n++){const[r,s]=e[n];t[r]=s}return t}function cv(e){return e==null?[]:fr(e).filter(t=>typeof e[t]=="function")}function fv(e){if(e==null)return[];const t=[];for(const n in e)Fr(e[n])&&t.push(n);return t}function hv(e,t){if(e==null)return!1;let n;if(Array.isArray(t)?n=t:typeof t=="string"&&qi(t)&&e[t]==null?n=Mn(t):n=[t],n.length===0)return!1;let r=e;for(let s=0;s<n.length;s++){const i=n[s];if((r==null||!(i in Object(r)))&&!((Array.isArray(r)||Ns(r))&&Gs(i)&&i<r.length))return!1;r=r[i]}return!0}function pv(e){const t={},n=Object.keys(e);for(let r=0;r<n.length;r++){const s=n[r],i=e[s];t[i]=s}return t}function dv(e){return pv(e)}function mv(e,t){const n={};if(rr(e))return n;t==null&&(t=ue);const r=Object.keys(e),s=ie(t);for(let i=0;i<r.length;i++){const a=r[i],o=e[a],l=s(o);Array.isArray(n[l])?n[l].push(a):n[l]=[a]}return n}function yv(e,t){const n={},r=Object.keys(e);for(let s=0;s<r.length;s++){const i=r[s],a=e[i];n[t(a,i,e)]=a}return n}function gv(e,t=ue){return e==null?{}:yv(e,ie(t))}function wv(e,t){const n={},r=Object.keys(e);for(let s=0;s<r.length;s++){const i=r[s],a=e[i];n[i]=t(a,i,e)}return n}function vv(e,t=ue){return e==null?{}:wv(e,ie(t))}function xv(e){if(Yi(e))return e;if(Array.isArray(e)||Xl(e)||e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer)return e.slice(0);const t=Object.getPrototypeOf(e),n=t.constructor;if(e instanceof Date||e instanceof Map||e instanceof Set)return new n(e);if(e instanceof RegExp){const r=new n(e);return r.lastIndex=e.lastIndex,r}if(e instanceof DataView)return new n(e.buffer.slice(0));if(e instanceof Error){const r=new n(e.message);return r.stack=e.stack,r.name=e.name,r.cause=e.cause,r}if(typeof File<"u"&&e instanceof File)return new n([e],e.name,{type:e.type,lastModified:e.lastModified});if(typeof e=="object"){const r=Object.create(t);return Object.assign(r,e)}return e}function Hh(e,...t){const n=t.slice(0,-1),r=t[t.length-1];let s=e;for(let i=0;i<n.length;i++){const a=n[i];s=za(s,a,r,new Map)}return s}function za(e,t,n,r){if(Yi(e)&&(e=Object(e)),t==null||typeof t!="object")return e;if(r.has(t))return xv(r.get(t));if(r.set(t,e),Array.isArray(t)){t=t.slice();for(let i=0;i<t.length;i++)t[i]=t[i]??void 0}const s=[...Object.keys(t),...Ii(t)];for(let i=0;i<s.length;i++){const a=s[i];if(nr(a))continue;let o=t[a],l=e[a];if(Ns(o)&&(o={...o}),Ns(l)&&(l={...l}),typeof Buffer<"u"&&Buffer.isBuffer(o)&&(o=Bi(o)),Array.isArray(o))if(typeof l=="object"&&l!=null){const c=[],f=Reflect.ownKeys(l);for(let h=0;h<f.length;h++){const d=f[h];c[d]=l[d]}l=c}else l=[];const u=n(l,o,a,e,t,r);u!==void 0?e[a]=u:Array.isArray(o)||Ur(l)&&Ur(o)?e[a]=za(l,o,n,r):l==null&&Fn(o)?e[a]=za({},o,n,r):l==null&&Nr(o)?e[a]=Bi(o):(l===void 0||o!==void 0)&&(e[a]=o)}return e}function Kh(e,...t){return Hh(e,...t,Zh)}function xo(e){const t=[];for(;e;)t.push(...Ii(e)),e=Object.getPrototypeOf(e);return t}function bv(e,...t){if(e==null)return{};t=Hi(t);const n=$v(e,t);for(let r=0;r<t.length;r++){let s=t[r];switch(typeof s){case"object":{Array.isArray(s)||(s=Array.from(s));for(let i=0;i<s.length;i++){const a=s[i];Ca(n,a)}break}case"string":case"symbol":case"number":{Ca(n,s);break}}}return n}function $v(e,t){return t.some(r=>Array.isArray(r)||qi(r))?_v(e):Tv(e)}function Tv(e){const t={},n=[...Pn(e),...xo(e)];for(let r=0;r<n.length;r++){const s=n[r];t[s]=e[s]}return t}function _v(e){const t={},n=[...Pn(e),...xo(e)];for(let r=0;r<n.length;r++){const s=n[r];t[s]=Zl(e[s],i=>{if(!Fn(i))return i})}return t}function Sv(e,t){if(e==null)return{};const n={},r=ie(t??Gr),s=Y(e)?Lr(0,e.length):[...Pn(e),...xo(e)];for(let i=0;i<s.length;i++){const a=Rr(s[i])?s[i]:s[i].toString(),o=e[a];r(o,a,e)||(n[a]=o)}return n}function zv(e,...t){if(yo(e))return{};const n={};for(let r=0;r<t.length;r++){let s=t[r];switch(typeof s){case"object":{Array.isArray(s)||(Y(s)?s=Array.from(s):s=[s]);break}case"string":case"symbol":case"number":{s=[s];break}}for(const i of s){const a=It(e,i);a===void 0&&!Hl(e,i)||(typeof i=="string"&&Object.hasOwn(e,i)?n[i]=a:su(n,i,a))}}return n}function kv(e,t){if(e==null)return{};const n=ie(t??Gr),r={},s=Y(e)?Lr(0,e.length):[...Pn(e),...xo(e)];for(let i=0;i<s.length;i++){const a=Rr(s[i])?s[i]:s[i].toString(),o=e[a];n(o,a,e)&&(r[a]=o)}return r}function Mv(e){return function(t){return It(e,t)}}function Pv(e,t,n){mo(t,e)?t=[t]:Array.isArray(t)||(t=Mn(me(t)));const r=Math.max(t.length,1);for(let s=0;s<r;s++){const i=e==null?void 0:e[lr(t[s])];if(i===void 0)return typeof n=="function"?n.call(e):n;e=typeof i=="function"?i.call(e):i}return e}function Iv(e,t,n,r){let s;return typeof r=="function"?s=r:s=()=>{},go(e,t,()=>n,s)}function Bv(e,...t){const n=Bi(e);return Fa(n,...t)}function Qh(e){const t=new Array(e.size),n=e.keys(),r=e.values();for(let s=0;s<t.length;s++)t[s]=[n.next().value,r.next().value];return t}function Jh(e){const t=new Array(e.size),n=e.values();for(let r=0;r<t.length;r++){const s=n.next().value;t[r]=[s,s]}return t}function Ev(e){if(e==null)return[];if(e instanceof Set)return Jh(e);if(e instanceof Map)return Qh(e);const t=fr(e),n=new Array(t.length);for(let r=0;r<t.length;r++){const s=t[r],i=e[s];n[r]=[s,i]}return n}function Av(e){if(e==null)return[];if(e instanceof Set)return Jh(e);if(e instanceof Map)return Qh(e);const t=Pn(e),n=new Array(t.length);for(let r=0;r<t.length;r++){const s=t[r],i=e[s];n[r]=[s,i]}return n}function ep(e){return pu(e)}function Ov(e,t=ue,n){const r=Array.isArray(e)||ep(e)||Nr(e);return t=ie(t),n==null&&(r?n=[]:ln(e)&&Fr(e.constructor)?n=Object.create(Object.getPrototypeOf(e)):n={}),e==null||Jo(e,(s,i,a)=>t(n,s,i,a)),n}function Uv(e,t,n){return go(e,t,n,()=>{})}function Rv(e){const t=Pn(e),n=new Array(t.length);for(let r=0;r<t.length;r++){const s=t[r];n[r]=e[s]}return n}function Cv(e){return typeof e=="function"}function Vv(e){return Number.isSafeInteger(e)&&e>=0}const tp=Function.prototype.toString,Lv=/[\\^$.*+?()[\]{}|]/g,Fv=RegExp(`^${tp.call(Object.prototype.hasOwnProperty).replace(Lv,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")}$`);function Gv(e){if(typeof e!="function")return!1;if((globalThis==null?void 0:globalThis["__core-js_shared__"])!=null)throw new Error("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Fv.test(tp.call(e))}function Nv(e){return e===null}function Dv(e){return el(e)}function np(e,t){if(t==null)return!0;if(e==null)return Object.keys(t).length===0;const n=Object.keys(t);for(let r=0;r<n.length;r++){const s=n[r],i=t[s],a=e[s];if(a===void 0&&!(s in e)||typeof i=="function"&&!i(a))return!1}return!0}function jv(e){return e=wh(e),function(t){return np(t,e)}}function Wv(e){return e instanceof ArrayBuffer}function qv(e){return Wv(e)}function Yv(e){return typeof e=="boolean"||e instanceof Boolean}function Xv(e){return e instanceof Date}function Zv(e){return Xv(e)}function Hv(e){return Ur(e)&&e.nodeType===1&&!Fn(e)}function Kv(e){if(e==null)return!0;if(Y(e))return typeof e.splice!="function"&&typeof e!="string"&&(typeof Buffer>"u"||!Buffer.isBuffer(e))&&!Nr(e)&&!Ns(e)?!1:e.length===0;if(typeof e=="object"){if(e instanceof Map||e instanceof Set)return e.size===0;const t=Object.keys(e);return du(e)?t.filter(n=>n!=="constructor").length===0:t.length===0}return!0}function lc(e,t){if(!Number.isInteger(e)||e<0)throw new Error("n must be a non-negative integer.");let n=0;return(...r)=>{if(++n>=e)return t(...r)}}function al(e,t,n){return typeof n!="function"&&(n=()=>{}),Xh(e,t,(...r)=>{const s=n(...r);if(s!==void 0)return!!s;if(e instanceof Map&&t instanceof Map||e instanceof Set&&t instanceof Set)return al(Array.from(e),Array.from(t),lc(2,n))})}function Qv(e){return Or(e)==="[object Error]"}function Jv(e){return Number.isFinite(e)}function ex(e){return Number.isInteger(e)}function tx(e){return e instanceof RegExp}function nx(e){return tx(e)}function rx(e){return Number.isSafeInteger(e)}function sx(e){return e instanceof Set}function ix(e){return sx(e)}function ax(e){return e instanceof WeakMap}function ox(e){return ax(e)}function lx(e){return e instanceof WeakSet}function ux(e){return lx(e)}function rp(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function cx(e){return rp(me(e))}function fx(e,...t){if(e==null||!ln(e)||sr(e)&&t.length===0)return e;const n=[];for(let r=0;r<t.length;r++){const s=t[r];sr(s)?n.push(...s):s&&typeof s=="object"&&"length"in s?n.push(...Array.from(s)):n.push(s)}if(n.length===0)return e;for(let r=0;r<n.length;r++){const s=n[r],i=me(s),a=e[i];Fr(a)&&(e[i]=a.bind(e))}return e}const hx=new RegExp("\\p{Lu}?\\p{Ll}+|[0-9]+|\\p{Lu}+(?!\\p{Ll})|\\p{Emoji_Presentation}|\\p{Extended_Pictographic}|\\p{L}+","gu");function Ys(e){return Array.from(e.match(hx)??[])}function px(e){const t=Ys(e);if(t.length===0)return"";const[n,...r]=t;return`${n.toLowerCase()}${r.map(s=>rp(s)).join("")}`}function Xs(e){return typeof e!="string"&&(e=me(e)),e.replace(/['\u2019]/g,"")}function dx(e){return px(Xs(e))}const mx=new Map(Object.entries({:"Ae",:"D",:"O",:"Th",:"ss",:"ae",:"d",:"o",:"th",:"D",:"d",:"H",:"h",:"i",:"IJ",:"ij",:"k",:"L",:"l",:"L",:"l",:"'n",:"N",:"n",:"Oe",:"oe",:"T",:"t",:"s"}));function yx(e){e=e.normalize("NFD");let t="";for(let n=0;n<e.length;n++){const r=e[n];r>=""&&r<=""||r>=""&&r<=""||(t+=mx.get(r)??r)}return t}function gx(e){return yx(me(e))}function wx(e,t,n){return e==null||t==null?!1:(n==null&&(n=e.length),e.endsWith(t,n))}const vx={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function xx(e){return e.replace(/[&<>"']/g,t=>vx[t])}function sp(e){return xx(me(e))}function bx(e){return e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&")}function $x(e){return bx(me(e))}function Tx(e){return Ys(e).map(n=>n.toLowerCase()).join("-")}function _x(e){return Tx(Xs(e))}function Sx(e){return Ys(e).map(n=>n.toLowerCase()).join(" ")}function zx(e){return Sx(Xs(e))}function kx(e){return e.substring(0,1).toLowerCase()+e.substring(1)}function Mx(e){return kx(me(e))}function Px(e,t,n=" "){return e.padStart(Math.floor((t-e.length)/2)+e.length,n).padEnd(t,n)}function Ix(e,t,n){return Px(me(e),t,n)}function Bx(e,t=0,n=" "){return me(e).padEnd(t,n)}function Ex(e,t=0,n=" "){return me(e).padStart(t,n)}const ol=Number.MAX_SAFE_INTEGER;function Ax(e,t,n){return(n?Ln(e,t,n):t===void 0)?t=1:t=nt(t),t<1||t>ol?"":me(e).repeat(t)}function Ox(e,t,n){return arguments.length<3?me(e):me(e).replace(t,n)}function Ux(e){return Ys(e).map(n=>n.toLowerCase()).join("_")}function Rx(e){return Ux(Xs(e))}function Cx(e,t,n){return me(e).split(t,n)}function Vx(e){const t=Ys(Xs(e).trim());let n="";for(let r=0;r<t.length;r++){const s=t[r];n&&(n+=" "),s===s.toUpperCase()?n+=s:n+=s[0].toUpperCase()+s.slice(1).toLowerCase()}return n}function Lx(e,t,n){return e==null||t==null?!1:(n==null&&(n=0),e.startsWith(t,n))}const Fx=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gx=/['\n\r\u2028\u2029\\]/g,pa=/($^)/,Nx=new Map([["\\","\\"],["'","'"],[`
`,"n"],["\r","r"],["\u2028","u2028"],["\u2029","u2029"]]);function Dx(e){return`\\${Nx.get(e)}`}const ka={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,variable:"",imports:{_:{escape:sp,template:ip}}};function ip(e,t,n){var d,p,y;e=me(e),n&&(t=ka),t=Fa({...t},ka);const r=new RegExp([((d=t.escape)==null?void 0:d.source)??pa.source,((p=t.interpolate)==null?void 0:p.source)??pa.source,t.interpolate?Fx.source:pa.source,((y=t.evaluate)==null?void 0:y.source)??pa.source,"$"].join("|"),"g");let s=0,i=!1,a="__p += ''";for(const T of e.matchAll(r)){const[z,U,J,j,N]=T,{index:E}=T;a+=` + '${e.slice(s,E).replace(Gx,Dx)}'`,U&&(a+=` + _.escape(${U})`),J?a+=` + ((${J}) == null ? '' : ${J})`:j&&(a+=` + ((${j}) == null ? '' : ${j})`),N&&(a+=`;
${N};
 __p += ''`,i=!0),s=E+z.length}const o=Fa({...t.imports},ka.imports),l=Object.keys(o),u=Object.values(o),c=`//# sourceURL=${t.sourceURL?String(t.sourceURL).replace(/[\r\n]/g," "):`es-toolkit.templateSource[${Date.now()}]`}
`,f=`function(${t.variable||"obj"}) {
    let __p = '';
    ${t.variable?"":"if (obj == null) { obj = {}; }"}
    ${i?"function print() { __p += Array.prototype.join.call(arguments, ''); }":""}
    ${t.variable?a:`with(obj) {
${a}
}`}
    return __p;
  }`,h=Nh(()=>new Function(...l,`${c}return ${f}`)(...u));if(h.source=f,h instanceof Error)throw h;return h}function jx(e){return me(e).toLowerCase()}function Wx(e){return me(e).toUpperCase()}function ap(e,t){if(t===void 0)return e.trimEnd();let n=e.length;switch(typeof t){case"string":{if(t.length!==1)throw new Error("The 'chars' parameter should be a single character string.");for(;n>0&&e[n-1]===t;)n--;break}case"object":for(;n>0&&t.includes(e[n-1]);)n--}return e.substring(0,n)}function op(e,t){if(t===void 0)return e.trimStart();let n=0;switch(typeof t){case"string":{for(;n<e.length&&e[n]===t;)n++;break}case"object":for(;n<e.length&&t.includes(e[n]);)n++}return e.substring(n)}function Fo(e,t){return t===void 0?e.trim():op(ap(e,t),t)}function qx(e,t,n){if(e==null)return"";if(n!=null||t==null)return e.toString().trim();switch(typeof t){case"object":return Array.isArray(t)?Fo(e,t.flatMap(r=>r.toString().split(""))):Fo(e,t.toString().split(""));default:return Fo(e,t.toString().split(""))}}function Yx(e,t,n){return e==null?"":n!=null||t==null?e.toString().trimEnd():ap(e,t.toString().split(""))}function Xx(e,t,n){return e==null?"":n!=null||t==null?e.toString().trimStart():op(e,t.toString().split(""))}const Zx=/[\u200d\ud800-\udfff\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff\ufe0e\ufe0f]/;function Hx(e,t){e=e!=null?`${e}`:"";let n=30,r="...";ln(t)&&(n=Kx(t.length),r="omission"in t?`${t.omission}`:"...");let s=e.length;const i=Array.from(r).length,a=Math.max(n-i,0);let o;if(Zx.test(e)&&(o=Array.from(e),s=o.length),n>=s)return e;if(s<=i)return r;let u=o===void 0?e.slice(0,a):o==null?void 0:o.slice(0,a).join("");const c=t==null?void 0:t.separator;if(!c)return u+=r,u;const f=c instanceof RegExp?c.source:c,h="u"+(c instanceof RegExp?c.flags.replace("u",""):""),d=new RegExp(`(?<result>.*(?:(?!${f}).))(?:${f})`,h).exec(u);return(d!=null&&d.groups?d.groups.result:u)+r}function Kx(e){return e==null?30:e<=0?0:e}const Qx={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};function Jx(e){return e.replace(/&(?:amp|lt|gt|quot|#(0+)?39);/g,t=>Qx[t]||"'")}function e1(e){return Jx(me(e))}function t1(e){const t=Ys(e);let n="";for(let r=0;r<t.length;r++)n+=t[r].toUpperCase(),r<t.length-1&&(n+=" ");return n}function n1(e){return t1(Xs(e))}function r1(e){return e.substring(0,1).toUpperCase()+e.substring(1)}function s1(e){return r1(me(e))}const i1="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\xd7\\xf7",ys="\\p{Lu}",lp="\\p{Ll}",up="(?:[\\p{Lm}\\p{Lo}]\\p{M}*)",ai="\\d",uc="(?:['](?:d|ll|m|re|s|t|ve))?",cc="(?:['](?:D|LL|M|RE|S|T|VE))?",fc=`[\\p{Z}\\p{P}${i1}]`,a1=`(?:${ys}|${up})`,hc=`(?:${lp}|${up})`,pc=RegExp([`${ys}?${lp}+${uc}(?=${fc}|${ys}|$)`,`${a1}+${cc}(?=${fc}|${ys}${hc}|$)`,`${ys}?${hc}+${uc}`,`${ys}+${cc}`,`${ai}*(?:1ST|2ND|3RD|(?![123])${ai}TH)(?=\\b|[a-z_])`,`${ai}*(?:1st|2nd|3rd|(?![123])${ai}th)(?=\\b|[A-Z_])`,`${ai}+`,"\\p{Emoji_Presentation}","\\p{Extended_Pictographic}"].join("|"),"gu");function o1(e,t=pc,n){const r=me(e);return n&&(t=pc),typeof t=="number"&&(t=t.toString()),Array.from(r.match(t)??[]).filter(i=>i!=="")}function l1(e){const t=e.length,n=e.map(r=>{const s=r[0],i=r[1];if(!Fr(i))throw new TypeError("Expected a function");return[ie(s),i]});return function(...r){for(let s=0;s<t;s++){const i=n[s],a=i[0],o=i[1];if(a.apply(this,r))return o.apply(this,r)}}}function u1(e){return()=>e}function c1(e,t){return e==null||Number.isNaN(e)?t:e}function f1(e,t){return typeof e=="string"&&typeof t=="string"?e>t:tt(e)>tt(t)}function h1(e,t){return typeof e=="string"&&typeof t=="string"?e>=t:tt(e)>=tt(t)}function yu(e,t,...n){if(n=n.flat(1),e!=null)switch(typeof t){case"string":return typeof e=="object"&&Object.hasOwn(e,t)?oi(e,[t],n):oi(e,Mn(t),n);case"number":case"symbol":return oi(e,[t],n);default:return Array.isArray(t)?oi(e,t,n):oi(e,[t],n)}}function oi(e,t,n){const r=It(e,t.slice(0,-1),e);if(r==null)return;let s=Vr(t);const i=s==null?void 0:s.valueOf();typeof i=="number"?s=lr(i):s=String(s);const a=It(r,s);return a==null?void 0:a.apply(r,n)}function p1(e,t){return typeof e=="string"&&typeof t=="string"?e<t:tt(e)<tt(t)}function d1(e,t){return typeof e=="string"&&typeof t=="string"?e<=t:tt(e)<=tt(t)}function m1(e,...t){return function(n){return yu(n,e,t)}}function y1(e,...t){return function(n){return yu(e,n,t)}}function g1(){return Date.now()}function w1(...e){e.length===1&&Array.isArray(e[0])&&(e=e[0]);const t=e.map(n=>ie(n));return function(...n){return t.map(r=>r.apply(this,n))}}function v1(...e){return function(...t){for(let n=0;n<e.length;++n){const r=e[n];if(!Array.isArray(r)){if(!ie(r).apply(this,t))return!1;continue}for(let s=0;s<r.length;++s)if(!ie(r[s]).apply(this,t))return!1}return!0}}function x1(...e){return function(...t){for(let n=0;n<e.length;++n){const r=e[n];if(!Array.isArray(r)){if(ie(r).apply(this,t))return!0;continue}for(let s=0;s<r.length;++s)if(ie(r[s]).apply(this,t))return!0}return!1}}function b1(){return[]}function $1(){return!1}function T1(){return{}}function _1(){return""}function S1(){return!0}const z1=4294967295;function k1(e){if(e==null)return 0;const t=Math.floor(Number(e));return Ds(t,0,z1)}function M1(e){const t={},n=Pn(e);for(let r=0;r<n.length;r++){const s=n[r],i=e[s];s==="__proto__"?Object.defineProperty(t,s,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[s]=i}return t}function P1(e){return e==null?0:Ds(nt(e),-ol,ol)}let I1=0;function B1(e=""){const t=++I1;return`${e}${t}`}const E1=Object.freeze(Object.defineProperty({__proto__:null,add:hw,after:Lg,ary:Gh,assign:Vw,assignIn:ac,assignInWith:oc,assignWith:jw,at:kh,attempt:Nh,before:Gg,bind:iu,bindAll:fx,bindKey:au,camelCase:dx,capitalize:cx,castArray:Rm,ceil:pw,chunk:Lm,clamp:Ds,clone:il,cloneDeep:Bi,cloneDeepWith:Zl,cloneWith:Hw,compact:Gm,concat:Nm,cond:l1,conforms:jv,conformsTo:np,constant:u1,countBy:ey,create:Kw,curry:Ki,curryRight:js,debounce:uu,deburr:gx,defaultTo:c1,defaults:Fa,defaultsDeep:Qw,defer:Yg,delay:Xg,difference:ty,differenceBy:vh,differenceWith:xh,divide:dw,drop:iy,dropRight:oy,dropRightWhile:ly,dropWhile:cy,each:Jo,eachRight:ec,endsWith:wx,eq:mt,escape:sp,escapeRegExp:$x,every:hy,extend:ac,extendWith:oc,fill:dy,filter:bh,find:my,findIndex:yy,findKey:rv,findLast:gy,findLastIndex:wy,findLastKey:sv,first:tc,flatMap:xy,flatMapDeep:by,flatMapDepth:Kl,flatten:Hi,flattenDeep:$y,flattenDepth:po,flip:Zg,floor:mw,flow:Hg,flowRight:Qg,forEach:Jo,forEachRight:ec,forIn:iv,forInRight:av,forOwn:ov,forOwnRight:lv,fromPairs:uv,functions:cv,functionsIn:fv,get:It,groupBy:_y,gt:f1,gte:h1,has:Hl,hasIn:hv,head:tc,identity:Gr,inRange:gw,includes:Sy,indexOf:zy,initial:My,intersection:Iy,intersectionBy:$h,intersectionWith:Th,invert:dv,invertBy:mv,invoke:yu,invokeMap:Ay,isArguments:Ns,isArray:sr,isArrayBuffer:qv,isArrayLike:Y,isArrayLikeObject:be,isBoolean:Yv,isBuffer:ep,isDate:Zv,isElement:Hv,isEmpty:Kv,isEqual:Uw,isEqualWith:al,isError:Qv,isFinite:Jv,isFunction:Cv,isInteger:ex,isLength:Vv,isMap:Ih,isMatch:Cl,isMatchWith:Rl,isNaN:tl,isNative:Gv,isNil:yo,isNull:Nv,isNumber:nu,isObject:ln,isObjectLike:Ur,isPlainObject:Fn,isRegExp:nx,isSafeInteger:rx,isSet:ix,isString:ho,isSymbol:Rr,isTypedArray:Nr,isUndefined:Dv,isWeakMap:ox,isWeakSet:ux,iteratee:ie,join:Oy,kebabCase:_x,keyBy:Uy,keys:fr,keysIn:Pn,last:Vr,lastIndexOf:Ry,lowerCase:zx,lowerFirst:Mx,lt:p1,lte:d1,map:Ra,mapKeys:gv,mapValues:vv,matches:ur,matchesProperty:cr,max:ww,maxBy:xw,mean:bw,meanBy:_w,memoize:wo,merge:Kh,mergeWith:Hh,method:m1,methodOf:y1,min:Sw,minBy:kw,multiply:Mw,negate:Jl,noop:Rw,now:g1,nth:Cy,nthArg:Jg,omit:bv,omitBy:Sv,once:tw,orderBy:Sh,over:w1,overArgs:nw,overEvery:v1,overSome:x1,pad:Ix,padEnd:Bx,padStart:Ex,parseInt:Pw,partial:cu,partialRight:fu,partition:Gy,pick:zv,pickBy:kv,property:Dn,propertyOf:Mv,pull:Ny,pullAll:Dy,pullAllBy:jy,pullAllWith:qy,pullAt:Yy,random:Iw,range:Bw,rangeRight:Ew,rearg:iw,reduce:_h,reduceRight:Xy,reject:Zy,remove:Ky,repeat:Ax,replace:Ox,rest:ow,result:Pv,reverse:Qy,round:Aw,sample:Jy,sampleSize:rg,set:su,setWith:Iv,shuffle:sg,size:ig,slice:ag,snakeCase:Rx,some:og,sortBy:lg,sortedIndex:Ah,sortedIndexBy:tu,sortedIndexOf:pg,sortedLastIndex:Uh,sortedLastIndexBy:Oh,sortedLastIndexOf:yg,split:Cx,spread:lw,startCase:Vx,startsWith:Lx,stubArray:b1,stubFalse:$1,stubObject:T1,stubString:_1,stubTrue:S1,subtract:Ow,sum:Yh,sumBy:qh,tail:wg,take:xg,takeRight:$g,takeRightWhile:_g,takeWhile:Sg,template:ip,templateSettings:ka,throttle:uw,times:mu,toArray:eu,toDefaulted:Bv,toFinite:er,toInteger:nt,toLength:k1,toLower:jx,toNumber:tt,toPairs:Ev,toPairsIn:Av,toPath:Mn,toPlainObject:M1,toSafeInteger:P1,toString:me,toUpper:Wx,transform:Ov,trim:qx,trimEnd:Yx,trimStart:Xx,truncate:Hx,unary:cw,unescape:e1,union:zg,unionBy:nl,unionWith:rl,uniq:Ql,uniqBy:kg,uniqWith:Mg,uniqueId:B1,unset:Ca,unzip:Vh,unzipWith:Pg,update:Uv,updateWith:go,upperCase:n1,upperFirst:s1,values:Bh,valuesIn:Rv,without:Bg,words:o1,wrap:fw,xor:Eg,xorBy:Ag,xorWith:Og,zip:Ug,zipObject:Rg,zipObjectDeep:Cg,zipWith:Vg},Symbol.toStringTag,{value:"Module"})),vt=e=>e;Object.assign(vt,E1);vt.partial.placeholder=vt;vt.partialRight.placeholder=vt;var ct=(e=>(e.Arc="arc",e.Rect="rect",e))(ct||{}),oe=(e=>(e.MaskPen="mask-pen",e.Eraser="eraser",e.PaintPen="paint-pen",e.MaskBucket="mask-bucket",e.MaskColorFill="mask-color-fill",e))(oe||{});const A1=["mask-pen","eraser","paint-pen","mask-bucket","mask-color-fill"];var Vt=(e=>(e.Black="black",e.White="white",e.Negative="negative",e))(Vt||{}),Er=(e=>(e.Simple="simple",e.Lab="lab",e))(Er||{}),Xt=(e=>(e.SourceOver="source-over",e.DestinationOut="destination-out",e))(Xt||{});function O1(e=20){const t=at(),n=k([]),r=k(-1),s=k(!1),i=Ce(()=>n.value.length>1&&r.value>0),a=Ce(()=>n.value.length>1&&r.value<n.value.length-1),o=()=>{const d=t.maskCtx,p=t.rgbCtx,y=t.maskCanvas,T=t.rgbCanvas;if(!d||!p||!y||!T){requestAnimationFrame(o);return}if(!y.width||!T.width){requestAnimationFrame(o);return}n.value=[];const z=d.getImageData(0,0,y.width,y.height),U=p.getImageData(0,0,T.width,T.height);n.value.push({mask:z,rgb:U}),r.value=0,s.value=!0},l=(d,p)=>{const y=t.maskCtx,T=t.rgbCtx,z=t.maskCanvas,U=t.rgbCanvas;if(!y||!T||!z||!U)return;if(!s.value||r.value===-1){o();return}n.value=n.value.slice(0,r.value+1);let J,j;if(d&&p?(J=d,j=p):(J=y.getImageData(0,0,z.width,z.height),j=T.getImageData(0,0,U.width,U.height)),n.value.push({mask:J,rgb:j}),r.value++,n.value.length>e){const N=n.value.shift();N&&(N.mask instanceof ImageBitmap&&N.mask.close(),N.rgb instanceof ImageBitmap&&N.rgb.close()),r.value--}},u=()=>{if(!i.value){alert("No more undo states available");return}r.value--,f(n.value[r.value])},c=()=>{if(!a.value){alert("No more redo states available");return}r.value++,f(n.value[r.value])},f=d=>{const p=t.maskCtx,y=t.rgbCtx;!p||!y||(d.mask instanceof ImageBitmap?(p.clearRect(0,0,d.mask.width,d.mask.height),p.drawImage(d.mask,0,0)):p.putImageData(d.mask,0,0),d.rgb instanceof ImageBitmap?(y.clearRect(0,0,d.rgb.width,d.rgb.height),y.drawImage(d.rgb,0,0)):y.putImageData(d.rgb,0,0))};return{canUndo:i,canRedo:a,currentStateIndex:r,saveInitialState:o,saveState:l,undo:u,redo:c,clearStates:()=>{n.value.forEach(d=>{d.mask instanceof ImageBitmap&&d.mask.close(),d.rgb instanceof ImageBitmap&&d.rgb.close()}),n.value=[],r.value=-1,s.value=!1}}}const at=eo("maskEditor",()=>{const e=k({type:ct.Arc,size:10,opacity:.7,hardness:1,stepSize:10}),t=k(Vt.Black),n=k("mask"),r=k("#FF0000"),s=k(oe.MaskPen),i=k(!1),a=k(5),o=k(100),l=k(20),u=k(!1),c=k(Er.Simple),f=k(!1),h=k(!1),d=k(0),p=k(100),y=k(1),T=k(1),z=k({x:0,y:0}),U=k({x:0,y:0}),J=k(0),j=k(0),N=k(null),E=k(null),G=k(null),W=k(null),ee=k(null),he=k(null),ye=k(null),De=k(null),Ae=k(null),He=k(null),_t=k(.8),Ot=k(!0),Ut=k(!1),ei=k(!1),tn=O1(20),ti=k(null);Cn(N,b=>{b&&(E.value=b.getContext("2d",{willReadFrequently:!0}))}),Cn(G,b=>{b&&(W.value=b.getContext("2d",{willReadFrequently:!0}))}),Cn(ee,b=>{b&&(he.value=b.getContext("2d",{willReadFrequently:!0}))});const ni=Ce(()=>tn.canUndo.value),R=Ce(()=>tn.canRedo.value),te=Ce(()=>{switch(t.value){case Vt.Black:return{r:0,g:0,b:0};case Vt.White:return{r:255,g:255,b:255};case Vt.Negative:return{r:255,g:255,b:255};default:return{r:0,g:0,b:0}}});function pe(b){e.value.size=vt.clamp(b,1,500)}function We(b){e.value.opacity=vt.clamp(b,0,1)}function Ke(b){e.value.hardness=vt.clamp(b,0,1)}function qe(b){e.value.stepSize=vt.clamp(b,1,100)}function ut(){e.value.type=ct.Arc,e.value.size=20,e.value.opacity=1,e.value.hardness=1,e.value.stepSize=5}function ht(b){a.value=vt.clamp(b,0,255)}function yt(b){o.value=vt.clamp(b,0,100)}function Dt(b){l.value=vt.clamp(b,0,255)}function St(b){d.value=vt.clamp(b,0,255)}function pt(b){p.value=vt.clamp(b,0,100)}function zt(b){y.value=Math.max(.1,Math.min(10,b))}function jt(b){z.value={...b}}function ri(b){U.value={...b}}function Qr(){J.value++}function Wn(){j.value++}function Jr(b){_t.value=vt.clamp(b,0,1)}function $(){e.value={type:ct.Arc,size:10,opacity:.7,hardness:1,stepSize:5},t.value=Vt.Black,n.value="mask",r.value="#FF0000",s.value=oe.MaskPen,i.value=!1,a.value=5,o.value=100,l.value=20,u.value=!1,c.value=Er.Simple,f.value=!1,h.value=!1,d.value=0,p.value=100,y.value=1,z.value={x:0,y:0},U.value={x:0,y:0},_t.value=.8}return{brushSettings:e,maskBlendMode:t,activeLayer:n,rgbColor:r,currentTool:s,isAdjustingBrush:i,paintBucketTolerance:a,fillOpacity:o,colorSelectTolerance:l,colorSelectLivePreview:u,colorComparisonMethod:c,applyWholeImage:f,maskBoundary:h,maskTolerance:d,selectionOpacity:p,zoomRatio:y,displayZoomRatio:T,panOffset:z,cursorPoint:U,resetZoomTrigger:J,maskCanvas:N,maskCtx:E,rgbCanvas:G,rgbCtx:W,imgCanvas:ee,imgCtx:he,canvasContainer:ye,canvasBackground:De,pointerZone:Ae,image:He,maskOpacity:_t,canUndo:ni,canRedo:R,maskColor:te,brushVisible:Ot,isPanning:Ut,brushPreviewGradientVisible:ei,canvasHistory:tn,tgpuRoot:ti,setBrushSize:pe,setBrushOpacity:We,setBrushHardness:Ke,setBrushStepSize:qe,resetBrushToDefault:ut,setPaintBucketTolerance:ht,setFillOpacity:yt,setColorSelectTolerance:Dt,setMaskTolerance:St,setSelectionOpacity:pt,setZoomRatio:zt,setPanOffset:jt,setCursorPoint:ri,resetZoom:Qr,triggerClear:Wn,clearTrigger:j,setMaskOpacity:Jr,resetState:$}}),gu=eo("maskEditorData",()=>{const e=k(null),t=k(null),n=k(null),r=k(!1),s=k(null),i=Ce(()=>e.value!==null),a=Ce(()=>t.value!==null),o=Ce(()=>i.value&&!r.value);return{inputData:e,outputData:t,sourceNode:n,isLoading:r,loadError:s,hasValidInput:i,hasValidOutput:a,isReady:o,reset:()=>{e.value=null,t.value=null,n.value=null,r.value=!1,s.value=null},setLoading:(c,f)=>{r.value=c,f&&(s.value=f)}}});function U1(e){return km()?(Mm(e),!0):!1}function cp(e){let t=0,n,r;const s=()=>{t-=1,r&&t<=0&&(r.stop(),n=void 0,r=void 0)};return(...i)=>(t+=1,r||(r=zm(!0),n=r.run(()=>e(...i))),U1(s),n)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;function fp(){const e=at(),t=async(i,a,o)=>{const l=e.maskColor;o.drawImage(i,0,0,a.width,a.height);const u=o.getImageData(0,0,a.width,a.height);for(let c=0;c<u.data.length;c+=4){const f=u.data[c+3];u.data[c]=l.r,u.data[c+1]=l.g,u.data[c+2]=l.b,u.data[c+3]=255-f}o.globalCompositeOperation="source-over",o.putImageData(u,0,0)},n=async(i,a,o)=>{const{imgCanvas:l,maskCanvas:u,rgbCanvas:c,imgCtx:f,maskCtx:h,rgbCtx:d}=e;if(!l||!u||!c||!f||!h||!d)throw new Error("Canvas elements or contexts not available");l.width=i.width,l.height=i.height,u.width=i.width,u.height=i.height,c.width=i.width,c.height=i.height,f.drawImage(i,0,0,i.width,i.height),o&&d.drawImage(o,0,0,o.width,o.height),await t(a,u,h)},r=()=>{const i=e.canvasBackground;i&&(e.maskBlendMode===Vt.Black?i.style.backgroundColor="rgba(0,0,0,1)":(e.maskBlendMode===Vt.White||e.maskBlendMode===Vt.Negative)&&(i.style.backgroundColor="rgba(255,255,255,1)"))};return{invalidateCanvas:n,updateMaskColor:async()=>{const{maskCanvas:i,maskCtx:a,maskColor:o,maskBlendMode:l,maskOpacity:u}=e;if(!i||!a)return;l===Vt.Negative?(i.style.mixBlendMode="difference",i.style.opacity="1"):(i.style.mixBlendMode="initial",i.style.opacity=String(u)),a.fillStyle=`rgb(${o.r}, ${o.g}, ${o.b})`,r();const c=a.getImageData(0,0,i.width,i.height);for(let f=0;f<c.data.length;f+=4)c.data[f]=o.r,c.data[f+1]=o.g,c.data[f+2]=o.b;a.putImageData(c,0,0)}}}function R1(){const e=at(),t=gu(),n=fp();return{loadImages:async()=>{var d;const s=t.inputData;if(!s)throw new Error("No input data available in dataStore");const{imgCanvas:i,maskCanvas:a,rgbCanvas:o,imgCtx:l,maskCtx:u}=e;if(!i||!a||!o||!l||!u)throw new Error("Canvas elements or contexts not available");l.clearRect(0,0,i.width,i.height),u.clearRect(0,0,a.width,a.height);const c=s.baseLayer.image,f=s.maskLayer.image,h=(d=s.paintLayer)==null?void 0:d.image;return a.width=c.width,a.height=c.height,o.width=c.width,o.height=c.height,e.image=c,await n.invalidateCanvas(c,f,h||null),await n.updateMaskColor(),c}}}const C1=cp(R1);function V1(){const e=at(),t=k([]),n=l=>t.value.includes(l),r=()=>{t.value=[]},s=l=>{if(t.value.includes(l.key)||t.value.push(l.key),l.key===" "){l.preventDefault();const u=document.activeElement;u&&u.blur&&u.blur()}if((l.ctrlKey||l.metaKey)&&!l.altKey){const u=l.key.toUpperCase();u==="Y"&&!l.shiftKey||u==="Z"&&l.shiftKey?e.canvasHistory.redo():u==="Z"&&!l.shiftKey&&e.canvasHistory.undo()}},i=l=>{t.value=t.value.filter(u=>u!==l.key)};return{isKeyDown:n,addListeners:()=>{document.addEventListener("keydown",s),document.addEventListener("keyup",i),window.addEventListener("blur",r)},removeListeners:()=>{document.removeEventListener("keydown",s),document.removeEventListener("keyup",i),window.removeEventListener("blur",r)}}}class L1{apiURL(t){return`${window.location.origin}${t}`}async fetchApi(t,n){return fetch(this.apiURL(t),n)}}const Ga=new L1;class F1{constructor(){g(this,"graph",{setDirtyCanvas:()=>{}});g(this,"nodeOutputs",{});g(this,"nodePreviewImages",{})}getPreviewFormatParam(){return"&preview=true"}getRandParam(){return`&rand=${Math.random()}`}}const Ar=new F1,G1=eo("nodeOutput",()=>{function e(s){return Ar.nodeOutputs[String(s.id)]}function t(s){return Ar.nodePreviewImages[String(s.id)]}function n(s){var l;const i=t(s);if(i!=null&&i.length)return i;const a=e(s);if(!((l=a==null?void 0:a.images)!=null&&l.length))return;const o=Ar.getRandParam();return a.images.map(u=>{const c=new URLSearchParams(u);return Ga.apiURL(`/view?${c}${o}`)})}function r(s){}return{getNodeOutputs:e,getNodePreviews:t,getNodeImageUrls:n,updateNodeImages:r}}),N1=!1,Go="clipspace-painted-masked-";function D1(e){if(!e.startsWith(Go))return;const n=e.slice(Go.length),r=parseInt(n.split(".")[0],10);return{maskedImage:`clipspace-mask-${r}.png`,paint:`clipspace-paint-${r}.png`,paintedImage:`clipspace-painted-${r}.png`,paintedMaskedImage:`${Go}${r}.png`}}function No(e){return{filename:e,subfolder:"clipspace",type:"input"}}function da(e){const t=new URLSearchParams;t.set("filename",e.ref.filename),e.ref.subfolder&&t.set("subfolder",e.ref.subfolder),e.ref.type&&t.set("type",e.ref.type);const n=Ga.apiURL("/view?"+t.toString()+Ar.getPreviewFormatParam()+Ar.getRandParam()),r=new Image;return r.crossOrigin="anonymous",r.src=n,r.src}function j1(){const e=gu(),t=G1(),n=async u=>{e.setLoading(!0);try{r(u);let c=s(u),f=i(c),h;if(u.widgets){const E=u.widgets.find(G=>G.name==="image");E&&(typeof E.value=="string"?h=E.value:typeof E.value=="object"&&E.value&&"filename"in E.value&&typeof E.value.filename=="string"&&(h=E.value.filename))}if(h)try{let E=h,G,W="input";const ee=E.match(/ \[([^\]]+)\]$/);ee&&(W=ee[1],E=E.substring(0,E.length-ee[0].length));const he=E.lastIndexOf("/");he!==-1&&(G=E.substring(0,he),E=E.substring(he+1)),f={filename:E,type:W,subfolder:G},c=da({ref:f})}catch(E){console.warn("Failed to parse widget filename as ref",E)}const d=h||f.filename;let p,y=D1(f.filename);if(p){const E=p.painted_masked||p.painted;E&&(y={maskedImage:E,paint:p.paint||"",paintedImage:p.painted||"",paintedMaskedImage:p.painted_masked||E})}const T=y!=null&&y.maskedImage?da({ref:No(y.maskedImage)}):c,z=y!=null&&y.maskedImage?i(T):f;let U=null;p!=null&&p.paint?U=da({ref:No(p.paint)}):y!=null&&y.paint&&(U=da({ref:No(y.paint)}));const[J,j,N]=await Promise.all([a(T,"rgb"),a(T,"a"),U?l(U):Promise.resolve(void 0)]);e.inputData={baseLayer:J,maskLayer:j,paintLayer:N,sourceRef:z,nodeId:u.id},e.sourceNode=u,e.setLoading(!1)}catch(c){const f=c instanceof Error?c.message:"Failed to load from node";throw console.error("[MaskEditorLoader]",f,c),e.setLoading(!1,f),c}};function r(u){var f;if(!u)throw new Error("Node is null or undefined");if(!(((f=u.imgs)==null?void 0:f.length)||u.previewMediaType==="image"))throw new Error("Node has no images")}function s(u){var f,h,d;if((f=u.images)!=null&&f[0]){const p=u.images[0],y=new URLSearchParams({filename:p.filename,type:p.type||"output",subfolder:p.subfolder||""});return Ga.apiURL(`/view?${y.toString()}`)}const c=t.getNodeOutputs(u);if((h=c==null?void 0:c.images)!=null&&h[0]){const p=c.images[0];if(!p.filename)throw new Error("nodeOutputStore image missing filename");const y=new URLSearchParams;return y.set("filename",p.filename),y.set("type",p.type||"output"),y.set("subfolder",p.subfolder||""),Ga.apiURL(`/view?${y.toString()}`)}if((d=u.imgs)!=null&&d.length){const p=u.imageIndex??0,y=u.imgs[p].src;if(y&&!y.startsWith("data:"))return y}throw new Error("Unable to get image URL from node")}function i(u){try{const c=new URL(u),f=c.searchParams.get("filename");if(!f)throw new Error("Image URL missing filename parameter");return{filename:f,subfolder:c.searchParams.get("subfolder")||void 0,type:c.searchParams.get("type")||void 0}}catch{try{const f=new URL(u,window.location.origin),h=f.searchParams.get("filename");if(!h)throw new Error("Image URL missing filename parameter");return{filename:h,subfolder:f.searchParams.get("subfolder")||void 0,type:f.searchParams.get("type")||void 0}}catch{throw new Error(`Invalid image URL: ${u}`)}}}async function a(u,c){let f;try{f=new URL(u)}catch{f=new URL(u,window.location.origin)}c&&(f.searchParams.delete("channel"),f.searchParams.set("channel",c));const h=f.toString();return{image:await o(h),url:h}}function o(u){return new Promise((c,f)=>{const h=new Image;h.crossOrigin="anonymous",h.onload=()=>c(h),h.onerror=()=>f(new Error(`Failed to load image: ${u}`)),h.src=u})}async function l(u){let c;try{c=new URL(u)}catch{c=new URL(u,window.location.origin)}const f=c.toString();return{image:await o(f),url:f}}return{loadFromNode:n}}function W1(){const e=at(),t=300,n=k(0),r=k(!1),s=k(0),i=k({x:0,y:0}),a=k({x:0,y:0}),o=k(1),l=k(1),u=k({x:0,y:0}),c=k(null),f=k({x:0,y:0}),h=k(null),d=k(null),p=k(null),y=k(null),T=k(null),z=k(null),U=k(null),J=k(0),j=k(0),N=k({x:0,y:0}),E=k([]),G=R=>{const te=R[0].clientX-R[1].clientX,pe=R[0].clientY-R[1].clientY;return Math.sqrt(te*te+pe*pe)},W=R=>({x:(R[0].clientX+R[1].clientX)/2,y:(R[0].clientY+R[1].clientY)/2}),ee=R=>{const te=R.x-u.value.x,pe=R.y-u.value.y;N.value={x:te,y:pe},e.setCursorPoint({x:te,y:pe})},he=()=>{e.canvasHistory.undo()},ye=async()=>{var pe,We;if(!((pe=U.value)!=null&&pe.width)||!((We=U.value)!=null&&We.height)||!u.value||!o.value){console.warn("Missing required properties for pan/zoom");return}const R=U.value.width*o.value,te=U.value.height*o.value;h.value||(h.value=e.canvasContainer),h.value&&(Object.assign(h.value.style,{width:`${R}px`,height:`${te}px`,left:`${u.value.x}px`,top:`${u.value.y}px`}),p.value||(p.value=e.rgbCanvas),p.value&&((p.value.width!==U.value.width||p.value.height!==U.value.height)&&(p.value.width=U.value.width,p.value.height=U.value.height),p.value.style.width=`${R}px`,p.value.style.height=`${te}px`),e.setPanOffset(u.value),e.setZoomRatio(o.value))},De=R=>{c.value={x:R.clientX,y:R.clientY},e.isPanning=!0,f.value={...u.value}},Ae=async R=>{if(c.value===null)throw new Error("mouseDownPoint is null");const te=c.value.x-R.clientX,pe=c.value.y-R.clientY,We=f.value.x-te,Ke=f.value.y-pe;u.value={x:We,y:Ke},await ye()},He=async R=>{if(a.value===null){a.value={x:R.clientX,y:R.clientY};return}const te=R.clientX-a.value.x,pe=R.clientY-a.value.y;u.value.x+=te,u.value.y+=pe,await ye(),a.value={x:R.clientX,y:R.clientY}},_t=R=>{if(R.preventDefault(),!(E.value.length>0))if(e.brushVisible=!1,R.touches.length===2){const te=new Date().getTime();te-n.value<t?(he(),n.value=0):(n.value=te,r.value=!0,s.value=G(R.touches),i.value=W(R.touches))}else R.touches.length===1&&(a.value={x:R.touches[0].clientX,y:R.touches[0].clientY})},Ot=async R=>{if(R.preventDefault(),!(E.value.length>0))if(n.value=0,r.value&&R.touches.length===2){const te=G(R.touches),pe=te/s.value,We=o.value;o.value=Math.max(.2,Math.min(10,o.value*pe));const Ke=o.value,qe=W(R.touches);if(i.value){const St=qe.x-i.value.x,pt=qe.y-i.value.y;u.value.x+=St,u.value.y+=pt}if(d.value===null&&(d.value=e.maskCanvas),!d.value)return;const ut=d.value.getBoundingClientRect(),ht=qe.x-ut.left,yt=qe.y-ut.top,Dt=Ke/We;u.value.x+=ht-ht*Dt,u.value.y+=yt-yt*Dt,await ye(),s.value=te,i.value=qe}else R.touches.length===1&&await He(R.touches[0])},Ut=R=>{R.preventDefault();const te=R.touches[0];te?a.value={x:te.clientX,y:te.clientY}:(r.value=!1,i.value={x:0,y:0})},ei=async R=>{const te={x:R.clientX,y:R.clientY},pe=o.value,We=R.deltaY<0?1.1:.9;o.value=Math.max(.2,Math.min(10,o.value*We));const Ke=o.value;if(d.value||(d.value=e.maskCanvas),!d.value)return;const qe=d.value.getBoundingClientRect(),ut=te.x-qe.left,ht=te.y-qe.top,yt=Ke/pe;u.value.x+=ut-ut*yt,u.value.y+=ht-ht*yt,await ye();const St=d.value.clientWidth/J.value;l.value=St,e.displayZoomRatio=St,ee(te)},tn=()=>{var pe,We;const R=((pe=T.value)==null?void 0:pe.getBoundingClientRect().width)||64;return{sidePanelWidth:((We=z.value)==null?void 0:We.getBoundingClientRect().width)||220,toolPanelWidth:R}},ti=async(R=500)=>{if(!U.value||!y.value)return;const te=o.value,pe={...u.value},{sidePanelWidth:We,toolPanelWidth:Ke}=tn(),qe=y.value.clientWidth-We-Ke,ut=y.value.clientHeight,ht=qe/U.value.width,yt=ut/U.value.height,Dt=Math.min(ht,yt),St=U.value.width/U.value.height;let pt,zt;const jt={x:Ke,y:0};yt>ht?(pt=qe,zt=pt/St,jt.y=(ut-zt)/2):(zt=ut,pt=zt*St,jt.x=(qe-pt)/2+Ke);const ri=performance.now(),Qr=async Wn=>{const Jr=Wn-ri,$=Math.min(Jr/R,1),b=1-Math.pow(1-$,3);o.value=te+(Dt-te)*b,u.value.x=pe.x+(jt.x-pe.x)*b,u.value.y=pe.y+(jt.y-pe.y)*b,await ye();const P=te+(1-te)*b;e.displayZoomRatio=P,$<1&&requestAnimationFrame(Qr)};requestAnimationFrame(Qr),l.value=1},ni=async(R,te,pe,We)=>{y.value=te,T.value=pe||null,z.value=We||null;const{sidePanelWidth:Ke,toolPanelWidth:qe}=tn(),ut=te.clientWidth-Ke-qe,ht=te.clientHeight,yt=ut/R.width,Dt=ht/R.height,St=R.width/R.height;let pt,zt;const jt={x:qe,y:0};Dt>yt?(pt=ut,zt=pt/St,jt.y=(ht-zt)/2):(zt=ht,pt=zt*St,jt.x=(ut-pt)/2+qe),U.value===null&&(U.value=R),J.value=pt,j.value=zt,o.value=Math.min(yt,Dt),u.value=jt,E.value=[],await ye()};return Cn(()=>e.resetZoomTrigger,async()=>{l.value!==1&&await ti()}),{initializeCanvasPanZoom:ni,handlePanStart:De,handlePanMove:Ae,handleTouchStart:_t,handleTouchMove:Ot,handleTouchEnd:Ut,updateCursorPosition:ee,zoom:ei,invalidatePanZoom:ye}}function q1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}class Y1{constructor(t={}){if(!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||1/0,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[n,r]of t)this.onEviction(n,r.value)}_deleteIfExpired(t,n){return typeof n.expiry=="number"&&n.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,n.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,n){if(this._deleteIfExpired(t,n)===!1)return n.value}_getItemValue(t,n){return n.expiry?this._getOrDeleteIfExpired(t,n):n.value}_peek(t,n){const r=n.get(t);return this._getItemValue(t,r)}_set(t,n){this.cache.set(t,n),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,n){this.oldCache.delete(t),this._set(t,n)}*_entriesAscending(){for(const t of this.oldCache){const[n,r]=t;this.cache.has(n)||this._deleteIfExpired(n,r)===!1&&(yield t)}for(const t of this.cache){const[n,r]=t;this._deleteIfExpired(n,r)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const n=this.cache.get(t);return this._getItemValue(t,n)}if(this.oldCache.has(t)){const n=this.oldCache.get(t);if(this._deleteIfExpired(t,n)===!1)return this._moveToRecent(t,n),n.value}}set(t,n,{maxAge:r=this.maxAge===1/0?void 0:Date.now()+this.maxAge}={}){this.cache.has(t)?this.cache.set(t,{value:n,maxAge:r}):this._set(t,{value:n,expiry:r})}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const n=this.cache.delete(t);return n&&this._size--,this.oldCache.delete(t)||n}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const n=[...this._entriesAscending()],r=n.length-t;r<0?(this.cache=new Map(n),this.oldCache=new Map,this._size=n.length):(r>0&&this._emitEvictions(n.slice(0,r)),this.oldCache=new Map(n.slice(r)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[n,r]=t;this._deleteIfExpired(n,r)===!1&&(yield[n,r.value])}for(const t of this.oldCache){const[n,r]=t;this.cache.has(n)||this._deleteIfExpired(n,r)===!1&&(yield[n,r.value])}}*entriesDescending(){let t=[...this.cache];for(let n=t.length-1;n>=0;--n){const r=t[n],[s,i]=r;this._deleteIfExpired(s,i)===!1&&(yield[s,i.value])}t=[...this.oldCache];for(let n=t.length-1;n>=0;--n){const r=t[n],[s,i]=r;this.cache.has(s)||this._deleteIfExpired(s,i)===!1&&(yield[s,i.value])}}*entriesAscending(){for(const[t,n]of this._entriesAscending())yield[t,n.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const n of this.oldCache.keys())this.cache.has(n)||t++;return Math.min(this._size+t,this.maxSize)}}var X1=Y1;const Z1=q1(X1);function dc({r:e,g:t,b:n}){e/=255,t/=255,n/=255;const r=Math.max(e,t,n),s=Math.min(e,t,n);let i=0,a=0;const o=(r+s)/2;if(r!==s){const l=r-s;switch(a=o>.5?l/(2-r-s):l/(r+s),r){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4;break}i/=6}return{h:i,s:a,l:o}}function hp(e){let t=0,n=0,r=0;return e.length==4?(t=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16),r=parseInt(e[3]+e[3],16)):e.length==7&&(t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16)),{r:t,g:n,b:r}}function ma(e){const t=pp(e);if(!t)return{r:0,g:0,b:0};const n=mp(e,t);if(!dp(n))return{r:0,g:0,b:0};const r=n.h/360,s=n.s/100,i=n.l/100,a=(1-Math.abs(2*i-1))*s,o=a*(1-Math.abs(r*6%2-1)),l=i-a/2;let u=0,c=0,f=0;return r<1/6?(u=a,c=o,f=0):r<2/6?(u=o,c=a,f=0):r<3/6?(u=0,c=a,f=o):r<4/6?(u=0,c=o,f=a):r<5/6?(u=o,c=0,f=a):(u=a,c=0,f=o),{r:Math.round((u+l)*255),g:Math.round((c+l)*255),b:Math.round((f+l)*255)}}const pp=e=>e?e.startsWith("#")&&(e.length===4||e.length===7)?"hex":/rgba?\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*/.test(e)?e.includes("rgba")?"rgba":"rgb":/hsla?\(\s*\d+(\.\d+)?\s*,\s*\d+(\.\d+)?%\s*,\s*\d+(\.\d+)?%/.test(e)?e.includes("hsla")?"hsla":"hsl":null:null,dp=e=>typeof e!="object"||e===null?!1:["h","s","l","a"].every(t=>typeof e[t]=="number"&&!isNaN(e[t]));function mp(e,t){let n;switch(t){case"hex":{const r=dc(hp(e));return{h:Math.round(r.h*360),s:+(r.s*100).toFixed(1),l:+(r.l*100).toFixed(1),a:1}}case"rgb":case"rgba":{if(n=e.match(/\d+(\.\d+)?/g),!n||n.length<3)return null;const[r,s,i]=n.map(Number),a=dc({r,g:s,b:i}),o=t==="rgba"&&n[3]?parseFloat(n[3]):1;return{h:Math.round(a.h*360),s:+(a.s*100).toFixed(1),l:+(a.l*100).toFixed(1),a:o}}case"hsl":case"hsla":{if(n=e.match(/\d+(\.\d+)?/g),!n||n.length<3)return null;const[r,s,i]=n.map(Number),a=t==="hsla"&&n[3]?parseFloat(n[3]):1;return{h:r,s,l:i,a}}default:return null}}const H1=(e,t)=>{if(!Object.keys(t).length)return e;const n=pp(e);if(!n)return console.warn(`Unsupported color format in color palette: ${e}`),e;const r=mp(e,n);return dp(r)?(t.lightness&&(r.l=Math.max(0,Math.min(100,r.l+t.lightness*100))),t.opacity&&(r.a=Math.max(0,Math.min(1,t.opacity))),`hsla(${r.h}, ${r.s}%, ${r.l}%, ${r.a})`):(console.warn(`Invalid color values in color palette: ${e}`),e)};wo(H1,(e,t)=>`${e}-${JSON.stringify(t)}`);function K1(e,t){try{const n=localStorage.getItem(e);return n?JSON.parse(n):t}catch{return t}}function Q1(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){console.warn("Failed to save to localStorage:",n)}}function J1(){const e=at();return{screenToCanvas:r=>{const s=B(e.pointerZone),i=B(e.canvasContainer),a=B(e.maskCanvas);if(!s||!i||!a)return console.warn("screenToCanvas called before elements are available"),{x:0,y:0};const o=s.getBoundingClientRect(),l=i.getBoundingClientRect(),u=a.getBoundingClientRect(),c=o.left+r.x,f=o.top+r.y,h=c-l.left,d=f-l.top,p=a.width/u.width,y=a.height/u.height,T=h*p,z=d*y;return{x:T,y:z}},canvasToScreen:r=>{const s=B(e.pointerZone),i=B(e.canvasContainer),a=B(e.maskCanvas);if(!s||!i||!a)return console.warn("canvasToScreen called before elements are available"),{x:0,y:0};const o=s.getBoundingClientRect(),l=i.getBoundingClientRect(),u=a.getBoundingClientRect(),c=u.width/a.width,f=u.height/a.height,h=r.x*c,d=r.y*f,p=l.left+h,y=l.top+d,T=p-o.left,z=y-o.top;return{x:T,y:z}}}}const yp=cp(J1);function e0(e,t,n,r,s){const a=(J,j,N)=>{const E=Math.hypot(N.x-j.x,N.y-j.y);return J+Math.pow(E,.5)},l=a(0,e,t),u=a(l,t,n),c=a(u,n,r),f=l+(u-l)*s,h=(J,j,N,E,G)=>{if(Math.abs(E-N)<1e-4)return J;const W=(G-N)/(E-N);return t0(mc(J,1-W),mc(j,W))},d=h(e,t,0,l,f),p=h(t,n,l,u,f),y=h(n,r,u,c,f),T=h(d,p,0,u,f),z=h(p,y,l,c,f);return h(T,z,l,u,f)}function t0(e,t){return{x:e.x+t.x,y:e.y+t.y}}function mc(e,t){return{x:e.x*t,y:e.y*t}}function gp(e,t,n){if(e.length===0)return{points:[],remainder:n};const r=[];let s=0,i=n;for(let o=0;o<e.length-1;o++){const l=e[o],u=e[o+1],c=u.x-l.x,f=u.y-l.y,h=Math.hypot(c,f);if(h<1e-4){for(;i<=s;)r.push(l),i+=t;continue}for(;i<=s+h;){const d=(i-s)/h,p=l.x+d*c,y=l.y+d*f;r.push({x:p,y}),i+=t}s+=h}const a=i-s;return{points:r,remainder:a}}var Dr="0.8.2",m=Symbol(`typegpu:${Dr}:$internal`),$e=Symbol(`typegpu:${Dr}:$gpuValueOf`),Ne=Symbol(`typegpu:${Dr}:$getNameForward`),$r=Symbol(`typegpu:${Dr}:$providing`),Bt=Symbol(`typegpu:${Dr}:$ownSnippet`),K=Symbol(`typegpu:${Dr}:$resolve`),Zs=Symbol(`typegpu:${Dr}:$repr`);function xe(e){return!!(e!=null&&e[m])}var Pt={[m]:!0,type:"void",toString(){return"void"}},n0=["bool","f32","f16","i32","u32","u16","vec2f","vec2h","vec2i","vec2u","vec2<bool>","vec3f","vec3h","vec3i","vec3u","vec3<bool>","vec4f","vec4h","vec4i","vec4u","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","struct","array","ptr","atomic","decorated","abstractInt","abstractFloat","void","texture_1d","texture_storage_1d","texture_2d","texture_storage_2d","texture_multisampled_2d","texture_depth_2d","texture_depth_multisampled_2d","texture_2d_array","texture_storage_2d_array","texture_depth_2d_array","texture_cube","texture_depth_cube","texture_cube_array","texture_depth_cube_array","texture_3d","texture_storage_3d","texture_external","sampler","sampler_comparison"];function Ee(e){let t=e;return xe(t)&&typeof t.kind=="string"&&t.kind.startsWith("vec")}function ll(e){let t=e;return xe(t)&&typeof t.type=="string"&&t.type.startsWith("vec2")}function ul(e){let t=e;return xe(t)&&typeof t.type=="string"&&t.type.startsWith("vec3")}function wp(e){let t=e;return xe(t)&&typeof t.type=="string"&&t.type.startsWith("vec4")}function Gn(e){return ll(e)||ul(e)||wp(e)}function vn(e){var n;let t=e;return xe(t)&&typeof((n=t.kind)==null?void 0:n.startsWith)=="function"&&t.kind.startsWith("mat")}function vp(e){return xe(e)&&(e==null?void 0:e.type)==="mat2x2f"}function xp(e){return xe(e)&&(e==null?void 0:e.type)==="mat3x3f"}function r0(e){return xe(e)&&(e==null?void 0:e.type)==="mat4x4f"}function Ei(e){return vp(e)||xp(e)||r0(e)}function yc(e){return Ee(e)&&["vec2f","vec3f","vec4f"].includes(e.kind)}function jr(e){return xe(e)&&n0.includes(e==null?void 0:e.type)}function on(e){return xe(e)&&(e==null?void 0:e.type)==="array"}function bt(e){return xe(e)&&(e==null?void 0:e.type)==="struct"}function gc(e){return xe(e)&&(e==null?void 0:e.type)==="ptr"}function s0(e){return xe(e)&&(e==null?void 0:e.type)==="atomic"}function bp(e){return xe(e)&&(e==null?void 0:e.type)==="@align"}function $p(e){return xe(e)&&(e==null?void 0:e.type)==="@size"}function i0(e){return xe(e)&&(e==null?void 0:e.type)==="@location"}function a0(e){return xe(e)&&(e==null?void 0:e.type)==="@builtin"}function Wr(e){return xe(e)&&(e==null?void 0:e.type)==="decorated"}function Tp(e){return xe(e)&&e.type==="void"}function Nn(e){let t=e==null?void 0:e.type;return xe(e)&&(t==="abstractInt"||t==="abstractFloat"||t==="f32"||t==="f16"||t==="i32"||t==="u32")}function wu(e){let t=e==null?void 0:e.type;return xe(e)&&(t==="f16"||t==="vec2h"||t==="vec3h"||t==="vec4h")}Object.assign(globalThis,{__TYPEGPU_AUTONAME__:(e,t)=>(bo(e)&&xe(e)&&!O(e)&&e.$name(t),e)});var mi=globalThis;function _p(e){return!!(e!=null&&e[Ne])}function O(e){var t;return _p(e)?O(e[Ne]):(t=$o(e))==null?void 0:t.name}function _e(e,t){_p(e)&&_e(e[Ne],t),o0(e,{name:t})}function bo(e){return!!(e!=null&&e.$name)}function bi(e){var t;return!!((t=$o(e))!=null&&t.ast)}function $o(e){return mi.__TYPEGPU_META__.get(e)}function o0(e,t){mi.__TYPEGPU_META__??(mi.__TYPEGPU_META__=new WeakMap);let n=mi.__TYPEGPU_META__;n.set(e,{...n.get(e),...t})}var Sp=["uint8","uint8x2","uint8x4","sint8","sint8x2","sint8x4","unorm8","unorm8x2","unorm8x4","snorm8","snorm8x2","snorm8x4","uint16","uint16x2","uint16x4","sint16","sint16x2","sint16x4","unorm16","unorm16x2","unorm16x4","snorm16","snorm16x2","snorm16x4","float16","float16x2","float16x4","float32","float32x2","float32x3","float32x4","uint32","uint32x2","uint32x3","uint32x4","sint32","sint32x2","sint32x3","sint32x4","unorm10-10-10-2","unorm8x4-bgra"],l0={f32:"float32",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",f16:"float16",vec2h:"float16x2",vec4h:"float16x4",u32:"uint32",vec2u:"uint32x2",vec3u:"uint32x3",vec4u:"uint32x4",i32:"sint32",vec2i:"sint32x2",vec3i:"sint32x3",vec4i:"sint32x4"};function ir(e){return e.type==="decorated"||e.type==="loose-decorated"?e.inner:e}var u0=["unstruct","disarray","loose-decorated",...Sp];function Qi(e){return xe(e)&&u0.includes(e==null?void 0:e.type)}function Hs(e){return xe(e)&&(e==null?void 0:e.type)==="disarray"}function hr(e){return xe(e)&&(e==null?void 0:e.type)==="unstruct"}function qr(e){return xe(e)&&(e==null?void 0:e.type)==="loose-decorated"}function $i(e){var t,n;return(n=(t=e.attribs)==null?void 0:t.find(bp))==null?void 0:n.params[0]}function c0(e){var t,n;return(n=(t=e.attribs)==null?void 0:t.find($p))==null?void 0:n.params[0]}function ar(e){var t,n;return(n=(t=e.attribs)==null?void 0:t.find(i0))==null?void 0:n.params[0]}function Ks(e){return jr(e)||Qi(e)}var xt={type:"unknown",toString(){return"unknown"}},wc=class{constructor(t,n,r){this.name=t,this.lhs=n,this.operator=r}},vc=class{constructor(t){this.matrix=t}},lf,xc=(lf=m,class{constructor(t){g(this,lf,!0);this.op=t,_e(this,"consoleLog")}}),f0="Invariant failed";function Rn(e,t){if(!e)throw new Error(f0)}var yi=class cl extends Error{constructor(t,n){let r=n.map(s=>`- ${bi(s)?`fn*:${O(s)}`:s}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Resolution of the following tree failed:
${r.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=n,Object.setPrototypeOf(this,cl.prototype)}appendToTrace(t){let n=[t,...this.trace];return new cl(this.cause,n)}},bc=class fl extends Error{constructor(t,n){let r=n.map(s=>`- ${s}`);r.length>20&&(r=[...r.slice(0,11),"...",...r.slice(-10)]),super(`Execution of the following tree failed:
${r.join(`
`)}: ${t&&typeof t=="object"&&"message"in t?t.message:t}`),this.cause=t,this.trace=n,Object.setPrototypeOf(this,fl.prototype)}appendToTrace(t){let n=[t,...this.trace];return new fl(this.cause,n)}},h0=class zp extends Error{constructor(t){super(`Missing value for '${t}'`),this.slot=t,Object.setPrototypeOf(this,zp.prototype)}},p0=class kp extends Error{constructor(t){super(`Buffer '${O(t)??"<unnamed>"}' is not bindable as a uniform. Use .$usage('uniform') to allow it.`),Object.setPrototypeOf(this,kp.prototype)}},d0=class Mp extends Error{constructor(t,n){super(`The function '${t??"<unnamed>"}' is missing links to the following external values: ${n}.`),Object.setPrototypeOf(this,Mp.prototype)}},vu=class Pp extends Error{constructor(t){super(`Missing bind groups for layouts: '${[...t].map(n=>O(n)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(bindGroup).(...)`),Object.setPrototypeOf(this,Pp.prototype)}},Ip=class Bp extends Error{constructor(t){super(`Missing vertex buffers for layouts: '${[...t].map(n=>O(n)??"<unnamed>").join(", ")}'. Please provide it using pipeline.with(layout, buffer).(...)`),Object.setPrototypeOf(this,Bp.prototype)}},$c=class Ep extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ep.prototype)}},Tc=class Ap extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ap.prototype)}},Kt=class Op extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Op.prototype)}};function hl(e){return(e==null?void 0:e.resourceType)==="slot"}function pl(e){return(e==null?void 0:e.resourceType)==="derived"}function dl(e){return(e==null?void 0:e[$r])!==void 0}function To(e){return(e==null?void 0:e.resourceType)==="accessor"}var Up=class{constructor(t,n){this.value=t,this.dataType=n}};function xu(e){return e instanceof Up}function ya(e){return Nn(e.dataType)}function S(e,t){return new Up(e,ir(t))}var Rp=class{constructor(){g(this,"type","normal")}},m0=class{constructor(){g(this,"type","codegen")}},y0=class{constructor(e,t){g(this,"type","simulate");this.buffers=e,this.vars=t}};function Cp(e){return!!(e!=null&&e[K])}function bu(e){return e==null?void 0:e[Bt]}function g0(e){return typeof e=="number"||typeof e=="boolean"||typeof e=="string"||Cp(e)||jr(e)||hl(e)||pl(e)||dl(e)}function ml(e){return!!e&&typeof e=="object"&&"getMappedRange"in e&&"mapAsync"in e}var Ma=!1;function w0(e){if(Ma)return e();try{return Ma=!0,e()}finally{Ma=!1}}function Na(){return Ma}var Qt;function Vp(e,t){if(Rn(Qt===void 0||Qt===e),Qt===e)return t();Qt=e;try{return t()}finally{Qt=void 0}}function Cr(){return Qt}var Lp=new Rp;function Da(){return(Qt==null?void 0:Qt.mode)??Lp}function In(){return(Qt==null?void 0:Qt.mode.type)==="codegen"}function x(e,...t){let n=Cr();function r(i){return xu(i)?n.resolve(i.value,i.dataType).value:i}let s="";for(let i=0;i<e.length;++i){s+=e[i];let a=t[i];Array.isArray(a)?s+=a.filter(o=>o!==void 0).map(r).join(", "):a&&(s+=r(a))}return s}function Ws(e,t){throw new Error(`Failed to handle ${e} at ${t}`)}var $u={rank:Number.POSITIVE_INFINITY,action:"none"};function ja(e,t){let n=ir(e),r=ir(t);if(n.type===r.type)return{rank:0,action:"none"};if(n.type==="abstractFloat"){if(r.type==="f32")return{rank:1,action:"none"};if(r.type==="f16")return{rank:2,action:"none"}}if(n.type==="abstractInt"){if(r.type==="i32")return{rank:3,action:"none"};if(r.type==="u32")return{rank:4,action:"none"};if(r.type==="abstractFloat")return{rank:5,action:"none"};if(r.type==="f32")return{rank:6,action:"none"};if(r.type==="f16")return{rank:7,action:"none"}}return Gn(n)&&Gn(r)?ja(n.primitive,r.primitive):Ei(n)&&Ei(r)?{rank:0,action:"none"}:$u}function v0(e,t){let n=ir(e),r=ir(t);if(n.type==="ptr"&&ja(n.inner,r).rank<Number.POSITIVE_INFINITY)return{rank:0,action:"deref"};if(r.type==="ptr"&&ja(n,r.inner).rank<Number.POSITIVE_INFINITY)return{rank:1,action:"ref"};let s={f32:0,f16:1,i32:2,u32:3,bool:4};if(n.type in s&&r.type in s){let i=n.type,a=r.type;if(i!==a){let o=s[i];return{rank:s[a]<o?10:20,action:"cast",targetType:r}}}if(n.type==="abstractFloat"){if(r.type==="u32")return{rank:2,action:"cast",targetType:r};if(r.type==="i32")return{rank:1,action:"cast",targetType:r}}return $u}function x0(e,t,n){let r=ja(e,t);return r.rank<Number.POSITIVE_INFINITY?r:n?v0(e,t):$u}function _c(e,t,n){let r;for(let i of t){let a=[],o=0;for(let l of e){let u=x0(l,i,n);if(o+=u.rank,u.rank===Number.POSITIVE_INFINITY)break;a.push(u)}o<((r==null?void 0:r.sum)??Number.POSITIVE_INFINITY)&&(r={type:i,details:a,sum:o})}if(!r)return;let s=r.details.map((i,a)=>({sourceIndex:a,action:i.action,...i.action==="cast"&&{targetType:i.targetType}}));return{targetType:r.type,actions:s,hasImplicitConversions:s.some(i=>i.action==="cast")}}function Tu(e,t){if(e.length===0)return;let n=[...new Set((t||e).map(ir))],r=_c(e,n,!1);if(r)return r;let s=_c(e,n,!0);if(s)return s}function b0(e,t,n){if(t.action==="none")return S(e.value,n);switch(t.action){case"ref":return S(x`&${e}`,n);case"deref":return S(x`*${e}`,n);case"cast":return n(e);default:Ws(t.action,"applyActionToSnippet")}}function $t(e,t){if(e.some(r=>r.type==="unknown"))return;let n=Tu(e,t);if(n)return e.map(()=>n.targetType)}function Ti(e,t,n=!0){let r=e.map(i=>i.dataType);if(r.some(i=>i.type==="unknown"))return;let s=Tu(r,t);if(s)return e.map((i,a)=>{let o=s.actions[a];return Rn(o),b0(i,o,s.targetType)})}function yl(e,t,n=!0){if(t===e.dataType)return S(e.value,t);if(e.dataType.type==="unknown")return S(x`${S(e.value,t)}`,t);let r=Ti([e],[t],n);if(!r)throw new Kt(`Cannot convert value of type '${e.dataType.type}' to type '${t.type}'`);return r[0]}function $0(e,t){return Object.keys(e.propTypes).map(n=>{var i;let r=t[n];if(!r)throw new Error(`Missing property ${n}`);let s=e.propTypes[n];return((i=Ti([r],[s]))==null?void 0:i[0])??r})}function T0(e){return typeof e!="string"&&bu(e)===void 0}function ot(e,t,n,r="keep"){let s=(...i)=>In()?t(...i):e(...i);return _e(s,n),s.toString=()=>n,Object.defineProperty(s,m,{value:{jsImpl:e,gpuImpl:t,argConversionHint:r}}),s}var Gt=class extends Error{constructor(t){super(t),this.name=this.constructor.name}};function M(e){let t=(...r)=>{let{argTypes:s,returnType:i}=typeof e.signature=="function"?e.signature(...r.map(o=>o.dataType)):e.signature,a=r.map((o,l)=>yl(o,s[l],!e.ignoreImplicitCastWarning));if(a.every(o=>T0(o.value))&&typeof e.normalImpl=="function")try{return S(e.normalImpl(...a.map(o=>o.value)),i)}catch(o){if(!(o instanceof Gt))throw o}return S(e.codegenImpl(...a),i)},n=(...r)=>{if(In())return t(...r);if(typeof e.normalImpl=="string")throw new Gt(e.normalImpl);return e.normalImpl(...r)};return _e(n,e.name),n.toString=()=>e.name,Object.defineProperty(n,m,{value:{jsImpl:e.normalImpl,gpuImpl:t,argConversionHint:"keep"}}),n}var _o={[m]:!0,type:"abstractInt",toString(){return"abstractInt"}},un={[m]:!0,type:"abstractFloat",toString(){return"abstractFloat"}},_0=M({name:"bool",signature:e=>({argTypes:e?[e]:[],returnType:Ve}),normalImpl(e){return e===void 0?!1:typeof e=="boolean"?e:!!e},codegenImpl:e=>e.dataType.type==="bool"?x`${e}`:x`bool(${e})`}),Ve=Object.assign(_0,{type:"bool"}),S0=M({name:"u32",signature:e=>({argTypes:e?[e]:[],returnType:V}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:(e&4294967295)>>>0},codegenImpl:e=>e.dataType.type==="u32"?x`${e}`:x`u32(${e})`}),V=Object.assign(S0,{type:"u32"}),z0=M({name:"i32",signature:e=>({argTypes:e?[e]:[],returnType:Te}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:e|0},codegenImpl:e=>e.dataType.type==="i32"?x`${e}`:x`i32(${e})`}),Te=Object.assign(z0,{type:"i32"}),k0=M({name:"f32",signature:e=>({argTypes:e?[e]:[],returnType:v}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:Math.fround(e)},codegenImpl:e=>e.dataType.type==="f32"?x`${e}`:x`f32(${e})`}),v=Object.assign(k0,{type:"f32"}),Fp=new ArrayBuffer(4),M0=new Float32Array(Fp),P0=new Uint32Array(Fp);function I0(e){M0[0]=e;let t=P0[0],n=t>>>31&1,r=t>>>23&255,s=t&8388607;return r===255?n<<15|31744|(s?512:0):(r=r-127+15,r<=0?r<-10?n<<15:(s=(s|8388608)>>1-r,s=s+4096>>13,n<<15|s):r>=31||(s=s+4096,s&8388608&&(s=0,++r,r>=31))?n<<15|31744:n<<15|r<<10|s>>13)}function B0(e){let t=e&32768?-1:1,n=e>>10&31,r=e&1023;return n===0?r?t*r*2**-24:t*0:n===31?r?Number.NaN:t===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:t*(1+r/1024)*2**(n-15)}function E0(e){return B0(I0(e))}var A0=M({name:"f16",signature:e=>({argTypes:e?[e]:[],returnType:Xe}),normalImpl(e){return e===void 0?0:typeof e=="boolean"?e?1:0:E0(e)},codegenImpl:e=>e.dataType.type==="f16"?x`${e}`:x`f16(${e})`}),Xe=Object.assign(A0,{type:"f16"}),_u=class extends Array{castElement(){return this[m].elementSchema[m].jsImpl}[K](){let t=this[m].elementSchema;return this.every(n=>!n)?S(`${this.kind}()`,t):this.every(n=>this[0]===n)?S(`${this.kind}(${this[0]})`,t):S(`${this.kind}(${this.join(", ")})`,t)}toString(){return this[K]().value}get xx(){return new this._Vec2(this[0],this[0])}get xy(){return new this._Vec2(this[0],this[1])}get xz(){return new this._Vec2(this[0],this[2])}get xw(){return new this._Vec2(this[0],this[3])}get yx(){return new this._Vec2(this[1],this[0])}get yy(){return new this._Vec2(this[1],this[1])}get yz(){return new this._Vec2(this[1],this[2])}get yw(){return new this._Vec2(this[1],this[3])}get zx(){return new this._Vec2(this[2],this[0])}get zy(){return new this._Vec2(this[2],this[1])}get zz(){return new this._Vec2(this[2],this[2])}get zw(){return new this._Vec2(this[2],this[3])}get wx(){return new this._Vec2(this[3],this[0])}get wy(){return new this._Vec2(this[3],this[1])}get wz(){return new this._Vec2(this[3],this[2])}get ww(){return new this._Vec2(this[3],this[3])}get xxx(){return new this._Vec3(this[0],this[0],this[0])}get xxy(){return new this._Vec3(this[0],this[0],this[1])}get xxz(){return new this._Vec3(this[0],this[0],this[2])}get xxw(){return new this._Vec3(this[0],this[0],this[3])}get xyx(){return new this._Vec3(this[0],this[1],this[0])}get xyy(){return new this._Vec3(this[0],this[1],this[1])}get xyz(){return new this._Vec3(this[0],this[1],this[2])}get xyw(){return new this._Vec3(this[0],this[1],this[3])}get xzx(){return new this._Vec3(this[0],this[2],this[0])}get xzy(){return new this._Vec3(this[0],this[2],this[1])}get xzz(){return new this._Vec3(this[0],this[2],this[2])}get xzw(){return new this._Vec3(this[0],this[2],this[3])}get xwx(){return new this._Vec3(this[0],this[3],this[0])}get xwy(){return new this._Vec3(this[0],this[3],this[1])}get xwz(){return new this._Vec3(this[0],this[3],this[2])}get xww(){return new this._Vec3(this[0],this[3],this[3])}get yxx(){return new this._Vec3(this[1],this[0],this[0])}get yxy(){return new this._Vec3(this[1],this[0],this[1])}get yxz(){return new this._Vec3(this[1],this[0],this[2])}get yxw(){return new this._Vec3(this[1],this[0],this[3])}get yyx(){return new this._Vec3(this[1],this[1],this[0])}get yyy(){return new this._Vec3(this[1],this[1],this[1])}get yyz(){return new this._Vec3(this[1],this[1],this[2])}get yyw(){return new this._Vec3(this[1],this[1],this[3])}get yzx(){return new this._Vec3(this[1],this[2],this[0])}get yzy(){return new this._Vec3(this[1],this[2],this[1])}get yzz(){return new this._Vec3(this[1],this[2],this[2])}get yzw(){return new this._Vec3(this[1],this[2],this[3])}get ywx(){return new this._Vec3(this[1],this[3],this[0])}get ywy(){return new this._Vec3(this[1],this[3],this[1])}get ywz(){return new this._Vec3(this[1],this[3],this[2])}get yww(){return new this._Vec3(this[1],this[3],this[3])}get zxx(){return new this._Vec3(this[2],this[0],this[0])}get zxy(){return new this._Vec3(this[2],this[0],this[1])}get zxz(){return new this._Vec3(this[2],this[0],this[2])}get zxw(){return new this._Vec3(this[2],this[0],this[3])}get zyx(){return new this._Vec3(this[2],this[1],this[0])}get zyy(){return new this._Vec3(this[2],this[1],this[1])}get zyz(){return new this._Vec3(this[2],this[1],this[2])}get zyw(){return new this._Vec3(this[2],this[1],this[3])}get zzx(){return new this._Vec3(this[2],this[2],this[0])}get zzy(){return new this._Vec3(this[2],this[2],this[1])}get zzz(){return new this._Vec3(this[2],this[2],this[2])}get zzw(){return new this._Vec3(this[2],this[2],this[3])}get zwx(){return new this._Vec3(this[2],this[3],this[0])}get zwy(){return new this._Vec3(this[2],this[3],this[1])}get zwz(){return new this._Vec3(this[2],this[3],this[2])}get zww(){return new this._Vec3(this[2],this[3],this[3])}get wxx(){return new this._Vec3(this[3],this[0],this[0])}get wxy(){return new this._Vec3(this[3],this[0],this[1])}get wxz(){return new this._Vec3(this[3],this[0],this[2])}get wxw(){return new this._Vec3(this[3],this[0],this[3])}get wyx(){return new this._Vec3(this[3],this[1],this[0])}get wyy(){return new this._Vec3(this[3],this[1],this[1])}get wyz(){return new this._Vec3(this[3],this[1],this[2])}get wyw(){return new this._Vec3(this[3],this[1],this[3])}get wzx(){return new this._Vec3(this[3],this[2],this[0])}get wzy(){return new this._Vec3(this[3],this[2],this[1])}get wzz(){return new this._Vec3(this[3],this[2],this[2])}get wzw(){return new this._Vec3(this[3],this[2],this[3])}get wwx(){return new this._Vec3(this[3],this[3],this[0])}get wwy(){return new this._Vec3(this[3],this[3],this[1])}get wwz(){return new this._Vec3(this[3],this[3],this[2])}get www(){return new this._Vec3(this[3],this[3],this[3])}get xxxx(){return new this._Vec4(this[0],this[0],this[0],this[0])}get xxxy(){return new this._Vec4(this[0],this[0],this[0],this[1])}get xxxz(){return new this._Vec4(this[0],this[0],this[0],this[2])}get xxxw(){return new this._Vec4(this[0],this[0],this[0],this[3])}get xxyx(){return new this._Vec4(this[0],this[0],this[1],this[0])}get xxyy(){return new this._Vec4(this[0],this[0],this[1],this[1])}get xxyz(){return new this._Vec4(this[0],this[0],this[1],this[2])}get xxyw(){return new this._Vec4(this[0],this[0],this[1],this[3])}get xxzx(){return new this._Vec4(this[0],this[0],this[2],this[0])}get xxzy(){return new this._Vec4(this[0],this[0],this[2],this[1])}get xxzz(){return new this._Vec4(this[0],this[0],this[2],this[2])}get xxzw(){return new this._Vec4(this[0],this[0],this[2],this[3])}get xxwx(){return new this._Vec4(this[0],this[0],this[3],this[0])}get xxwy(){return new this._Vec4(this[0],this[0],this[3],this[1])}get xxwz(){return new this._Vec4(this[0],this[0],this[3],this[2])}get xxww(){return new this._Vec4(this[0],this[0],this[3],this[3])}get xyxx(){return new this._Vec4(this[0],this[1],this[0],this[0])}get xyxy(){return new this._Vec4(this[0],this[1],this[0],this[1])}get xyxz(){return new this._Vec4(this[0],this[1],this[0],this[2])}get xyxw(){return new this._Vec4(this[0],this[1],this[0],this[3])}get xyyx(){return new this._Vec4(this[0],this[1],this[1],this[0])}get xyyy(){return new this._Vec4(this[0],this[1],this[1],this[1])}get xyyz(){return new this._Vec4(this[0],this[1],this[1],this[2])}get xyyw(){return new this._Vec4(this[0],this[1],this[1],this[3])}get xyzx(){return new this._Vec4(this[0],this[1],this[2],this[0])}get xyzy(){return new this._Vec4(this[0],this[1],this[2],this[1])}get xyzz(){return new this._Vec4(this[0],this[1],this[2],this[2])}get xyzw(){return new this._Vec4(this[0],this[1],this[2],this[3])}get xywx(){return new this._Vec4(this[0],this[1],this[3],this[0])}get xywy(){return new this._Vec4(this[0],this[1],this[3],this[1])}get xywz(){return new this._Vec4(this[0],this[1],this[3],this[2])}get xyww(){return new this._Vec4(this[0],this[1],this[3],this[3])}get xzxx(){return new this._Vec4(this[0],this[2],this[0],this[0])}get xzxy(){return new this._Vec4(this[0],this[2],this[0],this[1])}get xzxz(){return new this._Vec4(this[0],this[2],this[0],this[2])}get xzxw(){return new this._Vec4(this[0],this[2],this[0],this[3])}get xzyx(){return new this._Vec4(this[0],this[2],this[1],this[0])}get xzyy(){return new this._Vec4(this[0],this[2],this[1],this[1])}get xzyz(){return new this._Vec4(this[0],this[2],this[1],this[2])}get xzyw(){return new this._Vec4(this[0],this[2],this[1],this[3])}get xzzx(){return new this._Vec4(this[0],this[2],this[2],this[0])}get xzzy(){return new this._Vec4(this[0],this[2],this[2],this[1])}get xzzz(){return new this._Vec4(this[0],this[2],this[2],this[2])}get xzzw(){return new this._Vec4(this[0],this[2],this[2],this[3])}get xzwx(){return new this._Vec4(this[0],this[2],this[3],this[0])}get xzwy(){return new this._Vec4(this[0],this[2],this[3],this[1])}get xzwz(){return new this._Vec4(this[0],this[2],this[3],this[2])}get xzww(){return new this._Vec4(this[0],this[2],this[3],this[3])}get xwxx(){return new this._Vec4(this[0],this[3],this[0],this[0])}get xwxy(){return new this._Vec4(this[0],this[3],this[0],this[1])}get xwxz(){return new this._Vec4(this[0],this[3],this[0],this[2])}get xwxw(){return new this._Vec4(this[0],this[3],this[0],this[3])}get xwyx(){return new this._Vec4(this[0],this[3],this[1],this[0])}get xwyy(){return new this._Vec4(this[0],this[3],this[1],this[1])}get xwyz(){return new this._Vec4(this[0],this[3],this[1],this[2])}get xwyw(){return new this._Vec4(this[0],this[3],this[1],this[3])}get xwzx(){return new this._Vec4(this[0],this[3],this[2],this[0])}get xwzy(){return new this._Vec4(this[0],this[3],this[2],this[1])}get xwzz(){return new this._Vec4(this[0],this[3],this[2],this[2])}get xwzw(){return new this._Vec4(this[0],this[3],this[2],this[3])}get xwwx(){return new this._Vec4(this[0],this[3],this[3],this[0])}get xwwy(){return new this._Vec4(this[0],this[3],this[3],this[1])}get xwwz(){return new this._Vec4(this[0],this[3],this[3],this[2])}get xwww(){return new this._Vec4(this[0],this[3],this[3],this[3])}get yxxx(){return new this._Vec4(this[1],this[0],this[0],this[0])}get yxxy(){return new this._Vec4(this[1],this[0],this[0],this[1])}get yxxz(){return new this._Vec4(this[1],this[0],this[0],this[2])}get yxxw(){return new this._Vec4(this[1],this[0],this[0],this[3])}get yxyx(){return new this._Vec4(this[1],this[0],this[1],this[0])}get yxyy(){return new this._Vec4(this[1],this[0],this[1],this[1])}get yxyz(){return new this._Vec4(this[1],this[0],this[1],this[2])}get yxyw(){return new this._Vec4(this[1],this[0],this[1],this[3])}get yxzx(){return new this._Vec4(this[1],this[0],this[2],this[0])}get yxzy(){return new this._Vec4(this[1],this[0],this[2],this[1])}get yxzz(){return new this._Vec4(this[1],this[0],this[2],this[2])}get yxzw(){return new this._Vec4(this[1],this[0],this[2],this[3])}get yxwx(){return new this._Vec4(this[1],this[0],this[3],this[0])}get yxwy(){return new this._Vec4(this[1],this[0],this[3],this[1])}get yxwz(){return new this._Vec4(this[1],this[0],this[3],this[2])}get yxww(){return new this._Vec4(this[1],this[0],this[3],this[3])}get yyxx(){return new this._Vec4(this[1],this[1],this[0],this[0])}get yyxy(){return new this._Vec4(this[1],this[1],this[0],this[1])}get yyxz(){return new this._Vec4(this[1],this[1],this[0],this[2])}get yyxw(){return new this._Vec4(this[1],this[1],this[0],this[3])}get yyyx(){return new this._Vec4(this[1],this[1],this[1],this[0])}get yyyy(){return new this._Vec4(this[1],this[1],this[1],this[1])}get yyyz(){return new this._Vec4(this[1],this[1],this[1],this[2])}get yyyw(){return new this._Vec4(this[1],this[1],this[1],this[3])}get yyzx(){return new this._Vec4(this[1],this[1],this[2],this[0])}get yyzy(){return new this._Vec4(this[1],this[1],this[2],this[1])}get yyzz(){return new this._Vec4(this[1],this[1],this[2],this[2])}get yyzw(){return new this._Vec4(this[1],this[1],this[2],this[3])}get yywx(){return new this._Vec4(this[1],this[1],this[3],this[0])}get yywy(){return new this._Vec4(this[1],this[1],this[3],this[1])}get yywz(){return new this._Vec4(this[1],this[1],this[3],this[2])}get yyww(){return new this._Vec4(this[1],this[1],this[3],this[3])}get yzxx(){return new this._Vec4(this[1],this[2],this[0],this[0])}get yzxy(){return new this._Vec4(this[1],this[2],this[0],this[1])}get yzxz(){return new this._Vec4(this[1],this[2],this[0],this[2])}get yzxw(){return new this._Vec4(this[1],this[2],this[0],this[3])}get yzyx(){return new this._Vec4(this[1],this[2],this[1],this[0])}get yzyy(){return new this._Vec4(this[1],this[2],this[1],this[1])}get yzyz(){return new this._Vec4(this[1],this[2],this[1],this[2])}get yzyw(){return new this._Vec4(this[1],this[2],this[1],this[3])}get yzzx(){return new this._Vec4(this[1],this[2],this[2],this[0])}get yzzy(){return new this._Vec4(this[1],this[2],this[2],this[1])}get yzzz(){return new this._Vec4(this[1],this[2],this[2],this[2])}get yzzw(){return new this._Vec4(this[1],this[2],this[2],this[3])}get yzwx(){return new this._Vec4(this[1],this[2],this[3],this[0])}get yzwy(){return new this._Vec4(this[1],this[2],this[3],this[1])}get yzwz(){return new this._Vec4(this[1],this[2],this[3],this[2])}get yzww(){return new this._Vec4(this[1],this[2],this[3],this[3])}get ywxx(){return new this._Vec4(this[1],this[3],this[0],this[0])}get ywxy(){return new this._Vec4(this[1],this[3],this[0],this[1])}get ywxz(){return new this._Vec4(this[1],this[3],this[0],this[2])}get ywxw(){return new this._Vec4(this[1],this[3],this[0],this[3])}get ywyx(){return new this._Vec4(this[1],this[3],this[1],this[0])}get ywyy(){return new this._Vec4(this[1],this[3],this[1],this[1])}get ywyz(){return new this._Vec4(this[1],this[3],this[1],this[2])}get ywyw(){return new this._Vec4(this[1],this[3],this[1],this[3])}get ywzx(){return new this._Vec4(this[1],this[3],this[2],this[0])}get ywzy(){return new this._Vec4(this[1],this[3],this[2],this[1])}get ywzz(){return new this._Vec4(this[1],this[3],this[2],this[2])}get ywzw(){return new this._Vec4(this[1],this[3],this[2],this[3])}get ywwx(){return new this._Vec4(this[1],this[3],this[3],this[0])}get ywwy(){return new this._Vec4(this[1],this[3],this[3],this[1])}get ywwz(){return new this._Vec4(this[1],this[3],this[3],this[2])}get ywww(){return new this._Vec4(this[1],this[3],this[3],this[3])}get zxxx(){return new this._Vec4(this[2],this[0],this[0],this[0])}get zxxy(){return new this._Vec4(this[2],this[0],this[0],this[1])}get zxxz(){return new this._Vec4(this[2],this[0],this[0],this[2])}get zxxw(){return new this._Vec4(this[2],this[0],this[0],this[3])}get zxyx(){return new this._Vec4(this[2],this[0],this[1],this[0])}get zxyy(){return new this._Vec4(this[2],this[0],this[1],this[1])}get zxyz(){return new this._Vec4(this[2],this[0],this[1],this[2])}get zxyw(){return new this._Vec4(this[2],this[0],this[1],this[3])}get zxzx(){return new this._Vec4(this[2],this[0],this[2],this[0])}get zxzy(){return new this._Vec4(this[2],this[0],this[2],this[1])}get zxzz(){return new this._Vec4(this[2],this[0],this[2],this[2])}get zxzw(){return new this._Vec4(this[2],this[0],this[2],this[3])}get zxwx(){return new this._Vec4(this[2],this[0],this[3],this[0])}get zxwy(){return new this._Vec4(this[2],this[0],this[3],this[1])}get zxwz(){return new this._Vec4(this[2],this[0],this[3],this[2])}get zxww(){return new this._Vec4(this[2],this[0],this[3],this[3])}get zyxx(){return new this._Vec4(this[2],this[1],this[0],this[0])}get zyxy(){return new this._Vec4(this[2],this[1],this[0],this[1])}get zyxz(){return new this._Vec4(this[2],this[1],this[0],this[2])}get zyxw(){return new this._Vec4(this[2],this[1],this[0],this[3])}get zyyx(){return new this._Vec4(this[2],this[1],this[1],this[0])}get zyyy(){return new this._Vec4(this[2],this[1],this[1],this[1])}get zyyz(){return new this._Vec4(this[2],this[1],this[1],this[2])}get zyyw(){return new this._Vec4(this[2],this[1],this[1],this[3])}get zyzx(){return new this._Vec4(this[2],this[1],this[2],this[0])}get zyzy(){return new this._Vec4(this[2],this[1],this[2],this[1])}get zyzz(){return new this._Vec4(this[2],this[1],this[2],this[2])}get zyzw(){return new this._Vec4(this[2],this[1],this[2],this[3])}get zywx(){return new this._Vec4(this[2],this[1],this[3],this[0])}get zywy(){return new this._Vec4(this[2],this[1],this[3],this[1])}get zywz(){return new this._Vec4(this[2],this[1],this[3],this[2])}get zyww(){return new this._Vec4(this[2],this[1],this[3],this[3])}get zzxx(){return new this._Vec4(this[2],this[2],this[0],this[0])}get zzxy(){return new this._Vec4(this[2],this[2],this[0],this[1])}get zzxz(){return new this._Vec4(this[2],this[2],this[0],this[2])}get zzxw(){return new this._Vec4(this[2],this[2],this[0],this[3])}get zzyx(){return new this._Vec4(this[2],this[2],this[1],this[0])}get zzyy(){return new this._Vec4(this[2],this[2],this[1],this[1])}get zzyz(){return new this._Vec4(this[2],this[2],this[1],this[2])}get zzyw(){return new this._Vec4(this[2],this[2],this[1],this[3])}get zzzx(){return new this._Vec4(this[2],this[2],this[2],this[0])}get zzzy(){return new this._Vec4(this[2],this[2],this[2],this[1])}get zzzz(){return new this._Vec4(this[2],this[2],this[2],this[2])}get zzzw(){return new this._Vec4(this[2],this[2],this[2],this[3])}get zzwx(){return new this._Vec4(this[2],this[2],this[3],this[0])}get zzwy(){return new this._Vec4(this[2],this[2],this[3],this[1])}get zzwz(){return new this._Vec4(this[2],this[2],this[3],this[2])}get zzww(){return new this._Vec4(this[2],this[2],this[3],this[3])}get zwxx(){return new this._Vec4(this[2],this[3],this[0],this[0])}get zwxy(){return new this._Vec4(this[2],this[3],this[0],this[1])}get zwxz(){return new this._Vec4(this[2],this[3],this[0],this[2])}get zwxw(){return new this._Vec4(this[2],this[3],this[0],this[3])}get zwyx(){return new this._Vec4(this[2],this[3],this[1],this[0])}get zwyy(){return new this._Vec4(this[2],this[3],this[1],this[1])}get zwyz(){return new this._Vec4(this[2],this[3],this[1],this[2])}get zwyw(){return new this._Vec4(this[2],this[3],this[1],this[3])}get zwzx(){return new this._Vec4(this[2],this[3],this[2],this[0])}get zwzy(){return new this._Vec4(this[2],this[3],this[2],this[1])}get zwzz(){return new this._Vec4(this[2],this[3],this[2],this[2])}get zwzw(){return new this._Vec4(this[2],this[3],this[2],this[3])}get zwwx(){return new this._Vec4(this[2],this[3],this[3],this[0])}get zwwy(){return new this._Vec4(this[2],this[3],this[3],this[1])}get zwwz(){return new this._Vec4(this[2],this[3],this[3],this[2])}get zwww(){return new this._Vec4(this[2],this[3],this[3],this[3])}get wxxx(){return new this._Vec4(this[3],this[0],this[0],this[0])}get wxxy(){return new this._Vec4(this[3],this[0],this[0],this[1])}get wxxz(){return new this._Vec4(this[3],this[0],this[0],this[2])}get wxxw(){return new this._Vec4(this[3],this[0],this[0],this[3])}get wxyx(){return new this._Vec4(this[3],this[0],this[1],this[0])}get wxyy(){return new this._Vec4(this[3],this[0],this[1],this[1])}get wxyz(){return new this._Vec4(this[3],this[0],this[1],this[2])}get wxyw(){return new this._Vec4(this[3],this[0],this[1],this[3])}get wxzx(){return new this._Vec4(this[3],this[0],this[2],this[0])}get wxzy(){return new this._Vec4(this[3],this[0],this[2],this[1])}get wxzz(){return new this._Vec4(this[3],this[0],this[2],this[2])}get wxzw(){return new this._Vec4(this[3],this[0],this[2],this[3])}get wxwx(){return new this._Vec4(this[3],this[0],this[3],this[0])}get wxwy(){return new this._Vec4(this[3],this[0],this[3],this[1])}get wxwz(){return new this._Vec4(this[3],this[0],this[3],this[2])}get wxww(){return new this._Vec4(this[3],this[0],this[3],this[3])}get wyxx(){return new this._Vec4(this[3],this[1],this[0],this[0])}get wyxy(){return new this._Vec4(this[3],this[1],this[0],this[1])}get wyxz(){return new this._Vec4(this[3],this[1],this[0],this[2])}get wyxw(){return new this._Vec4(this[3],this[1],this[0],this[3])}get wyyx(){return new this._Vec4(this[3],this[1],this[1],this[0])}get wyyy(){return new this._Vec4(this[3],this[1],this[1],this[1])}get wyyz(){return new this._Vec4(this[3],this[1],this[1],this[2])}get wyyw(){return new this._Vec4(this[3],this[1],this[1],this[3])}get wyzx(){return new this._Vec4(this[3],this[1],this[2],this[0])}get wyzy(){return new this._Vec4(this[3],this[1],this[2],this[1])}get wyzz(){return new this._Vec4(this[3],this[1],this[2],this[2])}get wyzw(){return new this._Vec4(this[3],this[1],this[2],this[3])}get wywx(){return new this._Vec4(this[3],this[1],this[3],this[0])}get wywy(){return new this._Vec4(this[3],this[1],this[3],this[1])}get wywz(){return new this._Vec4(this[3],this[1],this[3],this[2])}get wyww(){return new this._Vec4(this[3],this[1],this[3],this[3])}get wzxx(){return new this._Vec4(this[3],this[2],this[0],this[0])}get wzxy(){return new this._Vec4(this[3],this[2],this[0],this[1])}get wzxz(){return new this._Vec4(this[3],this[2],this[0],this[2])}get wzxw(){return new this._Vec4(this[3],this[2],this[0],this[3])}get wzyx(){return new this._Vec4(this[3],this[2],this[1],this[0])}get wzyy(){return new this._Vec4(this[3],this[2],this[1],this[1])}get wzyz(){return new this._Vec4(this[3],this[2],this[1],this[2])}get wzyw(){return new this._Vec4(this[3],this[2],this[1],this[3])}get wzzx(){return new this._Vec4(this[3],this[2],this[2],this[0])}get wzzy(){return new this._Vec4(this[3],this[2],this[2],this[1])}get wzzz(){return new this._Vec4(this[3],this[2],this[2],this[2])}get wzzw(){return new this._Vec4(this[3],this[2],this[2],this[3])}get wzwx(){return new this._Vec4(this[3],this[2],this[3],this[0])}get wzwy(){return new this._Vec4(this[3],this[2],this[3],this[1])}get wzwz(){return new this._Vec4(this[3],this[2],this[3],this[2])}get wzww(){return new this._Vec4(this[3],this[2],this[3],this[3])}get wwxx(){return new this._Vec4(this[3],this[3],this[0],this[0])}get wwxy(){return new this._Vec4(this[3],this[3],this[0],this[1])}get wwxz(){return new this._Vec4(this[3],this[3],this[0],this[2])}get wwxw(){return new this._Vec4(this[3],this[3],this[0],this[3])}get wwyx(){return new this._Vec4(this[3],this[3],this[1],this[0])}get wwyy(){return new this._Vec4(this[3],this[3],this[1],this[1])}get wwyz(){return new this._Vec4(this[3],this[3],this[1],this[2])}get wwyw(){return new this._Vec4(this[3],this[3],this[1],this[3])}get wwzx(){return new this._Vec4(this[3],this[3],this[2],this[0])}get wwzy(){return new this._Vec4(this[3],this[3],this[2],this[1])}get wwzz(){return new this._Vec4(this[3],this[3],this[2],this[2])}get wwzw(){return new this._Vec4(this[3],this[3],this[2],this[3])}get wwwx(){return new this._Vec4(this[3],this[3],this[3],this[0])}get wwwy(){return new this._Vec4(this[3],this[3],this[3],this[1])}get wwwz(){return new this._Vec4(this[3],this[3],this[3],this[2])}get wwww(){return new this._Vec4(this[3],this[3],this[3],this[3])}},Ji=class extends _u{constructor(n,r){super(2);g(this,"e0");g(this,"e1");this.e0=this.castElement()(n),this.e1=this.castElement()(r??n)}get 0(){return this.e0}get 1(){return this.e1}set 0(n){this.e0=this.castElement()(n)}set 1(n){this.e1=this.castElement()(n)}get x(){return this[0]}get y(){return this[1]}set x(n){this[0]=this.castElement()(n)}set y(n){this[1]=this.castElement()(n)}},ea=class extends _u{constructor(n,r,s){super(3);g(this,"e0");g(this,"e1");g(this,"e2");this.e0=this.castElement()(n),this.e1=this.castElement()(r??n),this.e2=this.castElement()(s??n)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}set 0(n){this.e0=this.castElement()(n)}set 1(n){this.e1=this.castElement()(n)}set 2(n){this.e2=this.castElement()(n)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(n){this[0]=this.castElement()(n)}set y(n){this[1]=this.castElement()(n)}set z(n){this[2]=this.castElement()(n)}},ta=class extends _u{constructor(n,r,s,i){super(4);g(this,"e0");g(this,"e1");g(this,"e2");g(this,"e3");this.e0=this.castElement()(n),this.e1=this.castElement()(r??n),this.e2=this.castElement()(s??n),this.e3=this.castElement()(i??n)}get 0(){return this.e0}get 1(){return this.e1}get 2(){return this.e2}get 3(){return this.e3}set 0(n){this.e0=this.castElement()(n)}set 1(n){this.e1=this.castElement()(n)}set 2(n){this.e2=this.castElement()(n)}set 3(n){this.e3=this.castElement()(n)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(n){this[0]=n}set y(n){this[1]=n}set z(n){this[2]=n}set w(n){this[3]=n}},Su=class Gp extends Ji{get[m](){return{elementSchema:v}}get kind(){return"vec2f"}get _Vec2(){return Gp}get _Vec3(){return Iu}get _Vec4(){return Uu}},zu=class Np extends Ji{get[m](){return{elementSchema:Xe}}get kind(){return"vec2h"}get _Vec2(){return Np}get _Vec3(){return Bu}get _Vec4(){return Ru}},ku=class Dp extends Ji{get[m](){return{elementSchema:Te}}get kind(){return"vec2i"}get _Vec2(){return Dp}get _Vec3(){return Eu}get _Vec4(){return Cu}},Mu=class jp extends Ji{get[m](){return{elementSchema:V}}get kind(){return"vec2u"}get _Vec2(){return jp}get _Vec3(){return Au}get _Vec4(){return Vu}},Pu=class Wp extends Ji{get[m](){return{elementSchema:Ve}}get kind(){return"vec2<bool>"}get _Vec2(){return Wp}get _Vec3(){return Ou}get _Vec4(){return Lu}},Iu=class qp extends ea{get[m](){return{elementSchema:v}}get kind(){return"vec3f"}get _Vec2(){return Su}get _Vec3(){return qp}get _Vec4(){return Uu}},Bu=class Yp extends ea{get[m](){return{elementSchema:Xe}}get kind(){return"vec3h"}get _Vec2(){return zu}get _Vec3(){return Yp}get _Vec4(){return Ru}},Eu=class Xp extends ea{get[m](){return{elementSchema:Te}}get kind(){return"vec3i"}get _Vec2(){return ku}get _Vec3(){return Xp}get _Vec4(){return Cu}},Au=class Zp extends ea{get[m](){return{elementSchema:V}}get kind(){return"vec3u"}get _Vec2(){return Mu}get _Vec3(){return Zp}get _Vec4(){return Vu}},Ou=class Hp extends ea{get[m](){return{elementSchema:Ve}}get kind(){return"vec3<bool>"}get _Vec2(){return Pu}get _Vec3(){return Hp}get _Vec4(){return Lu}},Uu=class Kp extends ta{get[m](){return{elementSchema:v}}get kind(){return"vec4f"}get _Vec2(){return Su}get _Vec3(){return Iu}get _Vec4(){return Kp}},Ru=class Qp extends ta{get[m](){return{elementSchema:Xe}}get kind(){return"vec4h"}get _Vec2(){return zu}get _Vec3(){return Bu}get _Vec4(){return Qp}},Cu=class Jp extends ta{get[m](){return{elementSchema:Te}}get kind(){return"vec4i"}get _Vec2(){return ku}get _Vec3(){return Eu}get _Vec4(){return Jp}},Vu=class ed extends ta{get[m](){return{elementSchema:V}}get kind(){return"vec4u"}get _Vec2(){return Mu}get _Vec3(){return Au}get _Vec4(){return ed}},Lu=class td extends ta{get[m](){return{elementSchema:Ve}}get kind(){return"vec4<bool>"}get _Vec2(){return Pu}get _Vec3(){return Ou}get _Vec4(){return td}},ve=Tt(Su,v),$n=Tt(zu,Xe),ft=Tt(ku,Te),Lt=Tt(Mu,V),Yr=Tt(Pu,Ve),rt=Tt(Iu,v),Tn=Tt(Bu,Xe),Nt=Tt(Eu,Te),Ye=Tt(Au,V),Xr=Tt(Ou,Ve),_=Tt(Uu,v),_n=Tt(Ru,Xe),Me=Tt(Cu,Te),Be=Tt(Vu,V),Zr=Tt(Lu,Ve),Wa={vec2f:ve,vec2h:$n,vec2i:ft,vec2u:Lt,"vec2<bool>":Yr,vec3f:rt,vec3h:Tn,vec3i:Nt,vec3u:Ye,"vec3<bool>":Xr,vec4f:_,vec4h:_n,vec4i:Me,vec4u:Be,"vec4<bool>":Zr};function Tt(e,t){let{kind:n,length:r}=new e,s=M({name:n,signature:(...a)=>({argTypes:a.map(o=>{let l=ir(o);return Gn(l)?l:t}),returnType:i}),normalImpl:(...a)=>{let o=new Array(a.length),l=0;for(let u of a)if(typeof u=="number"||typeof u=="boolean")o[l++]=u;else for(let c=0;c<u.length;++c)o[l++]=u[c];if(o.length<=1||o.length===r)return new e(...o);throw new Error(`'${n}' constructor called with invalid number of arguments.`)},ignoreImplicitCastWarning:!0,codegenImpl:(...a)=>x`${n}(${a})`}),i=Object.assign(s,{type:n,primitive:t,[Zs]:void 0});return i}var or={uint8:V,uint8x2:Lt,uint8x4:Be,sint8:Te,sint8x2:ft,sint8x4:Me,unorm8:v,unorm8x2:ve,unorm8x4:_,snorm8:v,snorm8x2:ve,snorm8x4:_,uint16:V,uint16x2:Lt,uint16x4:Be,sint16:Te,sint16x2:ft,sint16x4:Me,unorm16:v,unorm16x2:ve,unorm16x4:_,snorm16:v,snorm16x2:ve,snorm16x4:_,float16:v,float16x2:ve,float16x4:_,float32:v,float32x2:ve,float32x3:rt,float32x4:_,uint32:V,uint32x2:Lt,uint32x3:Ye,uint32x4:Be,sint32:Te,sint32x2:ft,sint32x3:Nt,sint32x4:Me,"unorm10-10-10-2":_,"unorm8x4-bgra":_},nd=new Set(Object.keys(or));function O0(e){return xe(e)&&nd.has(e==null?void 0:e.type)}function Ai(e){let t=String(e);if(t!=="[object Object]")return t;try{return JSON.stringify(e)}catch(n){return console.error("Error parsing JSON:",n),"<invalid json>"}}function gl(e){return Ee(e)||vn(e)?e.toString():Array.isArray(e)?`[${e.map(gl).join(", ")}]`:e&&typeof e=="object"?`{ ${Object.entries(e).map(([t,n])=>`${t}: ${gl(n)}`).join(", ")} }`:String(e)}var U0={f32:4,f16:2,i32:4,u32:4,bool:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,vec2b:8,vec3f:16,vec3h:8,vec3i:16,vec3u:16,vec3b:16,vec4f:16,vec4h:8,vec4i:16,vec4u:16,vec4b:16,mat2x2f:8,mat3x3f:16,mat4x4f:16,atomic:4};function R0(e){let t=e==null?void 0:e.type,n=U0[t];if(n!==void 0)return n;if(bt(e))return Object.values(e.propTypes).map(Ge).reduce((r,s)=>r>s?r:s);if(on(e))return Ge(e.elementType);if(hr(e)){let r=Object.values(e.propTypes)[0];return r?$i(r)??1:1}if(Hs(e))return $i(e.elementType)??1;if(Wr(e)||qr(e))return $i(e)??Ge(e.inner);if(nd.has(t))return 1;throw new Error(`Cannot determine alignment of data: ${Ai(e)}`)}function C0(e){if(hr(e)){let t=Object.values(e.propTypes)[0];return t?Jt(t):1}return Hs(e)?Jt(e.elementType):qr(e)?$i(e)??Jt(e.inner):$i(e)??1}var Sc=new WeakMap,zc=new WeakMap;function Ge(e){let t=Sc.get(e);return t===void 0&&(t=R0(e),Sc.set(e,t)),t}function Jt(e){let t=zc.get(e);return t===void 0&&(t=C0(e),zc.set(e,t)),t}var Ft=(e,t)=>{let n=t-1,r=~n;return e&n?(e&r)+t:e},V0={bool:4,f32:4,f16:2,i32:4,u32:4,u16:2,vec2f:8,vec2h:4,vec2i:8,vec2u:8,"vec2<bool>":8,vec3f:12,vec3h:6,vec3i:12,vec3u:12,"vec3<bool>":12,vec4f:16,vec4h:8,vec4i:16,vec4u:16,"vec4<bool>":16,mat2x2f:16,mat3x3f:48,mat4x4f:64,uint8:1,uint8x2:2,uint8x4:4,sint8:1,sint8x2:2,sint8x4:4,unorm8:1,unorm8x2:2,unorm8x4:4,snorm8:1,snorm8x2:2,snorm8x4:4,uint16:2,uint16x2:4,uint16x4:8,sint16:2,sint16x2:4,sint16x4:8,unorm16:2,unorm16x2:4,unorm16x4:8,snorm16:2,snorm16x2:4,snorm16x4:8,float16:2,float16x2:4,float16x4:8,float32:4,float32x2:8,float32x3:12,float32x4:16,uint32:4,uint32x2:8,uint32x3:12,uint32x4:16,sint32:4,sint32x2:8,sint32x3:12,sint32x4:16,"unorm10-10-10-2":4,"unorm8x4-bgra":4,atomic:4};function L0(e){let t=0,n=e.propTypes;for(let r of Object.values(n)){if(Number.isNaN(t))throw new Error("Only the last property of a struct can be unbounded");if(t=Ft(t,Ge(r)),t+=fe(r),Number.isNaN(t)&&r.type!=="array")throw new Error("Cannot nest unbounded struct within another struct")}return Ft(t,Ge(e))}function F0(e){let t=0,n=e.propTypes;for(let r of Object.values(n)){let s=Jt(r);t=Ft(t,s),t+=fe(r)}return t}function G0(e){let t=V0[e==null?void 0:e.type];if(t!==void 0)return t;if(bt(e))return L0(e);if(hr(e))return F0(e);if(on(e)){if(e.elementCount===0)return Number.NaN;let n=Ge(e.elementType);return Ft(fe(e.elementType),n)*e.elementCount}if(Hs(e)){let n=Jt(e.elementType);return Ft(fe(e.elementType),n)*e.elementCount}if(Wr(e)||qr(e))return c0(e)??fe(e.inner);throw new Error(`Cannot determine size of data: ${e}`)}var kc=new WeakMap;function fe(e){let t=kc.get(e);return t===void 0&&(t=G0(e),kc.set(e,t)),t}function N0(e){return fe(e)}function rd(e,t){return Wr(e)?new Mc(e.inner,[t,...e.attribs]):qr(e)?new Pc(e.inner,[t,...e.attribs]):Qi(e)?new Pc(e,[t]):new Mc(e,[t])}function xn(e,t){return rd(t,{[m]:!0,type:"@location",params:[e]})}function na(e){return(Wr(e)||qr(e))&&e.attribs.find(a0)!==void 0}function Fu(e){return!Wr(e)&&!qr(e)?"":e.attribs.map(t=>t.params.length===0?`${t.type} `:`${t.type}(${t.params.join(", ")}) `).join("")}var uf,sd=(uf=m,class{constructor(t,n){g(this,uf,!0);var i,a;this.inner=t,this.attribs=n;let r=(i=n.find(bp))==null?void 0:i.params[0],s=(a=n.find($p))==null?void 0:a.params[0];if(r!==void 0){if(r<=0)throw new Error(`Custom data alignment must be a positive number, got: ${r}.`);if(Math.log2(r)%1!==0)throw new Error(`Alignment has to be a power of 2, got: ${r}.`);if(jr(this.inner)&&r%Ge(this.inner)!==0)throw new Error(`Custom alignment has to be a multiple of the standard data alignment. Got: ${r}, expected multiple of: ${Ge(this.inner)}.`)}if(s!==void 0){if(s<fe(this.inner))throw new Error(`Custom data size cannot be smaller then the standard data size. Got: ${s}, expected at least: ${fe(this.inner)}.`);if(s<=0)throw new Error(`Custom data size must be a positive number. Got: ${s}.`)}}}),cf,ff,Mc=class extends(ff=sd,cf=m,ff){constructor(){super(...arguments);g(this,cf,!0);g(this,"type","decorated")}},hf,pf,Pc=class extends(pf=sd,hf=m,pf){constructor(){super(...arguments);g(this,hf,!0);g(this,"type","loose-decorated")}};function Oi(e,t){let n=e==null?void 0:e.type,r=n in or?or[n]:e;return typeof r!="function"?t:t===void 0?r():r(t)}function ra(e){return id(e,!1)}function it(e){return id(e,!0)}function id(e,t){let n=r=>Object.fromEntries(Object.entries(e).map(([s,i])=>[s,Oi(i,r==null?void 0:r[s])]));return Object.setPrototypeOf(n,D0),n.propTypes=e,Object.defineProperty(n,m,{value:{isAbstruct:t}}),n}var D0={type:"struct",$name(e){return _e(this,e),this},toString(){return`struct:${O(this)??"<unnamed>"}`}},Ui=ot((e,t)=>t===void 0?n=>Do(e,n):Do(e,t),(e,t)=>{if((t==null?void 0:t.value)===void 0){let n=r=>Ui[m].gpuImpl(e,r);return n[m]=!0,S(n,xt)}if(typeof t.value!="number")throw new Error(`Cannot create array schema with count unknown at compile-time: '${t.value}'`);return S(Do(e.value,t.value),e.value)},"arrayOf");function Do(e,t){let n=r=>{if(r&&r.length!==t)throw new Error(`Array schema of ${t} elements of type ${e.type} called with ${r.length} argument(s).`);return Array.from({length:t},(s,i)=>Oi(e,r==null?void 0:r[i]))};if(Object.setPrototypeOf(n,j0),Number.isNaN(fe(e)))throw new Error("Cannot nest runtime sized arrays.");if(n.elementType=e,!Number.isInteger(t)||t<0)throw new Error(`Cannot create array schema with invalid element count: ${t}.`);return n.elementCount=t,n}var j0={[m]:!0,type:"array",toString(){return`arrayOf(${this.elementType}, ${this.elementCount})`}};function gt(e,t){return rd(e,{[m]:!0,type:"@builtin",params:[t]})}var ad={vertexIndex:gt(V,"vertex_index"),instanceIndex:gt(V,"instance_index"),position:gt(_,"position"),clipDistances:gt(Ui(V,8),"clip_distances"),frontFacing:gt(Ve,"front_facing"),fragDepth:gt(v,"frag_depth"),sampleIndex:gt(V,"sample_index"),sampleMask:gt(V,"sample_mask"),localInvocationId:gt(Ye,"local_invocation_id"),localInvocationIndex:gt(V,"local_invocation_index"),globalInvocationId:gt(Ye,"global_invocation_id"),workgroupId:gt(Ye,"workgroup_id"),numWorkgroups:gt(Ye,"num_workgroups"),subgroupInvocationId:gt(V,"subgroup_invocation_id"),subgroupSize:gt(V,"subgroup_size")},W0={block:0,binaryExpr:1,assignmentExpr:2,logicalExpr:3,unaryExpr:4,numericLiteral:5,call:6,memberAccess:7,indexAccess:8,return:10,if:11,let:12,const:13,for:14,while:15,continue:16,break:17,arrayExpr:100,preUpdate:101,postUpdate:102,stringLiteral:103,objectExpr:104},wl={identifier:"i",destructuredObject:"d"},q0=1;const Y0=Object.freeze(Object.defineProperty({__proto__:null,FORMAT_VERSION:q0,FuncParameterType:wl,NodeTypeCatalog:W0},Symbol.toStringTag,{value:"Module"}));function _i(e,t){for(let[n,r]of Object.entries(t))e[n]=r,r&&(typeof r=="object"||typeof r=="function")&&O(r)===void 0&&_e(r,n)}function X0(e,t,n){let r=[...e.matchAll(/:\s*(?<arg>.*?)\s*[,)]/g)].map(s=>s?s[1]:void 0);n(Object.fromEntries(t.flatMap((s,i)=>{let a=r?r[i]:void 0;return bt(s)&&a!==void 0?[[a,s]]:[]})))}function od(e,t,n){var i;let r=e.match(/->\s(?<output>[\w\d_]+)\s{/),s=r?(i=r[1])==null?void 0:i.trim():void 0;bt(t)&&s&&!/\s/g.test(s)&&n({[s]:t})}function Z0(e){return new RegExp(`(?<![\\w\\$_.])${e.replaceAll(".","\\.").replaceAll("$","\\$")}(?![\\w\\$_])`,"g")}function So(e,t,n){return Object.entries(t).reduce((r,[s,i])=>{let a=Z0(s);if(n&&s!=="Out"&&s!=="In"&&!a.test(n)&&console.warn(`The external '${s}' wasn't used in the resolved template.`),g0(i)||Qi(i)||bi(i))return r.replaceAll(a,e.resolve(i).value);if(i!==null&&typeof i=="object"){let o=[...n.matchAll(new RegExp(`${s.replaceAll(".","\\.").replaceAll("$","\\$")}\\.(?<prop>.*?)(?![\\w\\$_])`,"g"))].map(l=>l[1]);return[...new Set(o)].reduce((l,u)=>u&&u in i?So(e,{[`${s}.${u}`]:i[u]},l):l,r)}return console.warn(`During resolution, the external '${s}' has been omitted. Only primitives, TGPU resources and plain JS objects can be used as externals.`),r},n)}function H0(e){let{strippedCode:t,argRange:n}=K0(e),r=new ld(t);r.consume("(");let s=[];for(;!r.isAt(")");){let a=[];for(;r.isAt("@");)r.parseUntil(Ic,Bc),r.consume(")"),a.push(r.lastParsed);r.parseUntil(J0);let o=r.lastParsed,l;r.isAt(":")&&(r.consume(":"),r.parseUntil(eb,nb),l=r.lastParsed),s.push({identifier:o,attributes:a,type:l}),r.isAt(",")&&r.consume(",")}r.consume(")");let i;if(r.isAt("->")){r.consume("->");let a=[];for(;r.isAt("@");)r.parseUntil(Ic,Bc),r.consume(")"),a.push(r.lastParsed);i={type:r.str.slice(r.pos),attributes:a}}return{args:s,ret:i,range:{begin:n[0],end:n[1]}}}function K0(e){let t=new ld(e),n="",r;for(;!t.isFinished();){if(t.isAt(Q0)){t.advanceBy(1);continue}if(t.isAt("//")){t.consume("//"),t.parseUntil(ud),t.advanceBy(1);continue}if(t.isAt("/*")){t.parseUntil(tb,rb),t.consume("*/");continue}if(t.isAt("{"))return{strippedCode:n,argRange:[r,t.pos]};t.isAt("(")&&r===void 0&&(r=t.pos),r!==void 0&&(n+=t.str[t.pos]),t.advanceBy(1)}throw new Error("Invalid wgsl code!")}var $s,wt,df,ld=(df=class{constructor(t){Z(this,$s);Z(this,wt);this.str=t,q(this,wt,0)}get pos(){return w(this,wt)}get lastParsed(){if(w(this,$s)===void 0)throw new Error("Parse was not called yet!");return this.str.slice(w(this,$s),this.pos)}isFinished(){return w(this,wt)>=this.str.length}isAt(t){if(typeof t=="string"){for(let n=0;n<t.length;n++)if(this.str[w(this,wt)+n]!==t[n])return!1;return!0}for(let n of t)if(this.isAt(n))return!0;return!1}parseUntil(t,n){q(this,$s,w(this,wt));let r=0;for(;w(this,wt)<this.str.length;){if(n&&this.isAt(n[0])&&(r+=1),n&&this.isAt(n[1])&&(r-=1),r===0&&this.isAt(t))return w(this,wt);q(this,wt,w(this,wt)+1)}throw new Error("Reached the end of the string without finding a match!")}advanceBy(t){q(this,wt,w(this,wt)+t)}consume(t){if(!this.isAt(t))throw new Error(`Expected '${t}' at position ${w(this,wt)}, but found '${this.str.slice(w(this,wt),w(this,wt)+t.length)}'`);this.advanceBy(t.length)}},$s=new WeakMap,wt=new WeakMap,df),ud=new Set([`
`,"\v","\f","\r","","\u2028","\u2029"]),Q0=new Set([...ud," ","	","",""]),Ic=new Set([")"]),J0=new Set([":",",",")"]),eb=new Set([",",")"]),tb=new Set(["*/"]),Bc=["(",")"],nb=["<",">"],rb=["/*","*/"];function sa(e,t=""){let n=[],r={applyExternals(i){n.push(i)},resolve(i,a,o){var J;let l={};for(let j of n)_i(l,j);let u=i.getUniqueName(this);if(typeof e=="string"){if(!o)throw new Error("Explicit return type is required for string implementation");let j=So(i,l,e),N="",E="";if(t!==""){let G=bt(a[0])?`(in: ${i.resolve(a[0]).value})`:"()",W=jr(o)?Fu(o):"",ee=o!==Pt?bt(o)?`-> ${i.resolve(o).value}`:`-> ${W!==""?W:"@location(0)"} ${i.resolve(o).value}`:"";N=`${G} ${ee} `,E=j}else{let G=H0(j);if(G.args.length!==a.length)throw new Error(`WGSL implementation has ${G.args.length} arguments, while the shell has ${a.length} arguments.`);let W=G.args.map((he,ye)=>`${he.identifier}: ${Ec(i,`parameter ${he.identifier}`,he.type,a[ye])}`).join(", "),ee=o===Pt?"":`-> ${Ec(i,"return type",(J=G.ret)==null?void 0:J.type,o)}`;N=`(${W}) ${ee}`,E=j.slice(G.range.end)}return i.addDeclaration(`${t}fn ${u}${N}${E}`),S(u,o)}let c=$o(e);if(c!=null&&c.externals){let j=Object.fromEntries(Object.entries(c.externals).filter(([N])=>!(N in l)));_i(l,j)}let f=c==null?void 0:c.ast;if(!f)throw new Error("Missing metadata for tgpu.fn function body (either missing 'use gpu' directive, or misconfigured `unplugin-typegpu`)");let h=f.externalNames.filter(j=>!(j in l));if(h.length>0)throw new d0(O(this),h);let d=f.params[1];d&&d.type==="i"&&t!==""&&_i(l,{[d.name]:ir(o)});let p=[],y=[];for(let[j,N]of a.entries()){let E=f.params[j];switch(E==null?void 0:E.type){case wl.identifier:{let G=E.name,W=S(i.makeNameValid(G),N);p.push(W),W.value!==G&&y.push([G,W]);break}case wl.destructuredObject:{p.push(S(`_arg_${j}`,N)),y.push(...E.props.map(({name:G,alias:W})=>[W,S(`_arg_${j}.${G}`,a[j].propTypes[G])]));break}case void 0:p.push(S(`_arg_${j}`,N))}}let{head:T,body:z,returnType:U}=i.fnToWgsl({args:p,argAliases:Object.fromEntries(y),returnType:o,body:f.body,externalMap:l});return i.addDeclaration(`${t}fn ${u}${i.resolve(T).value}${i.resolve(z).value}`),S(u,U)}},s=O(e);return s!==void 0&&_e(r,s),r}function Ec(e,t,n,r){let s=e.resolve(r).value.replace(/\s/g,"");if(!n)return s;let i=n.replace(/\s/g,"");if(i!==s)throw new Error(`Type mismatch between TGPU shell and WGSL code string: ${t}, JS type "${s}", WGSL type "${i}".`);return n}function sb(e,t={}){let n=0,r=new Set;return Object.fromEntries(Object.entries(e??{}).map(([s,i])=>{let a=ar(i);if(a!==void 0){if(r.has(a))throw new Error("Duplicate custom location attributes found");r.add(a)}return[s,i]}).map(([s,i])=>{if(na(i))return[s,i];if(ar(i)!==void 0)return[s,i];if(t[s])return[s,xn(t[s],i)];for(;r.has(n);)n++;return[s,xn(n++,i)]}))}function ia(e,t={}){return Ks(e)?Tp(e)||ar(e)!==void 0?e:xn(0,e):ra(sb(e,t))}function zo(e,...t){return ib(e)?ab(e,...t):e}function ib(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)&&e.raw.every(t=>typeof t=="string")}function ab(e,...t){return e.slice(1).reduce((n,r,s)=>`${n}${t[s]}${r}`,e[0])}function ob(e){if(Object.keys(e.out).length===0)throw new Error("A vertexFn output cannot be empty since it must include the 'position' builtin.");let t={in:e.in,out:e.out,argTypes:e.in&&Object.keys(e.in).length!==0?[ia(e.in)]:[],isEntry:!0},n=(r,...s)=>lb(t,zo(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function lb(e,t){let n=sa(t,"@vertex "),r=e.argTypes[0];return{shell:e,$uses(s){return n.applyExternals(s),this},[m]:!0,[Ne]:n,$name(s){return _e(n,s),bo(r)&&r.$name(`${s}_Input`),this},[K](s){let i=ia(e.out,s.varyingLocations).$name(`${O(this)??""}_Output`);return typeof t=="string"&&(r&&n.applyExternals({In:r}),n.applyExternals({Out:i})),n.resolve(s,e.argTypes,i)},toString(){return`vertexFn:${O(n)??"<unnamed>"}`}}}var Gu=class{};function Nu(e){let t=ot((...r)=>{let s=[];for(let i of r)if(typeof i=="number")s.push(i);else for(let a=0;a<i.length;++a)s.push(i[a]);if(s.length!==0&&s.length!==e.columns*e.rows)throw new Error(`'${e.type}' constructor called with invalid number of arguments.`);for(let i=s.length;i<e.columns*e.rows;++i)s.push(0);return new e.MatImpl(...s)},(...r)=>S(x`${e.type}(${r})`,n),e.type),n=Object.assign(t,{type:e.type,identity:wb[e.columns],translation:e.columns===4?vb:void 0,scaling:e.columns===4?xb:void 0,rotationX:e.columns===4?bb:void 0,rotationY:e.columns===4?$b:void 0,rotationZ:e.columns===4?Tb:void 0});return n}var mf,ub=class extends Gu{constructor(...n){super();g(this,mf,!0);g(this,"columns");g(this,"length",4);this.columns=[this.makeColumn(n[0],n[1]),this.makeColumn(n[2],n[3])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[1].x}get 3(){return this.columns[1].y}set 0(n){this.columns[0].x=n}set 1(n){this.columns[0].y=n}set 2(n){this.columns[1].x=n}set 3(n){this.columns[1].y=n}*[(mf=m,Symbol.iterator)](){yield this[0],yield this[1],yield this[2],yield this[3]}[K](){return S(`${this.kind}(${Array.from({length:this.length}).map((n,r)=>this[r]).join(", ")})`,Sn)}toString(){return this[K]().value}},cb=class extends ub{constructor(){super(...arguments);g(this,"kind","mat2x2f")}makeColumn(n,r){return ve(n,r)}},yf,fb=class extends Gu{constructor(...t){super();g(this,yf,!0);g(this,"columns");g(this,"length",12);this.columns=[this.makeColumn(t[0],t[1],t[2]),this.makeColumn(t[3],t[4],t[5]),this.makeColumn(t[6],t[7],t[8])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return 0}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return 0}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return 0}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){}*[(yf=m,Symbol.iterator)](){for(let t=0;t<12;t++)yield this[t]}[K](){return S(`${this.kind}(${this[0]}, ${this[1]}, ${this[2]}, ${this[4]}, ${this[5]}, ${this[6]}, ${this[8]}, ${this[9]}, ${this[10]})`,zn)}toString(){return this[K]().value}},hb=class extends fb{constructor(){super(...arguments);g(this,"kind","mat3x3f")}makeColumn(t,n,r){return rt(t,n,r)}},gf,pb=class extends Gu{constructor(...t){super();g(this,gf,!0);g(this,"columns");g(this,"length",16);this.columns=[this.makeColumn(t[0],t[1],t[2],t[3]),this.makeColumn(t[4],t[5],t[6],t[7]),this.makeColumn(t[8],t[9],t[10],t[11]),this.makeColumn(t[12],t[13],t[14],t[15])]}get 0(){return this.columns[0].x}get 1(){return this.columns[0].y}get 2(){return this.columns[0].z}get 3(){return this.columns[0].w}get 4(){return this.columns[1].x}get 5(){return this.columns[1].y}get 6(){return this.columns[1].z}get 7(){return this.columns[1].w}get 8(){return this.columns[2].x}get 9(){return this.columns[2].y}get 10(){return this.columns[2].z}get 11(){return this.columns[2].w}get 12(){return this.columns[3].x}get 13(){return this.columns[3].y}get 14(){return this.columns[3].z}get 15(){return this.columns[3].w}set 0(t){this.columns[0].x=t}set 1(t){this.columns[0].y=t}set 2(t){this.columns[0].z=t}set 3(t){this.columns[0].w=t}set 4(t){this.columns[1].x=t}set 5(t){this.columns[1].y=t}set 6(t){this.columns[1].z=t}set 7(t){this.columns[1].w=t}set 8(t){this.columns[2].x=t}set 9(t){this.columns[2].y=t}set 10(t){this.columns[2].z=t}set 11(t){this.columns[2].w=t}set 12(t){this.columns[3].x=t}set 13(t){this.columns[3].y=t}set 14(t){this.columns[3].z=t}set 15(t){this.columns[3].w=t}*[(gf=m,Symbol.iterator)](){for(let t=0;t<16;t++)yield this[t]}[K](){return S(`${this.kind}(${Array.from({length:this.length}).map((t,n)=>this[n]).join(", ")})`,Ze)}toString(){return this[K]().value}},db=class extends pb{constructor(){super(...arguments);g(this,"kind","mat4x4f")}makeColumn(n,r,s,i){return _(n,r,s,i)}},mb=ot(()=>Sn(1,0,0,1),()=>S("mat2x2f(1, 0, 0, 1)",Sn),"identity2"),yb=ot(()=>zn(1,0,0,0,1,0,0,0,1),()=>S("mat3x3f(1, 0, 0, 0, 1, 0, 0, 0, 1)",zn),"identity3"),gb=ot(()=>Ze(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),()=>S("mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",Ze),"identity4"),wb={2:mb,3:yb,4:gb},vb=ot(e=>Ze(1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,e.z,1),e=>S(x`mat4x4f(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, ${e}.x, ${e}.y, ${e}.z, 1)`,Ze),"translation4"),xb=ot(e=>Ze(e.x,0,0,0,0,e.y,0,0,0,0,e.z,0,0,0,0,1),e=>S(x`mat4x4f(${e}.x, 0, 0, 0, 0, ${e}.y, 0, 0, 0, 0, ${e}.z, 0, 0, 0, 0, 1)`,Ze),"scaling4"),bb=ot(e=>Ze(1,0,0,0,0,Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1),e=>S(x`mat4x4f(1, 0, 0, 0, 0, cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1)`,Ze),"rotationX4"),$b=ot(e=>Ze(Math.cos(e),0,-Math.sin(e),0,0,1,0,0,Math.sin(e),0,Math.cos(e),0,0,0,0,1),e=>S(x`mat4x4f(cos(${e}), 0, -sin(${e}), 0, 0, 1, 0, 0, sin(${e}), 0, cos(${e}), 0, 0, 0, 0, 1)`,Ze),"rotationY4"),Tb=ot(e=>Ze(Math.cos(e),Math.sin(e),0,0,-Math.sin(e),Math.cos(e),0,0,0,0,1,0,0,0,0,1),e=>S(x`mat4x4f(cos(${e}), sin(${e}), 0, 0, -sin(${e}), cos(${e}), 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)`,Ze),"rotationZ4"),Sn=Nu({type:"mat2x2f",rows:2,columns:2,MatImpl:cb}),zn=Nu({type:"mat3x3f",rows:3,columns:3,MatImpl:hb}),Ze=Nu({type:"mat4x4f",rows:4,columns:4,MatImpl:db});function _b(e){return e==null?void 0:e[$e]}var Sb={f:{1:v,2:ve,3:rt,4:_},h:{1:Xe,2:$n,3:Tn,4:_n},i:{1:Te,2:ft,3:Nt,4:Me},u:{1:V,2:Lt,3:Ye,4:Be},b:{1:Ve,2:Yr,3:Xr,4:Zr}},zb={vec2f:ve,vec2h:$n,vec2i:ft,vec2u:Lt,"vec2<bool>":Yr,vec3f:rt,vec3h:Tn,vec3i:Nt,vec3u:Ye,"vec3<bool>":Xr,vec4f:_,vec4h:_n,vec4i:Me,vec4u:Be,"vec4<bool>":Zr,mat2x2f:Sn,mat3x3f:zn,mat4x4f:Ze};function vl(e,t){if(bt(e)||hr(e))return e.propTypes[t]??xt;if(e===Ve||Nn(e))return xt;let n=t.length;if(Gn(e)&&n>=1&&n<=4){let r=e.type.includes("bool")?"b":e.type[4],s=Sb[r][n];if(s)return s}return xt}var Ac={mat2x2f:ve,mat3x3f:rt,mat4x4f:_};function jo(e){return on(e)||Hs(e)?e.elementType:Gn(e)?e.primitive:e.type in Ac?Ac[e.type]:xt}function qa(e){return e>=2**63||e<-9223372036854776e3?S(e,un):Number.isInteger(e)?(Number.isSafeInteger(e)||console.warn(`The integer ${e} exceeds the safe integer range and may have lost precision.`),S(e,_o)):S(e,un)}function Ri(e){return e.type==="abstractFloat"?v:e.type==="abstractInt"?Te:e}function kb(e){return e.map(t=>S(t.value,Ri(t.dataType)))}function Pa(e){return xu(e)?e:bu(e)||(Ee(e)||vn(e)?S(e,zb[e.kind]):typeof e=="string"||typeof e=="function"||typeof e=="object"||typeof e=="symbol"||typeof e>"u"||e===null?S(e,xt):typeof e=="number"?qa(e):typeof e=="boolean"?S(e,Ve):S(e,xt))}var cn={get(e,t){if(t in e)return Reflect.get(e,t);if(t==="toString"||t===Symbol.toStringTag||t===Symbol.toPrimitive)return()=>e.toString();if(typeof t=="symbol")return;let n=bu(e).dataType,r=vl(n,String(t));if(r.type!=="unknown")return new Proxy({[m]:!0,[K]:s=>S(`${s.resolve(e).value}.${String(t)}`,r),get[Bt](){return S(this,r)},toString:()=>`${String(e)}.${t}`},cn)}};function ko(e){let t=e;for(;;){let n=_b(t);if(!n)break;t=n}return t}function xl(e,t){return new Mb(e,t)}var wf,Ts,vf,Mb=(vf=class{constructor(e,t){g(this,wf,{});Z(this,Ts);this.dataType=e,q(this,Ts,t)}$name(e){return _e(this,e),this}[(wf=m,K)](e){let t=e.getUniqueName(this),n=e.resolve(this.dataType).value,r=e.resolve(w(this,Ts),this.dataType).value;return e.addDeclaration(`const ${t}: ${n} = ${r};`),S(t,this.dataType)}toString(){return`const:${O(this)??"<unnamed>"}`}get[$e](){let e=this.dataType;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`const:${O(this)??"<unnamed>"}.$`},cn)}get value(){return In()?this[$e]:w(this,Ts)}get $(){return this.value}},Ts=new WeakMap,vf);function cd(){return{[m]:!0,type:"sampler",[Zs]:void 0}}function fd(){return{[m]:!0,type:"sampler_comparison",[Zs]:void 0}}function Pb(e){return!!e[m]&&e.type==="sampler"}function Ib(e){return!!e[m]&&e.type==="sampler_comparison"}function bl(e){if("multisampled"in e){if(e.multisampled){if(e.dimension==="2d")return Ab(e.sampleType);throw new Error(`Multisampled textures only support '2d' dimension, got '${e.dimension}'`)}switch(e.dimension){case"1d":return Bb(e.sampleType);case"2d":return Eb(e.sampleType);case"2d-array":return Ob(e.sampleType);case"3d":return Cb(e.sampleType);case"cube":return Ub(e.sampleType);case"cube-array":return Rb(e.sampleType);default:throw new Error(`Unsupported texture dimension: '${e.dimension}'`)}}if(!("access"in e))throw new Error("Descriptor is neither a sampled nor a storage texture");switch(e.dimension){case"1d":return Vb(e.format,e.access);case"2d":return Lb(e.format,e.access);case"2d-array":return Fb(e.format,e.access);case"3d":return Gb(e.format,e.access);default:throw new Error(`Unsupported storage texture dimension: '${e.dimension}'`)}}function Hr(e,t){let n=e.startsWith("texture_depth")?["depth","float","unfilterable-float"]:t.sampleType.type==="i32"?["sint"]:t.sampleType.type==="u32"?["uint"]:["float","unfilterable-float"];return{[m]:!0,[Zs]:void 0,type:e,bindingSampleType:n,...t}}function Mo(e,t){return{[m]:!0,[Zs]:void 0,type:e,...t}}var Oc=new Map,aa={"write-only":"write","read-only":"read","read-write":"read_write"};function en(e,t){let n=Oc.get(e);return n||(n=t(),Oc.set(e,n)),n}function Bb(e){let t=e||v,n=`texture_1d<${t.type}>`;return en(n,()=>Hr("texture_1d",{dimension:"1d",sampleType:t,multisampled:!1}))}function Eb(e){let t=e||v,n=`texture_2d<${t.type}>`;return en(n,()=>Hr("texture_2d",{dimension:"2d",sampleType:t,multisampled:!1}))}function Ab(e){let t=e||v,n=`texture_multisampled_2d<${t.type}>`;return en(n,()=>Hr("texture_multisampled_2d",{dimension:"2d",sampleType:t,multisampled:!0}))}function Ob(e){let t=e||v,n=`texture_2d_array<${t.type}>`;return en(n,()=>Hr("texture_2d_array",{dimension:"2d-array",sampleType:t,multisampled:!1}))}function Ub(e){let t=e||v,n=`texture_cube<${t.type}>`;return en(n,()=>Hr("texture_cube",{dimension:"cube",sampleType:t,multisampled:!1}))}function Rb(e){let t=e||v,n=`texture_cube_array<${t.type}>`;return en(n,()=>Hr("texture_cube_array",{dimension:"cube-array",sampleType:t,multisampled:!1}))}function Cb(e){let t=e||v,n=`texture_3d<${t.type}>`;return en(n,()=>Hr("texture_3d",{dimension:"3d",sampleType:t,multisampled:!1}))}function Vb(e,t){let n=t||"write-only",r=`texture_storage_1d<${e}, ${aa[n]}>`;return en(r,()=>Mo("texture_storage_1d",{dimension:"1d",format:e,access:n}))}function Lb(e,t){let n=t||"write-only",r=`texture_storage_2d<${e}, ${aa[n]}>`;return en(r,()=>Mo("texture_storage_2d",{dimension:"2d",format:e,access:n}))}function Fb(e,t){let n=t||"write-only",r=`texture_storage_2d_array<${e}, ${aa[n]}>`;return en(r,()=>Mo("texture_storage_2d_array",{dimension:"2d-array",format:e,access:n}))}function Gb(e,t){let n=t||"write-only",r=`texture_storage_3d<${e}, ${aa[n]}>`;return en(r,()=>Mo("texture_storage_3d",{dimension:"3d",format:e,access:n}))}function Nb(){return en("texture_external",()=>({[m]:!0,[Zs]:void 0,type:"texture_external",dimension:"2d"}))}function Db(e){return!!e[m]&&typeof e.multisampled=="boolean"}function $l(e){return!!e[m]&&typeof e.format=="string"&&typeof e.access=="string"}function jb(e){return new Wb(e)}var xf,Wb=(xf=m,class{constructor(e){g(this,xf,!0);g(this,"type","atomic");this.inner=e}}),wr=(e,t,n)=>{if(e===t)return 0;let r=ae((n-e)/(t-e),0,1);return r*r*(3-2*r)},ae=(e,t,n)=>Math.min(Math.max(t,e),n),ts=(e,t)=>t===0?e:Math.trunc(e/t);function hn(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getFloat32(0,!0)}function pn(e){let t=new DataView(new ArrayBuffer(4));return t.setUint32(0,e,!0),t.getInt32(0,!0)}var Wt=Yr[m].jsImpl,Zt=ve[m].jsImpl,En=$n[m].jsImpl,vs=ft[m].jsImpl,Si=Lt[m].jsImpl,qt=Xr[m].jsImpl,Rt=rt[m].jsImpl,yn=Tn[m].jsImpl,xs=Nt[m].jsImpl,zi=Ye[m].jsImpl,Yt=Zr[m].jsImpl,Ht=_[m].jsImpl,An=_n[m].jsImpl,bs=Me[m].jsImpl,ki=Be[m].jsImpl,ns=e=>Math.sqrt(e.x**2+e.y**2),rs=e=>Math.sqrt(e.x**2+e.y**2+e.z**2),ss=e=>Math.sqrt(e.x**2+e.y**2+e.z**2+e.w**2),ga=(e,t)=>e.x*t.x+e.y*t.y,wa=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z,va=(e,t)=>e.x*t.x+e.y*t.y+e.z*t.z+e.w*t.w,Pe=e=>t=>Zt(e(t.x),e(t.y)),Oe=e=>t=>En(e(t.x),e(t.y)),is=e=>t=>vs(e(t.x),e(t.y)),li=e=>t=>Si(e(t.x),e(t.y)),ke=e=>t=>Rt(e(t.x),e(t.y),e(t.z)),Ue=e=>t=>yn(e(t.x),e(t.y),e(t.z)),as=e=>t=>xs(e(t.x),e(t.y),e(t.z)),ui=e=>t=>zi(e(t.x),e(t.y),e(t.z)),Se=e=>t=>Ht(e(t.x),e(t.y),e(t.z),e(t.w)),Re=e=>t=>An(e(t.x),e(t.y),e(t.z),e(t.w)),os=e=>t=>bs(e(t.x),e(t.y),e(t.z),e(t.w)),ci=e=>t=>ki(e(t.x),e(t.y),e(t.z),e(t.w)),Uc=e=>t=>{let n=t.columns;return Sn(Pe(e)(n[0]),Pe(e)(n[1]))},Rc=e=>t=>{let n=t.columns;return zn(ke(e)(n[0]),ke(e)(n[1]),ke(e)(n[2]))},Cc=e=>t=>{let n=t.columns;return Ze(Se(e)(n[0]),Se(e)(n[1]),Se(e)(n[2]),Se(e)(n[3]))},Bn=e=>(t,n)=>Zt(e(t.x,n.x),e(t.y,n.y)),mr=e=>(t,n)=>En(e(t.x,n.x),e(t.y,n.y)),ls=e=>(t,n)=>vs(e(t.x,n.x),e(t.y,n.y)),us=e=>(t,n)=>Si(e(t.x,n.x),e(t.y,n.y)),gn=e=>(t,n)=>Rt(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),yr=e=>(t,n)=>yn(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),cs=e=>(t,n)=>xs(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),fs=e=>(t,n)=>zi(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z)),an=e=>(t,n)=>Ht(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),gr=e=>(t,n)=>An(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),hs=e=>(t,n)=>bs(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),ps=e=>(t,n)=>ki(e(t.x,n.x),e(t.y,n.y),e(t.z,n.z),e(t.w,n.w)),qb=e=>(t,n)=>{let r=t.columns,s=n.columns;return Sn(Bn(e)(r[0],s[0]),Bn(e)(r[1],s[1]))},Yb=e=>(t,n)=>{let r=t.columns,s=n.columns;return zn(gn(e)(r[0],s[0]),gn(e)(r[1],s[1]),gn(e)(r[2],s[2]))},Xb=e=>(t,n)=>{let r=t.columns,s=n.columns;return Ze(an(e)(r[0],s[0]),an(e)(r[1],s[1]),an(e)(r[2],s[2]),an(e)(r[3],s[3]))},Zb=e=>(t,n,r)=>Zt(e(t.x,n.x,r.x),e(t.y,n.y,r.y)),Hb=e=>(t,n,r)=>En(e(t.x,n.x,r.x),e(t.y,n.y,r.y)),Kb=e=>(t,n,r)=>Rt(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z)),Qb=e=>(t,n,r)=>yn(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z)),Jb=e=>(t,n,r)=>Ht(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z),e(t.w,n.w,r.w)),e2=e=>(t,n,r)=>An(e(t.x,n.x,r.x),e(t.y,n.y,r.y),e(t.z,n.z,r.z),e(t.w,n.w,r.w)),F={eq:{vec2f:(e,t)=>Wt(e.x===t.x,e.y===t.y),vec2h:(e,t)=>Wt(e.x===t.x,e.y===t.y),vec2i:(e,t)=>Wt(e.x===t.x,e.y===t.y),vec2u:(e,t)=>Wt(e.x===t.x,e.y===t.y),"vec2<bool>":(e,t)=>Wt(e.x===t.x,e.y===t.y),vec3f:(e,t)=>qt(e.x===t.x,e.y===t.y,e.z===t.z),vec3h:(e,t)=>qt(e.x===t.x,e.y===t.y,e.z===t.z),vec3i:(e,t)=>qt(e.x===t.x,e.y===t.y,e.z===t.z),vec3u:(e,t)=>qt(e.x===t.x,e.y===t.y,e.z===t.z),"vec3<bool>":(e,t)=>qt(e.x===t.x,e.y===t.y,e.z===t.z),vec4f:(e,t)=>Yt(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4h:(e,t)=>Yt(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4i:(e,t)=>Yt(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),vec4u:(e,t)=>Yt(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w),"vec4<bool>":(e,t)=>Yt(e.x===t.x,e.y===t.y,e.z===t.z,e.w===t.w)},lt:{vec2f:(e,t)=>Wt(e.x<t.x,e.y<t.y),vec2h:(e,t)=>Wt(e.x<t.x,e.y<t.y),vec2i:(e,t)=>Wt(e.x<t.x,e.y<t.y),vec2u:(e,t)=>Wt(e.x<t.x,e.y<t.y),vec3f:(e,t)=>qt(e.x<t.x,e.y<t.y,e.z<t.z),vec3h:(e,t)=>qt(e.x<t.x,e.y<t.y,e.z<t.z),vec3i:(e,t)=>qt(e.x<t.x,e.y<t.y,e.z<t.z),vec3u:(e,t)=>qt(e.x<t.x,e.y<t.y,e.z<t.z),vec4f:(e,t)=>Yt(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4h:(e,t)=>Yt(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4i:(e,t)=>Yt(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w),vec4u:(e,t)=>Yt(e.x<t.x,e.y<t.y,e.z<t.z,e.w<t.w)},or:{"vec2<bool>":(e,t)=>Wt(e.x||t.x,e.y||t.y),"vec3<bool>":(e,t)=>qt(e.x||t.x,e.y||t.y,e.z||t.z),"vec4<bool>":(e,t)=>Yt(e.x||t.x,e.y||t.y,e.z||t.z,e.w||t.w)},all:{"vec2<bool>":e=>e.x&&e.y,"vec3<bool>":e=>e.x&&e.y&&e.z,"vec4<bool>":e=>e.x&&e.y&&e.z&&e.w},abs:{vec2f:Pe(Math.abs),vec2h:Oe(Math.abs),vec2i:is(Math.abs),vec2u:li(Math.abs),vec3f:ke(Math.abs),vec3h:Ue(Math.abs),vec3i:as(Math.abs),vec3u:ui(Math.abs),vec4f:Se(Math.abs),vec4h:Re(Math.abs),vec4i:os(Math.abs),vec4u:ci(Math.abs)},atan2:{vec2f:Bn(Math.atan2),vec2h:mr(Math.atan2),vec3f:gn(Math.atan2),vec3h:yr(Math.atan2),vec4f:an(Math.atan2),vec4h:gr(Math.atan2)},acos:{vec2f:Pe(Math.acos),vec2h:Oe(Math.acos),vec2i:is(Math.acos),vec2u:li(Math.acos),vec3f:ke(Math.acos),vec3h:Ue(Math.acos),vec3i:as(Math.acos),vec3u:ui(Math.acos),vec4f:Se(Math.acos),vec4h:Re(Math.acos),vec4i:os(Math.acos),vec4u:ci(Math.acos)},acosh:{vec2f:Pe(Math.acosh),vec2h:Oe(Math.acosh),vec3f:ke(Math.acosh),vec3h:Ue(Math.acosh),vec4f:Se(Math.acosh),vec4h:Re(Math.acosh)},asin:{vec2f:Pe(Math.asin),vec2h:Oe(Math.asin),vec3f:ke(Math.asin),vec3h:Ue(Math.asin),vec4f:Se(Math.asin),vec4h:Re(Math.asin)},asinh:{vec2f:Pe(Math.asinh),vec2h:Oe(Math.asinh),vec3f:ke(Math.asinh),vec3h:Ue(Math.asinh),vec4f:Se(Math.asinh),vec4h:Re(Math.asinh)},atan:{vec2f:Pe(Math.atan),vec2h:Oe(Math.atan),vec3f:ke(Math.atan),vec3h:Ue(Math.atan),vec4f:Se(Math.atan),vec4h:Re(Math.atan)},atanh:{vec2f:Pe(Math.atanh),vec2h:Oe(Math.atanh),vec3f:ke(Math.atanh),vec3h:Ue(Math.atanh),vec4f:Se(Math.atanh),vec4h:Re(Math.atanh)},ceil:{vec2f:Pe(Math.ceil),vec2h:Oe(Math.ceil),vec3f:ke(Math.ceil),vec3h:Ue(Math.ceil),vec4f:Se(Math.ceil),vec4h:Re(Math.ceil)},clamp:{vec2f:(e,t,n)=>Zt(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y)),vec2h:(e,t,n)=>En(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y)),vec2i:(e,t,n)=>vs(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y)),vec2u:(e,t,n)=>Si(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y)),vec3f:(e,t,n)=>Rt(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z)),vec3h:(e,t,n)=>yn(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z)),vec3i:(e,t,n)=>xs(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z)),vec3u:(e,t,n)=>zi(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z)),vec4f:(e,t,n)=>Ht(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z),ae(e.w,t.w,n.w)),vec4h:(e,t,n)=>An(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z),ae(e.w,t.w,n.w)),vec4i:(e,t,n)=>bs(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z),ae(e.w,t.w,n.w)),vec4u:(e,t,n)=>ki(ae(e.x,t.x,n.x),ae(e.y,t.y,n.y),ae(e.z,t.z,n.z),ae(e.w,t.w,n.w))},length:{vec2f:ns,vec2h:ns,vec3f:rs,vec3h:rs,vec4f:ss,vec4h:ss},add:{vec2f:Bn((e,t)=>e+t),vec2h:mr((e,t)=>e+t),vec2i:ls((e,t)=>e+t),vec2u:us((e,t)=>e+t),vec3f:gn((e,t)=>e+t),vec3h:yr((e,t)=>e+t),vec3i:cs((e,t)=>e+t),vec3u:fs((e,t)=>e+t),vec4f:an((e,t)=>e+t),vec4h:gr((e,t)=>e+t),vec4i:hs((e,t)=>e+t),vec4u:ps((e,t)=>e+t),mat2x2f:qb((e,t)=>e+t),mat3x3f:Yb((e,t)=>e+t),mat4x4f:Xb((e,t)=>e+t)},smoothstep:{vec2f:Zb(wr),vec2h:Hb(wr),vec3f:Kb(wr),vec3h:Qb(wr),vec4f:Jb(wr),vec4h:e2(wr)},addMixed:{vec2f:(e,t)=>Pe(n=>n+t)(e),vec2h:(e,t)=>Oe(n=>n+t)(e),vec2i:(e,t)=>is(n=>n+t)(e),vec2u:(e,t)=>li(n=>n+t)(e),vec3f:(e,t)=>ke(n=>n+t)(e),vec3h:(e,t)=>Ue(n=>n+t)(e),vec3i:(e,t)=>as(n=>n+t)(e),vec3u:(e,t)=>ui(n=>n+t)(e),vec4f:(e,t)=>Se(n=>n+t)(e),vec4h:(e,t)=>Re(n=>n+t)(e),vec4i:(e,t)=>os(n=>n+t)(e),vec4u:(e,t)=>ci(n=>n+t)(e),mat2x2f:(e,t)=>Uc(n=>n+t)(e),mat3x3f:(e,t)=>Rc(n=>n+t)(e),mat4x4f:(e,t)=>Cc(n=>n+t)(e)},mulSxV:{vec2f:(e,t)=>Pe(n=>e*n)(t),vec2h:(e,t)=>Oe(n=>e*n)(t),vec2i:(e,t)=>is(n=>e*n)(t),vec2u:(e,t)=>li(n=>e*n)(t),vec3f:(e,t)=>ke(n=>e*n)(t),vec3h:(e,t)=>Ue(n=>e*n)(t),vec3i:(e,t)=>as(n=>e*n)(t),vec3u:(e,t)=>ui(n=>e*n)(t),vec4f:(e,t)=>Se(n=>e*n)(t),vec4h:(e,t)=>Re(n=>e*n)(t),vec4i:(e,t)=>os(n=>e*n)(t),vec4u:(e,t)=>ci(n=>e*n)(t),mat2x2f:(e,t)=>Uc(n=>e*n)(t),mat3x3f:(e,t)=>Rc(n=>e*n)(t),mat4x4f:(e,t)=>Cc(n=>e*n)(t)},mulVxV:{vec2f:Bn((e,t)=>e*t),vec2h:mr((e,t)=>e*t),vec2i:ls((e,t)=>e*t),vec2u:us((e,t)=>e*t),vec3f:gn((e,t)=>e*t),vec3h:yr((e,t)=>e*t),vec3i:cs((e,t)=>e*t),vec3u:fs((e,t)=>e*t),vec4f:an((e,t)=>e*t),vec4h:gr((e,t)=>e*t),vec4i:hs((e,t)=>e*t),vec4u:ps((e,t)=>e*t),mat2x2f:(e,t)=>{let n=e.columns,r=t.columns;return Sn(n[0].x*r[0].x+n[1].x*r[0].y,n[0].y*r[0].x+n[1].y*r[0].y,n[0].x*r[1].x+n[1].x*r[1].y,n[0].y*r[1].x+n[1].y*r[1].y)},mat3x3f:(e,t)=>{let n=e.columns,r=t.columns;return zn(n[0].x*r[0].x+n[1].x*r[0].y+n[2].x*r[0].z,n[0].y*r[0].x+n[1].y*r[0].y+n[2].y*r[0].z,n[0].z*r[0].x+n[1].z*r[0].y+n[2].z*r[0].z,n[0].x*r[1].x+n[1].x*r[1].y+n[2].x*r[1].z,n[0].y*r[1].x+n[1].y*r[1].y+n[2].y*r[1].z,n[0].z*r[1].x+n[1].z*r[1].y+n[2].z*r[1].z,n[0].x*r[2].x+n[1].x*r[2].y+n[2].x*r[2].z,n[0].y*r[2].x+n[1].y*r[2].y+n[2].y*r[2].z,n[0].z*r[2].x+n[1].z*r[2].y+n[2].z*r[2].z)},mat4x4f:(e,t)=>{let n=e.columns,r=t.columns;return Ze(n[0].x*r[0].x+n[1].x*r[0].y+n[2].x*r[0].z+n[3].x*r[0].w,n[0].y*r[0].x+n[1].y*r[0].y+n[2].y*r[0].z+n[3].y*r[0].w,n[0].z*r[0].x+n[1].z*r[0].y+n[2].z*r[0].z+n[3].z*r[0].w,n[0].w*r[0].x+n[1].w*r[0].y+n[2].w*r[0].z+n[3].w*r[0].w,n[0].x*r[1].x+n[1].x*r[1].y+n[2].x*r[1].z+n[3].x*r[1].w,n[0].y*r[1].x+n[1].y*r[1].y+n[2].y*r[1].z+n[3].y*r[1].w,n[0].z*r[1].x+n[1].z*r[1].y+n[2].z*r[1].z+n[3].z*r[1].w,n[0].w*r[1].x+n[1].w*r[1].y+n[2].w*r[1].z+n[3].w*r[1].w,n[0].x*r[2].x+n[1].x*r[2].y+n[2].x*r[2].z+n[3].x*r[2].w,n[0].y*r[2].x+n[1].y*r[2].y+n[2].y*r[2].z+n[3].y*r[2].w,n[0].z*r[2].x+n[1].z*r[2].y+n[2].z*r[2].z+n[3].z*r[2].w,n[0].w*r[2].x+n[1].w*r[2].y+n[2].w*r[2].z+n[3].w*r[2].w,n[0].x*r[3].x+n[1].x*r[3].y+n[2].x*r[3].z+n[3].x*r[3].w,n[0].y*r[3].x+n[1].y*r[3].y+n[2].y*r[3].z+n[3].y*r[3].w,n[0].z*r[3].x+n[1].z*r[3].y+n[2].z*r[3].z+n[3].z*r[3].w,n[0].w*r[3].x+n[1].w*r[3].y+n[2].w*r[3].z+n[3].w*r[3].w)}},mulMxV:{mat2x2f:(e,t)=>{let n=e.columns;return Zt(n[0].x*t.x+n[1].x*t.y,n[0].y*t.x+n[1].y*t.y)},mat3x3f:(e,t)=>{let n=e.columns;return Rt(n[0].x*t.x+n[1].x*t.y+n[2].x*t.z,n[0].y*t.x+n[1].y*t.y+n[2].y*t.z,n[0].z*t.x+n[1].z*t.y+n[2].z*t.z)},mat4x4f:(e,t)=>{let n=e.columns;return Ht(n[0].x*t.x+n[1].x*t.y+n[2].x*t.z+n[3].x*t.w,n[0].y*t.x+n[1].y*t.y+n[2].y*t.z+n[3].y*t.w,n[0].z*t.x+n[1].z*t.y+n[2].z*t.z+n[3].z*t.w,n[0].w*t.x+n[1].w*t.y+n[2].w*t.z+n[3].w*t.w)}},mulVxM:{mat2x2f:(e,t)=>{let n=t.columns;return Zt(e.x*n[0].x+e.y*n[0].y,e.x*n[1].x+e.y*n[1].y)},mat3x3f:(e,t)=>{let n=t.columns;return Rt(e.x*n[0].x+e.y*n[0].y+e.z*n[0].z,e.x*n[1].x+e.y*n[1].y+e.z*n[1].z,e.x*n[2].x+e.y*n[2].y+e.z*n[2].z)},mat4x4f:(e,t)=>{let n=t.columns;return Ht(e.x*n[0].x+e.y*n[0].y+e.z*n[0].z+e.w*n[0].w,e.x*n[1].x+e.y*n[1].y+e.z*n[1].z+e.w*n[1].w,e.x*n[2].x+e.y*n[2].y+e.z*n[2].z+e.w*n[2].w,e.x*n[3].x+e.y*n[3].y+e.z*n[3].z+e.w*n[3].w)}},div:{vec2f:Bn((e,t)=>e/t),vec2h:mr((e,t)=>e/t),vec2i:ls(ts),vec2u:us(ts),vec3f:gn((e,t)=>e/t),vec3h:yr((e,t)=>e/t),vec3i:cs(ts),vec3u:fs(ts),vec4f:an((e,t)=>e/t),vec4h:gr((e,t)=>e/t),vec4i:hs(ts),vec4u:ps(ts)},dot:{vec2f:ga,vec2h:ga,vec2i:ga,vec2u:ga,vec3f:wa,vec3h:wa,vec3i:wa,vec3u:wa,vec4f:va,vec4h:va,vec4i:va,vec4u:va},normalize:{vec2f:e=>{let t=ns(e);return Zt(e.x/t,e.y/t)},vec2h:e=>{let t=ns(e);return En(e.x/t,e.y/t)},vec2i:e=>{let t=ns(e);return vs(e.x/t,e.y/t)},vec2u:e=>{let t=ns(e);return Si(e.x/t,e.y/t)},vec3f:e=>{let t=rs(e);return Rt(e.x/t,e.y/t,e.z/t)},vec3h:e=>{let t=rs(e);return yn(e.x/t,e.y/t,e.z/t)},vec3i:e=>{let t=rs(e);return xs(e.x/t,e.y/t,e.z/t)},vec3u:e=>{let t=rs(e);return zi(e.x/t,e.y/t,e.z/t)},vec4f:e=>{let t=ss(e);return Ht(e.x/t,e.y/t,e.z/t,e.w/t)},vec4h:e=>{let t=ss(e);return An(e.x/t,e.y/t,e.z/t,e.w/t)},vec4i:e=>{let t=ss(e);return bs(e.x/t,e.y/t,e.z/t,e.w/t)},vec4u:e=>{let t=ss(e);return ki(e.x/t,e.y/t,e.z/t,e.w/t)}},cross:{vec3f:(e,t)=>Rt(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x),vec3h:(e,t)=>yn(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z,e.x*t.y-e.y*t.x)},mod:{vec2f:Bn((e,t)=>e%t),vec2h:mr((e,t)=>e%t),vec2i:ls((e,t)=>e%t),vec2u:us((e,t)=>e%t),vec3f:gn((e,t)=>e%t),vec3h:yr((e,t)=>e%t),vec3i:cs((e,t)=>e%t),vec3u:fs((e,t)=>e%t),vec4f:an((e,t)=>e%t),vec4h:gr((e,t)=>e%t),vec4i:hs((e,t)=>e%t),vec4u:ps((e,t)=>e%t)},floor:{vec2f:Pe(Math.floor),vec2h:Oe(Math.floor),vec3f:ke(Math.floor),vec3h:Ue(Math.floor),vec4f:Se(Math.floor),vec4h:Re(Math.floor)},max:{vec2f:Bn(Math.max),vec2h:mr(Math.max),vec2i:ls(Math.max),vec2u:us(Math.max),vec3f:gn(Math.max),vec3h:yr(Math.max),vec3i:cs(Math.max),vec3u:fs(Math.max),vec4f:an(Math.max),vec4h:gr(Math.max),vec4i:hs(Math.max),vec4u:ps(Math.max)},min:{vec2f:Bn(Math.min),vec2h:mr(Math.min),vec2i:ls(Math.min),vec2u:us(Math.min),vec3f:gn(Math.min),vec3h:yr(Math.min),vec3i:cs(Math.min),vec3u:fs(Math.min),vec4f:an(Math.min),vec4h:gr(Math.min),vec4i:hs(Math.min),vec4u:ps(Math.min)},pow:{vec2f:(e,t)=>Zt(e.x**t.x,e.y**t.y),vec2h:(e,t)=>En(e.x**t.x,e.y**t.y),vec3f:(e,t)=>Rt(e.x**t.x,e.y**t.y,e.z**t.z),vec3h:(e,t)=>yn(e.x**t.x,e.y**t.y,e.z**t.z),vec4f:(e,t)=>Ht(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w),vec4h:(e,t)=>An(e.x**t.x,e.y**t.y,e.z**t.z,e.w**t.w)},sign:{vec2f:Pe(Math.sign),vec2h:Oe(Math.sign),vec2i:is(Math.sign),vec3f:ke(Math.sign),vec3h:Ue(Math.sign),vec3i:as(Math.sign),vec4f:Se(Math.sign),vec4h:Re(Math.sign),vec4i:os(Math.sign)},sqrt:{vec2f:Pe(Math.sqrt),vec2h:Oe(Math.sqrt),vec3f:ke(Math.sqrt),vec3h:Ue(Math.sqrt),vec4f:Se(Math.sqrt),vec4h:Re(Math.sqrt)},mix:{vec2f:(e,t,n)=>typeof n=="number"?Zt(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n):Zt(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y),vec2h:(e,t,n)=>typeof n=="number"?En(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n):En(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y),vec3f:(e,t,n)=>typeof n=="number"?Rt(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n):Rt(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z),vec3h:(e,t,n)=>typeof n=="number"?yn(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n):yn(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z),vec4f:(e,t,n)=>typeof n=="number"?Ht(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n,e.w*(1-n)+t.w*n):Ht(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z,e.w*(1-n.w)+t.w*n.w),vec4h:(e,t,n)=>typeof n=="number"?An(e.x*(1-n)+t.x*n,e.y*(1-n)+t.y*n,e.z*(1-n)+t.z*n,e.w*(1-n)+t.w*n):An(e.x*(1-n.x)+t.x*n.x,e.y*(1-n.y)+t.y*n.y,e.z*(1-n.z)+t.z*n.z,e.w*(1-n.w)+t.w*n.w)},sin:{vec2f:Pe(Math.sin),vec2h:Oe(Math.sin),vec3f:ke(Math.sin),vec3h:Ue(Math.sin),vec4f:Se(Math.sin),vec4h:Re(Math.sin)},cos:{vec2f:Pe(Math.cos),vec2h:Oe(Math.cos),vec3f:ke(Math.cos),vec3h:Ue(Math.cos),vec4f:Se(Math.cos),vec4h:Re(Math.cos)},cosh:{vec2f:Pe(Math.cosh),vec2h:Oe(Math.cosh),vec3f:ke(Math.cosh),vec3h:Ue(Math.cosh),vec4f:Se(Math.cosh),vec4h:Re(Math.cosh)},exp:{vec2f:Pe(Math.exp),vec2h:Oe(Math.exp),vec3f:ke(Math.exp),vec3h:Ue(Math.exp),vec4f:Se(Math.exp),vec4h:Re(Math.exp)},exp2:{vec2f:Pe(e=>2**e),vec2h:Oe(e=>2**e),vec3f:ke(e=>2**e),vec3h:Ue(e=>2**e),vec4f:Se(e=>2**e),vec4h:Re(e=>2**e)},log:{vec2f:Pe(Math.log),vec2h:Oe(Math.log),vec3f:ke(Math.log),vec3h:Ue(Math.log),vec4f:Se(Math.log),vec4h:Re(Math.log)},log2:{vec2f:Pe(Math.log2),vec2h:Oe(Math.log2),vec3f:ke(Math.log2),vec3h:Ue(Math.log2),vec4f:Se(Math.log2),vec4h:Re(Math.log2)},fract:{vec2f:Pe(e=>e-Math.floor(e)),vec2h:Oe(e=>e-Math.floor(e)),vec3f:ke(e=>e-Math.floor(e)),vec3h:Ue(e=>e-Math.floor(e)),vec4f:Se(e=>e-Math.floor(e)),vec4h:Re(e=>e-Math.floor(e))},isCloseToZero:{vec2f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec2h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t,vec3f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec3h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t,vec4f:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t,vec4h:(e,t)=>Math.abs(e.x)<=t&&Math.abs(e.y)<=t&&Math.abs(e.z)<=t&&Math.abs(e.w)<=t},neg:{vec2f:Pe(e=>-e),vec2h:Oe(e=>-e),vec2i:is(e=>-e),vec2u:li(e=>-e),"vec2<bool>":e=>Wt(!e.x,!e.y),vec3f:ke(e=>-e),vec3h:Ue(e=>-e),vec3i:as(e=>-e),vec3u:ui(e=>-e),"vec3<bool>":e=>qt(!e.x,!e.y,!e.z),vec4f:Se(e=>-e),vec4h:Re(e=>-e),vec4i:os(e=>-e),vec4u:ci(e=>-e),"vec4<bool>":e=>Yt(!e.x,!e.y,!e.z,!e.w)},select:{vec2f:(e,t,n)=>Zt(n.x?t.x:e.x,n.y?t.y:e.y),vec2h:(e,t,n)=>En(n.x?t.x:e.x,n.y?t.y:e.y),vec2i:(e,t,n)=>vs(n.x?t.x:e.x,n.y?t.y:e.y),vec2u:(e,t,n)=>Si(n.x?t.x:e.x,n.y?t.y:e.y),"vec2<bool>":(e,t,n)=>Wt(n.x?t.x:e.x,n.y?t.y:e.y),vec3f:(e,t,n)=>Rt(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3h:(e,t,n)=>yn(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3i:(e,t,n)=>xs(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec3u:(e,t,n)=>zi(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),"vec3<bool>":(e,t,n)=>qt(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z),vec4f:(e,t,n)=>Ht(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4h:(e,t,n)=>An(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4i:(e,t,n)=>bs(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),vec4u:(e,t,n)=>ki(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w),"vec4<bool>":(e,t,n)=>Yt(n.x?t.x:e.x,n.y?t.y:e.y,n.z?t.z:e.z,n.w?t.w:e.w)},tanh:{vec2f:Pe(Math.tanh),vec2h:Oe(Math.tanh),vec3f:ke(Math.tanh),vec3h:Ue(Math.tanh),vec4f:Se(Math.tanh),vec4h:Re(Math.tanh)},bitcastU32toF32:{vec2u:e=>Zt(hn(e.x),hn(e.y)),vec3u:e=>Rt(hn(e.x),hn(e.y),hn(e.z)),vec4u:e=>Ht(hn(e.x),hn(e.y),hn(e.z),hn(e.w))},bitcastU32toI32:{vec2u:e=>vs(pn(e.x),pn(e.y)),vec3u:e=>xs(pn(e.x),pn(e.y),pn(e.z)),vec4u:e=>bs(pn(e.x),pn(e.y),pn(e.z),pn(e.w))}};function hd(e,t){if(typeof e=="number"&&typeof t=="number")return e+t;if(typeof e=="number"&&Ee(t))return F.addMixed[t.kind](t,e);if(Ee(e)&&typeof t=="number")return F.addMixed[e.kind](e,t);if(Ee(e)&&Ee(t)||vn(e)&&vn(t))return F.add[e.kind](e,t);throw new Error("Add/Sub called with invalid arguments.")}var pd=M({name:"add",signature:(...e)=>{let t=$t(e)??e;return{argTypes:t,returnType:Nn(t[0])?t[1]:t[0]}},normalImpl:hd,codegenImpl:(e,t)=>x`(${e} + ${t})`});function t2(e,t){return hd(e,dd(-1,t))}var oa=M({name:"sub",signature:(...e)=>{let t=$t(e)??e;return{argTypes:t,returnType:Nn(t[0])?t[1]:t[0]}},normalImpl:t2,codegenImpl:(e,t)=>x`(${e} - ${t})`});function dd(e,t){if(typeof e=="number"&&typeof t=="number")return e*t;if(typeof e=="number"&&(Ee(t)||vn(t)))return F.mulSxV[t.kind](e,t);if((Ee(e)||vn(e))&&typeof t=="number")return F.mulSxV[e.kind](t,e);if(Ee(e)&&Ee(t))return F.mulVxV[e.kind](e,t);if(yc(e)&&vn(t))return F.mulVxM[t.kind](e,t);if(vn(e)&&yc(t))return F.mulMxV[e.kind](e,t);if(vn(e)&&vn(t))return F.mulVxV[e.kind](e,t);throw new Error("Mul called with invalid arguments.")}var Du=M({name:"mul",signature:(...e)=>{let t=$t(e)??e,n=Nn(t[0])?t[1]:Nn(t[1])||t[0].type.startsWith("vec")?t[0]:t[1].type.startsWith("vec")?t[1]:t[0];return{argTypes:t,returnType:n}},normalImpl:dd,codegenImpl:(e,t)=>x`(${e} * ${t})`});function n2(e,t){if(typeof e=="number"&&typeof t=="number")return e/t;if(typeof e=="number"&&Ee(t)){let n=Wa[t.kind][m].jsImpl;return F.div[t.kind](n(e),t)}if(Ee(e)&&typeof t=="number"){let n=Wa[e.kind][m].jsImpl;return F.div[e.kind](e,n(t))}if(Ee(e)&&Ee(t))return F.div[e.kind](e,t);throw new Error("Div called with invalid arguments.")}var md=M({name:"div",signature:(...e)=>{let t=$t(e,[v,Xe,un])??e;return{argTypes:t,returnType:Nn(t[0])?t[1]:t[0]}},normalImpl:n2,codegenImpl:(e,t)=>x`(${e} / ${t})`,ignoreImplicitCastWarning:!0});M({name:"mod",signature:(...e)=>{let t=$t(e)??e;return{argTypes:t,returnType:Nn(t[0])?t[1]:t[0]}},normalImpl(e,t){if(typeof e=="number"&&typeof t=="number")return e%t;if(typeof e=="number"&&Ee(t)){let n=Wa[t.kind];return F.mod[t.kind](n(e),t)}if(Ee(e)&&typeof t=="number"){let n=Wa[e.kind];return F.mod[e.kind](e,n(t))}if(Ee(e)&&Ee(t))return F.mod[e.kind](e,t);throw new Error("Mod called with invalid arguments, expected types: number or vector.")},codegenImpl:(e,t)=>x`(${e} % ${t})`});function r2(e){return typeof e=="number"?-e:F.neg[e.kind](e)}M({name:"neg",signature:e=>({argTypes:[e],returnType:e}),normalImpl:r2,codegenImpl:e=>x`-(${e})`});function s2(e){return typeof e=="number"?Math.abs(e):F.abs[e.kind](e)}M({name:"abs",signature:e=>({argTypes:[e],returnType:e}),normalImpl:s2,codegenImpl:e=>x`abs(${e})`});function i2(e){return typeof e=="number"?Math.acos(e):F.acos[e.kind](e)}M({name:"acos",signature:e=>({argTypes:[e],returnType:e}),normalImpl:i2,codegenImpl:e=>x`acos(${e})`});function a2(e){return typeof e=="number"?Math.acosh(e):F.acosh[e.kind](e)}M({name:"acosh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:a2,codegenImpl:e=>x`acosh(${e})`});function o2(e){return typeof e=="number"?Math.asin(e):F.asin[e.kind](e)}M({name:"asin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:o2,codegenImpl:e=>x`asin(${e})`});function l2(e){return typeof e=="number"?Math.asinh(e):F.asinh[e.kind](e)}M({name:"asinh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:l2,codegenImpl:e=>x`asinh(${e})`});function u2(e){return typeof e=="number"?Math.atan(e):F.atan[e.kind](e)}M({name:"atan",signature:e=>({argTypes:[e],returnType:e}),normalImpl:u2,codegenImpl:e=>x`atan(${e})`});function c2(e){return typeof e=="number"?Math.atanh(e):F.atanh[e.kind](e)}M({name:"atanh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:c2,codegenImpl:e=>x`atanh(${e})`});function f2(e,t){return typeof e=="number"&&typeof t=="number"?Math.atan2(e,t):F.atan2[e.kind](e,t)}M({name:"atan2",signature:(...e)=>{let t=$t(e,[v,Xe,un])??e;return{argTypes:t,returnType:t[0]}},normalImpl:f2,codegenImpl:(e,t)=>x`atan2(${e}, ${t})`});function h2(e){return typeof e=="number"?Math.ceil(e):F.ceil[e.kind](e)}var p2=M({name:"ceil",signature:e=>({argTypes:[e],returnType:e}),normalImpl:h2,codegenImpl:e=>x`ceil(${e})`});function d2(e,t,n){return typeof e=="number"?Math.min(Math.max(t,e),n):F.clamp[e.kind](e,t,n)}M({name:"clamp",signature:(...e)=>{let t=$t(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:d2,codegenImpl:(e,t,n)=>x`clamp(${e}, ${t}, ${n})`});function m2(e){return typeof e=="number"?Math.cos(e):F.cos[e.kind](e)}M({name:"cos",signature:e=>({argTypes:[e],returnType:e}),normalImpl:m2,codegenImpl:e=>x`cos(${e})`});function y2(e){return typeof e=="number"?Math.cosh(e):F.cosh[e.kind](e)}M({name:"cosh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:y2,codegenImpl:e=>x`cosh(${e})`});M({name:"countLeadingZeros",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countLeadingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`countLeadingZeros(${e})`});M({name:"countOneBits",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countOneBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`countOneBits(${e})`});M({name:"countTrailingZeros",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for countTrailingZeros not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`countTrailingZeros(${e})`});M({name:"cross",signature:(e,t)=>({argTypes:[e,t],returnType:e}),normalImpl:(e,t)=>F.cross[e.kind](e,t),codegenImpl:(e,t)=>x`cross(${e}, ${t})`});function g2(e){if(typeof e=="number")return e*180/Math.PI;throw new Gt("CPU implementation for degrees on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"degrees",signature:e=>({argTypes:[e],returnType:e}),normalImpl:g2,codegenImpl:e=>x`degrees(${e})`});M({name:"determinant",signature:e=>({argTypes:[e],returnType:v}),normalImpl:"CPU implementation for determinant not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`determinant(${e})`});function w2(e,t){return typeof e=="number"&&typeof t=="number"?Math.abs(e-t):M2(oa(e,t))}M({name:"distance",signature:(e,t)=>({argTypes:[e,t],returnType:wu(e)?Xe:v}),normalImpl:w2,codegenImpl:(e,t)=>x`distance(${e}, ${t})`});var v2=M({name:"dot",signature:(e,t)=>({argTypes:[e,t],returnType:e.primitive}),normalImpl:(e,t)=>F.dot[e.kind](e,t),codegenImpl:(e,t)=>x`dot(${e}, ${t})`});M({name:"dot4U8Packed",signature:(e,t)=>({argTypes:[V,V],returnType:V}),normalImpl:"CPU implementation for dot4U8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>x`dot4U8Packed(${e}, ${t})`});M({name:"dot4I8Packed",signature:(e,t)=>({argTypes:[V,V],returnType:Te}),normalImpl:"CPU implementation for dot4I8Packed not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>x`dot4I8Packed(${e}, ${t})`});function x2(e){return typeof e=="number"?Math.exp(e):F.exp[e.kind](e)}M({name:"exp",signature:e=>({argTypes:[e],returnType:e}),normalImpl:x2,codegenImpl:e=>x`exp(${e})`});function b2(e){return typeof e=="number"?2**e:F.exp2[e.kind](e)}M({name:"exp2",signature:e=>({argTypes:[e],returnType:e}),normalImpl:b2,codegenImpl:e=>x`exp2(${e})`});M({name:"extractBits",signature:(e,t,n)=>({argTypes:[e,V,V],returnType:e}),normalImpl:"CPU implementation for extractBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n)=>x`extractBits(${e}, ${t}, ${n})`});M({name:"faceForward",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:"CPU implementation for faceForward not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n)=>x`faceForward(${e}, ${t}, ${n})`});M({name:"firstLeadingBit",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for firstLeadingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`firstLeadingBit(${e})`});M({name:"firstTrailingBit",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for firstTrailingBit not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`firstTrailingBit(${e})`});function $2(e){return typeof e=="number"?Math.floor(e):F.floor[e.kind](e)}M({name:"floor",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:$2,codegenImpl:e=>x`floor(${e})`});function T2(e,t,n){if(typeof e=="number")return e*t+n;throw new Gt("CPU implementation for fma on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"fma",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:T2,codegenImpl:(e,t,n)=>x`fma(${e}, ${t}, ${n})`});function _2(e){return typeof e=="number"?e-Math.floor(e):F.fract[e.kind](e)}M({name:"fract",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:_2,codegenImpl:e=>x`fract(${e})`});var S2={f32:it({fract:v,exp:Te}),f16:it({fract:Xe,exp:Te}),abstractFloat:it({fract:un,exp:_o}),vec2f:it({fract:ve,exp:ft}),vec3f:it({fract:rt,exp:Nt}),vec4f:it({fract:_,exp:Me}),vec2h:it({fract:$n,exp:ft}),vec3h:it({fract:Tn,exp:Nt}),vec4h:it({fract:_n,exp:Me})};ot(e=>{throw new Gt("CPU implementation for frexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")},e=>{let t=S2[e.dataType.type];if(!t)throw new Error(`Unsupported data type for frexp: ${e.dataType.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return S(x`frexp(${e})`,t)},"frexp");M({name:"insertBits",signature:(e,t,n,r)=>({argTypes:[e,t,V,V],returnType:e}),normalImpl:"CPU implementation for insertBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t,n,r)=>x`insertBits(${e}, ${t}, ${n}, ${r})`});function z2(e){if(typeof e=="number")return 1/Math.sqrt(e);throw new Gt("CPU implementation for inverseSqrt on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"inverseSqrt",signature:e=>({argTypes:[e],returnType:e}),normalImpl:z2,codegenImpl:e=>x`inverseSqrt(${e})`});M({name:"ldexp",signature:(e,t)=>{switch(e.type){case"abstractFloat":return{argTypes:[un,_o],returnType:e};case"f32":case"f16":return{argTypes:[e,Te],returnType:e};case"vec2f":case"vec2h":return{argTypes:[e,ft],returnType:e};case"vec3f":case"vec3h":return{argTypes:[e,Nt],returnType:e};case"vec4f":case"vec4h":return{argTypes:[e,Me],returnType:e};default:throw new Error(`Unsupported data type for ldexp: ${e.type}. Supported types are abstractFloat, f32, f16, vec2f, vec2h, vec3f, vec3h, vec4f, vec4h.`)}},normalImpl:"CPU implementation for ldexp not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:(e,t)=>x`ldexp(${e}, ${t})`});function k2(e){return typeof e=="number"?Math.abs(e):F.length[e.kind](e)}var M2=M({name:"length",signature:e=>({argTypes:[e],returnType:wu(e)?Xe:v}),normalImpl:k2,codegenImpl:e=>x`length(${e})`});function P2(e){return typeof e=="number"?Math.log(e):F.log[e.kind](e)}M({name:"log",signature:e=>({argTypes:[e],returnType:e}),normalImpl:P2,codegenImpl:e=>x`log(${e})`});function I2(e){return typeof e=="number"?Math.log2(e):F.log2[e.kind](e)}M({name:"log2",signature:e=>({argTypes:[e],returnType:e}),normalImpl:I2,codegenImpl:e=>x`log2(${e})`});function B2(e,t){return typeof e=="number"?Math.max(e,t):F.max[e.kind](e,t)}M({name:"max",signature:(...e)=>{let t=$t(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:B2,codegenImpl:(e,t)=>x`max(${e}, ${t})`});function E2(e,t){return typeof e=="number"?Math.min(e,t):F.min[e.kind](e,t)}M({name:"min",signature:(...e)=>{let t=$t(e)??e;return{argTypes:t,returnType:t[0]}},normalImpl:E2,codegenImpl:(e,t)=>x`min(${e}, ${t})`});function A2(e,t,n){if(typeof e=="number"){if(typeof n!="number"||typeof t!="number")throw new Error("When e1 and e2 are numbers, the blend factor must be a number.");return e*(1-n)+t*n}if(typeof e=="number"||typeof t=="number")throw new Error("e1 and e2 need to both be vectors of the same kind.");return F.mix[e.kind](e,t,n)}M({name:"mix",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:e}),normalImpl:A2,codegenImpl:(e,t,n)=>x`mix(${e}, ${t}, ${n})`});var O2={f32:it({fract:v,whole:v}),f16:it({fract:Xe,whole:Xe}),abstractFloat:it({fract:un,whole:un}),vec2f:it({fract:ve,whole:ve}),vec3f:it({fract:rt,whole:rt}),vec4f:it({fract:_,whole:_}),vec2h:it({fract:$n,whole:$n}),vec3h:it({fract:Tn,whole:Tn}),vec4h:it({fract:_n,whole:_n})};M({name:"modf",signature:e=>{let t=O2[e.type];if(!t)throw new Error(`Unsupported data type for modf: ${e.type}. Supported types are f32, f16, abstractFloat, vec2f, vec3f, vec4f, vec2h, vec3h, vec4h.`);return{argTypes:[e],returnType:t}},normalImpl:"CPU implementation for modf not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`modf(${e})`});M({name:"normalize",signature:e=>({argTypes:[e],returnType:e}),normalImpl:e=>F.normalize[e.kind](e),codegenImpl:e=>x`normalize(${e})`});function U2(e,t){if(typeof e=="number"&&typeof t=="number")return e**t;if(Ee(e)&&Ee(t))return F.pow[e.kind](e,t);throw new Error("Invalid arguments to pow()")}var R2=M({name:"pow",signature:(...e)=>{let t=$t(e,[v,Xe,un])??e;return{argTypes:t,returnType:Nn(t[0])?t[1]:t[0]}},normalImpl:U2,codegenImpl:(e,t)=>x`pow(${e}, ${t})`});M({name:"quantizeToF16",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for quantizeToF16 not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`quantizeToF16(${e})`});function C2(e){if(typeof e=="number")return e*Math.PI/180;throw new Gt("CPU implementation for radians on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"radians",signature:(...e)=>{let t=$t(e,[v,Xe,un])??e;return{argTypes:t,returnType:t[0]}},normalImpl:C2,codegenImpl:e=>x`radians(${e})`});M({name:"reflect",signature:(e,t)=>({argTypes:[e,t],returnType:e}),normalImpl:(e,t)=>oa(e,Du(2*v2(t,e),t)),codegenImpl:(e,t)=>x`reflect(${e}, ${t})`});ot((e,t,n)=>{throw new Gt("CPU implementation for refract not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")},(e,t,n)=>S(x`refract(${e}, ${t}, ${n})`,e.dataType),"refract",(e,t,n)=>[e.dataType,t.dataType,wu(e)?Xe:v]);M({name:"reverseBits",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for reverseBits not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`reverseBits(${e})`});function V2(e){if(typeof e=="number")return Math.round(e);throw new Gt("CPU implementation for round on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"round",signature:e=>({argTypes:[e],returnType:e}),normalImpl:V2,codegenImpl:e=>x`round(${e})`});function L2(e){if(typeof e=="number")return Math.max(0,Math.min(1,e));throw new Gt("CPU implementation for saturate on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"saturate",signature:e=>({argTypes:[e],returnType:e}),normalImpl:L2,codegenImpl:e=>x`saturate(${e})`});function F2(e){return typeof e=="number"?Math.sign(e):F.sign[e.kind](e)}M({name:"sign",signature:e=>({argTypes:[e],returnType:e}),normalImpl:F2,codegenImpl:e=>x`sign(${e})`});function G2(e){return typeof e=="number"?Math.sin(e):F.sin[e.kind](e)}M({name:"sin",signature:e=>({argTypes:[e],returnType:e}),normalImpl:G2,codegenImpl:e=>x`sin(${e})`});function N2(e){if(typeof e=="number")return Math.sinh(e);throw new Gt("CPU implementation for sinh on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"sinh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:N2,codegenImpl:e=>x`sinh(${e})`});function D2(e,t,n){return typeof n=="number"?wr(e,t,n):F.smoothstep[n.kind](e,t,n)}M({name:"smoothstep",signature:(e,t,n)=>({argTypes:[e,t,n],returnType:n}),normalImpl:D2,codegenImpl:(e,t,n)=>x`smoothstep(${e}, ${t}, ${n})`});function j2(e){return typeof e=="number"?Math.sqrt(e):F.sqrt[e.kind](e)}M({name:"sqrt",signature:e=>({argTypes:[e],returnType:e}),normalImpl:j2,codegenImpl:e=>x`sqrt(${e})`});function W2(e,t){if(typeof e=="number")return e<=t?1:0;throw new Gt("CPU implementation for step on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"step",signature:(...e)=>{let t=$t(e,[v,Xe,un])??e;return{argTypes:t,returnType:t[0]}},normalImpl:W2,codegenImpl:(e,t)=>x`step(${e}, ${t})`});function q2(e){if(typeof e=="number")return Math.tan(e);throw new Gt("CPU implementation for tan on vectors not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues")}M({name:"tan",signature:e=>({argTypes:[e],returnType:e}),normalImpl:q2,codegenImpl:e=>x`tan(${e})`});function Y2(e){return typeof e=="number"?Math.tanh(e):F.tanh[e.kind](e)}M({name:"tanh",signature:e=>({argTypes:[e],returnType:e}),normalImpl:Y2,codegenImpl:e=>x`tanh(${e})`});M({name:"transpose",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for transpose not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`transpose(${e})`});M({name:"trunc",signature:e=>({argTypes:[e],returnType:e}),normalImpl:"CPU implementation for trunc not implemented yet. Please submit an issue at https://github.com/software-mansion/TypeGPU/issues",codegenImpl:e=>x`trunc(${e})`});var{NodeTypeCatalog:ze}=Y0,X2=["==","!=","<","<=",">",">=","<<",">>","+","-","*","/","%","|","^","&","&&","||"],Z2=["&&","||","==","!=","<","<=",">",">="],H2=["vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","mat2x2f","mat3x3f","mat4x4f"],Vc={add:pd,sub:oa,mul:Du,div:md};function Lc(e,t,n){return n?Z2.includes(t)?Ve:t==="="?n:e:t==="!"||t==="~"?Ve:e}var K2={"+":pd[m].gpuImpl,"-":oa[m].gpuImpl,"*":Du[m].gpuImpl,"/":md[m].gpuImpl,"**":R2[m].gpuImpl},_s,bf,Q2=(bf=class{constructor(){Z(this,_s)}initGenerator(e){q(this,_s,e)}get ctx(){if(!w(this,_s))throw new Error("WGSL Generator has not yet been initialized. Please call initialize(ctx) before using the generator.");return w(this,_s)}block([e,t]){this.ctx.pushBlockScope();try{this.ctx.indent();let n=t.map(r=>this.statement(r)).join(`
`);return this.ctx.dedent(),`{
${n}
${this.ctx.pre}}`}finally{this.ctx.popBlockScope()}}blockVariable(e,t){let n=S(this.ctx.makeNameValid(e),t);return this.ctx.defineVariable(e,n),n}identifier(e){if(!e)throw new Error("Cannot resolve an empty identifier");let t=this.ctx.getById(e);if(!t)throw new Error(`Identifier ${e} not found`);return t}typedExpression(e,t){let n=this.ctx.expectedType;this.ctx.expectedType=t;try{let r=this.expression(e);return yl(r,t)}finally{this.ctx.expectedType=n}}expression(e){var t,n;if(typeof e=="string")return this.identifier(e);if(typeof e=="boolean")return S(e,Ve);if(e[0]===ze.logicalExpr||e[0]===ze.binaryExpr||e[0]===ze.assignmentExpr){let[r,s,i,a]=e,o=this.expression(s),l=this.expression(a),u=K2[i];if(u)return u(o,l);let c=e[0]===ze.assignmentExpr?o.dataType.type==="ptr"?[o.dataType.inner]:[o.dataType]:void 0,[f,h]=Ti([o,l],c)??[o,l],d=this.ctx.resolve(f.value,f.dataType).value,p=this.ctx.resolve(h.value,h.dataType).value,y=Lc(f.dataType,i,h.dataType);return S(X2.includes(i)?`(${d} ${i} ${p})`:`${d} ${i} ${p}`,y)}if(e[0]===ze.postUpdate){let[r,s,i]=e,a=this.expression(i),o=this.ctx.resolve(a.value,a.dataType).value;return S(`${o}${s}`,a.dataType)}if(e[0]===ze.unaryExpr){let[r,s,i]=e,a=this.expression(i),o=this.ctx.resolve(a.value,a.dataType).value,l=Lc(a.dataType,s);return S(`${s}${o}`,l)}if(e[0]===ze.memberAccess){let[r,s,i]=e,a=this.expression(s);if(a.value===console)return S(new xc(i),xt);if(H2.includes(a.dataType.type)&&i in Vc)return{value:new wc(i,a,Vc[i][m].gpuImpl),dataType:xt};if(a.dataType.type==="unknown"){let o=a.value[i];return Pa(o)}return gc(a.dataType)?S(`(*${this.ctx.resolve(a.value).value}).${i}`,vl(a.dataType.inner,i)):on(a.dataType)&&i==="length"?a.dataType.elementCount===0?S(`arrayLength(&${this.ctx.resolve(a.value).value})`,V):S(String(a.dataType.elementCount),_o):Ei(a.dataType)&&i==="columns"?S(new vc(a),xt):Gn(a.dataType)&&Ee(a.value)?Pa(a.value[i]):S(`${this.ctx.resolve(a.value).value}.${i}`,vl(a.dataType,i))}if(e[0]===ze.indexAccess){let[r,s,i]=e,a=this.expression(s),o=this.expression(i),l=this.ctx.resolve(o.value,o.dataType).value;if(a.value instanceof vc)return S(x`${a.value.matrix}[${l}]`,jo(a.value.matrix.dataType));let u=this.ctx.resolve(a.value,a.dataType).value;if(a.dataType.type==="unknown"){if(Array.isArray(i)&&i[0]===ze.numericLiteral)return Pa(a.value[i[1]]);throw new Error(`Unable to index a value of unknown type with index ${l}. If the value is an array, to address this, consider one of the following approaches: (1) declare the array using 'tgpu.const', (2) store the array in a buffer, or (3) define the array within the GPU function scope.`)}if(Ei(a.dataType))throw new Error("The only way of accessing matrix elements in TGSL is through the 'columns' property.");return gc(a.dataType)?S(`(*${u})[${l}]`,jo(a.dataType.inner)):S(`${u}[${l}]`,Ks(a.dataType)?jo(a.dataType):xt)}if(e[0]===ze.numericLiteral){let r=typeof e[1]=="string"?qa(e3(e[1])):qa(e[1]);if(!r)throw new Error(`Invalid numeric literal ${e[1]}`);return r}if(e[0]===ze.call){let[r,s,i]=e,a=this.expression(s);if(bt(a.value)||on(a.value)){if(i.length>1)throw new Kt("Array and struct schemas should always be called with at most 1 argument");if(!i[0])return S(`${this.ctx.resolve(a.value).value}()`,a.value);let l=this.typedExpression(i[0],a.value);return S(this.ctx.resolve(l.value,a.value).value,a.value)}if(a.value===xl)throw new Error("Constants cannot be defined within TypeGPU function scope. To address this, move the constant definition outside the function scope.");if(a.value instanceof wc){if(!i[0])throw new Kt(`An infix operator '${a.value.name}' was called without any arguments`);let l=this.expression(i[0]);return a.value.operator(a.value.lhs,l)}if(!xe(a.value)){let l=i.map(c=>this.expression(c)),u=this.ctx.shelllessRepo.get(a.value,l);if(u)return this.ctx.withResetIndentLevel(()=>{let c=this.ctx.resolve(u);return S(x`${c.value}(${l})`,c.dataType)});throw new Error(`Function '${O(a.value)??String(a.value)}' is not marked with the 'use gpu' directive and cannot be used in a shader`)}let o=((t=a.value[m])==null?void 0:t.argConversionHint)??"keep";try{let l;if(Array.isArray(o))l=i.map((c,f)=>{let h=o[f];if(!h)throw new Kt(`Function '${O(a.value)}' was called with too many arguments`);return this.typedExpression(c,h)});else{let c=i.map(f=>this.expression(f));o==="keep"?l=c:o==="unify"?l=Ti(c)??c:l=o(...c).map((f,h)=>[f,c[h]]).map(([f,h])=>yl(h,f))}if(a.value instanceof xc)return this.ctx.generateLog(a.value.op,l);let u=a.value(...l);if(!xu(u))throw new Error("Functions running in codegen mode must return snippets");return u}catch(l){throw new yi(l,[{toString:()=>O(a.value)}])}}if(e[0]===ze.objectExpr){let r=e[1],s=this.ctx.expectedType;if(!s||!bt(s))throw new Kt(`No target type could be inferred for object with keys [${Object.keys(r).join(", ")}], please wrap the object in the corresponding schema.`);let i=Object.fromEntries(Object.entries(s.propTypes).map(([o,l])=>{let u=r[o];if(u===void 0)throw new Kt(`Missing property ${o} in object literal for struct ${s}`);let c=this.typedExpression(u,l);return[o,c]})),a=$0(s,i);return S(x`${this.ctx.resolve(s).value}(${a})`,s)}if(e[0]===ze.arrayExpr){let[r,s]=e,i=this.ctx.expectedType,a,o;if(on(i)){if(a=i.elementType,o=s.map(u=>this.typedExpression(u,a)),o.length!==i.elementCount)throw new Kt(`Cannot create value of type '${i}' from an array of length: ${o.length}`)}else{let u=s.map(f=>this.expression(f));if(u.length===0)throw new Kt("Cannot infer the type of an empty array literal.");let c=Ti(u);if(!c)throw new Kt("The given values cannot be automatically converted to a common type. Consider wrapping the array in an appropriate schema");o=c,a=Ri((n=o[0])==null?void 0:n.dataType)}let l=`array<${this.ctx.resolve(a).value}, ${o.length}>`;return S(x`${l}(${o})`,Ui[m].jsImpl(a,o.length))}if(e[0]===ze.stringLiteral)return S(e[1],xt);if(e[0]===ze.preUpdate)throw new Error("Cannot use pre-updates in TGSL.");J2(e)}functionDefinition(e){return this.block(e)}statement(e){if(typeof e=="string")return`${this.ctx.pre}${this.ctx.resolve(this.identifier(e).value).value};`;if(typeof e=="boolean")return`${this.ctx.pre}${e?"true":"false"};`;if(e[0]===ze.return){let t=e[1];if(t!==void 0){let n=this.ctx.topFunctionReturnType,r=n?this.typedExpression(t,n):this.expression(t);return Rn(r.dataType.type!=="unknown"),this.ctx.reportReturnType(r.dataType),x`${this.ctx.pre}return ${r};`}return`${this.ctx.pre}return;`}if(e[0]===ze.if){let[t,n,r,s]=e,i=this.typedExpression(n,Ve),a=i.value===!1?void 0:this.block(xa(r)),o=i.value===!0||!s?void 0:this.block(xa(s));return i.value===!0?`${this.ctx.pre}${a}`:i.value===!1?o?`${this.ctx.pre}${o}`:"":o?x`\
${this.ctx.pre}if (${i}) ${a}
${this.ctx.pre}else ${o}`:x`${this.ctx.pre}if (${i}) ${a}`}if(e[0]===ze.let||e[0]===ze.const){let[t,n,r]=e,s=r!==void 0?this.expression(r):void 0;if(!s)throw new Error(`Cannot create variable '${n}' without an initial value.`);if(Qi(s.dataType))throw new Error(`Cannot create variable '${n}' with loose data type.`);let i=this.blockVariable(n,Ri(s.dataType));return x`${this.ctx.pre}var ${i.value} = ${s};`}if(e[0]===ze.block)return this.block(e);if(e[0]===ze.for){let[t,n,r,s,i]=e,[a,o,l]=this.ctx.withResetIndentLevel(()=>[n?this.statement(n):void 0,r?this.typedExpression(r,Ve):void 0,s?this.statement(s):void 0]),u=a?a.slice(0,-1):"",c=l?l.slice(0,-1):"",f=this.block(xa(i));return x`${this.ctx.pre}for (${u}; ${o}; ${c}) ${f}`}if(e[0]===ze.while){let[t,n,r]=e,s=this.typedExpression(n,Ve),i=this.ctx.resolve(s.value).value,a=this.block(xa(r));return`${this.ctx.pre}while (${i}) ${a}`}return e[0]===ze.continue?`${this.ctx.pre}continue;`:e[0]===ze.break?`${this.ctx.pre}break;`:`${this.ctx.pre}${this.ctx.resolve(this.expression(e).value).value};`}},_s=new WeakMap,bf);function J2(e){throw new Error(`'${Ai(e)}' was not handled by the WGSL generator.`)}function e3(e){return/^0x[0-9a-f]+$/i.test(e)?Number.parseInt(e):/^0b[01]+$/i.test(e)?Number.parseInt(e.slice(2),2):Number.parseFloat(e)}function xa(e){return typeof e!="object"||e[0]!==ze.block?[ze.block,[e]]:e}var t3=new Q2,yd=t3,gd=Object.defineProperty,n3=(e,t,n)=>t in e?gd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,r3=(e,t)=>{for(var n in t)gd(e,n,{get:t[n],enumerable:!0})},le=(e,t,n)=>n3(e,typeof t!="symbol"?t+"":t,n),s3={};r3(s3,{BufferReader:()=>tr,BufferWriter:()=>Kr,MaxValue:()=>je,Measurer:()=>Le,UnresolvedReferenceError:()=>vr,ValidationError:()=>Po,arrayOf:()=>u3,bool:()=>f3,byte:()=>g3,chars:()=>B3,concat:()=>U3,dynamicArrayOf:()=>C3,f16:()=>k3,f32:()=>P3,f32Array:()=>J3,f64Array:()=>e$,generic:()=>A3,genericEnum:()=>O3,i16:()=>v3,i16Array:()=>K3,i32:()=>T3,i32Array:()=>Q3,i8:()=>m3,i8Array:()=>H3,keyed:()=>F3,object:()=>E3,optional:()=>N3,string:()=>p3,tupleOf:()=>W3,u16:()=>b3,u16Array:()=>X3,u32:()=>S3,u32Array:()=>Z3,u8:()=>$d,u8Array:()=>q3,u8ClampedArray:()=>Y3});var vr=class wd extends Error{constructor(t){super(t),Object.setPrototypeOf(this,wd.prototype)}},Po=class vd extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vd.prototype)}},i3=class{constructor(){le(this,"size",Number.NaN),le(this,"unbounded",this),le(this,"isUnbounded",!0)}add(){return this}fork(){return this}},a3=new i3,Le=class xd{constructor(){le(this,"size",0),le(this,"unbounded",a3),le(this,"isUnbounded",!1)}add(t){return this.size+=t,this}fork(){const t=new xd;return t.size=this.size,t}},je=Symbol("The biggest (in amount of bytes needed) value a schema can represent"),lt=class{constructor(){le(this,"__unwrapped")}resolveReferences(e){}seekProperty(e,t){return null}},o3=class{constructor(e){this.key=e}},Mi={STRING:"string",ENUM:"enum"},l3=class extends lt{constructor(e,t){super(),this._unstableElementSchema=e,this.length=t,le(this,"elementSchema"),this.elementSchema=e}resolveReferences(e){this.elementSchema=e.resolve(this._unstableElementSchema)}write(e,t){if(t.length!==this.length)throw new Po(`Expected array of length ${this.length}, got ${t.length}`);for(const n of t)this.elementSchema.write(e,n)}read(e){const t=[];for(let n=0;n<this.length;++n)t.push(this.elementSchema.read(e));return t}get maxSize(){return this.elementSchema.measure(je).size*this.length}measure(e,t=new Le){for(let n=0;n<this.length;++n)this.elementSchema.measure(e===je?je:e[n],t);return t}};function u3(e,t){return new l3(e,t)}var c3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",1)}read(e){return e.readBool()}write(e,t){e.writeBool(t)}measure(e,t=new Le){return t.add(1)}},f3=new c3,bd=class gi extends lt{static get _encoder(){return gi._cachedEncoder||(gi._cachedEncoder=new TextEncoder),gi._cachedEncoder}read(t){return t.readString()}write(t,n){t.writeString(n)}measure(t,n=new Le){if(t===je)return n.unbounded;const r=gi._encoder.encode(t);return n.add(r.byteLength+1)}};le(bd,"_cachedEncoder");var h3=bd,p3=new h3,d3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",1)}read(e){return e.readInt8()}write(e,t){e.writeInt8(t)}measure(e,t=new Le){return t.add(1)}},m3=new d3,y3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",1)}read(e){return e.readUint8()}write(e,t){e.writeUint8(t)}measure(e,t=new Le){return t.add(1)}},$d=new y3,g3=$d,w3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",2)}read(e){return e.readInt16()}write(e,t){e.writeInt16(t)}measure(e,t=new Le){return t.add(2)}},v3=new w3,x3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",2)}read(e){return e.readUint16()}write(e,t){e.writeUint16(t)}measure(e,t=new Le){return t.add(2)}},b3=new x3,$3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",4)}read(e){return e.readInt32()}write(e,t){e.writeInt32(t)}measure(e,t=new Le){return t.add(4)}},T3=new $3,_3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",4)}read(e){return e.readUint32()}write(e,t){e.writeUint32(t)}measure(e,t=new Le){return t.add(4)}},S3=new _3,z3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",2)}read(e){return e.readFloat16()}write(e,t){e.writeFloat16(t)}measure(e,t=new Le){return t.add(2)}},k3=new z3,M3=class extends lt{constructor(){super(...arguments),le(this,"maxSize",4)}read(e){return e.readFloat32()}write(e,t){e.writeFloat32(t)}measure(e,t=new Le){return t.add(4)}},P3=new M3,I3=class extends lt{constructor(e){super(),this.length=e}write(e,t){if(t.length!==this.length)throw new Po(`Expected char-string of length ${this.length}, got ${t.length}`);for(let n=0;n<t.length;++n)e.writeUint8(t.charCodeAt(n))}read(e){let t="";for(let n=0;n<this.length;++n)t+=String.fromCharCode(e.readByte());return t}measure(e,t=new Le){return t.add(this.length)}};function B3(e){return new I3(e)}function Jn(e){return Object.entries(e)}function Td(e,t){const n={};for(const[r,s]of Jn(t))n[r]=e.resolve(s);return n}var ju=class extends lt{constructor(e){super(),this._properties=e,le(this,"properties"),this.properties=e}resolveReferences(e){this.properties=Td(e,this._properties)}write(e,t){for(const[n,r]of Jn(this.properties))r.write(e,t[n])}read(e){const t={};for(const[n,r]of Jn(this.properties))t[n]=r.read(e);return t}get maxSize(){const e=new Le;for(const t of Object.values(this.properties))t.measure(je,e);return e.size}measure(e,t=new Le){for(const[n,r]of Jn(this.properties))r.measure(e===je?je:e[n],t);return t}seekProperty(e,t){let n=0;for(const[r,s]of Jn(this.properties)){if(r===t)return{bufferOffset:n,schema:s};n+=s.measure(e).size}return null}};function E3(e){return new ju(e)}var _d=class extends lt{constructor(e,t,n){super(),this.keyedBy=e,this._subTypeMap=n,le(this,"_baseObject"),le(this,"subTypeMap"),this._baseObject=new ju(t),this.subTypeMap=n}resolveReferences(e){this._baseObject.resolveReferences(e),this.subTypeMap=Td(e,this._subTypeMap)}write(e,t){const n=t.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);this.keyedBy===Mi.ENUM?e.writeUint8(t.type):e.writeString(t.type),this._baseObject.write(e,t);for(const[s,i]of Jn(r.properties))i.write(e,t[s])}read(e){const t=this.keyedBy===Mi.ENUM?e.readByte():e.readString(),n=this.subTypeMap[t]||null;if(n===null)throw new Error(`Unknown sub-type '${t}' in among '${JSON.stringify(Object.keys(this.subTypeMap))}'`);const r=this._baseObject.read(e);if(r.type=t,n!==null)for(const[s,i]of Jn(n.properties))r[s]=i.read(e);return r}measure(e,t=new Le){if(this._baseObject.measure(e,t),this.keyedBy===Mi.ENUM)t.add(1);else if(e!==je)t.add(e.type.length+1);else return t.unbounded;if(e===je){const n=Object.values(this.subTypeMap).map(r=>{const s=t.fork();for(const i of Object.values(r.properties))i.measure(je,s);return[r,s.size]}).reduce((r,s)=>r[1]>s[1]?r:s)[0];for(const r of Object.values(n.properties))r.measure(je,t)}else{const n=e.type,r=this.subTypeMap[n]||null;if(r===null)throw new Error(`Unknown sub-type '${n.toString()}', expected one of '${JSON.stringify(Object.keys(this.subTypeMap))}'`);for(const[s,i]of Jn(r.properties))i.measure(e[s],t)}return t}};function A3(e,t){return new _d(Mi.STRING,e,t)}function O3(e,t){return new _d(Mi.ENUM,e,t)}function U3(e){return new ju(Object.fromEntries(e.flatMap(({properties:t})=>Object.entries(t))))}var R3=class extends lt{constructor(e){super(),this._unstableElementType=e,le(this,"elementType"),this.elementType=e}resolveReferences(e){this.elementType=e.resolve(this._unstableElementType)}write(e,t){e.writeUint32(t.length);for(const n of t)this.elementType.write(e,n)}read(e){const t=[],n=e.readUint32();for(let r=0;r<n;++r)t.push(this.elementType.read(e));return t}get maxSize(){return this.measure(je).size}measure(e,t=new Le){if(e===je)return t.unbounded;t.add(4);for(const n of e)this.elementType.measure(n,t);return t}seekProperty(e,t){if(typeof t=="symbol")return null;const n=Number.parseInt(String(t),10);if(Number.isNaN(n))return null;if(e===je)return{bufferOffset:this.elementType.measure(je).size*n,schema:this.elementType};if(n>=e.length)return null;const r=new Le;for(let s=0;s<n;++s)this.elementType.measure(e[s],r);return{bufferOffset:r.size,schema:this.elementType}}};function C3(e){return new R3(e)}var Sd=class{constructor(e){le(this,"__unwrapped"),le(this,"ref"),this.ref=new o3(e)}resolveReferences(){throw new vr("Tried to resolve a reference directly. Do it through a RefResolver instead.")}read(){throw new vr("Tried to read a reference directly. Resolve it instead.")}write(){throw new vr("Tried to write a reference directly. Resolve it instead.")}measure(){throw new vr("Tried to measure size of a reference directly. Resolve it instead.")}seekProperty(){throw new vr("Tried to seek property of a reference directly. Resolve it instead.")}},V3=class{constructor(){le(this,"registry",{})}hasKey(e){return this.registry[e]!==void 0}register(e,t){this.registry[e]=t}resolve(e){if(e instanceof Sd){const n=e.ref.key;if(this.registry[n]!==void 0)return this.registry[n];throw new vr(`Couldn't resolve reference to ${n}. Unknown key.`)}return e.resolveReferences(this),e}},L3=class{constructor(e,t){this.key=e,le(this,"__unwrapped"),le(this,"__keyDefinition"),le(this,"innerType"),this.innerType=t(new Sd(e)),this.resolveReferences(new V3)}resolveReferences(e){e.hasKey(this.key)||(e.register(this.key,this.innerType),this.innerType.resolveReferences(e))}read(e){return this.innerType.read(e)}write(e,t){this.innerType.write(e,t)}get maxSize(){return this.measure(je).size}measure(e,t=new Le){return this.innerType.measure(e,t)}seekProperty(e,t){return this.innerType.seekProperty(e,t)}};function F3(e,t){return new L3(e,t)}var G3=class extends lt{constructor(e){super(),this._innerUnstableSchema=e,le(this,"innerSchema"),this.innerSchema=e}resolveReferences(e){this.innerSchema=e.resolve(this._innerUnstableSchema)}write(e,t){t!=null?(e.writeBool(!0),this.innerSchema.write(e,t)):e.writeBool(!1)}read(e){if(e.readBool())return this.innerSchema.read(e)}get maxSize(){return this.measure(je).size}measure(e,t=new Le){return e!==void 0&&this.innerSchema.measure(e,t),t.add(1)}};function N3(e){return new G3(e)}function D3(e,t){return t.map(n=>e.resolve(n))}var j3=class extends lt{constructor(e){super(),this._unstableSchemas=e,le(this,"schemas"),this.schemas=e}resolveReferences(e){this.schemas=D3(e,this._unstableSchemas)}write(e,t){if(t.length!==this.schemas.length)throw new Po(`Expected tuple of length ${this.schemas.length}, got ${t.length}`);for(let n=0;n<this.schemas.length;++n)this.schemas[n].write(e,t[n])}read(e){const t=[];for(let n=0;n<this.schemas.length;++n)t.push(this.schemas[n].read(e));return t}get maxSize(){return this.measure(je).size}measure(e,t=new Le){for(let n=0;n<this.schemas.length;++n)this.schemas[n].measure(e===je?je:e[n],t);return t}};function W3(e){return new j3(e)}var jn=class extends lt{constructor(e,t){super(),this.length=e,this._arrayConstructor=t,le(this,"byteLength"),this.byteLength=e*t.BYTES_PER_ELEMENT}write(e,t){e.writeSlice(t)}read(e){const t=new ArrayBuffer(this.byteLength),n=new this._arrayConstructor(t,0,this.length);return e.readSlice(n,0,this.byteLength),n}measure(e,t=new Le){return t.add(this.byteLength)}},q3=e=>new jn(e,Uint8Array),Y3=e=>new jn(e,Uint8ClampedArray),X3=e=>new jn(e,Uint16Array),Z3=e=>new jn(e,Uint32Array),H3=e=>new jn(e,Int8Array),K3=e=>new jn(e,Int16Array),Q3=e=>new jn(e,Int32Array),J3=e=>new jn(e,Float32Array),e$=e=>new jn(e,Float64Array);function t$(){const e=new Uint8Array(4),t=new Uint32Array(e.buffer);return t[0]=1,e[0]===0}function zd(){return t$()?"big":"little"}function Wu(e){let t=0,n=e;return n&&"buffer"in n&&"byteOffset"in n&&(t+=n.byteOffset,n=n.buffer),{buffer:n,byteOffset:t,byteLength:e.byteLength}}var kd=class{constructor(e,t){le(this,"dataView"),le(this,"littleEndian"),le(this,"byteOffset",0),le(this,"endianness");const{byteOffset:n=0,endianness:r="system"}=t??{};this.byteOffset=n;const s=zd();this.endianness=r==="system"?s:r,this.littleEndian=this.endianness==="little";const i=Wu(e);this.byteOffset+=i.byteOffset,this.dataView=new DataView(i.buffer)}get currentByteOffset(){return this.byteOffset}seekTo(e){this.byteOffset=e}skipBytes(e){this.byteOffset+=e}};function n$(e){if(e===0)return 0;if(Number.isNaN(e))return 32256;if(!Number.isFinite(e))return e>0?31744:64512;const t=e<0?1:0,n=Math.abs(e),r=Math.floor(Math.log2(n)),s=n/2**r-1,i=r+15,a=Math.floor(s*1024);return t<<15|i<<10|a}function r$(e){const t=(e&32768)>>15,n=(e&31744)>>10,r=e&1023;return n===0?t===0?r/1024:-r/1024:n===31?r===0?t===0?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:Number.NaN:(t===0?1:-1)*(1+r/1024)*2**(n-15)}var tr=class extends kd{constructor(){super(...arguments),le(this,"_cachedTextDecoder")}get _textDecoder(){return this._cachedTextDecoder||(this._cachedTextDecoder=new TextDecoder(void 0,{fatal:!0})),this._cachedTextDecoder}readBool(){return this.dataView.getUint8(this.byteOffset++)!==0}readByte(){return this.dataView.getUint8(this.byteOffset++)}readInt8(){return this.dataView.getInt8(this.byteOffset++)}readUint8(){return this.dataView.getUint8(this.byteOffset++)}readInt16(){const e=this.dataView.getInt16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readUint16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,e}readInt32(){const e=this.dataView.getInt32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readUint32(){const e=this.dataView.getUint32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readFloat16(){const e=this.dataView.getUint16(this.byteOffset,this.littleEndian);return this.byteOffset+=2,r$(e)}readFloat32(){const e=this.dataView.getFloat32(this.byteOffset,this.littleEndian);return this.byteOffset+=4,e}readString(){let e=0;for(;this.byteOffset+e<this.dataView.byteLength&&this.dataView.getUint8(this.byteOffset+e++)!==0;);const t=this._textDecoder.decode(new Uint8Array(this.dataView.buffer,this.byteOffset,e-1));return this.byteOffset+=e,t}readSlice(e,t,n){const r=Wu(e),s=new Uint8Array(r.buffer,r.byteOffset+t);for(let i=0;i<n;++i)s[i]=this.dataView.getUint8(this.byteOffset++)}},Kr=class extends kd{constructor(){super(...arguments),le(this,"_cachedTextEncoder")}get _textEncoder(){return this._cachedTextEncoder||(this._cachedTextEncoder=new TextEncoder),this._cachedTextEncoder}writeBool(e){this.dataView.setUint8(this.byteOffset++,e?1:0)}writeByte(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt8(e){this.dataView.setInt8(this.byteOffset++,e)}writeUint8(e){this.dataView.setUint8(this.byteOffset++,e)}writeInt16(e){this.dataView.setInt16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeUint16(e){this.dataView.setUint16(this.byteOffset,e,this.littleEndian),this.byteOffset+=2}writeInt32(e){this.dataView.setInt32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeUint32(e){this.dataView.setUint32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeFloat16(e){this.dataView.setUint16(this.byteOffset,n$(e),this.littleEndian),this.byteOffset+=2}writeFloat32(e){this.dataView.setFloat32(this.byteOffset,e,this.littleEndian),this.byteOffset+=4}writeString(e){const t=this._textEncoder.encodeInto(e,new Uint8Array(this.dataView.buffer,this.byteOffset));this.byteOffset+=t.written,this.dataView.setUint8(this.byteOffset++,0)}writeSlice(e){const t=Wu(e),n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);for(const r of n)this.dataView.setUint8(this.byteOffset++,r)}},s$=M({name:"bitcastU32toF32",normalImpl:e=>typeof e=="number"?hn(e):F.bitcastU32toF32[e.kind](e),codegenImpl:e=>x`bitcast<f32>(${e})`,signature:(...e)=>{let t=$t(e,[V])??e;return{argTypes:t,returnType:Gn(t[0])?t[0].type==="vec2u"?ve:t[0].type==="vec3u"?rt:_:v}}}),i$=M({name:"bitcastU32toI32",normalImpl:e=>typeof e=="number"?pn(e):F.bitcastU32toI32[e.kind](e),codegenImpl:e=>x`bitcast<i32>(${e})`,signature:(...e)=>{let t=$t(e,[V])??e;return{argTypes:t,returnType:Gn(t[0])?t[0].type==="vec2u"?ft:t[0].type==="vec3u"?Nt:Me:Te}}}),a$=ot(e=>{let t=new ArrayBuffer(4);new Kr(t).writeUint32(e);let n=new tr(t);return ve(n.readFloat16(),n.readFloat16())},e=>S(x`unpack2x16float(${e})`,ve),"unpack2x16float");ot(e=>{let t=new ArrayBuffer(4),n=new Kr(t);n.writeFloat16(e.x),n.writeFloat16(e.y);let r=new tr(t);return V(r.readUint32())},e=>S(x`pack2x16float(${e})`,V),"pack2x16float");ot(e=>{let t=new ArrayBuffer(4);new Kr(t).writeUint32(e);let n=new tr(t);return _(n.readUint8()/255,n.readUint8()/255,n.readUint8()/255,n.readUint8()/255)},e=>S(x`unpack4x8unorm(${e})`,_),"unpack4x8unorm");ot(e=>{let t=new ArrayBuffer(4),n=new Kr(t);n.writeUint8(e.x*255),n.writeUint8(e.y*255),n.writeUint8(e.z*255),n.writeUint8(e.w*255);let r=new tr(t);return V(r.readUint32())},e=>S(x`pack4x8unorm(${e})`,V),"pack4x8unorm");function Qs(e){return e.type.includes("2")?Yr:e.type.includes("3")?Xr:Zr}var o$=M({name:"allEq",signature:(...e)=>({argTypes:e,returnType:Ve}),normalImpl:(e,t)=>Yu(la(e,t)),codegenImpl:(e,t)=>x`all(${e} == ${t})`}),la=(e,t)=>F.eq[e.kind](e,t);M({name:"eq",signature:(...e)=>({argTypes:e,returnType:Qs(e[0])}),normalImpl:la,codegenImpl:(e,t)=>x`(${e} == ${t})`});M({name:"ne",signature:(...e)=>({argTypes:e,returnType:Qs(e[0])}),normalImpl:(e,t)=>Vn(la(e,t)),codegenImpl:(e,t)=>x`(${e} != ${t})`});var Io=(e,t)=>F.lt[e.kind](e,t);M({name:"lt",signature:(...e)=>({argTypes:e,returnType:Qs(e[0])}),normalImpl:Io,codegenImpl:(e,t)=>x`(${e} < ${t})`});M({name:"le",signature:(...e)=>({argTypes:e,returnType:Qs(e[0])}),normalImpl:(e,t)=>qu(Io(e,t),la(e,t)),codegenImpl:(e,t)=>x`(${e} <= ${t})`});M({name:"gt",signature:(...e)=>({argTypes:e,returnType:Qs(e[0])}),normalImpl:(e,t)=>Md(Vn(Io(e,t)),Vn(la(e,t))),codegenImpl:(e,t)=>x`(${e} > ${t})`});M({name:"ge",signature:(...e)=>({argTypes:e,returnType:Qs(e[0])}),normalImpl:(e,t)=>Vn(Io(e,t)),codegenImpl:(e,t)=>x`(${e} >= ${t})`});var Vn=e=>F.neg[e.kind](e);M({name:"not",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Vn,codegenImpl:e=>x`!(${e})`});var qu=(e,t)=>F.or[e.kind](e,t);M({name:"or",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:qu,codegenImpl:(e,t)=>x`(${e} | ${t})`});var Md=(e,t)=>Vn(qu(Vn(e),Vn(t)));M({name:"and",signature:(...e)=>({argTypes:e,returnType:e[0]}),normalImpl:Md,codegenImpl:(e,t)=>x`(${e} & ${t})`});var Yu=e=>F.all[e.kind](e);M({name:"all",signature:(...e)=>({argTypes:e,returnType:Ve}),normalImpl:Yu,codegenImpl:e=>x`all(${e})`});M({name:"any",signature:(...e)=>({argTypes:e,returnType:Ve}),normalImpl:e=>!Yu(Vn(e)),codegenImpl:e=>x`any(${e})`});M({name:"isCloseTo",signature:(...e)=>({argTypes:e,returnType:Ve}),normalImpl:(e,t,n=.01)=>typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<n:Ee(e)&&Ee(t)?F.isCloseToZero[e.kind](oa[m].jsImpl(e,t),n):!1,codegenImpl:(e,t,n=S(.01,v))=>ya(e)&&ya(t)?x`(abs(f32(${e}) - f32(${t})) <= ${n})`:!ya(e)&&!ya(t)?x`all(abs(${e} - ${t}) <= (${e} - ${e}) + ${n})`:"false"});function l$(e,t,n){return typeof n=="boolean"?n?t:e:F.select[e.kind](e,t,n)}M({name:"select",signature:(e,t,n)=>{let[r,s]=$t([e,t])??[e,t];return{argTypes:[r,s,n],returnType:r}},normalImpl:l$,codegenImpl:(e,t,n)=>x`select(${e}, ${t}, ${n})`});var ua={r8unorm:{channelType:v,vectorType:_,texelSize:1,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},r8snorm:{channelType:v,vectorType:_,texelSize:1,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},r8uint:{channelType:V,vectorType:Be,texelSize:1,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r8sint:{channelType:Te,vectorType:Me,texelSize:1,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rg8unorm:{channelType:v,vectorType:_,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rg8snorm:{channelType:v,vectorType:_,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg8uint:{channelType:V,vectorType:Be,texelSize:2,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg8sint:{channelType:Te,vectorType:Me,texelSize:2,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba8unorm:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},"rgba8unorm-srgb":{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:null},rgba8snorm:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba8uint:{channelType:V,vectorType:Be,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba8sint:{channelType:Te,vectorType:Me,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},bgra8unorm:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only"]},"bgra8unorm-srgb":{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:null},r16unorm:{channelType:v,vectorType:_,texelSize:2,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},r16snorm:{channelType:v,vectorType:_,texelSize:2,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},r16uint:{channelType:V,vectorType:Be,texelSize:2,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r16sint:{channelType:Te,vectorType:Me,texelSize:2,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r16float:{channelType:v,vectorType:_,texelSize:2,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},rg16unorm:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16snorm:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16uint:{channelType:V,vectorType:Be,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16sint:{channelType:Te,vectorType:Me,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rg16float:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rgba16unorm:{channelType:v,vectorType:_,texelSize:8,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba16snorm:{channelType:v,vectorType:_,texelSize:8,sampleTypes:["unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgba16uint:{channelType:V,vectorType:Be,texelSize:8,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba16sint:{channelType:Te,vectorType:Me,texelSize:8,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba16float:{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only","read-write"]},r32uint:{channelType:V,vectorType:Be,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r32sint:{channelType:Te,vectorType:Me,texelSize:4,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},r32float:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rg32uint:{channelType:V,vectorType:Be,texelSize:8,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg32sint:{channelType:Te,vectorType:Me,texelSize:8,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only"]},rg32float:{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32uint:{channelType:V,vectorType:Be,texelSize:16,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32sint:{channelType:Te,vectorType:Me,texelSize:16,sampleTypes:["sint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgba32float:{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!1,canResolve:!1,storageBindings:["write-only","read-only","read-write"]},rgb10a2uint:{channelType:V,vectorType:Be,texelSize:4,sampleTypes:["uint"],aspects:["color"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:["write-only","read-only"]},rgb10a2unorm:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rg11b10ufloat:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!0,canBlend:!0,canMultisample:!0,canResolve:!0,storageBindings:["write-only","read-only"]},rgb9e5ufloat:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},stencil8:{channelType:V,vectorType:Be,texelSize:1,sampleTypes:["uint"],aspects:["stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth16unorm:{channelType:v,vectorType:_,texelSize:2,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth24plus:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"depth24plus-stencil8":{channelType:v,vectorType:_,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth","stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},depth32float:{channelType:v,vectorType:_,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"depth32float-stencil8":{channelType:v,vectorType:_,texelSize:4,sampleTypes:["depth","unfilterable-float"],aspects:["depth","stencil"],canRenderAttachment:!0,canBlend:!1,canMultisample:!0,canResolve:!1,storageBindings:null},"bc1-rgba-unorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc1-rgba-unorm-srgb":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc2-rgba-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc2-rgba-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc3-rgba-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc3-rgba-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc4-r-unorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc4-r-snorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc5-rg-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc5-rg-snorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc6h-rgb-ufloat":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc6h-rgb-float":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc7-rgba-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"bc7-rgba-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8unorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8unorm-srgb":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8a1unorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgb8a1unorm-srgb":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgba8unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"etc2-rgba8unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-r11unorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-r11snorm":{channelType:v,vectorType:_,texelSize:8,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-rg11unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"eac-rg11snorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-4x4-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-4x4-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x4-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x4-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x5-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-5x5-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x5-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x5-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x6-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-6x6-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x5-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x5-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x6-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x6-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x8-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-8x8-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x5-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x5-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x6-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x6-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x8-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x8-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x10-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-10x10-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x10-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x10-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x12-unorm":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null},"astc-12x12-unorm-srgb":{channelType:v,vectorType:_,texelSize:16,sampleTypes:["float","unfilterable-float"],aspects:["color"],canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1,storageBindings:null}};function Pd(e,t){let n=ua[e];if(!n)throw new Error(`Unknown texture format: ${e}`);let r={...n};switch(e){case"r32float":case"rg32float":case"rgba32float":t.features.has("float32-filterable")||(r={...r,sampleTypes:n.sampleTypes.filter(s=>s!=="float")}),t.features.has("float32-blendable")||(r={...r,canBlend:!1});break;case"bgra8unorm":t.features.has("bgra8unorm-storage")||(r={...r,storageBindings:null});break;case"rg11b10ufloat":t.features.has("rg11b10ufloat-renderable")||(r={...r,canRenderAttachment:!1,canBlend:!1,canMultisample:!1,canResolve:!1});break}if(r.storageBindings){let s=t.features.has("texture-formats-tier1"),i=t.features.has("texture-formats-tier2"),a=[...r.storageBindings],o=["r8unorm","r8uint","r8sint","r16uint","r16sint","r16float","rgba8unorm","rgba8uint","rgba8sint","rgba16uint","rgba16sint","rgba16float","r32uint","r32sint","r32float","rgba32uint","rgba32sint","rgba32float"],l=["r8snorm","rg8unorm","rg8snorm","rg8uint","rg8sint","rgba8snorm","r16unorm","r16snorm","rg16unorm","rg16snorm","rg16uint","rg16sint","rg16float","rgba16unorm","rgba16snorm","rgb10a2uint","rgb10a2unorm","rg11b10ufloat"];o.includes(e)&&!i&&(a=a.filter(u=>u!=="read-write")),l.includes(e)&&!s&&(a=a.filter(u=>u!=="write-only"&&u!=="read-only")),r={...r,storageBindings:a.length>0?a:null}}return r}var Id=["f16","clip_distances","dual_source_blending","subgroups","primitive_index"],Bd={f16:"shader-f16",clip_distances:"clip-distances",dual_source_blending:"dual-source-blending",subgroups:"subgroups",primitive_index:"primitive-index"};function u$(e){return new c$(e)}var $f,c$=class{constructor(e){g(this,$f,!0);g(this,"externalsToApply",[]);this.declaration=e}$uses(e){return this.externalsToApply.push(e),this}[($f=m,K)](e){let t={};for(let r of this.externalsToApply)_i(t,r);let n=So(e,t,this.declaration);return e.addDeclaration(n),S("",Pt)}toString(){return`declare: ${this.declaration}`}};function Ed(e){let t={argTypes:e.in&&Object.keys(e.in).length!==0?[ia(e.in)]:[],returnType:Pt,workgroupSize:[e.workgroupSize[0]??1,e.workgroupSize[1]??1,e.workgroupSize[2]??1],isEntry:!0},n=(r,...s)=>f$(t,e.workgroupSize,zo(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function f$(e,t,n){let r=sa(n,`@compute @workgroup_size(${t.join(", ")}) `),s=e.argTypes[0];return{shell:e,$uses(i){return r.applyExternals(i),this},[m]:!0,[Ne]:r,$name(i){return _e(r,i),bo(s)&&s.$name(`${i}_Input`),this},[K](i){return r.resolve(i,e.argTypes,e.returnType)},toString(){return`computeFn:${O(r)??"<unnamed>"}`}}}function ge(e,t){let n={[m]:!0,argTypes:e,returnType:t??Pt,isEntry:!1};return Object.assign((r,...s)=>p$(n,zo(r,...s)),n)}function Ad(e){return xe(e)&&(e==null?void 0:e.resourceType)==="function"}function h$([e,t]){return`${O(e)??"<unnamed>"}=${t}`}function p$(e,t){let n=sa(t,""),r={shell:e,resourceType:"function",$uses(a){return n.applyExternals(a),this},[Ne]:n,$name(a){return _e(n,a),this},with(a,o){return Od(i,[[To(a)?a.slot:a,o]])},[K](a){return typeof t=="string"&&(X0(t,e.argTypes,n.applyExternals),od(t,e.returnType,n.applyExternals)),n.resolve(a,e.argTypes,e.returnType)}},s=ot((...a)=>w0(()=>{try{if(typeof t=="string")throw new Error("Cannot execute on the CPU functions constructed with raw WGSL");let o=a.map((u,c)=>Oi(e.argTypes[c],u)),l=t(...o);return Oi(e.returnType,l)}catch(o){throw o instanceof bc?o.appendToTrace(i):new bc(o,[i])}}),(...a)=>S(new Ud(i,a),e.returnType),"tgpuFnCall",e.argTypes),i=Object.assign(s,r);return i[m].implementation=t,Object.defineProperty(i,"toString",{value(){return`fn:${O(n)??"<unnamed>"}`}}),i}function Od(e,t){let n={resourceType:"function",shell:e.shell,[$r]:{inner:e,pairs:t},$uses(i){return e.$uses(i),this},[Ne]:e,$name(i){return e.$name(i),this},with(i,a){return Od(s,[...t,[To(i)?i.slot:i,a]])}},r=ot((...i)=>e(...i),(...i)=>S(new Ud(s,i),e.shell.returnType),"tgpuFnCall",e.shell.argTypes),s=Object.assign(r,n);return s[m].implementation=e[m].implementation,Object.defineProperty(s,"toString",{value(){return`fn:${O(e)??"<unnamed>"}[${t.map(h$).join(", ")}]`}}),s[m].implementation=e[m].implementation,s}var Tf,_f,Sf,Tr,Vi,zf,Ud=(zf=class{constructor(e,t){g(this,Sf,!0);g(this,_f);g(this,Tf);Z(this,Tr);Z(this,Vi);q(this,Tr,e),q(this,Vi,t),this[Ne]=e,this[Bt]=S(this,w(this,Tr).shell.returnType)}[(Sf=m,_f=Bt,Tf=Ne,K)](e){return e.withResetIndentLevel(()=>S(x`${e.resolve(w(this,Tr)).value}(${w(this,Vi)})`,w(this,Tr).shell.returnType))}toString(){return`call:${O(this)??"<unnamed>"}`}},Tr=new WeakMap,Vi=new WeakMap,zf);function d$(e){let t={in:e.in,out:e.out,returnType:ia(e.out),isEntry:!0},n=(r,...s)=>m$(t,zo(r,...s));return Object.assign(Object.assign(n,t),{does:n})}function m$(e,t){let n=sa(t,"@fragment "),r=e.returnType;return typeof t=="string"&&od(t,r,s=>n.applyExternals(s)),{shell:e,outputType:r,$uses(s){return n.applyExternals(s),this},[m]:!0,[Ne]:n,$name(s){return _e(n,s),bo(r)&&r.$name(`${s}_Output`),this},[K](s){let i=e.in?ia(e.in,s.varyingLocations).$name(`${O(this)??""}_Input`):void 0;return i&&n.applyExternals({In:i}),n.applyExternals({Out:r}),n.resolve(s,i?[i]:[],e.returnType)},toString(){return`fragmentFn:${O(n)??"<unnamed>"}`}}}var Rd=new Set(["alias","break","case","const","const_assert","continue","continuing","default","diagnostic","discard","else","enable","false","fn","for","if","let","loop","override","requires","return","struct","switch","true","var","while","NULL","Self","abstract","active","alignas","alignof","as","asm","asm_fragment","async","attribute","auto","await","become","cast","catch","class","co_await","co_return","co_yield","coherent","column_major","common","compile","compile_fragment","concept","const_cast","consteval","constexpr","constinit","crate","debugger","decltype","delete","demote","demote_to_helper","do","dynamic_cast","enum","explicit","export","extends","extern","external","fallthrough","filter","final","finally","friend","from","fxgroup","get","goto","groupshared","highp","impl","implements","import","inline","instanceof","interface","layout","lowp","macro","macro_rules","match","mediump","meta","mod","module","move","mut","mutable","namespace","new","nil","noexcept","noinline","nointerpolation","non_coherent","noncoherent","noperspective","null","nullptr","of","operator","package","packoffset","partition","pass","patch","pixelfragment","precise","precision","premerge","priv","protected","pub","public","readonly","ref","regardless","register","reinterpret_cast","require","resource","restrict","self","set","shared","sizeof","smooth","snorm","static","static_assert","static_cast","std","subroutine","super","target","template","this","thread_local","throw","trait","try","type","typedef","typeid","typename","typeof","union","unless","unorm","unsafe","unsized","use","using","varying","virtual","volatile","wgsl","where","with","writeonly","yield"]);function Cd(e){if(e==="_"||e.startsWith("__")||/\s/.test(e))throw new Error(`Invalid identifier '${e}'. Choose an identifier without whitespaces or leading underscores.`);let t=e.split("_")[0];return!Rd.has(t)}var Vd=class{makeValid(e){return Cd(e)?e:this.makeUnique(e)}},y$=class extends Vd{constructor(){super(...arguments);g(this,"lastUniqueId",0)}makeUnique(t){let n;return t?(n=t.replaceAll(/\s/g,"_"),n=n.replaceAll(/[^\w\d]/g,"")):n="item",`${n}_${this.lastUniqueId++}`}},g$=class extends Vd{constructor(){super(...arguments);g(this,"_usedNames",new Set(Rd))}makeUnique(t){if(t===void 0)throw new Error("Unnamed item found when using a strict name registry");let n=0,r=t;for(;this._usedNames.has(r);)n++,r=`${t}_${n}`;return this._usedNames.add(r),r}};function w$(e,t){let n=sa(t,"");return{[m]:!0,[Ne]:n,resourceType:"shellless-impl",[K](r){return n.resolve(r,e,void 0)},toString(){return`fn*:${O(n)??"<unnamed>"}`}}}var v$=class{constructor(){g(this,"cache",new Map)}get(e,t){let n=$o(e);if(!(n!=null&&n.ast))return;if(!t&&n.ast.params.length>0)throw new Error(`Cannot resolve '${O(e)}' directly, because it expects arguments. Either call it from another function, or wrap it in a shell`);let r=(t??[]).map(a=>Ri(a.dataType)),s=this.cache.get(e);if(s){let a=s.find(o=>o.argTypes.every((l,u)=>l===r[u]));if(a)return a.value}else s=[],this.cache.set(e,s);let i=w$(r,e);return s.push({argTypes:r,value:i}),i}},kf,x$=(kf=m,class{constructor(e){g(this,kf);this[m]={nameRegistry:e,shelllessRepo:new v$,memoizedResolves:new WeakMap,memoizedDerived:new WeakMap,listeners:{name:new Set}}}on(e,t){if(e==="name"){let n=this[m].listeners.name;return n.add(t),()=>n.delete(t)}throw new Error(`Unsupported event: ${e}`)}});function b$(e,t){let n=e.nameRegistry.makeUnique(O(t));for(let r of e.listeners.name)r({target:t,name:n});return n}function ca(e){let{names:t="random"}=e||{};return new x$(t==="strict"?new g$:new y$)}function Bo(e){return typeof(e==null?void 0:e.format)=="string"}function $$(e,t){let n=[];if(Ks(e)){if(!Bo(t))throw new Error("Shader expected a single attribute, not a record of attributes to be passed in.");return n.push(t._layout),{usedVertexLayouts:n,bufferDefinitions:[{arrayStride:t._layout.stride,stepMode:t._layout.stepMode,attributes:[{format:t.format,offset:t.offset,shaderLocation:ar(e)??0}]}]}}let r=[],s=new WeakMap,i=0;for(let[a,o]of Object.entries(e)){if(na(o))continue;let l=t[a];if(!l)throw new Error(`An attribute by the name of '${a}' was not provided to the shader.`);let u=l._layout,c=s.get(u);c||(n.push(u),c=[],r.push({arrayStride:u.stride,stepMode:u.stepMode,attributes:c}),s.set(u,c)),i=ar(o)??i,c.push({format:l.format,offset:l.offset,shaderLocation:i++})}return{usedVertexLayouts:n,bufferDefinitions:r}}var T$=["bool","f32","f16","i32","u32","vec2f","vec3f","vec4f","vec2h","vec3h","vec4h","vec2i","vec3i","vec4i","vec2u","vec3u","vec4u","vec2<bool>","vec3<bool>","vec4<bool>","mat2x2f","mat3x3f","mat4x4f","texture_external"];function _$(e){return T$.includes(e.type)}function Tl(e,[t,n]){if(!Cd(t))throw new Error(`Property key '${t}' is a reserved WGSL word. Choose a different name.`);return`  ${Fu(n)}${t}: ${e.resolve(n).value},
`}function S$(e,t){if(t[m].isAbstruct)throw new Error("Cannot resolve abstract struct types to WGSL.");let n=e.getUniqueName(t);return e.addDeclaration(`struct ${n} {
${Object.entries(t.propTypes).map(r=>Tl(e,r)).join("")}}`),n}function z$(e,t){let n=e.getUniqueName(t);return e.addDeclaration(`struct ${n} {
${Object.entries(t.propTypes).map(r=>Bo(r[1])?Tl(e,[r[0],or[r[1].format]]):Tl(e,r)).join("")}
}`),n}function k$(e,t){let n=e.resolve(t.elementType).value;return t.elementCount===0?`array<${n}>`:`array<${n}, ${t.elementCount}>`}function M$(e,t){let n=e.resolve(Bo(t.elementType)?or[t.elementType.format]:t.elementType).value;return t.elementCount===0?`array<${n}>`:`array<${n}, ${t.elementCount}>`}function Ld(e,t){if(Qi(t))return t.type==="unstruct"?z$(e,t):t.type==="disarray"?M$(e,t):t.type==="loose-decorated"?e.resolve(Bo(t.inner)?or[t.inner.format]:t.inner).value:e.resolve(or[t.type]).value;if(_$(t))return t.type;if(t.type==="struct")return S$(e,t);if(t.type==="array")return k$(e,t);if(t.type==="atomic")return`atomic<${Ld(e,t.inner)}>`;if(t.type==="decorated")return e.resolve(t.inner).value;if(t.type==="ptr")return t.addressSpace==="storage"?`ptr<storage, ${e.resolve(t.inner).value}, ${t.access==="read-write"?"read_write":t.access}>`:`ptr<${t.addressSpace}, ${e.resolve(t.inner).value}>`;if(t.type==="abstractInt"||t.type==="abstractFloat"||t.type==="void"||t.type==="u16")throw new Error(`${t.type} has no representation in WGSL`);if($l(t))return`${t.type}<${t.format}, ${aa[t.access]}>`;if(Db(t))return t.type.startsWith("texture_depth")?t.type:`${t.type}<${t.sampleType.type}>`;if(Ib(t)||Pb(t))return t.type;Ws(t,"resolveData")}var Fd=class _l{constructor(t){this.bindings=t}with(t,n){return new _l([...this.bindings,[To(t)?t.slot:t,n]])}pipe(t){let n=t(this);return new _l([...this.bindings,...n.bindings])}};function*P$(e){let t=0;for(;;)e.has(t)||(yield t),t++}function I$(e,t){let n="size"in e?e.size:e.currentByteOffset,r=t-1,s=n&r;"skipBytes"in e?e.skipBytes(t-s&r):e.add(t-s&r)}var Je=I$,Fc=new WeakMap;function Gd(e){let t=Fc.get(e);if(t)return t;let n=new Le,r={},s;for(let i in e.propTypes){let a=e.propTypes[i];if(a===void 0)throw new Error(`Property ${i} is undefined in struct`);let o=n.size;Je(n,hr(e)?Jt(a):Ge(a)),s&&(s.padding=n.size-o);let l=fe(a);r[i]={offset:n.size,size:l},s=r[i],n.add(l)}return s&&(s.padding=Ft(fe(e),Ge(e))-n.size),Fc.set(e,r),r}var B$=(()=>{try{return new Function("return true"),!0}catch{return!1}})(),Wo=new WeakMap,ba={u32:"u32",vec2u:"u32",vec3u:"u32",vec4u:"u32",u16:"u16",i32:"i32",vec2i:"i32",vec3i:"i32",vec4i:"i32",f32:"f32",vec2f:"f32",vec3f:"f32",vec4f:"f32",f16:"f16",vec2h:"f16",vec3h:"f16",vec4h:"f16",mat2x2f:"f32",mat3x3f:"f32",mat4x4f:"f32"},E$={uint8:"u8",uint8x2:"u8",uint8x4:"u8",sint8:"i8",sint8x2:"i8",sint8x4:"i8",unorm8:"u8",unorm8x2:"u8",unorm8x4:"u8",snorm8:"i8",snorm8x2:"i8",snorm8x4:"i8",uint16:"u16",uint16x2:"u16",uint16x4:"u16",sint16:"i16",sint16x2:"i16",sint16x4:"i16",unorm16:"u16",unorm16x2:"u16",unorm16x4:"u16",snorm16:"i16",snorm16x2:"i16",snorm16x4:"i16",float16:"f16",float16x2:"f16",float16x4:"f16",float32:"f32",float32x2:"f32",float32x3:"f32",float32x4:"f32",uint32:"u32",uint32x2:"u32",uint32x3:"u32",uint32x4:"u32",sint32:"i32",sint32x2:"i32",sint32x3:"i32",sint32x4:"i32"},$a={u32:"setUint32",i32:"setInt32",f32:"setFloat32",u16:"setUint16",i16:"setInt16",f16:"setFloat16",u8:"setUint8",i8:"setInt8"},A$={unorm8:e=>`Math.round(${e} * 255)`,unorm8x2:e=>`Math.round(${e} * 255)`,unorm8x4:e=>`Math.round(${e} * 255)`,snorm8:e=>`Math.round(${e} * 127)`,snorm8x2:e=>`Math.round(${e} * 127)`,snorm8x4:e=>`Math.round(${e} * 127)`,unorm16:e=>`Math.round(${e} * 65535)`,unorm16x2:e=>`Math.round(${e} * 65535)`,unorm16x4:e=>`Math.round(${e} * 65535)`,snorm16:e=>`Math.round(${e} * 32767)`,snorm16x2:e=>`Math.round(${e} * 32767)`,snorm16x4:e=>`Math.round(${e} * 32767)`},Gc={"unorm10-10-10-2":{writeFunction:"setUint32",generator:(e,t)=>`output.setUint32(${e}, ((${t}.x*1023&0x3FF)<<22)|((${t}.y*1023&0x3FF)<<12)|((${t}.z*1023&0x3FF)<<2)|(${t}.w*3&3), littleEndian);
`},"unorm8x4-bgra":{writeFunction:"setUint8",generator:(e,t)=>{let n=["z","y","x","w"],r="";for(let s=0;s<4;s++)r+=`output.setUint8((${e} + ${s}), Math.round(${t}.${n[s]} * 255), littleEndian);
`;return r}}};function Ia(e,t,n,r=0){let s=["i","j","k"][r]||`i${r}`;if(s0(e)||Wr(e))return Ia(e.inner,t,n,r);if(bt(e)||hr(e)){let a=Gd(e),o="";for(let[l,u]of Object.entries(a)){let c=e.propTypes[l];c&&(o+=Ia(c,`(${t} + ${u.offset})`,`${n}.${l}`,r))}return o}if(on(e)||Hs(e)){let a=Ft(fe(e.elementType),Ge(e)),o="";return o+=`for (let ${s} = 0; ${s} < ${e.elementCount}; ${s}++) {
`,o+=Ia(e.elementType,`(${t} + ${s} * ${a})`,`${n}[${s}]`,r+1),o+=`}
`,o}if(Gn(e)){let a=ba[e.type],o="",l=$a[a],u=["x","y","z","w"],c=ll(e)?2:ul(e)?3:4;for(let f=0;f<c;f++)o+=`output.${l}((${t} + ${f*4}), ${n}.${u[f]}, littleEndian);
`;return o}if(Ei(e)){let a=ba[e.type],o=$a[a],l=vp(e)?2:xp(e)?3:4,u=l*l,c=Ft(l*4,8),f="";for(let h=0;h<u;h++){let d=Math.floor(h/l),p=h%l,y=d*c+p*4;f+=`output.${o}((${t} + ${y}), ${n}.columns[${d}].${["x","y","z","w"][p]}, littleEndian);
`}return f}if(O0(e)){let a=e.type;if(a in Gc)return Gc[a].generator(t,n);let o=E$[a],l=$a[o],u=or[a],c=wp(u)?4:ul(u)?3:ll(u)?2:1,f=o==="u8"||o==="i8"?1:o==="u16"||o==="i16"||o==="f16"?2:4,h=["x","y","z","w"],d=A$[a],p="";for(let y=0;y<c;y++){let T=c===1?n:`${n}.${h[y]}`,z=d?d(T):T;p+=`output.${l}((${t} + ${y*f}), ${z}, littleEndian);
`}return p}if(!Object.hasOwn(ba,e.type))throw new Error(`Primitive ${e.type} is unsupported by compiled writer`);let i=ba[e.type];return`output.${$a[i]}(${t}, ${n}, littleEndian);
`}function Nc(e){if(!B$){console.warn("This environment does not allow eval - using default writer as fallback");return}if(Wo.has(e))return Wo.get(e);try{let t=Ia(e,"offset","value",0),n=new Function("output","offset","value","littleEndian=true",t);return Wo.set(e,n),n}catch(t){console.warn(`Failed to compile writer for schema: ${e}
Reason: ${t instanceof Error?t.message:String(t)}
Falling back to default writer`)}}var kt={bool(){throw new Error("Booleans are not host-shareable")},f32(e,t,n){e.writeFloat32(n)},f16(e,t,n){e.writeFloat16(n)},i32(e,t,n){e.writeInt32(n)},u32(e,t,n){e.writeUint32(n)},u16(e,t,n){e.writeUint16(n)},vec2f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y)},vec2h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y)},vec2i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y)},vec2u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y)},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},vec3f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z)},vec3h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z)},vec3i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z)},vec3u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z)},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},vec4f(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z),e.writeFloat32(n.w)},vec4h(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z),e.writeFloat16(n.w)},vec4i(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z),e.writeInt32(n.w)},vec4u(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z),e.writeUint32(n.w)},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},mat3x3f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},mat4x4f(e,t,n){for(let r=0;r<n.length;++r)e.writeFloat32(n[r])},struct(e,t,n){let r=Ge(t);Je(e,r);for(let[s,i]of Object.entries(t.propTypes))Je(e,Ge(i)),Ya(e,i,n[s]);Je(e,r)},array(e,t,n){if(t.elementCount===0)throw new Error("Cannot write using a runtime-sized schema.");let r=Ge(t);Je(e,r);let s=e.currentByteOffset;for(let i=0;i<Math.min(t.elementCount,n.length);i++)Je(e,r),Ya(e,t.elementType,n[i]);e.seekTo(s+fe(t))},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t,n){var r;(r=kt[t.inner.type])==null||r.call(kt,e,t,n)},decorated(e,t,n){var i,a;let r=Jt(t);Je(e,r);let s=e.currentByteOffset;(a=kt[(i=t.inner)==null?void 0:i.type])==null||a.call(kt,e,t.inner,n),e.seekTo(s+fe(t))},uint8(e,t,n){e.writeUint8(n)},uint8x2(e,t,n){e.writeUint8(n.x),e.writeUint8(n.y)},uint8x4(e,t,n){e.writeUint8(n.x),e.writeUint8(n.y),e.writeUint8(n.z),e.writeUint8(n.w)},sint8(e,t,n){e.writeInt8(n)},sint8x2(e,t,n){e.writeInt8(n.x),e.writeInt8(n.y)},sint8x4(e,t,n){e.writeInt8(n.x),e.writeInt8(n.y),e.writeInt8(n.z),e.writeInt8(n.w)},unorm8(e,t,n){e.writeUint8(Math.round(n*255))},unorm8x2(e,t,n){e.writeUint8(Math.round(n.x*255)),e.writeUint8(Math.round(n.y*255))},unorm8x4(e,t,n){e.writeUint8(Math.round(n.x*255)),e.writeUint8(Math.round(n.y*255)),e.writeUint8(Math.round(n.z*255)),e.writeUint8(Math.round(n.w*255))},snorm8(e,t,n){e.writeInt8(Math.round(n*127))},snorm8x2(e,t,n){e.writeInt8(Math.round(n.x*127)),e.writeInt8(Math.round(n.y*127))},snorm8x4(e,t,n){e.writeInt8(Math.round(n.x*127)),e.writeInt8(Math.round(n.y*127)),e.writeInt8(Math.round(n.z*127)),e.writeInt8(Math.round(n.w*127))},uint16(e,t,n){e.writeUint16(n)},uint16x2(e,t,n){e.writeUint16(n.x),e.writeUint16(n.y)},uint16x4(e,t,n){e.writeUint16(n.x),e.writeUint16(n.y),e.writeUint16(n.z),e.writeUint16(n.w)},sint16(e,t,n){e.writeInt16(n)},sint16x2(e,t,n){e.writeInt16(n.x),e.writeInt16(n.y)},sint16x4(e,t,n){e.writeInt16(n.x),e.writeInt16(n.y),e.writeInt16(n.z),e.writeInt16(n.w)},unorm16(e,t,n){e.writeUint16(n*65535)},unorm16x2(e,t,n){e.writeUint16(n.x*65535),e.writeUint16(n.y*65535)},unorm16x4(e,t,n){e.writeUint16(n.x*65535),e.writeUint16(n.y*65535),e.writeUint16(n.z*65535),e.writeUint16(n.w*65535)},snorm16(e,t,n){e.writeInt16(Math.round(n*32767))},snorm16x2(e,t,n){e.writeInt16(Math.round(n.x*32767)),e.writeInt16(Math.round(n.y*32767))},snorm16x4(e,t,n){e.writeInt16(Math.round(n.x*32767)),e.writeInt16(Math.round(n.y*32767)),e.writeInt16(Math.round(n.z*32767)),e.writeInt16(Math.round(n.w*32767))},float16(e,t,n){e.writeFloat16(n)},float16x2(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y)},float16x4(e,t,n){e.writeFloat16(n.x),e.writeFloat16(n.y),e.writeFloat16(n.z),e.writeFloat16(n.w)},float32(e,t,n){e.writeFloat32(n)},float32x2(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y)},float32x3(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z)},float32x4(e,t,n){e.writeFloat32(n.x),e.writeFloat32(n.y),e.writeFloat32(n.z),e.writeFloat32(n.w)},uint32(e,t,n){e.writeUint32(n)},uint32x2(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y)},uint32x3(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z)},uint32x4(e,t,n){e.writeUint32(n.x),e.writeUint32(n.y),e.writeUint32(n.z),e.writeUint32(n.w)},sint32(e,t,n){e.writeInt32(n)},sint32x2(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y)},sint32x3(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z)},sint32x4(e,t,n){e.writeInt32(n.x),e.writeInt32(n.y),e.writeInt32(n.z),e.writeInt32(n.w)},"unorm10-10-10-2"(e,t,n){let r=0;r|=(n.x*1023&1023)<<22,r|=(n.y*1023&1023)<<12,r|=(n.z*1023&1023)<<2,r|=n.w*3&3,e.writeUint32(r)},"unorm8x4-bgra"(e,t,n){e.writeUint8(n.z*255),e.writeUint8(n.y*255),e.writeUint8(n.x*255),e.writeUint8(n.w*255)},disarray(e,t,n){var i,a;let r=Ge(t);Je(e,r);let s=e.currentByteOffset;for(let o=0;o<Math.min(t.elementCount,n.length);o++)Je(e,r),(a=kt[(i=t.elementType)==null?void 0:i.type])==null||a.call(kt,e,t.elementType,n[o]);e.seekTo(s+fe(t))},unstruct(e,t,n){var s;let r=t.propTypes;for(let[i,a]of Object.entries(r))(s=kt[a.type])==null||s.call(kt,e,a,n[i])},"loose-decorated"(e,t,n){var a;let r=Jt(t);Je(e,r);let s=e.currentByteOffset,i=kt[(a=t.inner)==null?void 0:a.type];return i==null||i(e,t.inner,n),e.seekTo(s+fe(t)),n}};function Ya(e,t,n){let r=kt[t.type];if(!r)throw new Error(`Cannot write data of type '${t.type}'.`);r(e,t,n)}var O$={bool(){throw new Error("Booleans are not host-shareable")},f32(e){return e.readFloat32()},f16(e){return e.readFloat16()},i32(e){return e.readInt32()},u32(e){return e.readUint32()},u16(e){return e.readUint16()},vec2f(e){return ve(e.readFloat32(),e.readFloat32())},vec3f(e){return rt(e.readFloat32(),e.readFloat32(),e.readFloat32())},vec4f(e){return _(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},vec2h(e){return $n(e.readFloat16(),e.readFloat16())},vec3h(e){return Tn(e.readFloat16(),e.readFloat16(),e.readFloat16())},vec4h(e){return _n(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16())},vec2i(e){return ft(e.readInt32(),e.readInt32())},vec3i(e){return Nt(e.readInt32(),e.readInt32(),e.readInt32())},vec4i(e){return Me(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32())},vec2u(e){return Lt(e.readUint32(),e.readUint32())},vec3u(e){return Ye(e.readUint32(),e.readUint32(),e.readUint32())},vec4u(e){return Be(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32())},"vec2<bool>"(){throw new Error("Booleans are not host-shareable")},"vec3<bool>"(){throw new Error("Booleans are not host-shareable")},"vec4<bool>"(){throw new Error("Booleans are not host-shareable")},mat2x2f(e){return Sn(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},mat3x3f(e){let t=()=>{let n=e.readFloat32();return e.readFloat32(),n};return zn(e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t(),e.readFloat32(),e.readFloat32(),t())},mat4x4f(e){return Ze(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32())},struct(e,t){let n=Ge(t);Je(e,n);let r={},s=t.propTypes;for(let[i,a]of Object.entries(s))Je(e,Ge(a)),r[i]=wn(e,a);return Je(e,n),r},array(e,t){if(t.elementCount===0)throw new Error("Cannot read using a runtime-sized schema.");let n=Ge(t),r=[];for(let s=0;s<t.elementCount;s++){Je(e,n);let i=t.elementType,a=wn(e,i);r.push(a)}return Je(e,n),r},ptr(){throw new Error("Pointers are not host-shareable")},atomic(e,t){return wn(e,t.inner)},decorated(e,t){let n=Jt(t);Je(e,n);let r=e.currentByteOffset,s=wn(e,t.inner);return e.seekTo(r+fe(t)),s},uint8:e=>e.readUint8(),uint8x2:e=>Lt(e.readUint8(),e.readUint8()),uint8x4:e=>Be(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),sint8:e=>e.readInt8(),sint8x2:e=>ft(e.readInt8(),e.readInt8()),sint8x4:e=>Me(e.readInt8(),e.readInt8(),e.readInt8(),e.readInt8()),unorm8:e=>e.readUint8()/255,unorm8x2:e=>ve(e.readUint8()/255,e.readUint8()/255),unorm8x4:e=>_(e.readUint8()/255,e.readUint8()/255,e.readUint8()/255,e.readUint8()/255),snorm8:e=>e.readInt8()/127,snorm8x2:e=>ve(e.readInt8()/127,e.readInt8()/127),snorm8x4:e=>_(e.readInt8()/127,e.readInt8()/127,e.readInt8()/127,e.readInt8()/127),uint16:e=>e.readUint16(),uint16x2:e=>Lt(e.readUint16(),e.readUint16()),uint16x4:e=>Be(e.readUint16(),e.readUint16(),e.readUint16(),e.readUint16()),sint16:e=>e.readInt16(),sint16x2:e=>ft(e.readInt16(),e.readInt16()),sint16x4:e=>Me(e.readInt16(),e.readInt16(),e.readInt16(),e.readInt16()),unorm16:e=>e.readUint16()/65535,unorm16x2:e=>ve(e.readUint16()/65535,e.readUint16()/65535),unorm16x4:e=>_(e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535,e.readUint16()/65535),snorm16:e=>e.readInt16()/32767,snorm16x2:e=>ve(e.readInt16()/32767,e.readInt16()/32767),snorm16x4:e=>_(e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767,e.readInt16()/32767),float16(e){return e.readFloat16()},float16x2:e=>ve(e.readFloat16(),e.readFloat16()),float16x4:e=>_(e.readFloat16(),e.readFloat16(),e.readFloat16(),e.readFloat16()),float32:e=>e.readFloat32(),float32x2:e=>ve(e.readFloat32(),e.readFloat32()),float32x3:e=>rt(e.readFloat32(),e.readFloat32(),e.readFloat32()),float32x4:e=>_(e.readFloat32(),e.readFloat32(),e.readFloat32(),e.readFloat32()),uint32:e=>e.readUint32(),uint32x2:e=>Lt(e.readUint32(),e.readUint32()),uint32x3:e=>Ye(e.readUint32(),e.readUint32(),e.readUint32()),uint32x4:e=>Be(e.readUint32(),e.readUint32(),e.readUint32(),e.readUint32()),sint32:e=>e.readInt32(),sint32x2:e=>ft(e.readInt32(),e.readInt32()),sint32x3:e=>Nt(e.readInt32(),e.readInt32(),e.readInt32()),sint32x4:e=>Me(e.readInt32(),e.readInt32(),e.readInt32(),e.readInt32()),"unorm10-10-10-2"(e){let t=e.readUint32(),n=(t>>22)/1023,r=(t>>12&1023)/1023,s=(t>>2&1023)/1023,i=(t&3)/3;return _(n,r,s,i)},"unorm8x4-bgra"(e){let t=e.readByte()/255,n=e.readByte()/255,r=e.readByte()/255,s=e.readByte()/255;return _(r,n,t,s)},unstruct(e,t){let n={},r=t.propTypes;for(let[s,i]of Object.entries(r))n[s]=wn(e,i);return n},disarray(e,t){let n=Ge(t),r=[];for(let s=0;s<t.elementCount;s++)Je(e,n),r.push(wn(e,t.elementType));return Je(e,n),r},"loose-decorated"(e,t){Je(e,Jt(t));let n=e.currentByteOffset,r=wn(e,t.inner);return e.seekTo(n+fe(t)),r}};function wn(e,t){let n=O$[t.type];if(!n)throw new Error(`Cannot read data of type '${t.type}'.`);return n(e,t)}function U$(e,t){let n=fe(e);if(n===0||t===void 0||t===null)return[];let r=new ArrayBuffer(n),s=new Kr(r),i=[];function a(u,c,f,h){if(c!=null){if(bt(u)||hr(u)){let d=Gd(u);for(let[p,y]of Object.entries(d)){let T=u.propTypes[p];if(!T)continue;let z=c[p];z!==void 0&&a(T,z,f+y.offset,y.padding??h)}return}if(on(u)||Hs(u)){let d=u,p=Ft(fe(d.elementType),Ge(d.elementType));if(!Array.isArray(c))throw new Error("Partial value for array must be an array");let y=c??[];y.sort((T,z)=>T.idx-z.idx);for(let{idx:T,value:z}of y)a(d.elementType,z,f+T*p,p-fe(d.elementType))}else{let d=fe(u);s.seekTo(f),Ya(s,u,c),i.push({start:f,end:f+d,padding:h})}}}if(a(e,t,0),i.length===0)return[];let o=[],l=i[0];for(let u=1;u<i.length;u++){let c=i[u];if(!c||!l)throw new Error("Internal error: missing segment");c.start===l.end+(l.padding??0)?(l.end=c.end,l.padding=c.padding):(o.push({data:new Uint8Array(r,l.start,l.end-l.start)}),l=c)}if(!l)throw new Error("Internal error: missing segment");return o.push({data:new Uint8Array(r,l.start,l.end-l.start)}),o}function Xa(e){return!!(e!=null&&e.usableAsStorage)}var Dc=class Nd extends Error{constructor(t){super(`Resource '${O(t)??"<unnamed>"}' cannot be bound as 'storage'. Use .$usage('storage') to allow it.`),Object.setPrototypeOf(this,Nd.prototype)}};function Dd(e){return!!e.usableAsUniform}var jd={uniform:"uniform",mutable:"storage, read_write",readonly:"storage, read"},Mf,Pf,Xu=class{constructor(e,t){g(this,"resourceType","buffer-usage");g(this,Pf);g(this,Mf);this.usage=e,this.buffer=t,this[m]={dataType:t.dataType},this[Ne]=t}$name(e){return this.buffer.$name(e),this}[(Pf=m,Mf=Ne,K)](e){let t=this.buffer.dataType,n=e.getUniqueName(this),{group:r,binding:s}=e.allocateFixedEntry(this.usage==="uniform"?{uniform:t}:{storage:t,access:this.usage},this.buffer),i=jd[this.usage];return e.addDeclaration(`@group(${r}) @binding(${s}) var<${i}> ${n}: ${e.resolve(t).value};`),S(n,t)}toString(){return`${this.usage}:${O(this)??"<unnamed>"}`}get[$e](){let e=this.buffer.dataType;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`${this.usage}:${O(this)??"<unnamed>"}.$`},cn)}get $(){let e=Da(),t=Na();if(e.type==="normal")throw new Tc(t?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.read()`");return e.type==="codegen"?this[$e]:e.type==="simulate"?(e.buffers.has(this.buffer)||e.buffers.set(this.buffer,Oi(this.buffer.dataType,this.buffer.initial)),e.buffers.get(this.buffer)):Ws(e,"bufferUsage.ts#TgpuFixedBufferImpl/$")}get value(){return this.$}set $(e){let t=Da(),n=Na();if(t.type==="normal")throw new Tc(n?`Cannot access ${String(this.buffer)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:".$ and .value are inaccessible during normal JS execution. Try `.write()`");if(t.type==="codegen")throw new Error("Unreachable bufferUsage.ts#TgpuFixedBufferImpl/$");if(t.type==="simulate"){t.buffers.set(this.buffer,e);return}Ws(t,"bufferUsage.ts#TgpuFixedBufferImpl/$")}set value(e){this.$=e}},If,Ss,Bf,jc=(Bf=class{constructor(e,t,n){g(this,If);g(this,"resourceType","buffer-usage");Z(this,Ss);this.usage=e,this.dataType=t,this[m]={dataType:t},q(this,Ss,n),_e(this,n.key)}[(If=m,K)](e){let t=this.dataType,n=e.getUniqueName(this),r=e.allocateLayoutEntry(w(this,Ss).layout),s=jd[this.usage];return e.addDeclaration(`@group(${r}) @binding(${w(this,Ss).idx}) var<${s}> ${n}: ${e.resolve(t).value};`),S(n,t)}toString(){return`${this.usage}:${O(this)??"<unnamed>"}`}get[$e](){let e=this.dataType;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`${this.usage}:${O(this)??"<unnamed>"}.$`},cn)}get $(){if(In())return this[$e];throw new Error("Direct access to buffer values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Ss=new WeakMap,Bf),Wc=new WeakMap;function R$(e){if(!Xa(e))throw new Error(`Cannot pass ${e} to asMutable, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=Wc.get(e);return t||(t=new Xu("mutable",e),Wc.set(e,t)),t}var qc=new WeakMap;function C$(e){if(!Xa(e))throw new Error(`Cannot pass ${e} to asReadonly, as it is not allowed to be used as storage. To allow it, call .$usage('storage') when creating the buffer.`);let t=qc.get(e);return t||(t=new Xu("readonly",e),qc.set(e,t)),t}var Yc=new WeakMap;function V$(e){if(!Dd(e))throw new Error(`Cannot pass ${e} to asUniform, as it is not allowed to be used as a uniform. To allow it, call .$usage('uniform') when creating the buffer.`);let t=Yc.get(e);return t||(t=new Xu("uniform",e),Yc.set(e,t)),t}var qo={uniform:V$,mutable:R$,readonly:C$};function Ta(e,t,n){return jr(t)?new Xc(e,t,n):new Xc(e,t,n,["storage","uniform"])}function Pi(e){return e.resourceType==="buffer"}var L$=zd(),Ef,Mt,Af,Xc=(Ef=m,Af=class{constructor(e,t,n,r){g(this,Ef,!0);g(this,"resourceType","buffer");g(this,"flags",GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC);Z(this,Mt);g(this,"_buffer",null);g(this,"_ownBuffer");g(this,"_destroyed",!1);g(this,"_hostBuffer");g(this,"initial");g(this,"usableAsUniform",!1);g(this,"usableAsStorage",!1);g(this,"usableAsVertex",!1);g(this,"usableAsIndex",!1);this.dataType=t,this.initialOrBuffer=n,this._disallowedUsages=r,q(this,Mt,e.device),ml(n)?(this._ownBuffer=!1,this._buffer=n):(this._ownBuffer=!0,this.initial=n)}get buffer(){if(this._destroyed)throw new Error("This buffer has been destroyed");return this._buffer||(this._buffer=w(this,Mt).createBuffer({size:fe(this.dataType),usage:this.flags,mappedAtCreation:!!this.initial,label:O(this)??"<unnamed>"}),this.initial&&(this._writeToTarget(this._buffer.getMappedRange(),this.initial),this._buffer.unmap())),this._buffer}get destroyed(){return this._destroyed}$name(e){return _e(this,e),this._buffer&&(this._buffer.label=e),this}$usage(...e){var t;for(let n of e){if((t=this._disallowedUsages)!=null&&t.includes(n))throw new Error(`Buffer of type ${this.dataType.type} cannot be used as ${n}`);this.flags|=n==="uniform"?GPUBufferUsage.UNIFORM:0,this.flags|=n==="storage"?GPUBufferUsage.STORAGE:0,this.flags|=n==="vertex"?GPUBufferUsage.VERTEX:0,this.flags|=n==="index"?GPUBufferUsage.INDEX:0,this.usableAsUniform=this.usableAsUniform||n==="uniform",this.usableAsStorage=this.usableAsStorage||n==="storage",this.usableAsVertex=this.usableAsVertex||n==="vertex",this.usableAsIndex=this.usableAsIndex||n==="index"}return this}$addFlags(e){if(!this._ownBuffer)throw new Error("Cannot add flags to a buffer that is not managed by TypeGPU.");return e&GPUBufferUsage.MAP_READ?(this.flags=GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ,this):e&GPUBufferUsage.MAP_WRITE?(this.flags=GPUBufferUsage.COPY_SRC|GPUBufferUsage.MAP_WRITE,this):(this.flags|=e,this)}compileWriter(){Nc(this.dataType)}_writeToTarget(e,t){let n=Nc(this.dataType);if(n)try{n(new DataView(e),0,t,L$==="little");return}catch(r){console.error(`Error when using compiled writer for buffer ${O(this)??"<unnamed>"} - this is likely a bug, please submit an issue at https://github.com/software-mansion/TypeGPU/issues
Using fallback writer instead.`,r)}Ya(new Kr(e),this.dataType,t)}write(e){let t=this.buffer;if(t.mapState==="mapped"){let r=t.getMappedRange();this._writeToTarget(r,e);return}let n=fe(this.dataType);this._hostBuffer||(this._hostBuffer=new ArrayBuffer(n)),this._writeToTarget(this._hostBuffer,e),w(this,Mt).queue.writeBuffer(t,0,this._hostBuffer,0,n)}writePartial(e){let t=this.buffer,n=U$(this.dataType,e);if(t.mapState==="mapped"){let r=t.getMappedRange(),s=new Uint8Array(r);for(let i of n)s.set(i.data,i.data.byteOffset)}else for(let r of n)w(this,Mt).queue.writeBuffer(t,r.data.byteOffset,r.data,0,r.data.byteLength)}clear(){let e=this.buffer;if(e.mapState==="mapped"){new Uint8Array(e.getMappedRange()).fill(0);return}let t=w(this,Mt).createCommandEncoder();t.clearBuffer(e),w(this,Mt).queue.submit([t.finish()])}copyFrom(e){if(this.buffer.mapState==="mapped")throw new Error("Cannot copy to a mapped buffer.");let t=fe(this.dataType),n=w(this,Mt).createCommandEncoder();n.copyBufferToBuffer(e.buffer,0,this.buffer,0,t),w(this,Mt).queue.submit([n.finish()])}async read(){let e=this.buffer;if(e.mapState==="mapped"){let s=e.getMappedRange();return wn(new tr(s),this.dataType)}if(e.usage&GPUBufferUsage.MAP_READ){await e.mapAsync(GPUMapMode.READ);let s=e.getMappedRange(),i=wn(new tr(s),this.dataType);return e.unmap(),i}let t=(globalThis.__TYPEGPU_AUTONAME__??(s=>s))(w(this,Mt).createBuffer({size:fe(this.dataType),usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"r"),n=w(this,Mt).createCommandEncoder();n.copyBufferToBuffer(e,0,t,0,fe(this.dataType)),w(this,Mt).queue.submit([n.finish()]),await t.mapAsync(GPUMapMode.READ,0,fe(this.dataType));let r=wn(new tr(t.getMappedRange()),this.dataType);return t.unmap(),t.destroy(),r}as(e){var t;return(t=qo[e])==null?void 0:t.call(qo,this)}destroy(){var e;this._destroyed||(this._destroyed=!0,this._ownBuffer&&((e=this._buffer)==null||e.destroy()))}toString(){return`buffer:${O(this)??"<unnamed>"}`}},Mt=new WeakMap,Af);function F$(e,t){return new Yd(cd(),e,t)}function G$(e,t){return new Yd(fd(),e,t)}function Wd(e){let t=e;return(t==null?void 0:t.resourceType)==="sampler"&&!!t[m]}function qd(e){let t=e;return(t==null?void 0:t.resourceType)==="sampler-comparison"&&!!t[m]}var Of,zs,Uf,N$=(Uf=class{constructor(e,t){g(this,Of,{unwrap:void 0});g(this,"resourceType");Z(this,zs);this.schema=e,q(this,zs,t),this.resourceType=e.type==="sampler_comparison"?"sampler-comparison":"sampler",_e(this,t.key)}[(Of=m,K)](e){let t=e.getUniqueName(this),n=e.allocateLayoutEntry(w(this,zs).layout);return e.addDeclaration(`@group(${n}) @binding(${w(this,zs).idx}) var ${t}: ${e.resolve(this.schema).value};`),S(t,this.schema)}get[$e](){let e=this.schema;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},cn)}get $(){if(In())return this[$e];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}toString(){return`${this.resourceType}:${O(this)??"<unnamed>"}`}},zs=new WeakMap,Uf),Rf,Li,ks,Fi,Gi,Cf,Yd=(Cf=class{constructor(e,t,n){g(this,Rf);g(this,"resourceType");Z(this,Li);Z(this,ks,null);Z(this,Fi);Z(this,Gi);this.schema=e,q(this,Fi,t),q(this,Gi,n),this.resourceType=e.type==="sampler_comparison"?"sampler-comparison":"sampler",this[m]={unwrap:()=>(w(this,ks)||q(this,ks,w(this,Gi).device.createSampler({...w(this,Fi),label:O(this)??"<unnamed>"})),w(this,ks))},q(this,Li,t.minFilter==="linear"||t.magFilter==="linear"||t.mipmapFilter==="linear")}[(Rf=m,K)](e){let t=e.getUniqueName(this),{group:n,binding:r}=e.allocateFixedEntry(this.schema.type==="sampler_comparison"?{sampler:"comparison"}:{sampler:w(this,Li)?"filtering":"non-filtering"},this);return e.addDeclaration(`@group(${n}) @binding(${r}) var ${t}: ${e.resolve(this.schema).value};`),S(t,this.schema)}get[$e](){let e=this.schema;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},cn)}get $(){if(In())return this[$e];throw new Error("Direct access to sampler values is possible only as part of a compute dispatch or draw call.")}get value(){return this.$}$name(e){return _e(this,e),this}toString(){return`${this.resourceType}:${O(this)??"<unnamed>"}`}},Li=new WeakMap,ks=new WeakMap,Fi=new WeakMap,Gi=new WeakMap,Cf),Vf,Ms,Lf,D$=(Lf=class{constructor(e,t){g(this,"resourceType","external-texture");g(this,Vf,!0);Z(this,Ms);this.schema=e,q(this,Ms,t),_e(this,t.key)}[(Vf=m,K)](e){let t=e.getUniqueName(this),n=e.allocateLayoutEntry(w(this,Ms).layout);return e.addDeclaration(`@group(${n}) @binding(${w(this,Ms).idx}) var ${t}: ${e.resolve(this.schema).value};`),S(t,Nb())}get[$e](){let e=this.schema;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`textureExternal:${O(this)??"<unnamed>"}.$`},cn)}get $(){if(In())return this[$e];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureExternal:${O(this)??"<unnamed>"}`}},Ms=new WeakMap,Lf);function Sl(e){let{videoWidth:t,videoHeight:n}=e;if(t&&n)return{width:t,height:n};let{naturalWidth:r,naturalHeight:s}=e;if(r&&s)return{width:r,height:s};let{codedWidth:i,codedHeight:a}=e;if(i&&a)return{width:i,height:a};let{width:o,height:l}=e||HTMLCanvasElement||OffscreenCanvas||HTMLImageElement||ImageData;if(!o||!l)throw new Error("Cannot determine dimensions of the provided image source.");return{width:o,height:l}}var zl=new WeakMap;function Xd(e){let t=zl.get(e);return t||(t=new Map,zl.set(e,t)),t}function j$(e){let t=zl.get(e);t&&t.clear()}function W$(e,t,n=0,r){if(t.dimension!=="2d")throw new Error("Cannot generate mipmaps for non-2D textures: only 2D textures are currently supported.");let s=r??t.mipLevelCount-n,i=Pd(t.format,e);if(![...i.sampleTypes].some(a=>a==="float"||a==="unfilterable-float"))throw new Error(`Cannot generate mipmaps for format '${t.format}': only float and unfilterable-float formats are currently supported.`);if(!i.canRenderAttachment)throw new Error(`Cannot generate mipmaps for format '${t.format}': format does not support render attachments.`);for(let a=0;a<t.depthOrArrayLayers;a++)for(let o=n;o<n+s-1;o++){let l=o,u=o+1;X$(e,t,l,u,a)}}function q$(e,t,n,r){if(t.dimension==="3d")throw new Error("Cannot resample to 3D textures: only 2D textures are currently supported.");let s=ua[t.format];if(![...s.sampleTypes].some(i=>i==="float"||i==="unfilterable-float"))throw new Error(`Cannot resample to format '${t.format}': only float and unfilterable-float formats are currently supported.`);if(!s.canRenderAttachment)throw new Error(`Cannot resample to format '${t.format}': format does not support render attachments.`);return Y$(e,t,n,r)}function Y$(e,t,n,r=0){let s=[...ua[t.format].sampleTypes].includes("float"),i=`${s?"filterable":"unfilterable"}`,a=Xd(e),o=a.get(i);if(!o){let T=e.createShaderModule({code:`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
  let pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  let uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  var output: VertexOutput;
  output.pos = vec4f(pos[vertexIndex], 0, 1);
  output.uv = uv[vertexIndex];
  return output;
}
      `}),z=(globalThis.__TYPEGPU_AUTONAME__??(N=>N))(e.createSampler({magFilter:s?"linear":"nearest",minFilter:s?"linear":"nearest"}),"R"),U=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:s?"filtering":"non-filtering"}}]}),J=e.createPipelineLayout({bindGroupLayouts:[U]}),j=e.createShaderModule({code:`
@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var inputSampler: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  ${s?"return textureSample(inputTexture, inputSampler, uv);":`let texelCoord = vec2u(uv * vec2f(textureDimensions(inputTexture)));
        return textureLoad(inputTexture, texelCoord, 0);`}
}
      `});o={vertexShader:T,fragmentShader:j,bindGroupLayout:U,pipelineLayout:J,sampler:z},a.set(i,o)}let l=(globalThis.__TYPEGPU_AUTONAME__??(T=>T))(e.createTexture({size:[...Object.values(Sl(n))],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST}),"l"),{width:u,height:c}=Sl(n);e.queue.copyExternalImageToTexture({source:n},{texture:l},[u,c,1]);let f=(globalThis.__TYPEGPU_AUTONAME__??(T=>T))(e.createTexture({size:[t.width,t.height,1],format:t.format,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),"f"),h=e.createRenderPipeline({layout:o.pipelineLayout,vertex:{module:o.vertexShader},fragment:{module:o.fragmentShader,targets:[{format:t.format}]},primitive:{topology:"triangle-list"}}),d=e.createBindGroup({layout:o.bindGroupLayout,entries:[{binding:0,resource:l.createView()},{binding:1,resource:o.sampler}]}),p=e.createCommandEncoder(),y=p.beginRenderPass({colorAttachments:[{view:f.createView(),loadOp:"clear",storeOp:"store"}]});y.setPipeline(h),y.setBindGroup(0,d),y.draw(3),y.end(),p.copyTextureToTexture({texture:f},{texture:t,origin:{x:0,y:0,z:r}},{width:t.width,height:t.height,depthOrArrayLayers:1}),e.queue.submit([p.finish()]),l.destroy(),f.destroy()}function X$(e,t,n,r,s){let i=[...Pd(t.format,e).sampleTypes].includes("float"),a=`${i?"filterable":"unfilterable"}`,o=Xd(e),l=o.get(a);if(!l){let y=e.createShaderModule({code:`
struct VertexOutput {
  @builtin(position) pos: vec4f,
  @location(0) uv: vec2f,
}

@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
  let pos = array<vec2f, 3>(vec2f(-1, -1), vec2f(3, -1), vec2f(-1, 3));
  let uv = array<vec2f, 3>(vec2f(0, 1), vec2f(2, 1), vec2f(0, -1));

  var output: VertexOutput;
  output.pos = vec4f(pos[vertexIndex], 0, 1);
  output.uv = uv[vertexIndex];
  return output;
}
      `}),T=e.createShaderModule({code:`
@group(0) @binding(0) var inputTexture: texture_2d<f32>;
@group(0) @binding(1) var inputSampler: sampler;

@fragment
fn fs_main(@location(0) uv: vec2f) -> @location(0) vec4f {
  return textureSample(inputTexture, inputSampler, uv);
}
      `}),z=(globalThis.__TYPEGPU_AUTONAME__??(j=>j))(e.createSampler({magFilter:i?"linear":"nearest",minFilter:i?"linear":"nearest"}),"R"),U=e.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:i?"float":"unfilterable-float"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,sampler:{type:i?"filtering":"non-filtering"}}]}),J=e.createPipelineLayout({bindGroupLayouts:[U]});l={vertexShader:y,fragmentShader:T,bindGroupLayout:U,pipelineLayout:J,sampler:z},o.set(a,l)}let u=e.createRenderPipeline({layout:l.pipelineLayout,vertex:{module:l.vertexShader},fragment:{module:l.fragmentShader,targets:[{format:t.format}]},primitive:{topology:"triangle-list"}}),c=t.createView({baseMipLevel:n,dimension:"2d",mipLevelCount:1,...s!==void 0&&{baseArrayLayer:s,arrayLayerCount:1}}),f=t.createView({baseMipLevel:r,dimension:"2d",mipLevelCount:1,...s!==void 0&&{baseArrayLayer:s,arrayLayerCount:1}}),h=e.createBindGroup({layout:l.bindGroupLayout,entries:[{binding:0,resource:c},{binding:1,resource:l.sampler}]}),d=e.createCommandEncoder(),p=d.beginRenderPass({colorAttachments:[{view:f,loadOp:"clear",storeOp:"store"}]});p.setPipeline(u),p.setBindGroup(0,h),p.draw(3),p.end(),e.queue.submit([d.finish()])}function Z$(e){return{dimension:e.dimension??"2d",sampleType:ua[e.format].channelType,multisampled:(e.sampleCount??1)!==1}}function H$(e){return e==="depth24plus-stencil8"||e==="depth32float-stencil8"?["depth","stencil"]:e==="depth16unorm"||e==="depth24plus"||e==="depth32float"?["depth"]:e==="stencil8"?["stencil"]:["color"]}function K$(e,t){return new Q$(e,t)}function Ci(e){return(e==null?void 0:e.resourceType)==="texture"&&!!e[m]}function Za(e){return(e==null?void 0:e.resourceType)==="texture-view"&&!!e[m]}var Ff,On,Ja,_r,Sr,zr,nn,kn,kl,Zd,Ml,Gf,Q$=(Ff=m,Gf=class{constructor(e,t){Z(this,kn);g(this,Ff);g(this,"resourceType","texture");g(this,"aspects");g(this,"usableAsSampled",!1);g(this,"usableAsStorage",!1);g(this,"usableAsRender",!1);Z(this,On);Z(this,Ja);Z(this,_r,!1);Z(this,Sr,GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC);Z(this,zr,null);Z(this,nn);this.props=e;let n=e.format;q(this,nn,t),q(this,On,ua[n]),q(this,Ja,e.size[0]*(e.size[1]??1)*(e.size[2]??1)*w(this,On).texelSize),this.aspects=H$(n),this[m]={unwrap:()=>{if(w(this,_r))throw new Error("This texture has been destroyed");return w(this,zr)||q(this,zr,t.device.createTexture({label:O(this)??"<unnamed>",format:e.format,size:e.size,usage:w(this,Sr),dimension:e.dimension??"2d",viewFormats:e.viewFormats??[],mipLevelCount:e.mipLevelCount??1,sampleCount:e.sampleCount??1})),w(this,zr)}}}$name(e){return _e(this,e),this}$usage(...e){let t=e.includes("storage"),n=e.includes("sampled"),r=e.includes("render");return q(this,Sr,w(this,Sr)|(n?GPUTextureUsage.TEXTURE_BINDING:0)),q(this,Sr,w(this,Sr)|(t?GPUTextureUsage.STORAGE_BINDING:0)),q(this,Sr,w(this,Sr)|(r?GPUTextureUsage.RENDER_ATTACHMENT:0)),this.usableAsStorage||(this.usableAsStorage=t),this.usableAsSampled||(this.usableAsSampled=n),this.usableAsRender||(this.usableAsRender=r),this}createView(e,t){return new J$(e??bl(Z$(this.props)),this,t)}clear(e="all"){if(e==="all"){let t=this.props.mipLevelCount??1;for(let n=0;n<t;n++)Yn(this,kn,kl).call(this,n)}else Yn(this,kn,kl).call(this,e)}generateMipmaps(e=0,t){if(this.usableAsRender===!1)throw new Error("generateMipmaps called without specifying 'render' usage. Add it via the $usage('render') method.");let n=t??(this.props.mipLevelCount??1)-e;if(n<=1){console.warn(`generateMipmaps is a no-op: would generate ${n} mip levels (base: ${e}, total: ${this.props.mipLevelCount??1})`);return}if(e>=(this.props.mipLevelCount??1))throw new Error(`Base mip level ${e} is out of range. Texture has ${this.props.mipLevelCount??1} mip levels.`);W$(w(this,nn).device,this[m].unwrap(),e,n)}write(e,t=0){if(e instanceof ArrayBuffer||ArrayBuffer.isView(e)){Yn(this,kn,Zd).call(this,e,t);return}let n=this.props.dimension??"2d";if(!Array.isArray(e)){Yn(this,kn,Ml).call(this,e,n==="3d"?0:void 0);return}let r=this.props.size[2]??1;e.length>r&&console.warn(`Too many image sources provided. Expected ${r} layers, got ${e.length}. Extra sources will be ignored.`);for(let s=0;s<Math.min(e.length,r);s++){let i=e[s];i&&Yn(this,kn,Ml).call(this,i,s)}}copyFrom(e){if(e.props.format!==this.props.format)throw new Error(`Texture format mismatch. Source texture has format ${e.props.format}, target texture has format ${this.props.format}`);if(e.props.size[0]!==this.props.size[0]||(e.props.size[1]??1)!==(this.props.size[1]??1)||(e.props.size[2]??1)!==(this.props.size[2]??1))throw new Error(`Texture size mismatch. Source texture has size ${e.props.size.join("x")}, target texture has size ${this.props.size.join("x")}`);let t=w(this,nn).device.createCommandEncoder();t.copyTextureToTexture({texture:e[m].unwrap()},{texture:this[m].unwrap()},e.props.size),w(this,nn).device.queue.submit([t.finish()])}get destroyed(){return w(this,_r)}destroy(){var e;w(this,_r)||(q(this,_r,!0),(e=w(this,zr))==null||e.destroy())}},On=new WeakMap,Ja=new WeakMap,_r=new WeakMap,Sr=new WeakMap,zr=new WeakMap,nn=new WeakMap,kn=new WeakSet,kl=function(e=0){let t=2**e,[n,r,s]=[Math.max(1,Math.floor((this.props.size[0]??1)/t)),Math.max(1,Math.floor((this.props.size[1]??1)/t)),Math.max(1,Math.floor((this.props.size[2]??1)/t))];w(this,nn).device.queue.writeTexture({texture:this[m].unwrap(),mipLevel:e},new Uint8Array(n*r*s*w(this,On).texelSize),{bytesPerRow:w(this,On).texelSize*n,rowsPerImage:r},[n,r,s])},Zd=function(e,t){let n=Math.max(1,this.props.size[0]>>t),r=Math.max(1,(this.props.size[1]??1)>>t),s=Math.max(1,(this.props.size[2]??1)>>t),i=n*r*s*w(this,On).texelSize,a=e.byteLength??e.byteLength;if(a!==i)throw new Error(`Buffer size mismatch. Expected ${i} bytes for mip level ${t}, got ${a} bytes.`);w(this,nn).device.queue.writeTexture({texture:this[m].unwrap(),mipLevel:t},e,{bytesPerRow:w(this,On).texelSize*n,rowsPerImage:r},[n,r,s])},Ml=function(e,t){let n=this.props.size[0],r=this.props.size[1]??1,{width:s,height:i}=Sl(e);if(s!==n||i!==r){q$(w(this,nn).device,this[m].unwrap(),e,t);return}w(this,nn).device.queue.copyExternalImageToTexture({source:e},{texture:this[m].unwrap(),...t!==void 0&&{origin:{x:0,y:0,z:t}}},t!==void 0?[n,r,1]:this.props.size)},Gf),Nf,Ps,Zn,rn,Df,J$=(Df=class{constructor(e,t,n){g(this,Nf);g(this,"resourceType","texture-view");Z(this,Ps);Z(this,Zn);Z(this,rn);this.schema=e,q(this,Ps,t),q(this,rn,n),this[m]={unwrap:()=>{var r,s,i,a;if(!w(this,Zn)){let o=this.schema,l;$l(o)?l={label:O(this)??"<unnamed>",format:((r=w(this,rn))==null?void 0:r.format)??o.format,dimension:o.dimension}:l={label:O(this)??"<unnamed>",format:((s=w(this,rn))==null?void 0:s.format)??w(this,Ps).props.format,dimension:o.dimension},((i=w(this,rn))==null?void 0:i.mipLevelCount)!==void 0&&(l.mipLevelCount=w(this,rn).mipLevelCount),((a=w(this,rn))==null?void 0:a.arrayLayerCount)!==void 0&&(l.arrayLayerCount=w(this,rn).arrayLayerCount),q(this,Zn,w(this,Ps)[m].unwrap().createView(l))}return w(this,Zn)}}}$name(e){return _e(this,e),w(this,Zn)&&(w(this,Zn).label=e),this}get[(Nf=m,$e)](){let e=this.schema;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},cn)}get $(){if(In())return this[$e];throw new Error("Direct access to texture view values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}toString(){return`textureView:${O(this)??"<unnamed>"}`}[K](e){var s;let t=e.getUniqueName(this),{group:n,binding:r}=e.allocateFixedEntry($l(this.schema)?{storageTexture:this.schema}:{texture:this.schema,sampleType:((s=w(this,rn))==null?void 0:s.sampleType)??this.schema.bindingSampleType[0]},this);return e.addDeclaration(`@group(${n}) @binding(${r}) var ${t}: ${e.resolve(this.schema).value};`),S(t,this.schema)}},Ps=new WeakMap,Zn=new WeakMap,rn=new WeakMap,Df),jf,Is,Wf,Zc=(Wf=class{constructor(e,t){g(this,jf,{unwrap:void 0});g(this,"resourceType","texture-view");Z(this,Is);this.schema=e,q(this,Is,t),_e(this,t.key)}toString(){return`textureView:${O(this)??"<unnamed>"}`}[(jf=m,K)](e){let t=e.getUniqueName(this),n=e.allocateLayoutEntry(w(this,Is).layout);return e.addDeclaration(`@group(${n}) @binding(${w(this,Is).idx}) var ${t}: ${e.resolve(this.schema).value};`),S(t,this.schema)}get[$e](){let e=this.schema;return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`${this.toString()}.$`},cn)}get $(){if(In())return this[$e];throw new Error("Direct access to texture views values is possible only as part of a compute dispatch or draw call. Try .read() or .write() instead")}get value(){return this.$}},Is=new WeakMap,Wf);function eT(e){return!!(e!=null&&e.usableAsSampled)}var tT=class Hd extends Error{constructor(t){super(`Resource '${O(t)??"<unnamed>"}' cannot be bound as 'sampled'. Use .$usage('sampled') to allow it.`),Object.setPrototypeOf(this,Hd.prototype)}};function nT(e){let t={};for(let[n,r]of Object.entries(e)){if(r===null){t[n]=null;continue}if("texture"in r&&typeof r.texture=="string"){let s=r.texture;t[n]={...r,texture:bl({dimension:r.viewDimension??"2d",sampleType:s==="sint"?Te:s==="uint"?V:v,multisampled:r.multisampled??!1})}}else if("storageTexture"in r&&typeof r.storageTexture=="string"){let s={readonly:"read-only",writeonly:"write-only",mutable:"read-write"};t[n]={...r,storageTexture:bl({access:s[r.access??"writeonly"],format:r.storageTexture,dimension:r.viewDimension??"2d"})}}else"externalTexture"in r&&Object.keys(r.externalTexture).length===0?t[n]={...r,externalTexture:{type:"texture_external",dimension:"2d"}}:t[n]=r}return t}function Kd(e){let t=nT(e);return new sT(t)}function Qd(e){return!!e&&e.resourceType==="bind-group-layout"}function Ha(e){return!!e&&e.resourceType==="bind-group"}var rT=class Jd extends Error{constructor(t,n){super(`Bind group '${t??"<unnamed>"}' is missing a required binding '${n}'`),Object.setPrototypeOf(this,Jd.prototype)}},Hc=["compute","fragment"],fi=["compute","vertex","fragment"],qf,sT=class{constructor(e){g(this,qf,!0);g(this,"_index");g(this,"resourceType","bind-group-layout");g(this,"bound",{});g(this,"value",{});g(this,"$",this.value);this.entries=e;let t=0;for(let[n,r]of Object.entries(e)){if(r===null){t++;continue}let s={layout:this,key:n,idx:t};if("uniform"in r&&(this.bound[n]=new jc("uniform",r.uniform,s)),"storage"in r){let i="type"in r.storage?r.storage:r.storage(0);this.bound[n]=new jc(r.access??"readonly",i,s)}"texture"in r&&(this.bound[n]=new Zc(r.texture,s)),"storageTexture"in r&&(this.bound[n]=new Zc(r.storageTexture,s)),"externalTexture"in r&&(this.bound[n]=new D$(r.externalTexture,s)),"sampler"in r&&(this.bound[n]=new N$(r.sampler==="comparison"?fd():cd(),s)),Object.defineProperty(this.value,n,{get:()=>this.bound[n].value}),t++}}get[(qf=m,$e)](){return this.$}toString(){return`bindGroupLayout:${O(this)??"<unnamed>"}`}get index(){return this._index}$name(e){return _e(this,e),this}$idx(e){return this._index=e,this}unwrap(e){return e.device.createBindGroupLayout({label:O(this)??"<unnamed>",entries:Object.values(this.entries).map((t,n)=>{if(t===null)return null;let r=t.visibility,s={binding:n,visibility:0};if("uniform"in t)r=r??fi,s.buffer={type:"uniform"};else if("storage"in t)r=r??(t.access==="mutable"?Hc:fi),s.buffer={type:t.access==="mutable"?"storage":"read-only-storage"};else if("sampler"in t)r=r??fi,s.sampler={type:t.sampler};else if("texture"in t){r=r??fi;let{multisampled:i,dimension:a,bindingSampleType:o}=t.texture;s.texture={sampleType:t.sampleType??o[0],viewDimension:a,multisampled:i}}else if("storageTexture"in t){r=r??Hc;let{dimension:i,access:a,format:o}=t.storageTexture;s.storageTexture={access:a,format:o,viewDimension:i}}else"externalTexture"in t&&(r=r??fi,s.externalTexture={});return r!=null&&r.includes("compute")&&(s.visibility|=GPUShaderStage.COMPUTE),r!=null&&r.includes("vertex")&&(s.visibility|=GPUShaderStage.VERTEX),r!=null&&r.includes("fragment")&&(s.visibility|=GPUShaderStage.FRAGMENT),s}).filter(t=>t!==null)})}},em=class{constructor(e,t){g(this,"resourceType","bind-group");this.layout=e,this.entries=t;for(let n of Object.keys(e.entries))if(e.entries[n]!==null&&!(n in t))throw new rT(O(e),n)}unwrap(e){return e.device.createBindGroup({label:O(this.layout)??"<unnamed>",layout:e.unwrap(this.layout),entries:Object.entries(this.layout.entries).map(([t,n],r)=>{if(n===null)return null;let s=this.entries[t];if(s===void 0)throw new Error(`'${t}' is a resource required to populate bind group layout '${O(this.layout)??"<unnamed>"}'.`);if("uniform"in n){let i;if(Pi(s)){if(!Dd(s))throw new p0(s);i={buffer:e.unwrap(s)}}else i={buffer:s};return{binding:r,resource:i}}if("storage"in n){let i;if(Pi(s)){if(!Xa(s))throw new Dc(s);i={buffer:e.unwrap(s)}}else i={buffer:s};return{binding:r,resource:i}}if("texture"in n){let i;if(Ci(s)){if(!eT(s))throw new tT(s);i=e.unwrap(s.createView(n.texture))}else Za(s)?i=e.unwrap(s):i=s;return{binding:r,resource:i}}if("storageTexture"in n){let i;if(Ci(s)){if(!Xa(s))throw new Dc(s);i=e.unwrap(s.createView(n.storageTexture))}else Za(s)?i=e.unwrap(s):i=s;return{binding:r,resource:i}}if("sampler"in n)return qd(s)||Wd(s)?{binding:r,resource:e.unwrap(s)}:{binding:r,resource:s};if("externalTexture"in n)return{binding:r,resource:s};throw new Error(`Malformed bind group entry: ${Ai(s)}`)}).filter(t=>t!==null)})}};function Ka(e){return new iT(e)}var Yf,iT=class{constructor(e=void 0){g(this,Yf,!0);g(this,"resourceType","slot");this.defaultValue=e}$name(e){return _e(this,e),this}areEqual(e,t){return Object.is(e,t)}toString(){return`slot:${O(this)??"<unnamed>"}`}get[(Yf=m,$e)](){let e=Cr();if(!e)throw new Error("Cannot access tgpu.slot's value outside of resolution.");return ko(e.unwrap(this))}get value(){return this[$e]}get $(){return this.value}};function Qa(e,t){return new tm("private",e,t)}function Kc(e){return new tm("workgroup",e)}var Xf,Un,Hn,kr,Zf,tm=(Zf=class{constructor(e,t,n){g(this,Xf,{});Z(this,Un);Z(this,Hn);Z(this,kr);q(this,Un,e),q(this,Hn,t),q(this,kr,n)}[(Xf=m,K)](e){let t=e.getUniqueName(this),n=`var<${w(this,Un)}> ${t}: ${e.resolve(w(this,Hn)).value}`;return w(this,kr)?e.addDeclaration(`${n} = ${e.resolve(w(this,kr),w(this,Hn)).value};`):e.addDeclaration(`${n};`),S(t,w(this,Hn))}$name(e){return _e(this,e),this}toString(){return`var:${O(this)??"<unnamed>"}`}get[$e](){let e=w(this,Hn);return new Proxy({[m]:!0,get[Bt](){return S(this,e)},[K]:t=>t.resolve(this),toString:()=>`var:${O(this)??"<unnamed>"}.$`},cn)}get $(){let e=Da(),t=Na();if(e.type==="normal")throw new $c(t?`Cannot access variable '${O(this)??"<unnamed>"}'. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");return e.type==="codegen"?this[$e]:e.type==="simulate"?(e.vars[w(this,Un)].has(this)||e.vars[w(this,Un)].set(this,w(this,kr)),e.vars[w(this,Un)].get(this)):Ws(e,"tgpuVariable.ts#TgpuVarImpl/$")}set $(e){let t=Da(),n=Na();if(t.type==="normal")throw new $c(n?`Cannot access ${String(this)}. TypeGPU functions that depends on GPU resources need to be part of a compute dispatch, draw call or simulation`:"TypeGPU variables are inaccessible during normal JS execution. If you wanted to simulate GPU behavior, try `tgpu.simulate()`");if(t.type==="codegen")throw new Error("Unreachable tgpuVariable.ts#TgpuVarImpl/$");if(t.type==="simulate"){t.vars[w(this,Un)].set(this,e);return}Ws(t,"tgpuVariable.ts#TgpuVarImpl/$")}get value(){return this.$}set value(e){this.$=e}},Un=new WeakMap,Hn=new WeakMap,kr=new WeakMap,Zf),nm=Qa(V,0).$name("dataBlockIndex"),rm=Qa(V,0).$name("dataByteIndex"),sm=Ka().$name("dataBuffer"),aT=ge([],V)`() {
  let i = dataByteIndex;
  dataByteIndex = dataByteIndex + 1u;
  return i;
}`.$uses({dataByteIndex:rm}).$name("nextByteIndex"),I="dataBuffer[dataBlockIndex].serializedData[nextByteIndex()]",im={f32:ge([v])`(n) => {
  ${I} = bitcast<u32>(n);
}`,f16:ge([Xe])`(n) => {
  ${I} = pack2x16float(vec2f(f32(n), 0.0));
}`,i32:ge([Te])`(n) => {
  ${I} = bitcast<u32>(n);
}`,u32:ge([V])`(n) => {
  ${I} = n;
}`,bool:ge([Ve])`(b) => {
  ${I} = u32(b);
}`,vec2f:ge([ve])`(v) => {
  ${I} = bitcast<u32>(v.x);
  ${I} = bitcast<u32>(v.y);
}`,vec3f:ge([rt])`(v) => {
  ${I} = bitcast<u32>(v.x);
  ${I} = bitcast<u32>(v.y);
  ${I} = bitcast<u32>(v.z);
}`,vec4f:ge([_])`(v) => {
  ${I} = bitcast<u32>(v.x);
  ${I} = bitcast<u32>(v.y);
  ${I} = bitcast<u32>(v.z);
  ${I} = bitcast<u32>(v.w);
}`,vec2h:ge([$n])`(v) => {
  ${I} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
}`,vec3h:ge([Tn])`(v) => {
  ${I} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${I} = pack2x16float(vec2f(f32(v.z), 0.0));
}`,vec4h:ge([_n])`(v) => {
  ${I} = pack2x16float(vec2f(f32(v.x), f32(v.y)));
  ${I} = pack2x16float(vec2f(f32(v.z), f32(v.w)));
}`,vec2i:ge([ft])`(v) => {
  ${I} = bitcast<u32>(v.x);
  ${I} = bitcast<u32>(v.y);
}`,vec3i:ge([Nt])`(v) => {
  ${I} = bitcast<u32>(v.x);
  ${I} = bitcast<u32>(v.y);
  ${I} = bitcast<u32>(v.z);
}`,vec4i:ge([Me])`(v) => {
  ${I} = bitcast<u32>(v.x);
  ${I} = bitcast<u32>(v.y);
  ${I} = bitcast<u32>(v.z);
  ${I} = bitcast<u32>(v.w);
}`,vec2u:ge([Lt])`(v) => {
  ${I} = v.x;
  ${I} = v.y;
}`,vec3u:ge([Ye])`(v) => {
  ${I} = v.x;
  ${I} = v.y;
  ${I} = v.z;
}`,vec4u:ge([Be])`(v) => {
  ${I} = v.x;
  ${I} = v.y;
  ${I} = v.z;
  ${I} = v.w;
}`,"vec2<bool>":ge([Yr])`(v) => {
  ${I} = u32(v.x);
  ${I} = u32(v.y);
}`,"vec3<bool>":ge([Xr])`(v) => {
  ${I} = u32(v.x);
  ${I} = u32(v.y);
  ${I} = u32(v.z);
}`,"vec4<bool>":ge([Zr])`(v) => {
  ${I} = u32(v.x);
  ${I} = u32(v.y);
  ${I} = u32(v.z);
  ${I} = u32(v.w);
}`,mat2x2f:ge([Sn])`(m) => {
  ${I} = bitcast<u32>(m[0][0]);
  ${I} = bitcast<u32>(m[0][1]);
  ${I} = bitcast<u32>(m[1][0]);
  ${I} = bitcast<u32>(m[1][1]);
}`,mat3x3f:ge([zn])`(m) => {
  ${I} = bitcast<u32>(m[0][0]);
  ${I} = bitcast<u32>(m[0][1]);
  ${I} = bitcast<u32>(m[0][2]);
  ${I} = 0u;
  ${I} = bitcast<u32>(m[1][0]);
  ${I} = bitcast<u32>(m[1][1]);
  ${I} = bitcast<u32>(m[1][2]);
  ${I} = 0u;
  ${I} = bitcast<u32>(m[2][0]);
  ${I} = bitcast<u32>(m[2][1]);
  ${I} = bitcast<u32>(m[2][2]);
  ${I} = 0u;
}`,mat4x4f:ge([Ze])`(m) => {
  ${I} = bitcast<u32>(m[0][0]);
  ${I} = bitcast<u32>(m[0][1]);
  ${I} = bitcast<u32>(m[0][2]);
  ${I} = bitcast<u32>(m[0][3]);
  ${I} = bitcast<u32>(m[1][0]);
  ${I} = bitcast<u32>(m[1][1]);
  ${I} = bitcast<u32>(m[1][2]);
  ${I} = bitcast<u32>(m[1][3]);
  ${I} = bitcast<u32>(m[2][0]);
  ${I} = bitcast<u32>(m[2][1]);
  ${I} = bitcast<u32>(m[2][2]);
  ${I} = bitcast<u32>(m[2][3]);
  ${I} = bitcast<u32>(m[3][0]);
  ${I} = bitcast<u32>(m[3][1]);
  ${I} = bitcast<u32>(m[3][2]);
  ${I} = bitcast<u32>(m[3][3]);
}`};for(let[e,t]of Object.entries(im))t.$name(`serialize${e[0].toLocaleUpperCase()}${e.slice(1)}`).$uses({dataBlockIndex:nm,nextByteIndex:aT,dataBuffer:sm});function am(e){return`(${e.map((t,n)=>`_arg_${n}`).join(", ")})`}function om(e,t){let n=im[e.type];if(n)return n.with(sm,t);if(bt(e)){let r=Object.keys(e.propTypes),s=Object.values(e.propTypes),i=lm(s,t);return ge([e])`(arg) {\n  propsSerializer(${r.map(a=>`arg.${a}`).join(", ")});\n}`.$uses({propsSerializer:i}).$name(`${O(e)??"struct"}Serializer`)}if(on(e)){let r=e.elementType,s=e.elementCount,i=om(r,t);return ge([e])`(arg) {\n${Array.from({length:s},(a,o)=>`  elementSerializer(arg[${o}]);`).join(`
`)}\n}`.$uses({elementSerializer:i}).$name("arraySerializer")}throw new Error(`Cannot serialize data of type ${e.type}`)}function lm(e,t){let n={},r=ge(e),s=am(e),i=e.map((a,o)=>(n[`serializer${o}`]=om(a,t),`  serializer${o}(_arg_${o});`)).join(`
`);return r`${s} {\n${i}\n}`.$uses(n).$name("compoundSerializer")}function oT(e,t,n,r,s){let i=t.map(fe).reduce((l,u)=>l+u,0);if(i>s.logSizeLimit)throw new Error(`Logged data needs to fit in ${s.logSizeLimit} bytes (one of the logs requires ${i} bytes). Consider increasing the limit by passing appropriate options to tgpu.init().`);let a=lm(t,n).$name(`log${e}serializer`),o=am(t);return ge(t)`${o} {
  dataBlockIndex = atomicAdd(&indexBuffer, 1);
  if (dataBlockIndex >= ${s.logCountLimit}) {
    return;
  }
  dataBuffer[dataBlockIndex].id = ${e};
  dataByteIndex = 0;

  compoundSerializer${o};
}`.$uses({indexBuffer:r,dataBuffer:n,dataBlockIndex:nm,dataByteIndex:rm,compoundSerializer:a}).$name(`log${e}`)}var lT=["log","debug","info","warn","error","clear"],uT={logCountLimit:64,logSizeLimit:252,messagePrefix:" GPU "},um=S("/* console.log() */",Pt),cT=class{get logResources(){}generateLog(){return console.warn("'console.log' is currently only supported in compute pipelines."),um}},Kn,Bs,Ni,Es,As,Hf,fT=(Hf=class{constructor(e){Z(this,Kn);Z(this,Bs);Z(this,Ni,1);Z(this,Es);Z(this,As);q(this,Kn,{...uT,...e[m].logOptions}),q(this,Bs,new Map);let t=ra({id:V,serializedData:Ui(V,Math.ceil(w(this,Kn).logSizeLimit/4))}).$name("SerializedLogData");q(this,As,e.createMutable(Ui(t,w(this,Kn).logCountLimit)).$name("dataBuffer")),q(this,Es,e.createMutable(jb(V)).$name("indexBuffer"))}generateLog(e,t,n){if(!lT.includes(t))return console.warn(`Unsupported log method '${t}' was used in TGSL.`),um;let r=kb(n),s=Ju(this,Ni)._++,i=r.filter(l=>l.dataType!==xt),a=oT(s,i.map(l=>l.dataType),w(this,As),w(this,Es),w(this,Kn)),o=r.map(l=>l.dataType===xt?l.value:l.dataType);return w(this,Bs).set(s,{op:t,argTypes:o}),S(x`${e.resolve(a).value}(${i})`,Pt)}get logResources(){return w(this,Ni)===1?void 0:{dataBuffer:w(this,As),indexBuffer:w(this,Es),options:w(this,Kn),logIdToMeta:w(this,Bs)}}},Kn=new WeakMap,Bs=new WeakMap,Ni=new WeakMap,Es=new WeakMap,As=new WeakMap,Hf),cm="#CATCHALL#",hT=class{constructor(){g(this,"_stack",[]);g(this,"_itemDepth",0)}get itemDepth(){return this._itemDepth}get topItem(){let e=this._stack[this._stack.length-1];if(!e||e.type!=="item")throw new Error("Internal error, expected item layer to be on top.");return e}get topFunctionScope(){return this._stack.findLast(e=>e.type==="functionScope")}pushItem(){this._itemDepth++,this._stack.push({type:"item",usedSlots:new Set})}popItem(){this.pop("item")}pushSlotBindings(e){this._stack.push({type:"slotBinding",bindingMap:new WeakMap(e)})}popSlotBindings(){this.pop("slotBinding")}pushFunctionScope(e,t,n,r){let s={type:"functionScope",args:e,argAliases:t,returnType:n,externalMap:r,reportedReturnTypes:new Set};return this._stack.push(s),s}popFunctionScope(){this.pop("functionScope")}pushBlockScope(){this._stack.push({type:"blockScope",declarations:new Map})}popBlockScope(){this.pop("blockScope")}pop(e){let t=this._stack[this._stack.length-1];if(!t||e&&t.type!==e)throw new Error(`Internal error, expected a ${e} layer to be on top.`);this._stack.pop(),e==="item"&&this._itemDepth--}readSlot(e){for(let t=this._stack.length-1;t>=0;--t){let n=this._stack[t];if((n==null?void 0:n.type)==="item")n.usedSlots.add(e);else if((n==null?void 0:n.type)==="slotBinding"){let r=n.bindingMap.get(e);if(r!==void 0)return r}else if(!((n==null?void 0:n.type)==="functionScope"||(n==null?void 0:n.type)==="blockScope"))throw new Error("Unknown layer type.")}return e.defaultValue}getSnippetById(e){for(let t=this._stack.length-1;t>=0;--t){let n=this._stack[t];if((n==null?void 0:n.type)==="functionScope"){let r=n.args.find(i=>i.value===e);if(r!==void 0)return r;if(n.argAliases[e])return n.argAliases[e];let s=n.externalMap[e];return s!=null?Pa(s):void 0}if((n==null?void 0:n.type)==="blockScope"){let r=n.declarations.get(e);if(r!==void 0)return r}}}defineBlockVariable(e,t){if(t.dataType.type==="unknown")throw Error(`Tried to define variable '${e}' of unknown type`);for(let n=this._stack.length-1;n>=0;--n){let r=this._stack[n];if((r==null?void 0:r.type)==="blockScope"){r.declarations.set(e,t);return}}throw new Error("No block scope found to define a variable in.")}},Ba=["","  ","    ","      ","        ","          ","            ","              ","                "],Yo=Ba.length-1,pT=class{constructor(){g(this,"identLevel",0)}get pre(){return Ba[this.identLevel]??Ba[Yo].repeat(this.identLevel/Yo)+Ba[this.identLevel%Yo]}indent(){let e=this.pre;return this.identLevel++,e}dedent(){return this.identLevel--,this.pre}withResetLevel(e){let t=this.identLevel;this.identLevel=0;try{return e()}finally{this.identLevel=t}}},Kf,Ct,Os,Mr,Di,Us,Qf,fm=(Kf=m,Qf=class{constructor(e){Z(this,Ct);Z(this,Os);g(this,"_indentController",new pT);g(this,"_itemStateStack",new hT);Z(this,Mr,[]);g(this,"_declarations",[]);g(this,"_varyingLocations");Z(this,Di,new WeakSet);Z(this,Us);g(this,Kf,{itemStateStack:this._itemStateStack});g(this,"bindGroupLayoutsToPlaceholderMap",new Map);g(this,"_nextFreeLayoutPlaceholderIdx",0);g(this,"fixedBindings",[]);g(this,"enableExtensions");g(this,"expectedType");this.enableExtensions=e.enableExtensions,q(this,Os,e.shaderGenerator??yd),q(this,Us,e.root?new fT(e.root):new cT),q(this,Ct,e.namespace[m])}get varyingLocations(){return this._varyingLocations}getUniqueName(e){return b$(w(this,Ct),e)}makeNameValid(e){return w(this,Ct).nameRegistry.makeValid(e)}get pre(){return this._indentController.pre}get topFunctionReturnType(){let e=this._itemStateStack.topFunctionScope;return Rn(e),e.returnType}get shelllessRepo(){return w(this,Ct).shelllessRepo}indent(){return this._indentController.indent()}dedent(){return this._indentController.dedent()}withResetIndentLevel(e){return this._indentController.withResetLevel(e)}getById(e){let t=this._itemStateStack.getSnippetById(e);return t===void 0?null:t}defineVariable(e,t){this._itemStateStack.defineBlockVariable(e,t)}reportReturnType(e){let t=this._itemStateStack.topFunctionScope;Rn(t),t.reportedReturnTypes.add(e)}pushBlockScope(){this._itemStateStack.pushBlockScope()}popBlockScope(){this._itemStateStack.popBlockScope()}generateLog(e,t){return w(this,Us).generateLog(this,e,t)}get logResources(){return w(this,Us).logResources}fnToWgsl(e){let t=this._itemStateStack.pushFunctionScope(e.args,e.argAliases,e.returnType,e.externalMap);try{w(this,Os).initGenerator(this);let n=w(this,Os).functionDefinition(e.body),r=e.returnType;if(!r){let s=[...t.reportedReturnTypes];if(s.length===0)r=Pt;else{let i=Tu(s);i&&!i.hasImplicitConversions&&(r=i.targetType)}if(!r)throw new Error(`Expected function to have a single return type, got [${s.join(", ")}]. Cast explicitly to the desired type.`);r=Ri(r)}return{head:dT(this,e.args,r),body:n,returnType:r}}finally{this._itemStateStack.popFunctionScope()}}addDeclaration(e){this._declarations.push(e)}allocateLayoutEntry(e){let t=this.bindGroupLayoutsToPlaceholderMap,n=t.get(e);return n||(n=`#BIND_GROUP_LAYOUT_${this._nextFreeLayoutPlaceholderIdx++}#`,t.set(e,n)),n}allocateFixedEntry(e,t){let n=this.fixedBindings.length;return this.fixedBindings.push({layoutEntry:e,resource:t}),{group:cm,binding:n}}readSlot(e){let t=this._itemStateStack.readSlot(e);if(t===void 0)throw new h0(e);return t}withSlots(e,t){this._itemStateStack.pushSlotBindings(e);try{return t()}finally{this._itemStateStack.popSlotBindings()}}withVaryingLocations(e,t){this._varyingLocations=e;try{return t()}finally{this._varyingLocations=void 0}}unwrap(e){if(dl(e))return this.withSlots(e[$r].pairs,()=>this.unwrap(e[$r].inner));let t=e;for(;;)if(hl(t))t=this.readSlot(t);else if(pl(t))t=this._getOrCompute(t);else break;return t}_getOrCompute(e){let t=w(this,Ct).memoizedDerived.get(e)??[];this._itemStateStack.pushItem();try{for(let s of t)if([...s.slotToValueMap.entries()].every(([i,a])=>i.areEqual(this._itemStateStack.readSlot(i),a)))return s.result;this.pushMode(new Rp);let n;try{n=e["~compute"]()}finally{this.popMode("normal")}let r=new Map;for(let s of this._itemStateStack.topItem.usedSlots)r.set(s,this._itemStateStack.readSlot(s));return t.push({slotToValueMap:r,result:n}),w(this,Ct).memoizedDerived.set(e,t),n}catch(n){throw n instanceof yi?n.appendToTrace(e):new yi(n,[e])}finally{this._itemStateStack.popItem()}}_getOrInstantiate(e){let t=w(this,Ct).memoizedResolves.get(e)??[];this._itemStateStack.pushItem();try{for(let s of t)if([...s.slotToValueMap.entries()].every(([i,a])=>i.areEqual(this._itemStateStack.readSlot(i),a)))return s.result;let n;if(Ks(e))n=S(Ld(this,e),Pt);else if(pl(e)||hl(e))n=this.resolve(this.unwrap(e));else if(Cp(e))n=e[K](this);else if(bi(e)){let s=w(this,Ct).shelllessRepo.get(e,void 0);if(!s)throw new Error(`Couldn't resolve ${e.name}. Make sure it's a function that accepts no arguments, or call it from another TypeGPU function.`);return this.withResetIndentLevel(()=>this.resolve(s))}else throw new TypeError(`Unresolvable internal value: ${Ai(e)}`);let r=new Map;for(let s of this._itemStateStack.topItem.usedSlots)r.set(s,this._itemStateStack.readSlot(s));return t.push({slotToValueMap:r,result:n}),w(this,Ct).memoizedResolves.set(e,t),n}catch(n){throw n instanceof yi?n.appendToTrace(e):new yi(n,[e])}finally{this._itemStateStack.popItem()}}resolve(e,t){if(Ad(e)||bi(e)){if(w(this,Di).has(e)&&!w(this,Ct).memoizedResolves.has(e))throw new Error(`Recursive function ${e} detected. Recursion is not allowed on the GPU.`);w(this,Di).add(e)}if(dl(e))return this.withSlots(e[$r].pairs,()=>this.resolve(e[$r].inner,t));if(xe(e)||bi(e)){if(this._itemStateStack.itemDepth===0)try{this.pushMode(new m0);let n=Vp(this,()=>this._getOrInstantiate(e));return S(`${[...this._declarations].join(`

`)}${n.value}`,Pt)}finally{this.popMode("codegen")}return this._getOrInstantiate(e)}if(typeof e=="number"){let n=t??qa(e).dataType;if(Rn(n.type!=="unknown"),n.type==="abstractInt")return S(`${e}`,n);if(n.type==="u32")return S(`${e}u`,n);if(n.type==="i32")return S(`${e}i`,n);let r=e.toExponential(),s=n.type==="abstractFloat"&&Number.isInteger(e)?`${e}.`:`${e}`,i=r.length<s.length?r:s;return n.type==="f32"?S(`${i}f`,n):n.type==="f16"?S(`${i}h`,n):S(i,n)}if(typeof e=="boolean")return S(e?"true":"false",Ve);if(typeof e=="string")return S(e,Pt);if(t&&on(t)){if(!Array.isArray(e))throw new Kt(`Cannot coerce ${e} into value of type '${t}'`);if(t.elementCount!==e.length)throw new Kt(`Cannot create value of type '${t}' from an array of length: ${e.length}`);let n=this.resolve(t.elementType);return S(x`array<${n}, ${t.elementCount}>(${e.map(r=>S(r,t.elementType))})`,t)}if(Array.isArray(e))return S(x`array(${e.map(n=>this.resolve(n))})`,xt);if(t&&bt(t))return S(x`${this.resolve(t)}(${Object.entries(t.propTypes).map(([n,r])=>S(e[n],r))})`,t);throw new Kt(`Value ${e} (as json: ${Ai(e)}) is not resolvable${t?` to type ${t.type}`:""}`)}pushMode(e){w(this,Mr).push(e)}popMode(e){let t=w(this,Mr).pop();e!==void 0&&Rn((t==null?void 0:t.type)===e)}get mode(){return w(this,Mr)[w(this,Mr).length-1]??Lp}},Ct=new WeakMap,Os=new WeakMap,Mr=new WeakMap,Di=new WeakMap,Us=new WeakMap,Qf);function Zu(e,t){let n=new fm(t),r=(t.config?n.withSlots(t.config(new Fd([])).bindings,()=>n.resolve(e)):n.resolve(e)).value,s=n.bindGroupLayoutsToPlaceholderMap,i=[],a=new Set([...s.keys()].map(f=>f.index).filter(f=>f!==void 0)),o=P$(a),l=n.fixedBindings.map((f,h)=>[String(h),f.layoutEntry]),u=()=>{let f=o.next().value,h=Kd(Object.fromEntries(l));return i[f]=h,r=r.replaceAll(cm,String(f)),[f,new em(h,Object.fromEntries(n.fixedBindings.map((d,p)=>[String(p),d.resource])))]},c=l.length>0?u():void 0;for(let[f,h]of s.entries()){let d=f.index??o.next().value;i[d]=f,r=r.replaceAll(h,String(d))}return t.enableExtensions&&t.enableExtensions.length>0&&(r=`${t.enableExtensions.map(f=>`enable ${f};`).join(`
`)}

${r}`),{code:r,usedBindGroupLayouts:i,catchall:c,logResources:n.logResources}}function dT(e,t,n){let r=t.map(s=>`${s.value}: ${e.resolve(s.dataType).value}`).join(", ");return n.type!=="void"?`(${r}) -> ${Fu(n)}${e.resolve(n).value} `:`(${r}) `}function hm(e){let t=e;return(t==null?void 0:t.resourceType)==="compute-pipeline"&&!!t[m]}function pm(e){let t=e;return(t==null?void 0:t.resourceType)==="render-pipeline"&&!!t[m]}function mT(e){return pm(e)||hm(e)}function dm(e){var c;let{externals:t,shaderGenerator:n,template:r,names:s="random",config:i,enableExtensions:a}=e,o={};_i(o,t??{});let l={[m]:!0,[K](f){return S(So(f,o,r??""),Pt)},toString:()=>"<root>"},u=Object.values(t).filter(mT);if(u.length>1)throw new Error(`Found ${u.length} pipelines but can only resolve one at a time.`);return Zu(l,{namespace:typeof s=="string"?ca({names:s}):s,enableExtensions:a,shaderGenerator:n,config:i,root:(c=u[0])==null?void 0:c[m].branch})}function yT(e){return dm(e).code}function gT(e){let t=Cr()??new fm({namespace:ca(),shaderGenerator:yd}),n=[1,1,1],r=[1,1,1],s=[n[0]*r[0],n[1]*r[1],n[2]*r[2]],i=new Map,a=Array.from({length:n[0]},()=>Array.from({length:n[1]},()=>Array.from({length:n[2]},()=>new Map))),o=Array.from({length:s[0]},()=>Array.from({length:s[1]},()=>Array.from({length:s[2]},()=>new Map))),l=Array.from({length:s[0]},(u,c)=>Array.from({length:s[1]},(f,h)=>Array.from({length:s[2]},(d,p)=>{let y=Math.floor(c/r[0]),T=Math.floor(h/r[1]),z=Math.floor(p/r[2]);return new y0(i,{private:o[c][h][p],workgroup:a[y][T][z]})})));t.pushMode(l[0][0][0]);try{return{value:Vp(t,e),buffers:i,privateVars:o,workgroupVars:a}}finally{t.popMode("simulate")}}function wT(e,t,n,r){return new vT(e,t,n,r)}function Hu(e){let t=e;return(t==null?void 0:t.resourceType)==="query-set"&&!!t[m]}var sn,Jf,vT=(Jf=class{constructor(e,t,n,r){g(this,"resourceType","query-set");Z(this,sn);g(this,"_querySet",null);g(this,"_ownQuerySet");g(this,"_destroyed",!1);g(this,"_available",!0);g(this,"_readBuffer",null);g(this,"_resolveBuffer",null);this.type=t,this.count=n,this.rawQuerySet=r,q(this,sn,e.device),this._ownQuerySet=!r,this._querySet=r||null}get querySet(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");return this.rawQuerySet?this.rawQuerySet:this._querySet?this._querySet:(this._querySet=w(this,sn).createQuerySet({type:this.type,count:this.count}),this._querySet)}get destroyed(){return this._destroyed}get available(){return this._available}get[m](){let e=this;return{get readBuffer(){return e._readBuffer||(e._readBuffer=w(e,sn).createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})),e._readBuffer},get resolveBuffer(){return e._resolveBuffer||(e._resolveBuffer=w(e,sn).createBuffer({size:e.count*BigUint64Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC})),e._resolveBuffer}}}$name(e){return _e(this,e),this._querySet&&(this._querySet.label=e),this}resolve(){if(this._destroyed)throw new Error("This QuerySet has been destroyed.");if(!this._available)throw new Error("This QuerySet is busy resolving or reading.");let e=w(this,sn).createCommandEncoder();e.resolveQuerySet(this.querySet,0,this.count,this[m].resolveBuffer,0),w(this,sn).queue.submit([e.finish()])}async read(){if(!this._resolveBuffer)throw new Error("QuerySet must be resolved before reading.");this._available=!1;try{let e=w(this,sn).createCommandEncoder();e.copyBufferToBuffer(this[m].resolveBuffer,0,this[m].readBuffer,0,this.count*BigUint64Array.BYTES_PER_ELEMENT),w(this,sn).queue.submit([e.finish()]);let t=this[m].readBuffer;await t.mapAsync(GPUMapMode.READ);let n=new BigUint64Array(t.getMappedRange().slice());return t.unmap(),Array.from(n)}finally{this._available=!0}}destroy(){var e,t;this._destroyed||(this._destroyed=!0,this._querySet&&this._ownQuerySet&&this._querySet.destroy(),(e=this._readBuffer)==null||e.destroy(),(t=this._resolveBuffer)==null||t.destroy(),this._readBuffer=this._resolveBuffer=null)}},sn=new WeakMap,Jf),Qc=class{constructor(e){g(this,"_map",new WeakMap);this._make=e}getOrMake(e,...t){if(this._map.has(e))return this._map.get(e);let n=this._make(e,...t);return this._map.set(e,n),n}},eh,th,Pr,nh,Xo=(nh=class{constructor(e,t){g(this,th,!0);g(this,eh);Z(this,Pr);this.resourceType=e,this.buffer=t,this[Ne]=t,q(this,Pr,this.buffer.as(this.resourceType))}$name(e){return _e(this[Ne],e),this}write(e){this.buffer.write(e)}writePartial(e){this.buffer.writePartial(e)}read(){return this.buffer.read()}get[(th=m,eh=Ne,$e)](){return w(this,Pr).$}get $(){return w(this,Pr).$}get value(){return this.$}[K](e){return e.resolve(w(this,Pr))}},Pr=new WeakMap,nh),se=e=>s$(e??0),fn=e=>i$(e??0),ds=e=>a$(e??0),xT={f32:e=>se(e[0]),f16:e=>ds(e[0]).x,i32:e=>fn(e[0]),u32:e=>e[0]??0,bool:e=>!!e[0],vec2f:e=>ve(se(e[0]),se(e[1])),vec3f:e=>rt(se(e[0]),se(e[1]),se(e[2])),vec4f:e=>_(se(e[0]),se(e[1]),se(e[2]),se(e[3])),vec2h(e){let t=ds(e[0]);return $n(t.x,t.y)},vec3h(e){let t=ds(e[0]),n=ds(e[1]);return Tn(t.x,t.y,n.x)},vec4h(e){let t=ds(e[0]),n=ds(e[1]);return _n(t.x,t.y,n.x,n.y)},vec2i:e=>ft(fn(e[0]),fn(e[1])),vec3i:e=>Nt(fn(e[0]),fn(e[1]),fn(e[2])),vec4i:e=>Me(fn(e[0]),fn(e[1]),fn(e[2]),fn(e[3])),vec2u:e=>Lt(e[0]??0,e[1]??0),vec3u:e=>Ye(e[0]??0,e[1]??0,e[2]??0),vec4u:e=>Be(e[0]??0,e[1]??0,e[2]??0,e[3]??0),"vec2<bool>":e=>Yr(!!e[0],!!e[1]),"vec3<bool>":e=>Xr(!!e[0],!!e[1],!!e[2]),"vec4<bool>":e=>Zr(!!e[0],!!e[1],!!e[2],!!e[3]),mat2x2f:e=>Sn(se(e[0]),se(e[1]),se(e[2]),se(e[3])),mat3x3f:e=>zn(se(e[0]),se(e[1]),se(e[2]),se(e[4]),se(e[5]),se(e[6]),se(e[8]),se(e[9]),se(e[10])),mat4x4f:e=>Ze(se(e[0]),se(e[1]),se(e[2]),se(e[3]),se(e[4]),se(e[5]),se(e[6]),se(e[7]),se(e[8]),se(e[9]),se(e[10]),se(e[11]),se(e[12]),se(e[13]),se(e[14]),se(e[15]))};function bT(e,t){let n=xT[t.type];if(n)return n(e);if(bt(t)){let r=Object.keys(t.propTypes),s=Object.values(t.propTypes),i=Pl(e,s);return Object.fromEntries(r.map((a,o)=>[a,i[o]]))}if(on(t)){let r=t.elementType,s=t.elementCount;return Pl(e,Array.from({length:s},()=>r))}throw new Error(`Cannot deserialize data of type ${t.type}`)}function Pl(e,t){let n=0;return t.map(r=>{if(!jr(r))return r;let s=Math.ceil(fe(r)/4),i=bT(e.subarray(n,n+s),r);return n+=s,i})}function $T(e,t){return Pl(e,t).map(gl)}function Il(e){let{indexBuffer:t,dataBuffer:n,logIdToMeta:r,options:s}=e;n.read().then(i=>{i.filter(a=>a.id).forEach(({id:a,serializedData:o})=>{let{argTypes:l,op:u}=r.get(a),c=$T(new Uint32Array(o),l);c.length===0&&c.push(""),console[u](`%c${s.messagePrefix}%c ${c[0]}`,"background: #936ff5; color: white;","color: inherit; background: none",...c.slice(1))})}),t.read().then(i=>{i>s.logCountLimit&&console.warn(`Log count limit per dispatch (${s.logCountLimit}) exceeded by ${i-s.logCountLimit} calls. Consider increasing the limit by passing appropriate options to tgpu.init().`)}),n.buffer.clear(),t.buffer.clear()}function mm(e,t,n){if(!n.enabledFeatures.has("timestamp-query"))throw new Error('Performance callback requires the "timestamp-query" feature to be enabled on GPU device.');return e.timestampWrites?{...e,performanceCallback:t}:{...e,performanceCallback:t,hasAutoQuerySet:!0,timestampWrites:{querySet:(globalThis.__TYPEGPU_AUTONAME__??(r=>r))(n.createQuerySet("timestamp",2),"querySet"),beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}}function ym(e,t,n){if(!n.enabledFeatures.has("timestamp-query"))throw new Error('Timestamp writes require the "timestamp-query" feature to be enabled on GPU device.');e.hasAutoQuerySet&&e.timestampWrites&&e.timestampWrites.querySet.destroy();let r={querySet:t.querySet};return t.beginningOfPassWriteIndex!==void 0&&(r.beginningOfPassWriteIndex=t.beginningOfPassWriteIndex),t.endOfPassWriteIndex!==void 0&&(r.endOfPassWriteIndex=t.endOfPassWriteIndex),{...e,hasAutoQuerySet:!1,timestampWrites:r}}function gm(e,t){if(!e.timestampWrites)return{};let{querySet:n,beginningOfPassWriteIndex:r,endOfPassWriteIndex:s}=e.timestampWrites,i={querySet:Hu(n)?t.unwrap(n):n};return r!==void 0&&(i.beginningOfPassWriteIndex=r),s!==void 0&&(i.endOfPassWriteIndex=s),{timestampWrites:i}}function Bl({root:e,priors:t}){var i;let n=(i=t.timestampWrites)==null?void 0:i.querySet,r=t.performanceCallback;if(!n)throw new Error("Cannot dispatch workgroups with performance callback without a query set.");if(!Hu(n))throw new Error("Performance callback with raw GPUQuerySet is not supported. Use TgpuQuerySet instead.");let s=e.device.createCommandEncoder();s.resolveQuerySet(e.unwrap(n),0,n.count,n[m].resolveBuffer,0),e.device.queue.submit([s.finish()]),e.device.queue.onSubmittedWorkDone().then(async()=>{var u,c;if(!n.available)return;let a=await n.read(),o=a[((u=t.timestampWrites)==null?void 0:u.beginningOfPassWriteIndex)??0],l=a[((c=t.timestampWrites)==null?void 0:c.endOfPassWriteIndex)??1];if(o===void 0||l===void 0)throw new Error("QuerySet did not return valid timestamps.");await r(o,l)})}function TT(e,t,n){return new _T(new ST(e,t,n),{})}var rh,sh,_T=class wi{constructor(t,n){g(this,sh);g(this,"resourceType","compute-pipeline");g(this,rh);this._core=t,this._priors=n,this[m]={get rawPipeline(){return t.unwrap().pipeline},get priors(){return n},get branch(){return t.branch}},this[Ne]=t}[(sh=m,rh=Ne,K)](t){return t.resolve(this._core)}toString(){return`computePipeline:${O(this)??"<unnamed>"}`}get rawPipeline(){return this._core.unwrap().pipeline}with(t,n){return Ha(t)?new wi(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t.layout,t]])}):new wi(this._core,{...this._priors,bindGroupLayoutMap:new Map([...this._priors.bindGroupLayoutMap??[],[t,n]])})}withPerformanceCallback(t){let n=mm(this._priors,t,this._core.branch);return new wi(this._core,n)}withTimestampWrites(t){let n=ym(this._priors,t,this._core.branch);return new wi(this._core,n)}dispatchWorkgroups(t,n,r){let s=this._core.unwrap(),{branch:i}=this._core,a={label:O(this._core)??"<unnamed>",...gm(this._priors,i)},o=i.device.createCommandEncoder(),l=o.beginComputePass(a);l.setPipeline(s.pipeline);let u=new Set(s.usedBindGroupLayouts);if(s.usedBindGroupLayouts.forEach((c,f)=>{var h;if(s.catchall&&f===s.catchall[0])l.setBindGroup(f,i.unwrap(s.catchall[1])),u.delete(c);else{let d=(h=this._priors.bindGroupLayoutMap)==null?void 0:h.get(c);d!==void 0&&(u.delete(c),l.setBindGroup(f,i.unwrap(d)))}}),u.size>0)throw new vu(u);l.dispatchWorkgroups(t,n,r),l.end(),i.device.queue.submit([o.finish()]),s.logResources&&Il(s.logResources),this._priors.performanceCallback&&Bl({root:i,priors:this._priors})}$name(t){return _e(this._core,t),this}},ih,ST=class{constructor(e,t,n){g(this,ih,!0);g(this,"_memo");this.branch=e,this._slotBindings=t,this._entryFn=n}[(ih=m,K)](e){return e.withSlots(this._slotBindings,()=>(e.resolve(this._entryFn),S("",Pt)))}toString(){return"computePipelineCore"}unwrap(){var e;if(this._memo===void 0){let t=this.branch.device,n=Id.filter(c=>this.branch.enabledFeatures.has(Bd[c])),r,s=ca({names:this.branch.nameRegistrySetting});r=Zu(this,{namespace:s,enableExtensions:n,shaderGenerator:this.branch.shaderGenerator,root:this.branch});let{code:i,usedBindGroupLayouts:a,catchall:o,logResources:l}=r;o!==void 0&&((e=a[o[0]])==null||e.$name(`${O(this)??"<unnamed>"} - Automatic Bind Group & Layout`));let u=t.createShaderModule({label:`${O(this)??"<unnamed>"} - Shader`,code:i});this._memo={pipeline:t.createComputePipeline({label:O(this)??"<unnamed>",layout:t.createPipelineLayout({label:`${O(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:a.map(c=>this.branch.unwrap(c))}),compute:{module:u}}),usedBindGroupLayouts:a,catchall:o,logResources:l}}return this._memo}};function Jc(e,t="vertex"){return new zT(e,t)}function wm(e){return(e==null?void 0:e.resourceType)==="vertex-layout"}var El=Symbol("defaultAttribEntry");function Ea(e,t,n,r,s){if(Wr(t)||qr(t)){let i=ar(t);return i!==void 0&&(r[s??El]=i),Ea(e,t.inner,Ft(n,Jt(t)),r)}if(bt(t)){let i=n,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,l])=>{i=Ft(i,Ge(l));let u=[o,Ea(e,l,i,r,o)];return i+=fe(l),u}))}if(hr(t)){let i=n,a=t.propTypes;return Object.fromEntries(Object.entries(a).map(([o,l])=>{i=Ft(i,Jt(l));let u=[o,Ea(e,l,i,r,o)];return i+=fe(l),u}))}if("type"in t&&typeof t.type=="string"){if(Sp.includes(t.type))return{_layout:e,format:t.type,offset:n};let i=l0[t.type];if(i)return{_layout:e,format:i,offset:n}}throw new Error(`Unsupported data used in vertex layout: ${String(t)}`)}var ah,zT=(ah=m,class{constructor(e,t){g(this,ah,!0);g(this,"resourceType","vertex-layout");g(this,"stride");g(this,"attrib");g(this,"_customLocationMap",{});this.schemaForCount=e,this.stepMode=t;let n=e(0);this.stride=Ft(fe(n.elementType),Ge(n)),this.attrib=Ea(this,n.elementType,0,this._customLocationMap)}get vertexLayout(){if(this._customLocationMap[El]!==void 0){if(typeof this.attrib.format!="string"||typeof this.attrib.offset!="number")throw new Error("Single attribute vertex layouts must have a format and offset.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[{format:this.attrib.format,offset:this.attrib.offset,shaderLocation:this._customLocationMap[El]}]}}if(!Object.keys(this.attrib).every(e=>this._customLocationMap[e]!==void 0))throw new Error("All attributes must have custom locations in order to unwrap a vertex layout.");return{arrayStride:this.stride,stepMode:this.stepMode,attributes:[...Object.entries(this.attrib).map(([e,t])=>({format:t.format,offset:t.offset,shaderLocation:this._customLocationMap[e]}))]}}$name(e){return _e(this,e),this}});function kT(e){return typeof(e==null?void 0:e.loadOp)=="string"}function MT(e,t){if(Ks(e)){if(!kT(t))throw new Error("Expected a single color attachment, not a record.");return[t]}let n=[];for(let r of Object.keys(e)){let s=e[r];if(na(s))continue;let i=t[r];if(!i)throw new Error(`A color attachment by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function PT(e){return typeof(e==null?void 0:e.format)=="string"}function IT(e,t){if(Ks(e)){if(Tp(e))return[];if(!PT(t))throw new Error("Expected a single color target configuration, not a record.");return[t]}let n=[];for(let r of Object.keys(e)){let s=e[r];if(na(s))continue;let i=t[r];if(!i)throw new Error(`A color target by the name of '${r}' was not provided to the shader.`);n.push(i)}return n}function vm(e){return new BT(new ET(e),{})}var oh,lh,BT=class dn{constructor(t,n){g(this,lh);g(this,"resourceType","render-pipeline");g(this,oh);g(this,"hasIndexBuffer",!1);this[m]={core:t,priors:n,branch:t.options.branch},this[Ne]=t}[(lh=m,oh=Ne,K)](t){return t.resolve(this[m].core)}toString(){return`renderPipeline:${O(this)??"<unnamed>"}`}$name(t){return _e(this[m].core,t),this}with(t,n){let r=this[m];if(Ha(t))return new dn(r.core,{...r.priors,bindGroupLayoutMap:new Map([...r.priors.bindGroupLayoutMap??[],[t.layout,t]])});if(Qd(t))return new dn(r.core,{...r.priors,bindGroupLayoutMap:new Map([...r.priors.bindGroupLayoutMap??[],[t,n]])});if(wm(t))return new dn(r.core,{...r.priors,vertexLayoutMap:new Map([...r.priors.vertexLayoutMap??[],[t,n]])});throw new Error("Unsupported value passed into .with()")}withPerformanceCallback(t){let n=this[m],r=mm(n.priors,t,n.core.options.branch);return new dn(n.core,r)}withTimestampWrites(t){let n=this[m],r=ym(n.priors,t,n.core.options.branch);return new dn(n.core,r)}withColorAttachment(t){let n=this[m];return new dn(n.core,{...n.priors,colorAttachment:t})}withDepthStencilAttachment(t){let n=this[m];return new dn(n.core,{...n.priors,depthStencilAttachment:t})}withIndexBuffer(t,n,r,s){let i=this[m];if(ml(t)){if(typeof n!="string")throw new Error("If a GPUBuffer is passed, indexFormat must be provided.");return new dn(i.core,{...i.priors,indexBuffer:{buffer:t,indexFormat:n,offsetBytes:r,sizeBytes:s}})}let a={u32:"uint32",u16:"uint16"},o=t.dataType.elementType;return new dn(i.core,{...i.priors,indexBuffer:{buffer:t,indexFormat:a[o.type],offsetBytes:n!==void 0?n*fe(o):void 0,sizeBytes:s!==void 0?s*fe(o):void 0}})}setupRenderPass(t){let n=this[m],r=n.core.unwrap(),{branch:s,fragmentFn:i}=n.core.options,a=i?MT(i.shell.out,n.priors.colorAttachment??{}).map(f=>Ci(f.view)?{...f,view:s.unwrap(f.view).createView()}:Za(f.view)?{...f,view:s.unwrap(f.view)}:f):[null],o={label:O(n.core)??"<unnamed>",colorAttachments:a,...gm(n.priors,s)};if(n.priors.depthStencilAttachment!==void 0){let f=n.priors.depthStencilAttachment;Ci(f.view)?o.depthStencilAttachment={...f,view:s.unwrap(f.view).createView()}:o.depthStencilAttachment=f}let l=t.beginRenderPass(o);l.setPipeline(r.pipeline);let u=new Set(r.usedBindGroupLayouts);r.usedBindGroupLayouts.forEach((f,h)=>{var d;if(r.catchall&&h===r.catchall[0])l.setBindGroup(h,s.unwrap(r.catchall[1])),u.delete(f);else{let p=(d=n.priors.bindGroupLayoutMap)==null?void 0:d.get(f);p!==void 0&&(u.delete(f),l.setBindGroup(h,s.unwrap(p)))}});let c=new Set(n.core.usedVertexLayouts);if(n.core.usedVertexLayouts.forEach((f,h)=>{var p;let d=(p=n.priors.vertexLayoutMap)==null?void 0:p.get(f);d&&(c.delete(f),l.setVertexBuffer(h,s.unwrap(d)))}),u.size>0)throw new vu(u);if(c.size>0)throw new Ip(c);return l}draw(t,n,r,s){let i=this[m],{branch:a}=i.core.options,{logResources:o}=i.core.unwrap(),l=a.device.createCommandEncoder(),u=this.setupRenderPass(l);u.draw(t,n,r,s),u.end(),a.device.queue.submit([l.finish()]),o&&Il(o),i.priors.performanceCallback&&Bl({root:a,priors:i.priors})}drawIndexed(t,n,r,s,i){let a=this[m];if(!a.priors.indexBuffer)throw new Error("No index buffer set for this render pipeline.");let{logResources:o}=a.core.unwrap(),{branch:l}=a.core.options,{buffer:u,indexFormat:c,offsetBytes:f,sizeBytes:h}=a.priors.indexBuffer,d=l.device.createCommandEncoder(),p=this.setupRenderPass(d);ml(u)?p.setIndexBuffer(u,c,f,h):p.setIndexBuffer(l.unwrap(u),c,f,h),p.drawIndexed(t,n,r,s,i),p.end(),l.device.queue.submit([d.finish()]),o&&Il(o),a.priors.performanceCallback&&Bl({root:l,priors:a.priors})}},uh,ET=class{constructor(e){g(this,uh,!0);g(this,"usedVertexLayouts");g(this,"_memo");g(this,"_vertexBufferLayouts");g(this,"_targets");this.options=e;let t=$$(e.vertexFn.shell.in??{},e.vertexAttribs);this._vertexBufferLayouts=t.bufferDefinitions,this.usedVertexLayouts=t.usedVertexLayouts,this._targets=e.fragmentFn&&e.targets?IT(e.fragmentFn.shell.out,e.targets):[null]}[(uh=m,K)](e){let{vertexFn:t,fragmentFn:n,slotBindings:r}=this.options,s=AT(t.shell.out,n==null?void 0:n.shell.in,O(t)??"<unnamed>",O(n)??"<unnamed>");return e.withVaryingLocations(s,()=>e.withSlots(r,()=>(e.resolve(t),n&&e.resolve(n),S("",Pt))))}toString(){return"renderPipelineCore"}unwrap(){var e;if(this._memo===void 0){let{branch:t,primitiveState:n,depthStencilState:r,multisampleState:s}=this.options,i=t.device,a=Id.filter(T=>t.enabledFeatures.has(Bd[T])),o,l=ca({names:t.nameRegistrySetting});o=Zu(this,{namespace:l,enableExtensions:a,shaderGenerator:t.shaderGenerator,root:t});let{code:u,usedBindGroupLayouts:c,catchall:f,logResources:h}=o;f!==void 0&&((e=c[f[0]])==null||e.$name(`${O(this)??"<unnamed>"} - Automatic Bind Group & Layout`));let d=i.createShaderModule({label:`${O(this)??"<unnamed>"} - Shader`,code:u}),p={layout:i.createPipelineLayout({label:`${O(this)??"<unnamed>"} - Pipeline Layout`,bindGroupLayouts:c.map(T=>t.unwrap(T))}),vertex:{module:d,buffers:this._vertexBufferLayouts}},y=O(this);y!==void 0&&(p.label=y),this.options.fragmentFn&&(p.fragment={module:d,targets:this._targets}),n&&(jr(n.stripIndexFormat)?p.primitive={...n,stripIndexFormat:{u32:"uint32",u16:"uint16"}[n.stripIndexFormat.type]}:p.primitive=n),r&&(p.depthStencil=r),s&&(p.multisample=s),this._memo={pipeline:i.createRenderPipeline(p),usedBindGroupLayouts:c,catchall:f,logResources:h}}return this._memo}};function AT(e,t,n,r){let s={},i=new Set;function a(l,u){s[l]=u,i.add(u)}for(let[l,u]of Object.entries(e)){let c=ar(u);c!==void 0&&a(l,c)}for(let[l,u]of Object.entries(t??{})){let c=ar(u);c!==void 0&&(s[l]===void 0?a(l,c):s[l]!==c&&console.warn(`Mismatched location between vertexFn (${n}) output (${s[l]}) and fragmentFn (${r}) input (${c}) for the key "${l}", using the location set on vertex output.`))}let o=0;for(let l of Object.keys(e??{}))if(!(na(e[l])||s[l]!==void 0)){for(;i.has(o);)o++;a(l,o)}return s}function OT(e){if(e.includes(0))throw new Error("Size and workgroupSize cannot contain zeroes.");return Ye(e[0]??1,e[1]??1,e[2]??1)}var UT=[Ye(1,1,1),Ye(256,1,1),Ye(16,16,1),Ye(8,8,4)],ji,Ir,Br,Rs,Cs,Vs,RT=(Vs=class{constructor(t,n,r,s){Z(this,ji);Z(this,Ir);Z(this,Br);Z(this,Rs);Z(this,Cs);q(this,ji,t),q(this,Ir,n),q(this,Br,r),q(this,Rs,s),q(this,Cs,Ye())}with(t){return new Vs(w(this,ji),w(this,Ir).with(t),w(this,Br),w(this,Rs))}dispatchThreads(...t){let n=OT(t),r=p2(rt(n).div(rt(w(this,Rs))));o$(n,w(this,Cs))||(q(this,Cs,n),w(this,Br).write(n)),w(this,Ir).dispatchWorkgroups(r.x,r.y,r.z)}get pipeline(){return w(this,Ir)}get sizeUniform(){return w(this,Br)}},ji=new WeakMap,Ir=new WeakMap,Br=new WeakMap,Rs=new WeakMap,Cs=new WeakMap,Vs),CT=class Al{constructor(t,n){this._getRoot=t,this._slotBindings=n}with(t,n){return new Al(this._getRoot,[...this._slotBindings,[To(t)?t.slot:t,n]])}withCompute(t){return new VT(this._getRoot(),this._slotBindings,t)}createGuardedComputePipeline(t){let n=this._getRoot();if(t.length>=4)throw new Error("Guarded compute callback only supports up to three dimensions.");let r=UT[t.length],s=ge([V,V,V])(t),i=(globalThis.__TYPEGPU_AUTONAME__??(l=>l))(n.createUniform(Ye),"o"),a=Ed({workgroupSize:r,in:{id:ad.globalInvocationId}})`{
  if (any(in.id >= sizeUniform)) {
    return;
  }
  wrappedCallback(in.id.x, in.id.y, in.id.z);
}`.$uses({sizeUniform:i,wrappedCallback:s}),o=(globalThis.__TYPEGPU_AUTONAME__??(l=>l))(this.withCompute(a).createPipeline(),"i");return new RT(n,o,i,r)}withVertex(t,n){return new LT({branch:this._getRoot(),primitiveState:void 0,depthStencilState:void 0,slotBindings:this._slotBindings,vertexFn:t,vertexAttribs:n,multisampleState:void 0})}pipe(t){let n=t(new Fd([]));return new Al(this._getRoot,[...this._slotBindings,...n.bindings])}},VT=class{constructor(e,t,n){this._root=e,this._slotBindings=t,this._entryFn=n}createPipeline(){return TT(this._root,this._slotBindings,this._entryFn)}},LT=class Aa{constructor(t){this._options=t}withFragment(t,n,r){return Rn(typeof t!="string"),Rn(typeof n!="string"),new FT({...this._options,fragmentFn:t,targets:n})}withPrimitive(t){return new Aa({...this._options,primitiveState:t})}withDepthStencil(t){return new Aa({...this._options,depthStencilState:t})}withMultisample(t){return new Aa({...this._options,multisampleState:t})}createPipeline(){return vm({...this._options,fragmentFn:null,targets:null})}},FT=class Oa{constructor(t){this._options=t}withPrimitive(t){return new Oa({...this._options,primitiveState:t})}withDepthStencil(t){return new Oa({...this._options,depthStencilState:t})}withMultisample(t){return new Oa({...this._options,multisampleState:t})}createPipeline(){return vm(this._options)}},ch,fh,xm=class extends(fh=CT,ch=m,fh){constructor(t,n,r,s,i){super(()=>this,[]);g(this,"~unstable");g(this,"_unwrappedBindGroupLayouts",new Qc(t=>t.unwrap(this)));g(this,"_unwrappedBindGroups",new Qc(t=>t.unwrap(this)));g(this,ch);this.device=t,this.nameRegistrySetting=n,this._ownDevice=r,this.shaderGenerator=i,this["~unstable"]=this,this[m]={logOptions:s}}get enabledFeatures(){return new Set(this.device.features)}createBuffer(t,n){return Ta(this,t,n)}createUniform(t,n){let r=Ta(this,t,n).$usage("uniform");return new Xo("uniform",r)}createMutable(t,n){let r=Ta(this,t,n).$usage("storage");return new Xo("mutable",r)}createReadonly(t,n){let r=Ta(this,t,n).$usage("storage");return new Xo("readonly",r)}createQuerySet(t,n,r){return wT(this,t,n,r)}createBindGroup(t,n){return new em(t,n)}destroy(){j$(this.device),this._ownDevice&&this.device.destroy()}createTexture(t){return K$(t,this)}createSampler(t){return F$(t,this)}createComparisonSampler(t){return G$(t,this)}unwrap(t){if(hm(t))return t[m].rawPipeline;if(pm(t))return t[m].core.unwrap().pipeline;if(Qd(t))return this._unwrappedBindGroupLayouts.getOrMake(t);if(Ha(t))return this._unwrappedBindGroups.getOrMake(t);if(Pi(t))return t.buffer;if(Ci(t))return t[m].unwrap();if(Za(t)){if(!t[m].unwrap)throw new Error("Cannot unwrap laid-out texture view as it has no underlying resource.");return t[m].unwrap()}if(wm(t))return t.vertexLayout;if(Wd(t)||qd(t)){if(t[m].unwrap)return t[m].unwrap();throw new Error("Cannot unwrap laid-out sampler.")}if(Hu(t))return t.querySet;throw new Error(`Unknown resource type: ${t}`)}beginRenderPass(t,n){let r=this.device.createCommandEncoder(),s=r.beginRenderPass(t),i=new Map,a=new Map,o,l=()=>{if(!o)throw new Error("Cannot draw without a call to pass.setPipeline");let{core:u,priors:c}=o[m],f=u.unwrap();s.setPipeline(f.pipeline);let h=new Set(f.usedBindGroupLayouts);f.usedBindGroupLayouts.forEach((p,y)=>{var T;if(f.catchall&&y===f.catchall[0])s.setBindGroup(y,this.unwrap(f.catchall[1])),h.delete(p);else{let z=((T=c.bindGroupLayoutMap)==null?void 0:T.get(p))??i.get(p);z!==void 0&&(h.delete(p),Ha(z)?s.setBindGroup(y,this.unwrap(z)):s.setBindGroup(y,z))}});let d=new Set;if(u.usedVertexLayouts.forEach((p,y)=>{var U;let T=(U=c.vertexLayoutMap)==null?void 0:U.get(p),z=T?{buffer:T,offset:void 0,size:void 0}:a.get(p);!z||!z.buffer?d.add(p):Pi(z.buffer)?s.setVertexBuffer(y,this.unwrap(z.buffer),z.offset,z.size):s.setVertexBuffer(y,z.buffer,z.offset,z.size)}),h.size>0)throw new vu(h);if(d.size>0)throw new Ip(d)};n({setViewport(...u){s.setViewport(...u)},setScissorRect(...u){s.setScissorRect(...u)},setBlendConstant(...u){s.setBlendConstant(...u)},setStencilReference(...u){s.setStencilReference(...u)},beginOcclusionQuery(...u){s.beginOcclusionQuery(...u)},endOcclusionQuery(...u){s.endOcclusionQuery(...u)},executeBundles(...u){s.executeBundles(...u)},setPipeline(u){o=u},setIndexBuffer:(u,c,f,h)=>{Pi(u)?s.setIndexBuffer(this.unwrap(u),c,f,h):s.setIndexBuffer(u,c,f,h)},setVertexBuffer(u,c,f,h){a.set(u,{buffer:c,offset:f,size:h})},setBindGroup(u,c){i.set(u,c)},draw(u,c,f,h){l(),s.draw(u,c,f,h)},drawIndexed(...u){l(),s.drawIndexed(...u)},drawIndirect(...u){l(),s.drawIndirect(...u)},drawIndexedIndirect(...u){l(),s.drawIndexedIndirect(...u)}}),s.end(),this.device.queue.submit([r.finish()])}flush(){console.warn("flush() has been deprecated, and has no effect.")}};async function GT(e){let{adapter:t,device:n,unstable_names:r="random",unstable_logOptions:s}=e??{};if(!navigator.gpu)throw new Error("WebGPU is not supported by this browser.");let i=await navigator.gpu.requestAdapter(t);if(!i)throw new Error("Could not find a compatible GPU");let a=[];for(let l of(n==null?void 0:n.requiredFeatures)??[]){if(!i.features.has(l))throw new Error(`Requested feature "${l}" is not supported by the adapter.`);a.push(l)}for(let l of(n==null?void 0:n.optionalFeatures)??[])i.features.has(l)?a.push(l):console.warn(`Optional feature "${l}" is not supported by the adapter.`);let o=await i.requestDevice({...n,requiredFeatures:a});return new xm(o,r,!0,s??{},e==null?void 0:e.shaderGenerator)}function NT(e){let{device:t,unstable_names:n="random",unstable_logOptions:r}=e??{};return new xm(t,n,!1,r??{},e==null?void 0:e.shaderGenerator)}function DT(e,t){return new jT(e,t)}var hh,ph,Wi,Ol,dh,jT=(dh=class{constructor(e,t=void 0){Z(this,Wi);g(this,ph,!0);g(this,hh);g(this,"resourceType","accessor");g(this,"slot");this.schema=e,this.defaultValue=t,this.slot=Ka(t),this[Ne]=this.slot}get[(ph=m,hh=Ne,$e)](){return new Proxy({[m]:!0,[Bt]:Yn(this,Wi,Ol).call(this),[K]:e=>e.resolve(this),toString:()=>`accessor:${O(this)??"<unnamed>"}.$`},cn)}$name(e){return this.slot.$name(e),this}toString(){return`accessor:${O(this)??"<unnamed>"}`}get value(){if(In())return this[$e];throw new Error("`tgpu.accessor` relies on GPU resources and cannot be accessed outside of a compute dispatch or draw call")}get $(){return this.value}[K](e){let t=Yn(this,Wi,Ol).call(this);return S(e.resolve(t.value,t.dataType).value,t.dataType)}},Wi=new WeakSet,Ol=function(){let e=Cr(),t=ko(e.unwrap(this.slot));return Ad(t)?t[m].gpuImpl():S(t,this.schema)},dh);function WT(e){return YT(e)}function qT([e,t]){return`${O(e)??"<unnamed>"}=${t}`}function YT(e){if(Cr())throw new Error("Cannot create tgpu.derived objects at the resolution stage.");return{[m]:!0,resourceType:"derived","~compute":e,get[$e](){let t=Cr();if(!t)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return ko(t.unwrap(this))},get value(){return this[$e]},get $(){return this.value},with(t,n){return bm(this,[[t,n]])},toString(){return"derived"}}}function bm(e,t){return{[m]:!0,resourceType:"derived","~compute"(){throw new Error("'~compute' should never be read on bound derived items.")},[$r]:{inner:e,pairs:t},get[$e](){let n=Cr();if(!n)throw new Error("Cannot access tgpu.derived's value outside of resolution.");return ko(n.unwrap(this))},get value(){return this[$e]},get $(){return this.value},with(n,r){return bm(e,[...t,[n,r]])},toString(){return`derived[${t.map(qT).join(", ")}]`}}}var XT={fn:ge,bindGroupLayout:Kd,vertexLayout:Jc,slot:Ka,init:GT,initFromDevice:NT,resolve:yT,resolveWithContext:dm,privateVar:Qa,workgroupVar:Kc,const:xl,"~unstable":{fn:ge,fragmentFn:d$,vertexFn:ob,computeFn:Ed,vertexLayout:Jc,namespace:ca,derived:WT,slot:Ka,accessor:DT,privateVar:Qa,workgroupVar:Kc,const:xl,declare:u$,simulate:gT}},Js=XT;const Ku=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(ra({brushColor:rt,brushOpacity:v,hardness:v,screenSize:ve,brushShape:V}),"BrushUniforms"),ZT=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(ra({pos:xn(0,ve),size:xn(1,v),pressure:xn(2,v)}),"StrokePoint"),$m=(globalThis.__TYPEGPU_AUTONAME__??(e=>e))(ra({position:ad.position,localUV:xn(0,ve),color:xn(1,rt),opacity:xn(2,v),hardness:xn(3,v)}),"VertexOutput"),HT=`
@group(0) @binding(0) var<uniform> globals: BrushUniforms;

@vertex
fn vs(
  @location(0) quadPos: vec2<f32>,
  @location(1) pos: vec2<f32>,
  @location(2) size: f32,
  @location(3) pressure: f32
) -> VertexOutput {
  // Convert diameter to radius
  let radius = size * pressure;
  let pixelPos = pos + (quadPos * radius);
  
  // Convert pixel coordinates to Normalized Device Coordinates (NDC)
  let ndcX = (pixelPos.x / globals.screenSize.x) * 2.0 - 1.0;
  let ndcY = 1.0 - ((pixelPos.y / globals.screenSize.y) * 2.0);  // Flip Y axis for WebGPU coordinate system

  return VertexOutput(
    vec4<f32>(ndcX, ndcY, 0.0, 1.0),
    quadPos,
    globals.brushColor,
    pressure * globals.brushOpacity,
    globals.hardness
  );
}
`,KT=Js.resolve({template:HT,externals:{BrushUniforms:Ku,VertexOutput:$m}}),QT=`
@group(0) @binding(0) var<uniform> globals: BrushUniforms;

@fragment
fn fs(v: VertexOutput) -> @location(0) vec4<f32> {
  var dist: f32;
  if (globals.brushShape == 1u) {
    // Calculate Chebyshev distance for square shape
    dist = max(abs(v.localUV.x), abs(v.localUV.y));
  } else {
    // Calculate Euclidean distance for circle shape
    dist = length(v.localUV);
  }

  if (dist > 1.0) { discard; }

  // Calculate alpha with hardness and anti-aliasing
  let edgeWidth = fwidth(dist);
  let startFade = min(v.hardness, 1.0 - edgeWidth * 2.0);
  let linearAlpha = 1.0 - smoothstep(startFade, 1.0, dist);
  // Apply quadratic falloff for smoother edges
  let alphaShape = pow(linearAlpha, 2.0);
  
  // Return premultiplied alpha color
  let alpha = alphaShape * v.opacity;
  return vec4<f32>(v.color * alpha, alpha);
}
`,JT=Js.resolve({template:QT,externals:{VertexOutput:$m,BrushUniforms:Ku}}),e_=`
@vertex fn vs(@builtin(vertex_index) vIdx: u32) -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 3>(
    vec2<f32>(-1.0, -1.0), vec2<f32>(3.0, -1.0), vec2<f32>(-1.0, 3.0)
  );
  return vec4<f32>(pos[vIdx], 0.0, 1.0);
}

@group(0) @binding(0) var myTexture: texture_2d<f32>;

@fragment fn fs(@builtin(position) pos: vec4<f32>) -> @location(0) vec4<f32> {
  let c = textureLoad(myTexture, vec2<i32>(pos.xy), 0);
  // Treat texture as premultiplied to prevent double-darkening on overlaps
  return c;
}
`,ef=Js.resolve({template:e_,externals:{}}),t_=`
@vertex fn vs(@builtin(vertex_index) vIdx: u32) -> @builtin(position) vec4<f32> {
  var pos = array<vec2<f32>, 3>(
    vec2<f32>(-1.0, -1.0), vec2<f32>(3.0, -1.0), vec2<f32>(-1.0, 3.0)
  );
  return vec4<f32>(pos[vIdx], 0.0, 1.0);
}

@group(0) @binding(0) var myTexture: texture_2d<f32>;
@group(1) @binding(0) var<uniform> globals: BrushUniforms;

@fragment fn fs(@builtin(position) pos: vec4<f32>) -> @location(0) vec4<f32> {
  let sampled = textureLoad(myTexture, vec2<i32>(pos.xy), 0);
  // Apply global brush opacity to accumulated coverage
  return sampled * globals.brushOpacity;
}
`,Xn=Js.resolve({template:t_,externals:{BrushUniforms:Ku}}),n_=`
@group(0) @binding(0) var inputTex: texture_2d<f32>;
@group(0) @binding(1) var<storage, read_write> outputBuf: array<u32>;

@compute @workgroup_size(8, 8)
fn main(@builtin(global_invocation_id) id: vec3<u32>) {
  let dims = textureDimensions(inputTex);
  if (id.x >= dims.x || id.y >= dims.y) { return; }

  let color = textureLoad(inputTex, vec2<i32>(id.xy), 0);
  
  var r = color.r;
  var g = color.g;
  var b = color.b;
  let a = color.a;

  if (a > 0.0) {
    r = r / a;
    g = g / a;
    b = b / a;
  }

  let ir = u32(clamp(r * 255.0, 0.0, 255.0));
  let ig = u32(clamp(g * 255.0, 0.0, 255.0));
  let ib = u32(clamp(b * 255.0, 0.0, 255.0));
  let ia = u32(clamp(a * 255.0, 0.0, 255.0));

  // Pack RGBA channels into a single u32 (Little Endian)
  let packed = ir | (ig << 8u) | (ib << 16u) | (ia << 24u);

  let index = id.y * dims.x + id.x;
  outputBuf[index] = packed;
}
`,r_=Js.resolve({template:n_,externals:{}}),tf=new Float32Array([-1,-1,1,-1,1,1,-1,1]),nf=new Uint16Array([0,1,2,0,2,3]),_a=48,s_=N0(ZT),rf=1e4;class i_{constructor(t,n="rgba8unorm"){g(this,"device");g(this,"quadVertexBuffer");g(this,"indexBuffer");g(this,"instanceBuffer");g(this,"uniformBuffer");g(this,"renderPipeline");g(this,"accumulatePipeline");g(this,"blitPipeline");g(this,"compositePipeline");g(this,"compositePipelinePreview");g(this,"erasePipeline");g(this,"erasePipelinePreview");g(this,"readbackPipeline");g(this,"uniformBindGroupLayout");g(this,"textureBindGroupLayout");g(this,"mainUniformBindGroup");g(this,"currentStrokeTexture",null);g(this,"currentStrokeView",null);g(this,"compositeTextureBindGroup",null);g(this,"previewTextureBindGroup",null);g(this,"lastReadbackTexture",null);g(this,"lastReadbackBuffer",null);g(this,"readbackBindGroup",null);g(this,"lastBackgroundTexture",null);g(this,"backgroundBindGroup",null);this.device=t,this.quadVertexBuffer=t.createBuffer({size:tf.byteLength,usage:GPUBufferUsage.VERTEX,mappedAtCreation:!0}),new Float32Array(this.quadVertexBuffer.getMappedRange()).set(tf),this.quadVertexBuffer.unmap(),this.indexBuffer=t.createBuffer({size:nf.byteLength,usage:GPUBufferUsage.INDEX,mappedAtCreation:!0}),new Uint16Array(this.indexBuffer.getMappedRange()).set(nf),this.indexBuffer.unmap(),this.instanceBuffer=t.createBuffer({size:rf*s_,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),this.uniformBuffer=t.createBuffer({size:_a,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const r=t.createShaderModule({code:KT}),s=t.createShaderModule({code:JT});this.uniformBindGroupLayout=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),this.textureBindGroupLayout=t.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,texture:{}}]}),this.mainUniformBindGroup=t.createBindGroup({layout:this.uniformBindGroupLayout,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const i=t.createPipelineLayout({bindGroupLayouts:[this.uniformBindGroupLayout]});this.renderPipeline=t.createRenderPipeline({layout:i,vertex:{module:r,entryPoint:"vs",buffers:[{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]},{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float32x2"},{shaderLocation:2,offset:8,format:"float32"},{shaderLocation:3,offset:12,format:"float32"}]}]},fragment:{module:s,entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.accumulatePipeline=t.createRenderPipeline({layout:i,vertex:{module:r,entryPoint:"vs",buffers:[{arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float32x2"}]},{arrayStride:16,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float32x2"},{shaderLocation:2,offset:8,format:"float32"},{shaderLocation:3,offset:12,format:"float32"}]}]},fragment:{module:s,entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}});const a=t.createPipelineLayout({bindGroupLayouts:[this.textureBindGroupLayout]});this.blitPipeline=t.createRenderPipeline({layout:a,vertex:{module:t.createShaderModule({code:ef}),entryPoint:"vs"},fragment:{module:t.createShaderModule({code:ef}),entryPoint:"fs",targets:[{format:n,blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}});const o=t.createPipelineLayout({bindGroupLayouts:[this.textureBindGroupLayout,this.uniformBindGroupLayout]});this.compositePipeline=t.createRenderPipeline({layout:o,vertex:{module:t.createShaderModule({code:Xn}),entryPoint:"vs"},fragment:{module:t.createShaderModule({code:Xn}),entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.compositePipelinePreview=t.createRenderPipeline({layout:o,vertex:{module:t.createShaderModule({code:Xn}),entryPoint:"vs"},fragment:{module:t.createShaderModule({code:Xn}),entryPoint:"fs",targets:[{format:n,blend:{color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.erasePipeline=t.createRenderPipeline({layout:o,vertex:{module:t.createShaderModule({code:Xn}),entryPoint:"vs"},fragment:{module:t.createShaderModule({code:Xn}),entryPoint:"fs",targets:[{format:"rgba8unorm",blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.erasePipelinePreview=t.createRenderPipeline({layout:o,vertex:{module:t.createShaderModule({code:Xn}),entryPoint:"vs"},fragment:{module:t.createShaderModule({code:Xn}),entryPoint:"fs",targets:[{format:n,blend:{color:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"}}}]},primitive:{topology:"triangle-list"}}),this.readbackPipeline=t.createComputePipeline({layout:"auto",compute:{module:t.createShaderModule({code:r_}),entryPoint:"main"}})}prepareStroke(t,n){(!this.currentStrokeTexture||this.currentStrokeTexture.width!==t||this.currentStrokeTexture.height!==n)&&(this.currentStrokeTexture&&this.currentStrokeTexture.destroy(),this.currentStrokeTexture=this.device.createTexture({size:[t,n],format:"rgba8unorm",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC}),this.currentStrokeView=this.currentStrokeTexture.createView(),this.compositeTextureBindGroup=null,this.previewTextureBindGroup=null,this.lastReadbackTexture===this.currentStrokeTexture&&(this.readbackBindGroup=null,this.lastReadbackTexture=null));const r=this.device.createCommandEncoder();r.beginRenderPass({colorAttachments:[{view:this.currentStrokeView,loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]}).end(),this.device.queue.submit([r.finish()])}renderStrokeToAccumulator(t,n){this.currentStrokeView&&this.renderStrokeInternal(this.currentStrokeView,this.accumulatePipeline,t,n)}compositeStroke(t,n){if(!this.currentStrokeTexture)return;const r=new ArrayBuffer(_a),s=new Float32Array(r),i=new Uint32Array(r);s[0]=n.color[0],s[1]=n.color[1],s[2]=n.color[2],s[3]=n.opacity,s[4]=n.hardness,s[5]=0,s[6]=n.screenSize[0],s[7]=n.screenSize[1],i[8]=n.brushShape,this.device.queue.writeBuffer(this.uniformBuffer,0,r);const a=this.device.createCommandEncoder(),o=n.isErasing?this.erasePipeline:this.compositePipeline;this.compositeTextureBindGroup||(this.compositeTextureBindGroup=this.device.createBindGroup({layout:this.textureBindGroupLayout,entries:[{binding:0,resource:this.currentStrokeTexture.createView()}]}));const l=a.beginRenderPass({colorAttachments:[{view:t,loadOp:"load",storeOp:"store"}]});l.setPipeline(o),l.setBindGroup(0,this.compositeTextureBindGroup),l.setBindGroup(1,this.mainUniformBindGroup),l.draw(3),l.end(),this.device.queue.submit([a.finish()])}renderStroke(t,n,r){this.renderStrokeInternal(t,this.renderPipeline,n,r)}renderStrokeInternal(t,n,r,s){if(r.length===0)return;const i=new ArrayBuffer(_a),a=new Float32Array(i),o=new Uint32Array(i);a[0]=s.color[0],a[1]=s.color[1],a[2]=s.color[2],a[3]=s.opacity,a[4]=s.hardness,a[5]=0,a[6]=s.width,a[7]=s.height,o[8]=s.brushShape,this.device.queue.writeBuffer(this.uniformBuffer,0,i);let l=0;for(;l<r.length;){const u=Math.min(r.length-l,rf),c=new Float32Array(u*4);for(let d=0;d<u;d++){const p=r[l+d];c[d*4+0]=p.x,c[d*4+1]=p.y,c[d*4+2]=s.size,c[d*4+3]=p.pressure}this.device.queue.writeBuffer(this.instanceBuffer,0,c);const f=this.device.createCommandEncoder(),h=f.beginRenderPass({colorAttachments:[{view:t,loadOp:"load",storeOp:"store"}]});h.setPipeline(n),h.setBindGroup(0,this.mainUniformBindGroup),h.setVertexBuffer(0,this.quadVertexBuffer),h.setVertexBuffer(1,this.instanceBuffer),h.setIndexBuffer(this.indexBuffer,"uint16"),h.drawIndexed(6,u),h.end(),this.device.queue.submit([f.finish()]),l+=u}}blitToCanvas(t,n,r){const s=this.device.createCommandEncoder(),i=t.getCurrentTexture().createView();if(r){(this.lastBackgroundTexture!==r||!this.backgroundBindGroup)&&(this.backgroundBindGroup=this.device.createBindGroup({layout:this.textureBindGroupLayout,entries:[{binding:0,resource:r.createView()}]}),this.lastBackgroundTexture=r);const a=s.beginRenderPass({colorAttachments:[{view:i,loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]});a.setPipeline(this.blitPipeline),a.setBindGroup(0,this.backgroundBindGroup),a.draw(3),a.end()}else s.beginRenderPass({colorAttachments:[{view:i,loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]}).end();if(this.currentStrokeTexture){const a=new ArrayBuffer(_a),o=new Float32Array(a),l=new Uint32Array(a);o[0]=n.color[0],o[1]=n.color[1],o[2]=n.color[2],o[3]=n.opacity,o[4]=n.hardness,o[5]=0,o[6]=n.screenSize[0],o[7]=n.screenSize[1],l[8]=n.brushShape,this.device.queue.writeBuffer(this.uniformBuffer,0,a);const u=n.isErasing?this.erasePipelinePreview:this.compositePipelinePreview;this.previewTextureBindGroup||(this.previewTextureBindGroup=this.device.createBindGroup({layout:this.textureBindGroupLayout,entries:[{binding:0,resource:this.currentStrokeTexture.createView()}]}));const c=s.beginRenderPass({colorAttachments:[{view:i,loadOp:"load",storeOp:"store"}]});c.setPipeline(u),c.setBindGroup(0,this.previewTextureBindGroup),c.setBindGroup(1,this.mainUniformBindGroup),c.draw(3),c.end()}this.device.queue.submit([s.finish()])}clearPreview(t){const n=this.device.createCommandEncoder();n.beginRenderPass({colorAttachments:[{view:t.getCurrentTexture().createView(),loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0},storeOp:"store"}]}).end(),this.device.queue.submit([n.finish()])}prepareReadback(t,n){(this.lastReadbackTexture!==t||this.lastReadbackBuffer!==n||!this.readbackBindGroup)&&(this.readbackBindGroup=this.device.createBindGroup({layout:this.readbackPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:t.createView()},{binding:1,resource:{buffer:n}}]}),this.lastReadbackTexture=t,this.lastReadbackBuffer=n);const r=this.device.createCommandEncoder(),s=r.beginComputePass();s.setPipeline(this.readbackPipeline),s.setBindGroup(0,this.readbackBindGroup);const i=t.width,a=t.height;s.dispatchWorkgroups(Math.ceil(i/8),Math.ceil(a/8)),s.end(),this.device.queue.submit([r.finish()])}destroy(){this.quadVertexBuffer.destroy(),this.indexBuffer.destroy(),this.instanceBuffer.destroy(),this.uniformBuffer.destroy(),this.currentStrokeTexture&&this.currentStrokeTexture.destroy(),this.compositeTextureBindGroup=null,this.previewTextureBindGroup=null,this.readbackBindGroup=null,this.backgroundBindGroup=null,this.lastReadbackTexture=null,this.lastReadbackBuffer=null,this.lastBackgroundTexture=null}}class a_{constructor(t){g(this,"controlPoints",[]);g(this,"remainder",0);g(this,"spacing");g(this,"isFirstPoint",!0);g(this,"hasProcessedSegment",!1);this.spacing=t}addPoint(t){if(this.isFirstPoint)return this.controlPoints.push(t),this.controlPoints.push(t),this.isFirstPoint=!1,[];if(this.controlPoints.push(t),this.controlPoints.length<4)return[];const n=this.controlPoints[0],r=this.controlPoints[1],s=this.controlPoints[2],i=this.controlPoints[3],a=this.processSegment(n,r,s,i);return this.controlPoints.shift(),a}endStroke(){if(this.controlPoints.length<2)return[];const t=[];for(;this.controlPoints.length>=3;){const n=this.controlPoints[0],r=this.controlPoints[1],s=this.controlPoints[2],i=s,a=this.processSegment(n,r,s,i);t.push(...a),this.controlPoints.shift()}if(!this.hasProcessedSegment&&this.controlPoints.length>=2){const n=this.controlPoints[1],r=this.processSegment(n,n,n,n);t.push(...r)}return t}processSegment(t,n,r,s){this.hasProcessedSegment=!0;const i=[],a=Math.hypot(r.x-n.x,r.y-n.y),o=Math.max(5,Math.ceil(a));for(let c=0;c<o;c++){const f=c/o;i.push(e0(t,n,r,s,f))}i.push(r);const{points:l,remainder:u}=gp(i,this.spacing,this.remainder);return this.remainder=u,l}}function xr(e,t){const r=1+(1-t)*.5;return e*r}function gs(e,t,n){return n<=0?0:e*t/n}const o_=uu(function(e,t){try{const n=JSON.stringify(t);Q1(e,n)}catch(n){console.error("Failed to save brush to cache:",n)}},300);function l_(e){try{const t=K1(e);return t?JSON.parse(t):null}catch(t){return console.error("Failed to load brush from cache:",t),null}}function u_(e){const t=at(),n=yp();let r=null,s=null,i=null,a=null,o=null,l=null,u=null,c=null,f=null,h=null,d=0;const p=k(!1),y=new Z1({maxSize:20});function T($,b,P,A){const D=`${$}_${b}_${P}_${A}`;if(y.has(D))return y.get(D);const X=Math.ceil($*2),L=document.createElement("canvas"),H=L.getContext("2d");L.width=X,L.height=X;const ne=X/2,ce=X/2,de=$*b,Q=H.createImageData(X,X),re=Q.data,{r:st,g:Qe,b:qn}=ma(P),Eo=$-de;for(let pr=0;pr<X;pr++){const si=pr+.5-ce;for(let dr=0;dr<X;dr++){const Ao=dr+.5-ne,es=(pr*X+dr)*4,ii=Math.max(Math.abs(Ao),Math.abs(si));let Oo=0;if(ii<=de)Oo=A;else if(ii<=$){const Tm=(ii-de)/Eo;Oo=A*Math.pow(1-Tm,2)}re[es]=st,re[es+1]=Qe,re[es+2]=qn,re[es+3]=Oo*255}}return H.putImageData(Q,0,0),y.set(D,L),L}const z=k(!1),U=k(!1),J=k(null),j=k(0),N=k(new Date),E=k(!0),G=k({minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});function W(){G.value={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ee($,b,P){G.value.minX=Math.min(G.value.minX,$-P-2),G.value.minY=Math.min(G.value.minY,b-P-2),G.value.maxX=Math.max(G.value.maxX,$+P+2),G.value.maxY=Math.max(G.value.maxY,b+P+2)}let he=null;const ye=k(null),De=k((e==null?void 0:e.useDominantAxis)??!1),Ae=k((e==null?void 0:e.brushAdjustmentSpeed)??1),He=l_("maskeditor_brush_settings");He&&(t.setBrushSize(He.size),t.setBrushOpacity(He.opacity),t.setBrushHardness(He.hardness),t.brushSettings.type=He.type,t.setBrushStepSize(He.stepSize??5)),Cn(()=>t.clearTrigger,()=>{Jr()}),Cn(()=>t.canvasHistory.currentStateIndex,async()=>{p.value||(await Ut(),a&&o&&a.clearPreview(o))}),Pm(()=>{a&&(a.destroy(),a=null),r&&(r.destroy(),r=null),s&&(s.destroy(),s=null),u&&(u.destroy(),u=null),c&&(c.destroy(),c=null),f&&(f.destroy(),f=null),h&&(h.destroy(),h=null)});async function _t(){if(t.tgpuRoot){i=t.tgpuRoot.device;return}try{const $=await Js.init();t.tgpuRoot=$,i=$.device,console.warn(" TypeGPU initialized! Root:",$),console.warn("Device info:",$.device.limits)}catch($){console.warn("Failed to initialize TypeGPU:",$.message)}}function Ot($){for(let b=0;b<$.length;b+=4){const P=$[b+3]/255;$[b]=Math.round($[b]*P),$[b+1]=Math.round($[b+1]*P),$[b+2]=Math.round($[b+2]*P)}}async function Ut(){if(!i||!r||!s||!t.maskCanvas||!t.rgbCtx)return;const $=t.maskCanvas.width,b=t.maskCanvas.height,P=t.maskCtx.getImageData(0,0,$,b);Ot(P.data),i.queue.writeTexture({texture:r},P.data,{bytesPerRow:$*4},{width:$,height:b});const A=t.rgbCtx.getImageData(0,0,$,b);Ot(A.data),i.queue.writeTexture({texture:s},A.data,{bytesPerRow:$*4},{width:$,height:b})}async function ei(){if(await _t(),!t.tgpuRoot||!i){console.warn("TypeGPU not initialized, skipping GPU resource setup");return}if(!t.maskCanvas||!t.rgbCanvas||!t.maskCtx||!t.rgbCtx){console.warn("Canvas contexts not ready, skipping GPU resource setup");return}const $=t.maskCanvas.width,b=t.maskCanvas.height;try{console.warn(` Initializing GPU resources for ${$}x${b} canvas`),r=(globalThis.__TYPEGPU_AUTONAME__??(A=>A))(i.createTexture({size:[$,b],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC}),"maskTexture"),s=(globalThis.__TYPEGPU_AUTONAME__??(A=>A))(i.createTexture({size:[$,b],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC}),"rgbTexture"),await Ut(),console.warn(" GPU resources initialized successfully");const P=navigator.gpu.getPreferredCanvasFormat();a=new i_(i,P),console.warn(" Brush renderer initialized")}catch(P){console.error("Failed to initialize GPU resources:",P),r=null,s=null}}function tn($,b){const P=t.brushSettings,A=t.maskCtx,D=t.rgbCtx;if(!A||!D)throw new Error("Canvas contexts are required");const X=P.type,L=P.size,H=P.hardness,ne=b??P.opacity,ce=A.globalCompositeOperation==="destination-out",de=t.currentTool;if(t.activeLayer==="rgb"&&de&&(de===oe.Eraser||de===oe.PaintPen)){const Qe=xr(L,H),qn=gs(L,H,Qe);ti(D,$,X,Qe,qn,ne);return}const re=xr(L,H),st=gs(L,H,re);ni(A,$,X,re,st,ne,ce),ee($.x,$.y,re)}function ti($,b,P,A,D,X){const{x:L,y:H}=b,ne=t.rgbColor;if(P===ct.Rect&&D<1){const de=te(ne,X),Q=T(A,D,de,X);$.drawImage(Q,L-A,H-A),ee(L,H,A);return}if(D===1){const de=te(ne,X);$.fillStyle=de,R($,P,L,H,A),ee(L,H,A);return}const ce=pe($,L,H,A,D,ne,X,!1);$.fillStyle=ce,R($,P,L,H,A),ee(L,H,A)}function ni($,b,P,A,D,X,L){const{x:H,y:ne}=b,ce=t.maskColor;if(P===ct.Rect&&D<1){const re=L?`rgba(255, 255, 255, ${X})`:`rgba(${ce.r}, ${ce.g}, ${ce.b}, ${X})`,st=T(A,D,re,X);$.drawImage(st,H-A,ne-A),ee(H,ne,A);return}if(D===1){$.fillStyle=L?`rgba(255, 255, 255, ${X})`:`rgba(${ce.r}, ${ce.g}, ${ce.b}, ${X})`,R($,P,H,ne,A),ee(H,ne,A);return}const de=`rgb(${ce.r}, ${ce.g}, ${ce.b})`,Q=pe($,H,ne,A,D,de,X,L);$.fillStyle=Q,R($,P,H,ne,A),ee(H,ne,A)}function R($,b,P,A,D){$.beginPath(),b===ct.Rect?$.rect(P-D,A-D,D*2,D*2):$.arc(P,A,D,0,Math.PI*2,!1),$.fill()}function te($,b){const{r:P,g:A,b:D}=hp($);return`rgba(${P}, ${A}, ${D}, ${b})`}function pe($,b,P,A,D,X,L,H){if(!Number.isFinite(b)||!Number.isFinite(P)||!Number.isFinite(A))return $.createRadialGradient(0,0,0,0,0,0);const ne=$.createRadialGradient(b,P,0,b,P,A);if(H)ne.addColorStop(0,`rgba(255, 255, 255, ${L})`),ne.addColorStop(D,`rgba(255, 255, 255, ${L})`),ne.addColorStop(1,"rgba(255, 255, 255, 0)");else{const{r:ce,g:de,b:Q}=ma(X);ne.addColorStop(0,`rgba(${ce}, ${de}, ${Q}, ${L})`),ne.addColorStop(D,`rgba(${ce}, ${de}, ${Q}, ${L})`),ne.addColorStop(1,`rgba(${ce}, ${de}, ${Q}, 0)`)}return ne}async function We($){if(!he)return;const b=he.addPoint($);if(b.length===0){a&&E.value&&Wn([],!0);return}if(a)Wn(b,!0);else for(const P of b)tn(P);E.value=!1}function Ke($){const b=t.maskBlendMode,P=t.maskCtx,A=t.rgbCtx;if(!P||!A)throw new Error("Canvas contexts are required");P.beginPath(),A.beginPath(),$===Xt.SourceOver?(P.fillStyle=b,P.globalCompositeOperation=Xt.SourceOver,A.globalCompositeOperation=Xt.SourceOver):$===Xt.DestinationOut&&(P.globalCompositeOperation=Xt.DestinationOut,A.globalCompositeOperation=Xt.DestinationOut)}async function qe($,b,P,A){const{points:D,remainder:X}=gp([$,b],A,j.value);if(j.value=X,Ke(P),a)Wn(D);else for(const L of D)tn(L,1)}async function ut($){z.value=!0,W();try{a&&t.maskCanvas&&a.prepareStroke(t.maskCanvas.width,t.maskCanvas.height);let b;const P=t.currentTool,A={x:$.offsetX,y:$.offsetY},D=n.screenToCanvas(A);P==="eraser"||$.buttons===2?b=Xt.DestinationOut:b=Xt.SourceOver;const X=t.brushSettings.stepSize/100,L=Math.max(1,t.brushSettings.size*X);if($.shiftKey&&J.value?(U.value=!0,await qe(J.value,D,b,L)):(U.value=!1,Ke(b),j.value=L),J.value=D,a){const H=t.activeLayer==="rgb";H&&t.rgbCanvas?(t.rgbCanvas.style.opacity="0",l&&(l.style.opacity="1")):!H&&t.maskCanvas&&(t.maskCanvas.style.opacity="0",l&&(l.style.opacity=String(t.maskOpacity)))}he=new a_(L),await We(D),N.value=new Date}catch(b){console.error("[useBrushDrawing] Failed to start drawing:",b),z.value=!1,U.value=!1}}async function ht($){const b=performance.now()-N.value.getTime(),P={x:$.offsetX,y:$.offsetY},A=n.screenToCanvas(P),D=t.currentTool;b>20&&!z.value?requestAnimationFrame(async()=>{if(z.value)try{Ke(Xt.SourceOver),await ri(A)}catch(X){console.error("[useBrushDrawing] Drawing error:",X)}}):requestAnimationFrame(async()=>{if(z.value)try{D==="eraser"||$.buttons===2?Ke(Xt.DestinationOut):Ke(Xt.SourceOver),await We(A)}catch(X){console.error("[useBrushDrawing] Drawing error:",X)}}),N.value=new Date}async function yt($){var A;const b={x:$.offsetX,y:$.offsetY},P=n.screenToCanvas(b);if(z.value){if(z.value=!1,J.value=P,E.value=!0,he){const L=he.endStroke();if(L.length>0)if(a)Wn(L,!0);else for(const H of L)tn(H);he=null}if(a&&r&&s){const H=t.activeLayer==="rgb"?s:r,ne=t.brushSettings.size,ce=t.brushSettings.hardness,de=xr(ne,ce),Q=gs(ne,ce,de),re=t.currentTool==="eraser"||((A=t.maskCtx)==null?void 0:A.globalCompositeOperation)==="destination-out",st=t.brushSettings.type===ct.Rect?1:0;a.compositeStroke(H.createView(),{opacity:t.brushSettings.opacity,color:[0,0,0],hardness:Q,screenSize:[t.maskCanvas.width,t.maskCanvas.height],brushShape:st,isErasing:re})}let D,X;if(a&&r&&s)try{const L=await zt();D=L.maskData,X=L.rgbData}catch(L){console.warn("GPU readback failed, falling back to CPU:",L)}p.value=!0,t.canvasHistory.saveState(D,X),await Im(),p.value=!1,a&&o&&a.clearPreview(o),t.activeLayer==="rgb"&&t.rgbCanvas?t.rgbCanvas.style.opacity="1":t.activeLayer==="mask"&&t.maskCanvas&&(t.maskCanvas.style.opacity=String(t.maskOpacity)),l&&(l.style.opacity="1")}}async function Dt($){$.preventDefault();const b={x:$.offsetX,y:$.offsetY},P=n.screenToCanvas(b);t.brushPreviewGradientVisible=!0,ye.value=P}async function St($){if(!ye.value)return;const b={x:$.offsetX,y:$.offsetY},P=5,A=n.screenToCanvas(b),D=A.x-ye.value.x,X=A.y-ye.value.y,L=Math.abs(D)<P?0:D,H=Math.abs(X)<P?0:X;let ne=L,ce=H;if(De.value){const Qe=Math.abs(L)/Math.abs(H),qn=2;Qe>qn?ce=0:Qe<1/qn&&(ne=0)}const de=Math.max(-100,Math.min(100,ne)),Q=Math.max(-100,Math.min(100,ce)),re=Math.max(1,Math.min(500,t.brushSettings.size+de/35*Ae.value)),st=Math.max(0,Math.min(1,t.brushSettings.hardness-Q/4e3*Ae.value));t.setBrushSize(re),t.setBrushHardness(st)}function pt(){o_("maskeditor_brush_settings",t.brushSettings)}async function zt(){if(!i||!r||!s||!t.maskCanvas||!t.rgbCanvas||!t.maskCtx||!t.rgbCtx||!a)throw new Error("GPU resources not ready");const $=t.maskCanvas.width,b=t.maskCanvas.height,P=$*b*4;(!u||!c||!f||!h||d!==P)&&(u==null||u.destroy(),c==null||c.destroy(),f==null||f.destroy(),h==null||h.destroy(),u=(globalThis.__TYPEGPU_AUTONAME__??(re=>re))(i.createBuffer({size:P,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),"readbackStorageMask"),c=(globalThis.__TYPEGPU_AUTONAME__??(re=>re))(i.createBuffer({size:P,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),"readbackStorageRgb"),f=(globalThis.__TYPEGPU_AUTONAME__??(re=>re))(i.createBuffer({size:P,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"readbackStagingMask"),h=(globalThis.__TYPEGPU_AUTONAME__??(re=>re))(i.createBuffer({size:P,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),"readbackStagingRgb"),d=P),a.prepareReadback(r,u),a.prepareReadback(s,c);const A=i.createCommandEncoder();A.copyBufferToBuffer(u,0,f,0,P),A.copyBufferToBuffer(c,0,h,0,P),i.queue.submit([A.finish()]),await Promise.all([f.mapAsync(GPUMapMode.READ),h.mapAsync(GPUMapMode.READ)]);const D=new Uint8ClampedArray(f.getMappedRange().slice(0)),X=new Uint8ClampedArray(h.getMappedRange().slice(0));f.unmap(),h.unmap();const L=new ImageData(D,$,b),H=new ImageData(X,$,b);let ne=0,ce=0,de=$,Q=b;if(G.value.minX!==1/0&&G.value.maxX!==-1/0){const re=G.value;ne=Math.floor(Math.max(0,re.minX)),ce=Math.floor(Math.max(0,re.minY));const st=Math.ceil(Math.min($,re.maxX)),Qe=Math.ceil(Math.min(b,re.maxY));de=st-ne,Q=Qe-ce}return de>0&&Q>0?(t.maskCtx.putImageData(L,0,0,ne,ce,de,Q),t.rgbCtx.putImageData(H,0,0,ne,ce,de,Q)):(t.maskCtx.putImageData(L,0,0),t.rgbCtx.putImageData(H,0,0)),{maskData:L,rgbData:H}}function jt(){a==null||a.destroy(),r&&(r.destroy(),r=null),s&&(s.destroy(),s=null),u==null||u.destroy(),c==null||c.destroy(),f==null||f.destroy(),h==null||h.destroy(),u=null,c=null,f=null,h=null,d=0,t.tgpuRoot&&(t.tgpuRoot.destroy(),t.tgpuRoot=null),i=null}async function ri($,b=1){var P;if(a){const A=t.maskCanvas.width,D=t.maskCanvas.height,X=[{x:$.x,y:$.y,pressure:b}],L=t.brushSettings.size,H=t.brushSettings.hardness,ne=xr(L,H),ce=gs(L,H,ne),de=t.brushSettings.type===ct.Rect?1:0;if(a.renderStrokeToAccumulator(X,{size:ne,opacity:.5,hardness:ce,color:[1,1,1],width:A,height:D,brushShape:de}),r&&o){const Q=t.activeLayer==="rgb";let re=[1,1,1];if(Q){const Qe=ma(t.rgbColor);re=[Qe.r/255,Qe.g/255,Qe.b/255]}else{const Qe=t.maskColor;re=[Qe.r/255,Qe.g/255,Qe.b/255]}const st=t.currentTool==="eraser"||((P=t.maskCtx)==null?void 0:P.globalCompositeOperation)==="destination-out";a.blitToCanvas(o,{opacity:t.brushSettings.opacity,color:re,hardness:ce,screenSize:[A,D],brushShape:de,isErasing:st},void 0)}}else tn($,b)}function Qr($){if(!i)return;const b=$.getContext("webgpu");b&&(b.configure({device:i,format:navigator.gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),o=b,l=$,console.warn(" Preview Canvas Initialized"))}function Wn($,b=!1){var de;if(!a||!r||!s)return;const P=t.activeLayer==="rgb";let A=[1,1,1];if(P){const Q=ma(t.rgbColor);A=[Q.r/255,Q.g/255,Q.b/255]}else{const Q=t.maskColor;A=[Q.r/255,Q.g/255,Q.b/255]}let D=[];if(b)D=$.map(Q=>({x:Q.x,y:Q.y,pressure:1}));else for(let Q=0;Q<$.length-1;Q++){const re=$[Q],st=$[Q+1],Qe=Math.hypot(st.x-re.x,st.y-re.y),qn=t.brushSettings.stepSize/100,Eo=Math.max(1,t.brushSettings.size*qn),pr=Math.max(1,Math.ceil(Qe/Eo));for(let si=0;si<=pr;si++){const dr=si/pr,Ao=1,es=re.x+(st.x-re.x)*dr,ii=re.y+(st.y-re.y)*dr;D.push({x:es,y:ii,pressure:Ao})}}const X=t.brushSettings.size,L=t.brushSettings.hardness,H=xr(X,L),ne=gs(X,L,H),ce=t.brushSettings.type===ct.Rect?1:0;a.renderStrokeToAccumulator(D,{size:H,opacity:.5,hardness:ne,color:A,width:t.maskCanvas.width,height:t.maskCanvas.height,brushShape:ce});for(const Q of D)ee(Q.x,Q.y,H);if(o){const Q=t.currentTool==="eraser"||((de=t.maskCtx)==null?void 0:de.globalCompositeOperation)==="destination-out",re=P?s:r;a.blitToCanvas(o,{opacity:t.brushSettings.opacity,color:A,hardness:ne,screenSize:[t.maskCanvas.width,t.maskCanvas.height],brushShape:ce,isErasing:Q},re??void 0)}}function Jr(){if(!i||!r||!s||!t.maskCanvas)return;const $=t.maskCanvas.width,b=t.maskCanvas.height;i.queue.writeTexture({texture:r},new Uint8Array($*b*4),{bytesPerRow:$*4},{width:$,height:b}),i.queue.writeTexture({texture:s},new Uint8Array($*b*4),{bytesPerRow:$*4},{width:$,height:b})}return{startDrawing:ut,handleDrawing:ht,drawEnd:yt,startBrushAdjustment:Dt,handleBrushAdjustment:St,saveBrushSettings:pt,destroy:jt,initGPUResources:ei,initPreviewCanvas:Qr,clearGPU:Jr}}const Sa=(e,t,n,r)=>e[(n*r+t)*4+3],hi=(e,t,n,r)=>{const s=(n*r+t)*4;return{r:e[s],g:e[s+1],b:e[s+2]}},Zo=(e,t,n,r,s,i)=>{const a=(n*r+t)*4;e[a]=i.r,e[a+1]=i.g,e[a+2]=i.b,e[a+3]=s},sf=(e,t,n)=>{e/=255,t/=255,n/=255;const r=Math.max(e,t,n),s=Math.min(e,t,n);let i=0,a=0;const o=(r+s)/2;if(r!==s){const l=r-s;switch(a=o>.5?l/(2-r-s):l/(r+s),r){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4;break}i/=6}return{h:i*360,s:a*100,l:o*100}},af=e=>{let t=e.r/255,n=e.g/255,r=e.b/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,t*=100,n*=100,r*=100;const s=t*.4124+n*.3576+r*.1805,i=t*.2126+n*.7152+r*.0722,a=t*.0193+n*.1192+r*.9505,c=[s/95.047,i/100,a/108.883];for(let f=0;f<c.length;f++)c[f]=c[f]>.008856?Math.pow(c[f],1/3):7.787*c[f]+16/116;return{l:116*c[1]-16,a:500*(c[0]-c[1]),b:200*(c[1]-c[2])}},of=(e,t,n)=>Math.sqrt(Math.pow(e.r-t.r,2)+Math.pow(e.g-t.g,2)+Math.pow(e.b-t.b,2))<=n,c_=(e,t,n)=>{const r=sf(e.r,e.g,e.b),s=sf(t.r,t.g,t.b),i=Math.abs(r.h-s.h),a=Math.abs(r.s-s.s),o=Math.abs(r.l-s.l);return Math.sqrt(Math.pow(i/360*255,2)+Math.pow(a/100*255,2)+Math.pow(o/100*255,2))<=n},f_=(e,t,n)=>{const r=af(e),s=af(t);return Math.sqrt(Math.pow(r.l-s.l,2)+Math.pow(r.a-s.a,2)+Math.pow(r.b-s.b,2))/100*255<=n},Ho=(e,t,n,r)=>{switch(r){case Er.Simple:return of(e,t,n);case Er.HSL:return c_(e,t,n);case Er.LAB:return f_(e,t,n);default:return of(e,t,n)}};function h_(){const e=at(),t=k(null),n=o=>{const l=e.maskCtx,u=e.maskCanvas;if(!l||!u)return;const c=Math.floor(o.x),f=Math.floor(o.y),h=u.width,d=u.height;if(c<0||c>=h||f<0||f>=d)return;const p=l.getImageData(0,0,h,d),y=p.data,T=Sa(y,c,f,h),z=T!==255;if(T===-1)return;const U=e.maskColor,J=e.paintBucketTolerance,j=Math.floor(e.fillOpacity/100*255),N=[],E=new Uint8Array(h*d),G=(W,ee,he,ye)=>W===-1?!1:ye?W!==255&&Math.abs(W-ee)<=he:W===255||Math.abs(W-ee)<=he;for(G(T,T,J,z)&&N.push([c,f]);N.length>0;){const[W,ee]=N.pop(),he=ee*h+W;if(E[he])continue;const ye=Sa(y,W,ee,h);if(!G(ye,T,J,z))continue;E[he]=1,Zo(y,W,ee,h,z?j:0,U);const De=(Ae,He)=>{if(!(Ae<0||Ae>=h||He<0||He>=d)&&!E[He*h+Ae]){const _t=Sa(y,Ae,He,h);G(_t,T,J,z)&&N.push([Ae,He])}};De(W-1,ee),De(W+1,ee),De(W,ee-1),De(W,ee+1)}l.putImageData(p,0,0),e.canvasHistory.saveState()},r=async o=>{const l=e.maskCtx,u=e.imgCtx,c=e.imgCanvas;if(!l||!u||!c)return;const f=c.width,h=c.height;t.value=o;const d=l.getImageData(0,0,f,h),p=d.data,y=u.getImageData(0,0,f,h).data,T=e.colorSelectTolerance,z=e.colorComparisonMethod,U=e.maskColor,J=Math.floor(e.selectionOpacity/100*255),j=e.applyWholeImage,N=e.maskBoundary,E=e.maskTolerance;if(j){const G=hi(y,Math.floor(o.x),Math.floor(o.y),f),W=1e4;for(let ee=0;ee<f*h;ee+=W){const he=Math.min(ee+W,f*h);for(let ye=ee;ye<he;ye++){const De=ye%f,Ae=Math.floor(ye/f);Ho(hi(y,De,Ae,f),G,T,z)&&Zo(p,De,Ae,f,J,U)}await new Promise(ye=>setTimeout(ye,0))}}else{const G=Math.floor(o.x),W=Math.floor(o.y);if(G<0||G>=f||W<0||W>=h)return;const ee=hi(y,G,W,f),he=[],ye=new Uint8Array(f*h);for(he.push([G,W]);he.length>0;){const[De,Ae]=he.pop(),He=Ae*f+De;if(ye[He]||!Ho(hi(y,De,Ae,f),ee,T,z))continue;ye[He]=1,Zo(p,De,Ae,f,J,U);const _t=(Ot,Ut)=>{Ot<0||Ot>=f||Ut<0||Ut>=h||ye[Ut*f+Ot]||Ho(hi(y,Ot,Ut,f),ee,T,z)&&(N&&255-Sa(p,Ot,Ut,f)<=E||he.push([Ot,Ut]))};_t(De-1,Ae),_t(De+1,Ae),_t(De,Ae-1),_t(De,Ae+1)}}l.putImageData(d,0,0),e.canvasHistory.saveState()},s=()=>{const o=e.maskCtx,l=e.maskCanvas;if(!o||!l)return;const u=o.getImageData(0,0,l.width,l.height),c=u.data;let f=0,h=0,d=0;for(let p=0;p<c.length;p+=4)if(c[p+3]>0){f=c[p],h=c[p+1],d=c[p+2];break}for(let p=0;p<c.length;p+=4){const y=c[p+3];c[p+3]=255-y,y===0&&(c[p]=f,c[p+1]=h,c[p+2]=d)}o.putImageData(u,0,0),e.canvasHistory.saveState()},i=()=>{const o=e.maskCtx,l=e.maskCanvas,u=e.rgbCtx,c=e.rgbCanvas;o&&l&&o.clearRect(0,0,l.width,l.height),u&&c&&u.clearRect(0,0,c.width,c.height),e.canvasHistory.saveState()},a=()=>{t.value=null};return Cn([()=>e.colorSelectTolerance,()=>e.colorComparisonMethod,()=>e.selectionOpacity],async()=>{t.value&&e.colorSelectLivePreview&&e.canUndo&&(e.canvasHistory.undo(),await r(t.value))}),{paintBucketFill:n,colorSelectFill:r,clearLastColorSelectPoint:a,invertMask:s,clearMask:i}}function p_(e,t){const n=at(),r=yp(),s=u_({useDominantAxis:Ar.extensionManager.setting.get("Comfy.MaskEditor.UseDominantAxis"),brushAdjustmentSpeed:Ar.extensionManager.setting.get("Comfy.MaskEditor.BrushAdjustmentSpeed")}),i=h_(),a=k(null),o={[oe.MaskPen]:{newActiveLayerOnSet:"mask"},[oe.Eraser]:{},[oe.PaintPen]:{newActiveLayerOnSet:"rgb"},[oe.MaskBucket]:{cursor:"url('/cursor/paintBucket.png') 30 25, auto",newActiveLayerOnSet:"mask"},[oe.MaskColorFill]:{cursor:"url('/cursor/colorSelect.png') 15 25, auto",newActiveLayerOnSet:"mask"}},l=p=>{n.activeLayer=p;const y=n.currentTool;[oe.MaskPen,oe.MaskBucket,oe.MaskColorFill].includes(y)&&p==="rgb"&&u(oe.PaintPen),y===oe.PaintPen&&p==="mask"&&u(oe.MaskPen)},u=p=>{n.currentTool=p;const y=o[p].newActiveLayerOnSet;y&&(n.activeLayer=y);const T=o[p].cursor,z=n.pointerZone;T&&z?(n.brushVisible=!1,z.style.cursor=T):z&&(n.brushVisible=!0,z.style.cursor="none")},c=()=>{const p=n.currentTool,y=o[p].cursor,T=n.pointerZone;y&&T?(n.brushVisible=!1,T.style.cursor=y):T&&(n.brushVisible=!0,T.style.cursor="none"),n.brushPreviewGradientVisible=!1};return Cn(()=>n.currentTool,p=>{p!==oe.MaskColorFill&&i.clearLastColorSelectPoint()}),{switchTool:u,setActiveLayer:l,updateCursor:c,handlePointerDown:async p=>{if(p.preventDefault(),p.pointerType==="touch")return;const y=e.isKeyDown(" ");if(p.buttons===4||p.buttons===1&&y){t.handlePanStart(p),n.brushVisible=!1;return}if(n.currentTool===oe.PaintPen&&p.button===0){await s.startDrawing(p);return}if(n.currentTool===oe.PaintPen&&p.buttons===1){await s.handleDrawing(p);return}if(n.currentTool===oe.MaskBucket&&p.button===0){const z={x:p.offsetX,y:p.offsetY},U=r.screenToCanvas(z);i.paintBucketFill(U);return}if(n.currentTool===oe.MaskColorFill&&p.button===0){const z={x:p.offsetX,y:p.offsetY},U=r.screenToCanvas(z);await i.colorSelectFill(U);return}if(p.altKey&&p.button===2){n.isAdjustingBrush=!0,await s.startBrushAdjustment(p);return}const T=[oe.MaskPen,oe.Eraser,oe.PaintPen].includes(n.currentTool);if([0,2].includes(p.button)&&T){await s.startDrawing(p);return}},handlePointerMove:async p=>{if(p.preventDefault(),p.pointerType==="touch")return;const y={x:p.clientX,y:p.clientY};t.updateCursorPosition(y);const T=e.isKeyDown(" ");if(p.buttons===4||p.buttons===1&&T){await t.handlePanMove(p);return}if([oe.MaskPen,oe.Eraser,oe.PaintPen].includes(n.currentTool)){if(n.isAdjustingBrush&&(n.currentTool===oe.MaskPen||n.currentTool===oe.Eraser)&&p.altKey&&p.buttons===2){await s.handleBrushAdjustment(p);return}if(p.buttons===1||p.buttons===2){await s.handleDrawing(p);return}}},handlePointerUp:async p=>{n.isPanning=!1,n.brushVisible=!0,p.pointerType!=="touch"&&(c(),n.isAdjustingBrush=!1,await s.drawEnd(p),a.value=null)},brushDrawing:s}}const d_=eo("dialog",()=>{const e=k([]),t=k(null),n=()=>`dialog-${Math.random().toString(36).slice(2,9)}`;function r(f){const h=e.value.findIndex(d=>d.priority<=f.priority);e.value.splice(h===-1?e.value.length:h,0,f)}function s(f){const h=f.key,d=e.value.findIndex(p=>p.key===h);if(d!==-1){const[p]=e.value.splice(d,1);r(p),t.value=h,o()}}function i(f){var p,y;const h=f?e.value.find(T=>T.key===f.key):e.value.find(T=>T.key===t.value);if(!h)return;(y=(p=h.dialogComponentProps)==null?void 0:p.onClose)==null||y.call(p);const d=e.value.indexOf(h);e.value.splice(d,1),t.value=e.value.length>0?e.value[e.value.length-1].key:null,o()}function a(f){var d;e.value.length>=10&&e.value.shift();const h={key:f.key,visible:!0,title:f.title,headerComponent:f.headerComponent?Ro(f.headerComponent):void 0,footerComponent:f.footerComponent?Ro(f.footerComponent):void 0,component:Ro(f.component),contentProps:{...f.props},footerProps:{...f.footerProps},priority:f.priority??1,dialogComponentProps:{maximizable:!1,modal:!0,closable:!0,closeOnEscape:!0,dismissableMask:!0,...f.dialogComponentProps,maximized:!1,onMaximize:()=>{h.dialogComponentProps.maximized=!0},onUnmaximize:()=>{h.dialogComponentProps.maximized=!1},onAfterHide:()=>{i(h)},pt:Kh(((d=f.dialogComponentProps)==null?void 0:d.pt)||{},{root:{onMousedown:()=>{s(h)}}})}};return r(h),t.value=f.key,o(),h}function o(){const f=e.value.find(d=>d.key===t.value),h=f==null?void 0:f.dialogComponentProps.closable;e.value.forEach(d=>{d.dialogComponentProps={...d.dialogComponentProps,closeOnEscape:d===f&&!!h}})}function l(f){const h=f.key||n();let d=e.value.find(p=>p.key===h);return d?(d.visible=!0,s(d)):d=a({...f,key:h}),d}function u(f){const{key:h}=f;if(!h){console.error("Extension dialog key is required");return}const d=h.startsWith("extension-")?h:`extension-${h}`,p=e.value.find(y=>y.key===d);return p?(p.visible=!0,s(p),p):a({...f,key:d})}function c(f){return e.value.some(h=>h.key===f)}return{dialogStack:e,riseDialog:s,showDialog:l,closeDialog:i,showExtensionDialog:u,isDialogOpen:c,activeKey:t}}),m_=Et({__name:"BrushCursor",props:{containerRef:{}},setup(e){const t=at(),n=Ce(()=>t.brushVisible?1:0),r=Ce(()=>{const c=t.brushSettings.size,f=t.brushSettings.hardness;return xr(c,f)*t.zoomRatio}),s=Ce(()=>r.value*2),i=Ce(()=>{var h;const c=(h=e.containerRef)==null?void 0:h.getBoundingClientRect(),f=(c==null?void 0:c.left)||0;return t.cursorPoint.x+t.panOffset.x-r.value-f}),a=Ce(()=>{var h;const c=(h=e.containerRef)==null?void 0:h.getBoundingClientRect(),f=(c==null?void 0:c.top)||0;return t.cursorPoint.y+t.panOffset.y-r.value-f}),o=Ce(()=>t.brushSettings.type===ct.Rect?"0%":"50%"),l=Ce(()=>t.brushPreviewGradientVisible),u=Ce(()=>{const c=t.brushSettings.size,f=t.brushSettings.hardness,h=xr(c,f),d=gs(c,f,h);if(d===1)return"rgba(255, 0, 0, 0.5)";const p=d*100,y=100,T=p+(y-p)*.5;return`radial-gradient(
    circle,
    rgba(255, 0, 0, 0.5) 0%,
    rgba(255, 0, 0, 0.5) ${p}%,
    rgba(255, 0, 0, 0.125) ${T}%,
    rgba(255, 0, 0, 0) ${y}%
  )`});return(c,f)=>(Ie(),et("div",{id:"maskEditor_brush",style:Qn({position:"absolute",opacity:n.value,width:`${s.value}px`,height:`${s.value}px`,left:`${i.value}px`,top:`${a.value}px`,borderRadius:o.value,pointerEvents:"none",zIndex:1e3})},[C("div",{id:"maskEditor_brushPreviewGradient",style:Qn({display:l.value?"block":"none",background:u.value})},null,4)],4))}}),y_=Et({__name:"PointerZone",props:{toolManager:{},panZoom:{}},setup(e){const t=at(),n=k();Ul(()=>{if(!n.value){console.error("[PointerZone] Pointer zone ref not initialized");return}t.pointerZone=n.value}),Cn(()=>t.isPanning,h=>{n.value&&(h?n.value.style.cursor="grabbing":e.toolManager.updateCursor())});const r=async h=>{await e.toolManager.handlePointerDown(h)},s=async h=>{await e.toolManager.handlePointerMove(h)},i=h=>{e.toolManager.handlePointerUp(h)},a=()=>{t.brushVisible=!1,n.value&&(n.value.style.cursor="")},o=()=>{e.toolManager.updateCursor()},l=h=>{e.panZoom.handleTouchStart(h)},u=async h=>{await e.panZoom.handleTouchMove(h)},c=h=>{e.panZoom.handleTouchEnd(h)},f=async h=>{await e.panZoom.zoom(h);const d={x:h.clientX,y:h.clientY};e.panZoom.updateCursorPosition(d)};return(h,d)=>(Ie(),et("div",{ref_key:"pointerZoneRef",ref:n,class:"w-[calc(100%-4rem-220px)] h-full",onPointerdown:r,onPointermove:s,onPointerup:i,onPointerleave:a,onPointerenter:o,onTouchstart:l,onTouchmove:u,onTouchend:c,onWheel:f,onContextmenu:d[0]||(d[0]=ms(()=>{},["prevent"]))},null,544))}}),g_={"g.save":"Save","g.saving":"Saving...","g.cancel":"Cancel","g.undo":"Undo","g.redo":"Redo","maskeditor.invert":"Invert","maskeditor.clear":"Clear"};function we(e){return g_[e]||e}const w_={class:"flex flex-col gap-3 pb-3"},v_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},x_=["min","max","step","value"],bn=Et({__name:"SliderControl",props:{label:{},min:{},max:{},step:{default:1},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t,r=s=>{const i=Number(s.target.value);n("update:modelValue",i)};return(s,i)=>(Ie(),et("div",w_,[C("span",v_,Fe(e.label),1),C("input",{type:"range",class:"maskEditor_sidePanelBrushRange",min:e.min,max:e.max,step:e.step,value:e.modelValue,onInput:r},null,40,x_)]))}}),b_={class:"flex flex-col gap-3 pb-3"},$_={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},T_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},__={class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] -mt-2 -mb-1.5"},S_=["value"],z_={value:"black"},k_={value:"white"},M_={value:"negative"},P_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},I_=["checked"],B_={class:"maskEditor_sidePanelLayerPreviewContainer"},E_={viewBox:"0 0 20 20",style:{}},A_=["disabled"],O_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},U_=["checked"],R_=["disabled"],C_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},V_={class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-[var(--p-surface-300)] dark-theme:bg-[var(--p-surface-800)]"},L_=["checked"],F_={class:"maskEditor_sidePanelLayerPreviewContainer"},G_=["src","alt"],N_=Et({__name:"ImageLayerSettingsPanel",props:{toolManager:{}},setup(e){const t=at(),n=fp(),r=k(!0),s=k(!0),i=k(!0),a=Ce(()=>{var p;return((p=t.image)==null?void 0:p.src)??""}),o=Ce(()=>t.currentTool===oe.Eraser),l=p=>{const y=p.target.checked;r.value=y;const T=t.maskCanvas;T&&(T.style.opacity=y?String(t.maskOpacity):"0")},u=p=>{const y=p.target.checked;s.value=y;const T=t.rgbCanvas;T&&(T.style.opacity=y?"1":"0")},c=p=>{const y=p.target.checked;i.value=y;const T=t.imgCanvas;T&&(T.style.opacity=y?"1":"0")},f=p=>{t.setMaskOpacity(p);const y=t.maskCanvas;y&&(y.style.opacity=String(p)),r.value=p!==0},h=async p=>{const y=p.target.value;let T;switch(y){case"white":T=Vt.White;break;case"negative":T=Vt.Negative;break;default:T=Vt.Black}t.maskBlendMode=T,await n.updateMaskColor()},d=p=>{var y;(y=e.toolManager)==null||y.setActiveLayer(p)};return(p,y)=>(Ie(),et("div",b_,[C("h3",$_,Fe(B(we)("maskEditor.layers")),1),dt(bn,{label:B(we)("maskEditor.maskOpacity"),min:0,max:1,step:.01,"model-value":B(t).maskOpacity,"onUpdate:modelValue":f},null,8,["label","model-value"]),C("span",T_,Fe(B(we)("maskEditor.maskBlendingOptions")),1),C("div",__,[C("select",{class:"maskEditor_sidePanelDropdown",value:B(t).maskBlendMode,onChange:h},[C("option",z_,Fe(B(we)("maskEditor.black")),1),C("option",k_,Fe(B(we)("maskEditor.white")),1),C("option",M_,Fe(B(we)("maskEditor.negative")),1)],40,S_)]),C("span",P_,Fe(B(we)("maskEditor.maskLayer")),1),C("div",{class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-[var(--p-surface-300)] dark-theme:bg-[var(--p-surface-800)]",style:Qn({border:B(t).activeLayer==="mask"?"2px solid #007acc":"none"})},[C("input",{type:"checkbox",class:"maskEditor_sidePanelLayerCheckbox",checked:r.value,onChange:l},null,40,I_),C("div",B_,[(Ie(),et("svg",E_,[...y[2]||(y[2]=[C("path",{class:"cls-1",d:"M1.31,5.32v9.36c0,.55.45,1,1,1h15.38c.55,0,1-.45,1-1V5.32c0-.55-.45-1-1-1H2.31c-.55,0-1,.45-1,1ZM11.19,13.44c-2.91.94-5.57-1.72-4.63-4.63.34-1.05,1.19-1.9,2.24-2.24,2.91-.94,5.57,1.72,4.63,4.63-.34,1.05-1.19-1.9-2.24,2.24Z"},null,-1)])]))]),C("button",{style:Qn([{"font-size":"12px"},{opacity:B(t).activeLayer==="mask"?"0.5":"1"}]),disabled:B(t).activeLayer==="mask",onClick:y[0]||(y[0]=T=>d("mask"))},Fe(B(we)("maskEditor.activateLayer")),13,A_)],4),C("span",O_,Fe(B(we)("maskEditor.paintLayer")),1),C("div",{class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-[var(--p-surface-300)] dark-theme:bg-[var(--p-surface-800)]",style:Qn({border:B(t).activeLayer==="rgb"?"2px solid #007acc":"none"})},[C("input",{type:"checkbox",class:"maskEditor_sidePanelLayerCheckbox",checked:s.value,onChange:u},null,40,U_),y[3]||(y[3]=C("div",{class:"maskEditor_sidePanelLayerPreviewContainer"},[C("svg",{viewBox:"0 0 20 20"},[C("path",{class:"cls-1",d:"M 17 6.965 c 0 0.235 -0.095 0.47 -0.275 0.655 l -6.51 6.52 c -0.045 0.035 -0.09 0.075 -0.135 0.11 c -0.035 -0.695 -0.605 -1.24 -1.305 -1.245 c 0.035 -0.06 0.08 -0.12 0.135 -0.17 l 6.52 -6.52 c 0.36 -0.36 0.945 -0.36 1.3 0 c 0.175 0.175 0.275 0.415 0.275 0.65 Z"}),C("path",{class:"cls-1",d:"M 9.82 14.515 c 0 2.23 -3.23 1.59 -4.82 0 c 1.65 -0.235 2.375 -1.29 3.53 -1.29 c 0.715 0 1.29 0.58 1.29 1.29 Z"})])],-1)),C("button",{style:Qn([{"font-size":"12px"},{opacity:B(t).activeLayer==="rgb"?"0.5":"1",display:o.value?"block":"none"}]),disabled:B(t).activeLayer==="rgb",onClick:y[1]||(y[1]=T=>d("rgb"))},Fe(B(we)("maskEditor.activateLayer")),13,R_)],4),C("span",C_,Fe(B(we)("maskEditor.baseImageLayer")),1),C("div",V_,[C("input",{type:"checkbox",class:"maskEditor_sidePanelLayerCheckbox",checked:i.value,onChange:c},null,40,L_),C("div",F_,[C("img",{class:"maskEditor_sidePanelImageLayerImage",src:a.value,alt:B(we)("maskEditor.baseLayerPreview")},null,8,G_)])])]))}}),D_={class:"flex flex-col gap-3 pb-3"},j_={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},W_={class:"flex flex-col gap-3 pb-3"},q_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},Y_={class:"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-[var(--p-surface-300)] dark-theme:bg-[var(--p-surface-800)]"},X_={class:"flex flex-col gap-3 pb-3"},Z_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},H_=["value"],K_=Et({__name:"BrushSettingsPanel",setup(e){const t=at(),n=u=>{t.brushSettings.type=u},r=u=>{t.rgbColor=u.target.value},s=u=>{t.setBrushSize(u)},i=u=>{t.setBrushOpacity(u)},a=u=>{t.setBrushHardness(u)},o=u=>{t.setBrushStepSize(u)},l=()=>{t.resetBrushToDefault()};return(u,c)=>(Ie(),et("div",D_,[C("h3",j_,Fe(B(we)("maskEditor.brushSettings")),1),C("button",{class:"w-45 h-7.5 border-none bg-black/20 border border-[var(--border-color)] text-[var(--input-text)] font-sans text-[15px] pointer-events-auto transition-colors duration-100 hover:bg-[var(--p-overlaybadge-outline-color)] hover:border-none",onClick:l},Fe(B(we)("maskEditor.resetToDefault")),1),C("div",W_,[C("span",q_,Fe(B(we)("maskEditor.brushShape")),1),C("div",Y_,[C("div",{class:Ua(["maskEditor_sidePanelBrushShapeCircle bg-transparent hover:bg-[var(--comfy-menu-bg)] dark-theme:hover:bg-[var(--p-surface-900)]",{active:B(t).brushSettings.type===B(ct).Arc}]),style:Qn({background:B(t).brushSettings.type===B(ct).Arc?"var(--p-button-text-primary-color)":""}),onClick:c[0]||(c[0]=f=>n(B(ct).Arc))},null,6),C("div",{class:Ua(["maskEditor_sidePanelBrushShapeSquare bg-transparent hover:bg-[var(--comfy-menu-bg)] dark-theme:hover:bg-[var(--p-surface-900)]",{active:B(t).brushSettings.type===B(ct).Rect}]),style:Qn({background:B(t).brushSettings.type===B(ct).Rect?"var(--p-button-text-primary-color)":""}),onClick:c[1]||(c[1]=f=>n(B(ct).Rect))},null,6)])]),C("div",X_,[C("span",Z_,Fe(B(we)("maskEditor.colorSelector")),1),C("input",{type:"color",value:B(t).rgbColor,onInput:r},null,40,H_)]),dt(bn,{label:B(we)("maskEditor.thickness"),min:1,max:500,step:1,"model-value":B(t).brushSettings.size,"onUpdate:modelValue":s},null,8,["label","model-value"]),dt(bn,{label:B(we)("maskEditor.opacity"),min:0,max:1,step:.01,"model-value":B(t).brushSettings.opacity,"onUpdate:modelValue":i},null,8,["label","model-value"]),dt(bn,{label:B(we)("maskEditor.hardness"),min:0,max:1,step:.01,"model-value":B(t).brushSettings.hardness,"onUpdate:modelValue":a},null,8,["label","model-value"]),dt(bn,{label:"Stepsize",min:1,max:100,step:1,"model-value":B(t).brushSettings.stepSize,"onUpdate:modelValue":o},null,8,["model-value"])]))}}),Q_={class:"flex flex-row gap-2.5 items-center min-h-6 relative"},J_={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},eS=["value"],tS=["value"],nS=Et({__name:"DropdownControl",props:{label:{},options:{},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,r=t,s=Ce(()=>n.options.map(a=>typeof a=="string"?{label:a,value:a}:a)),i=a=>{const o=a.target.value;r("update:modelValue",o)};return(a,o)=>(Ie(),et("div",Q_,[C("span",J_,Fe(e.label),1),C("select",{class:"absolute right-0 h-6 px-1.5 rounded-md border border-[var(--p-form-field-border-color)] transition-colors duration-100 bg-[var(--comfy-menu-bg)] focus:outline focus:outline-1 focus:outline-[var(--p-surface-300)] dark-theme:bg-[var(--p-surface-900)] dark-theme:focus:outline-[var(--p-button-text-primary-color)]",value:e.modelValue,onChange:i},[(Ie(!0),et(mh,null,yh(s.value,l=>(Ie(),et("option",{key:l.value,value:l.value},Fe(l.label),9,tS))),128))],40,eS)]))}}),rS={class:"flex flex-row gap-2.5 items-center min-h-6 relative"},sS={class:"text-left text-xs font-sans text-[var(--descrip-text)]"},iS={class:"maskEditor_sidePanelToggleContainer"},aS=["checked"],Ko=Et({__name:"ToggleControl",props:{label:{},modelValue:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:t}){const n=t,r=s=>{const i=s.target.checked;n("update:modelValue",i)};return(s,i)=>(Ie(),et("div",rS,[C("span",sS,Fe(e.label),1),C("label",iS,[C("input",{type:"checkbox",class:"maskEditor_sidePanelToggleCheckbox",checked:e.modelValue,onChange:r},null,40,aS),i[0]||(i[0]=C("div",{class:"maskEditor_sidePanelToggleSwitch"},null,-1))])]))}}),oS={class:"flex flex-col gap-3 pb-3"},lS={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},uS=Et({__name:"ColorSelectSettingsPanel",setup(e){const t=at(),n=Object.values(Er),r=c=>{t.setColorSelectTolerance(c)},s=c=>{t.setSelectionOpacity(c)},i=c=>{t.colorSelectLivePreview=c},a=c=>{t.applyWholeImage=c},o=c=>{t.colorComparisonMethod=c},l=c=>{t.maskBoundary=c},u=c=>{t.setMaskTolerance(c)};return(c,f)=>(Ie(),et("div",oS,[C("h3",lS,Fe(B(we)("maskEditor.colorSelectSettings")),1),dt(bn,{label:B(we)("maskEditor.tolerance"),min:0,max:255,step:1,"model-value":B(t).colorSelectTolerance,"onUpdate:modelValue":r},null,8,["label","model-value"]),dt(bn,{label:B(we)("maskEditor.selectionOpacity"),min:0,max:100,step:1,"model-value":B(t).selectionOpacity,"onUpdate:modelValue":s},null,8,["label","model-value"]),dt(Ko,{label:B(we)("maskEditor.livePreview"),"model-value":B(t).colorSelectLivePreview,"onUpdate:modelValue":i},null,8,["label","model-value"]),dt(Ko,{label:B(we)("maskEditor.applyToWholeImage"),"model-value":B(t).applyWholeImage,"onUpdate:modelValue":a},null,8,["label","model-value"]),dt(nS,{label:B(we)("maskEditor.method"),options:B(n),"model-value":B(t).colorComparisonMethod,"onUpdate:modelValue":o},null,8,["label","options","model-value"]),dt(Ko,{label:B(we)("maskEditor.stopAtMask"),"model-value":B(t).maskBoundary,"onUpdate:modelValue":l},null,8,["label","model-value"]),dt(bn,{label:B(we)("maskEditor.maskTolerance"),min:0,max:255,step:1,"model-value":B(t).maskTolerance,"onUpdate:modelValue":u},null,8,["label","model-value"])]))}}),cS={class:"flex flex-col gap-3 pb-3"},fS={class:"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5"},hS=Et({__name:"PaintBucketSettingsPanel",setup(e){const t=at(),n=s=>{t.setPaintBucketTolerance(s)},r=s=>{t.setFillOpacity(s)};return(s,i)=>(Ie(),et("div",cS,[C("h3",fS,Fe(B(we)("maskEditor.paintBucketSettings")),1),dt(bn,{label:B(we)("maskEditor.tolerance"),min:0,max:255,step:1,"model-value":B(t).paintBucketTolerance,"onUpdate:modelValue":n},null,8,["label","model-value"]),dt(bn,{label:B(we)("maskEditor.fillOpacity"),min:0,max:100,step:1,"model-value":B(t).fillOpacity,"onUpdate:modelValue":r},null,8,["label","model-value"])]))}}),pS={class:"maskEditor_sidePanel"},dS={class:"maskEditor_sidePanelContainer"},mS=Et({__name:"SettingsPanelContainer",setup(e){const t=Ce(()=>{const n=at().currentTool;return n===oe.MaskBucket?hS:n===oe.MaskColorFill?uS:K_});return(n,r)=>(Ie(),et("div",pS,[C("div",dS,[(Ie(),ws(Bm(t.value)))])]))}}),yS={class:"flex flex-col gap-3 pb-3 h-full !items-stretch bg-[var(--comfy-menu-bg)] overflow-y-auto w-55 px-2.5"},gS={class:"w-full min-h-full"},wS=Et({__name:"SidePanel",props:{toolManager:{}},setup(e){return(t,n)=>(Ie(),et("div",yS,[C("div",gS,[dt(mS),n[0]||(n[0]=C("div",{class:"w-full h-0.5 bg-[var(--border-color)] mt-6 mb-1.5"},null,-1)),dt(N_,{"tool-manager":e.toolManager},null,8,["tool-manager"])])]))}}),vS={[oe.MaskPen]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M10.97,15.98v14.04c0,.825.675,1.5,1.5,1.5h23.07c.825,0,1.5-.675,1.5-1.5V15.98c0-.825-.675-1.5-1.5-1.5H12.47c-.825,0-1.5.675-1.5,1.5ZM25.79,28.16c-4.365,1.41-8.355-2.58-6.945-6.945.51-1.575,1.785-2.85,3.36-3.36,4.365-1.41,8.355,2.58,6.945,6.945-.51,1.575-1.785,2.85-3.36,3.36Z"/>
    </svg>
  `,[oe.Eraser]:`
    <svg viewBox="0 0 44 44">
      <g>
        <rect class="cls-2" x="16.68" y="10" width="10.63" height="24" rx="1.16" ry="1.16" transform="translate(22 -9.11) rotate(45)"/>
        <path class="cls-1" d="M17.27,34.27c-.42,0-.85-.16-1.17-.48l-5.88-5.88c-.31-.31-.48-.73-.48-1.17s.17-.86.48-1.17l15.34-15.34c.62-.62,1.72-.62,2.34,0l5.88,5.88c.65.65.65,1.7,0,2.34l-15.34,15.34c-.32.32-.75.48-1.17.48ZM26.73,10.73c-.18,0-.34.07-.46.19l-15.34,15.34c-.12.12-.19.29-.19.46s.07.34.19.46l5.88,5.88c.26.26.67.26.93,0l15.34-15.34c.26-.26.26-.67,0-.93l-5.88-5.88c-.12-.12-.29-.19-.46-.19Z"/>
      </g>
      <path class="cls-3" d="M20.33,11.03h8.32c.64,0,1.16.52,1.16,1.16v15.79h-10.63v-15.79c0-.64.52-1.16,1.16-1.16Z" transform="translate(20.97 -11.61) rotate(45)"/>
    </svg>
  `,[oe.MaskBucket]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M33.4,21.76l-11.42,11.41-.04.05c-.61.61-1.6.61-2.21,0l-8.91-8.91c-.61-.61-.61-1.6,0-2.21l.04-.05.3-.29h22.24Z"/>
      <path class="cls-1" d="M20.83,34.17c-.55,0-1.07-.21-1.46-.6l-8.91-8.91c-.8-.8-.8-2.11,0-2.92l11.31-11.31c.8-.8,2.11-.8,2.92,0l8.91,8.91c.39.39.6.91.6,1.46s-.21,1.07-.6,1.46l-11.31,11.31c-.39.39-.91.6-1.46.6ZM23.24,10.83c-.27,0-.54.1-.75.31l-11.31,11.31c-.41.41-.41,1.09,0,1.5l8.91,8.91c.4.4,1.1.4,1.5,0l11.31-11.31c.2-.2.31-.47.31-.75s-.11-.55-.31-.75l-8.91-8.91c-.21-.21-.48-.31-.75-.31Z"/>
      <path class="cls-1" d="M34.28,26.85c0,.84-.68,1.52-1.52,1.52s-1.52-.68-1.52-1.52,1.52-2.86,1.52-2.86c0,0,1.52,2.02,1.52,2.86Z"/>
    </svg>
  `,[oe.MaskColorFill]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M30.29,13.72c-1.09-1.1-2.85-1.09-3.94,0l-2.88,2.88-.75-.75c-.2-.19-.51-.19-.71,0-.19.2-.19.51,0,.71l1.4,1.4-9.59,9.59c-.35.36-.54.82-.54,1.32,0,.14,0,.28.05.41-.05.04-.1.08-.15.13-.39.39-.39,1.01,0,1.4.38.39,1.01.39,1.4,0,.04-.04.08-.09.11-.13.14.04.3.06.45.06.5,0,.97-.19,1.32-.55l9.59-9.59,1.38,1.38c.1.09.22.14.35.14s.26-.05.35-.14c.2-.2.2-.52,0-.71l-.71-.72,2.88-2.89c1.08-1.08,1.08-2.85-.01-3.94ZM19.43,25.82h-2.46l7.15-7.15,1.23,1.23-5.92,5.92Z"/>
    </svg>
  `,[oe.PaintPen]:`
    <svg viewBox="0 0 44 44">
      <path class="cls-1" d="M34,13.93c0,.47-.19.94-.55,1.31l-13.02,13.04c-.09.07-.18.15-.27.22-.07-1.39-1.21-2.48-2.61-2.49.07-.12.16-.24.27-.34l13.04-13.04c.72-.72,1.89-.72,2.6,0,.35.35.55.83.55,1.3Z"/>
      <path class="cls-1" d="M19.64,29.03c0,4.46-6.46,3.18-9.64,0,3.3-.47,4.75-2.58,7.06-2.58,1.43,0,2.58,1.16,2.58,2.58Z"/>
    </svg>
  `},xS={class:"h-full z-[8888] flex flex-col justify-between bg-[var(--comfy-menu-bg)]"},bS={class:"flex flex-col"},$S=["onClick"],TS=["innerHTML"],_S=["title"],SS={class:"text-sm text-[var(--p-button-text-secondary-color)]"},zS={class:"text-xs text-[var(--p-button-text-secondary-color)]"},kS=Et({__name:"ToolPanel",props:{toolManager:{}},setup(e){const t=at(),n=o=>{e.toolManager.switchTool(o)},r=Ce(()=>t.currentTool),s=Ce(()=>`${Math.round(t.displayZoomRatio*100)}%`),i=Ce(()=>{const o=t.image;return o?`${o.width}x${o.height}`:" "}),a=()=>{t.resetZoom()};return(o,l)=>(Ie(),et("div",xS,[C("div",bS,[(Ie(!0),et(mh,null,yh(B(A1),u=>(Ie(),et("div",{key:u,class:Ua(["maskEditor_toolPanelContainer hover:bg-[var(--p-surface-300)] dark-theme:hover:bg-[var(--p-surface-800)]",{maskEditor_toolPanelContainerSelected:r.value===u}]),onClick:c=>n(u)},[C("div",{class:"flex items-center justify-center",innerHTML:B(vS)[u]},null,8,TS),l[0]||(l[0]=C("div",{class:"maskEditor_toolPanelIndicator"},null,-1))],10,$S))),128))]),C("div",{class:"flex flex-col items-center cursor-pointer rounded-md mb-2 transition-colors duration-200 hover:bg-[var(--p-surface-300)] dark-theme:hover:bg-[var(--p-surface-800)]",title:B(we)("maskEditor.clickToResetZoom"),onClick:a},[C("span",SS,Fe(s.value),1),C("span",zS,Fe(i.value),1)],8,_S)]))}}),MS={class:"maskEditor-ui-container flex min-h-0 flex-1 flex-col"},PS={class:"flex min-h-0 flex-1 overflow-hidden"},IS=Et({__name:"MaskEditorContent",props:{node:{}},setup(e){const t=at(),n=gu(),r=d_(),s=j1(),i=k(),a=k(),o=k(),l=k(),u=k(),c=k(),f=k(),h=k(),d=k(),p=k(!1),y=V1(),T=W1(),z=p_(y,T);let U=null;const J=N=>{N.ctrlKey&&N.preventDefault()},j=async()=>{var N,E;if(!i.value){console.error("[MaskEditorContent] Cannot initialize - missing required refs");return}if(!o.value||!l.value||!u.value||!a.value||!f.value){console.error("[MaskEditorContent] Cannot initialize - missing canvas refs");return}t.maskCanvas=l.value,t.rgbCanvas=u.value,t.imgCanvas=o.value,t.canvasContainer=a.value,t.canvasBackground=f.value;try{await s.loadFromNode(e.node);const W=await C1().loadImages();await T.initializeCanvasPanZoom(W,i.value,(N=h.value)==null?void 0:N.$el,(E=d.value)==null?void 0:E.$el),t.canvasHistory.saveInitialState(),z.brushDrawing&&(await z.brushDrawing.initGPUResources(),c.value&&z.brushDrawing.initPreviewCanvas&&(c.value.width=l.value.width,c.value.height=l.value.height,z.brushDrawing.initPreviewCanvas(c.value))),p.value=!0}catch(G){console.error("[MaskEditorContent] Initialization failed:",G),r.closeDialog()}};return Ul(()=>{y.addListeners(),i.value&&(U=new ResizeObserver(async()=>{T&&await T.invalidatePanZoom()}),U.observe(i.value)),j()}),Em(()=>{z.brushDrawing.saveBrushSettings(),y==null||y.removeListeners(),U&&(U.disconnect(),U=null),t.canvasHistory.clearStates(),t.resetState(),n.reset()}),(N,E)=>(Ie(),et("div",{ref_key:"containerRef",ref:i,class:"maskEditor-dialog-root flex h-full w-full flex-col",onContextmenu:E[4]||(E[4]=ms(()=>{},["prevent"])),onDragstart:J},[C("div",{id:"maskEditorCanvasContainer",ref_key:"canvasContainerRef",ref:a,onContextmenu:E[3]||(E[3]=ms(()=>{},["prevent"]))},[C("canvas",{ref_key:"imgCanvasRef",ref:o,class:"absolute top-0 left-0 w-full h-full z-0",onContextmenu:E[0]||(E[0]=ms(()=>{},["prevent"]))},null,544),C("canvas",{ref_key:"rgbCanvasRef",ref:u,class:"absolute top-0 left-0 w-full h-full z-10",onContextmenu:E[1]||(E[1]=ms(()=>{},["prevent"]))},null,544),C("canvas",{ref_key:"maskCanvasRef",ref:l,class:"absolute top-0 left-0 w-full h-full z-30",onContextmenu:E[2]||(E[2]=ms(()=>{},["prevent"]))},null,544),C("canvas",{ref_key:"gpuCanvasRef",ref:c,class:Ua(["absolute top-0 left-0 w-full h-full pointer-events-none",{"z-20":B(t).activeLayer==="rgb","z-40":B(t).activeLayer==="mask"}])},null,2),C("div",{ref_key:"canvasBackgroundRef",ref:f,class:"bg-white w-full h-full"},null,512)],544),C("div",MS,[C("div",PS,[p.value?(Ie(),ws(kS,{key:0,ref_key:"toolPanelRef",ref:h,"tool-manager":B(z)},null,8,["tool-manager"])):pi("",!0),p.value?(Ie(),ws(y_,{key:1,"tool-manager":B(z),"pan-zoom":B(T)},null,8,["tool-manager","pan-zoom"])):pi("",!0),p.value?(Ie(),ws(wS,{key:2,ref_key:"sidePanelRef",ref:d,"tool-manager":B(z)},null,8,["tool-manager"])):pi("",!0)])]),p.value?(Ie(),ws(m_,{key:0,"container-ref":i.value},null,8,["container-ref"])):pi("",!0)],544))}}),BS=Am(IS,[["__scopeId","data-v-6c02c403"]]),ES={class:"mask-editor-app"},AS=Et({__name:"MaskEditorApp",props:{nodeData:{}},setup(e){const t=e,n=k(null);return Ul(()=>{t.nodeData&&(n.value=t.nodeData)}),(r,s)=>(Ie(),et("div",ES,[n.value?(Ie(),ws(BS,{key:0,node:n.value},null,8,["node"])):pi("",!0)]))}});function OS(e,t={}){const n=Om(AS,{nodeData:t.nodeData,...t.props}),r=Um();return n.use(r),n.mount(e),n}window.createMaskEditorApp=OS;
