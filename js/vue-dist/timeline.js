import{d as je,r as z,c as ve,b as xe,k as Ce,a as Se,w as Xe,f as L,h as w,C as k,j as o,D as Pe,l as G,u as l,z as ie,E as _e,t as _,_ as Te,y as Ye,q as ye,p as Ae,F as se,G as Ie,H as C,I as Ue,s as me,i as be,A as Re,B as De}from"./assets/_plugin-vue_export-helper.js";const ze=je("timeline",()=>{const j=z({width:1280,height:720,fps:30,duration:5,total_frames:150,mask_expansion:0,mask_feather:0}),a=z([]),n=z(-1),M=z(0),A=z(0),S=z(!1),F=z({enabled:!1,drawing:!1,erase:!1,brush:20}),J=z({enabled:!1,data:null}),O=z({enabled:!1,drawing:!1,brush:30,blurType:"gaussian"}),D=ve(()=>n.value>=0&&n.value<a.value.length?a.value[n.value]:null),T=ve(()=>a.value.filter(r=>r.type==="foreground")),Z=ve(()=>a.value.find(r=>r.type==="background"));function Y(r){Object.assign(j.value,r),r.fps&&r.duration&&(j.value.total_frames=Math.floor(r.fps*r.duration))}function V(r){a.value.push(r),n.value=a.value.length-1}function Q(r){r>=0&&r<a.value.length&&(a.value.splice(r,1),n.value>=a.value.length&&(n.value=a.value.length-1))}function le(){a.value=[],n.value=-1}function ue(r){r>=0&&r<a.value.length&&(n.value=r)}function I(r,e){r>=0&&r<a.value.length&&Object.assign(a.value[r],e)}function K(r){M.value=Math.max(0,Math.min(r,j.value.duration)),A.value=Math.floor(M.value*j.value.fps)}function ee(r){A.value=Math.max(0,Math.min(r,j.value.total_frames-1)),M.value=A.value/j.value.fps}let P=null,N=0;function B(){S.value=!S.value,S.value?ce():te()}function ce(){N=performance.now(),q()}function q(){if(!S.value)return;const r=performance.now(),e=(r-N)/1e3;N=r;let d=M.value+e;d>=j.value.duration&&(d=0),K(d),P=requestAnimationFrame(q)}function te(){P!==null&&(cancelAnimationFrame(P),P=null)}function de(){S.value=!1,te(),K(0)}function pe(r){if(!r)return;const e=r.project||{};Y({width:e.width||1280,height:e.height||720,fps:e.fps||30,duration:e.duration||5,total_frames:e.total_frames||150,mask_expansion:e.mask_expansion||0,mask_feather:e.mask_feather||0}),a.value=(r.layers||[]).map(d=>({id:d.id,name:d.name,type:d.type,image_data:d.image_data,x:d.x||0,y:d.y||0,scale:d.scale||1,rotation:d.rotation||0,opacity:d.opacity!==void 0?d.opacity:1,rotationX:d.rotationX||0,rotationY:d.rotationY||0,rotationZ:d.rotationZ||0,anchorX:d.anchorX||0,anchorY:d.anchorY||0,perspective:d.perspective||1e3,mask_size:d.mask_size||0,customMask:d.customMask,bezierPath:d.bezierPath,usePathAnimation:d.usePathAnimation||!1,keyframes:d.keyframes||{},bg_mode:d.bg_mode||"fit"}))}function ne(){const r=D.value;if(!r)return;const e=["x","y","scale","rotation","opacity","mask_size","rotationX","rotationY","rotationZ","anchorX","anchorY","perspective"];r.keyframes||(r.keyframes={});for(const d of e){let c=r[d];c===void 0&&(d==="scale"||d==="opacity"?c=1:d==="perspective"?c=1e3:c=0),r.keyframes[d]||(r.keyframes[d]=[]),r.keyframes[d]=r.keyframes[d].filter(h=>h.time!==M.value),r.keyframes[d].push({time:M.value,value:c}),r.keyframes[d].sort((h,v)=>h.time-v.time)}}function re(){const r=D.value;if(!r||!r.keyframes)return;const e=["x","y","scale","rotation","opacity","mask_size"];for(const d of e)r.keyframes[d]&&(r.keyframes[d]=r.keyframes[d].filter(c=>c.time!==M.value))}function W(){const r=D.value;r&&(r.keyframes={})}function X(){return{project:{...j.value},layers:a.value.map(r=>({id:r.id,name:r.name,type:r.type,image_data:r.image_data,x:r.x,y:r.y,scale:r.scale,rotation:r.rotation,opacity:r.opacity,rotationX:r.rotationX,rotationY:r.rotationY,rotationZ:r.rotationZ,anchorX:r.anchorX,anchorY:r.anchorY,perspective:r.perspective,mask_size:r.mask_size,customMask:r.customMask,bezierPath:r.bezierPath,usePathAnimation:r.usePathAnimation,keyframes:r.keyframes,bg_mode:r.bg_mode}))}}return{project:j,layers:a,currentLayerIndex:n,currentTime:M,currentFrame:A,isPlaying:S,maskMode:F,pathMode:J,extractMode:O,currentLayer:D,foregroundLayers:T,backgroundLayer:Z,setProject:Y,addLayer:V,removeLayer:Q,clearLayers:le,selectLayer:ue,updateLayer:I,setCurrentTime:K,setCurrentFrame:ee,togglePlayback:B,stopPlayback:de,addKeyframe:ne,deleteKeyframe:re,clearAllKeyframes:W,loadAnimation:pe,exportAnimation:X}}),Ve=["width","height"],Ke=["width","height"],Fe={class:"canvas-info"},Be={key:0},We={key:0,class:"gpu-badge"},$e={key:1},Ee=xe({__name:"CanvasPreview",setup(j){const a=ze(),n=z(),M=z(),A=z();let S=!1,F=0,J=0,O=0,D=0;const T=z(!1);let Z=!1,Y=null;const V=new Map,Q=new Map;Ce(async()=>{n.value&&(Y=n.value.getContext("2d",{alpha:!1,desynchronized:!0})),await le(),I()}),Se(()=>{V.clear(),ue()});async function le(){console.log("[Timeline GPU] GPU rendering disabled, using Canvas 2D for stability"),T.value=!1}function ue(){for(const t of Q.values())t.destroy();Q.clear()}function I(){Z||(Z=!0,requestAnimationFrame(()=>{Z=!1,ce()}))}Xe(()=>[a.layers,a.currentLayer,a.currentTime],()=>{I()},{deep:!0});function K(){{q();return}}function ee(t){if(t.img)return t.img;if(!t.image_data)return null;const s=t.id;if(V.has(s)){const i=V.get(s);return i.complete?(t.img=i,i):null}const u=new Image;return u.onload=()=>{t.img=u,I()},u.src=t.image_data,V.set(s,u),null}function P(t,s,u){if(!t||t.length===0)return u;const i=[...t].sort((f,p)=>f.time-p.time);if(s<=i[0].time)return i[0].value;if(s>=i[i.length-1].time)return i[i.length-1].value;for(let f=0;f<i.length-1;f++)if(s>=i[f].time&&s<=i[f+1].time){const p=(s-i[f].time)/(i[f+1].time-i[f].time);return i[f].value+(i[f+1].value-i[f].value)*p}return u}function N(t,s,u){if(!t||t.length<2)return null;const i=s/u,p=t.length-1,g=Math.min(Math.floor(i*p),p-1),b=i*p-g,y=t[g],m=t[g+1];if(!y||!m)return null;const R=y.cp2x??y.x+(m.x-y.x)/3,$=y.cp2y??y.y+(m.y-y.y)/3,oe=m.cp1x??y.x+(m.x-y.x)*2/3,he=m.cp1y??y.y+(m.y-y.y)*2/3,E=1-b,H=E*E,we=H*E,ge=b*b,Me=ge*b;return{x:we*y.x+3*H*b*R+3*E*ge*oe+Me*m.x,y:we*y.y+3*H*b*$+3*E*ge*he+Me*m.y}}function B(t){const s=a.currentTime,u=t.keyframes||{};let i=P(u.x,s,t.x||0),f=P(u.y,s,t.y||0);if(t.usePathAnimation&&t.bezierPath&&t.bezierPath.length>=2){const p=N(t.bezierPath,s,a.project.duration);p&&(i=p.x,f=p.y)}return{x:i,y:f,scale:P(u.scale,s,t.scale||1),rotation:P(u.rotation,s,t.rotation||0),opacity:P(u.opacity,s,t.opacity??1),mask_size:P(u.mask_size,s,t.mask_size||0),rotationX:P(u.rotationX,s,t.rotationX||0),rotationY:P(u.rotationY,s,t.rotationY||0),rotationZ:P(u.rotationZ,s,t.rotationZ||0),anchorX:P(u.anchorX,s,t.anchorX||0),anchorY:P(u.anchorY,s,t.anchorY||0),perspective:P(u.perspective,s,t.perspective||1e3)}}function ce(){if(T.value){K();return}q()}function q(){var s;if(!n.value||!Y)return;Y.fillStyle="#000",Y.fillRect(0,0,a.project.width,a.project.height);const t=a.layers.find(u=>u.type==="background");t&&de(Y,t),a.layers.filter(u=>u.type!=="background").forEach(u=>{pe(Y,u)}),a.pathMode.enabled&&((s=a.currentLayer)!=null&&s.bezierPath)&&te(Y,a.currentLayer.bezierPath)}function te(t,s){if(!s||s.length===0)return;const u=a.project.width/2,i=a.project.height/2;t.save(),t.strokeStyle="#ff6b6b",t.lineWidth=2,t.setLineDash([5,5]),t.beginPath(),t.moveTo(u+s[0].x,i+s[0].y);for(let f=1;f<s.length;f++){const p=s[f-1],g=s[f],b=p.cp2x??p.x+(g.x-p.x)/3,y=p.cp2y??p.y+(g.y-p.y)/3,m=g.cp1x??p.x+(g.x-p.x)*2/3,R=g.cp1y??p.y+(g.y-p.y)*2/3;t.bezierCurveTo(u+b,i+y,u+m,i+R,u+g.x,i+g.y)}t.stroke(),t.setLineDash([]),s.forEach((f,p)=>{t.beginPath(),t.arc(u+f.x,i+f.y,6,0,Math.PI*2),t.fillStyle=p===0?"#4ecdc4":p===s.length-1?"#ff6b6b":"#ffe66d",t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.stroke()}),t.restore()}function de(t,s){const u=ee(s);if(!u)return;const i=B(s);t.save(),t.globalAlpha=i.opacity;const f=s.bg_mode||"fit",p=a.project.width,g=a.project.height,b=u.width,y=u.height;let m=1;f==="fit"?m=Math.min(p/b,g/y):f==="fill"?m=Math.max(p/b,g/y):f==="stretch"&&(m=Math.min(p/b,g/y)),t.translate(p/2+i.x,g/2+i.y),t.rotate(i.rotation*Math.PI/180),t.scale(i.scale*m,i.scale*m),t.drawImage(u,-b/2,-y/2,b,y),s===a.currentLayer&&(t.strokeStyle="#3a7bc8",t.lineWidth=2/(i.scale*m),t.strokeRect(-b/2-2,-y/2-2,b+4,y+4)),t.restore()}function pe(t,s){const u=ee(s);if(!u)return;const i=B(s),f=u.width,p=u.height;if(t.save(),t.translate(a.project.width/2+i.x,a.project.height/2+i.y),i.rotationX!==0||i.rotationY!==0){const y=i.perspective||1e3,m=i.rotationX*Math.PI/180,R=i.rotationY*Math.PI/180,$=Math.cos(m),oe=Math.sin(m),he=Math.cos(R),E=Math.sin(R),H=1/(1+(E*f/2+oe*p/2)/y);t.transform(he*H,oe*E*H,0,$*H,0,0)}t.rotate(i.rotation*Math.PI/180),t.scale(i.scale,i.scale),t.globalAlpha=i.opacity;const g=(i.anchorX||0)*f,b=(i.anchorY||0)*p;if(s.maskCanvas&&(t.save(),t.globalCompositeOperation="destination-in",t.drawImage(s.maskCanvas,-f/2-g,-p/2-b,f,p),t.restore()),t.drawImage(u,-f/2-g,-p/2-b,f,p),s===a.currentLayer&&s.img){t.strokeStyle="#3a7bc8",t.lineWidth=2/i.scale;const y=s.img.width,m=s.img.height;t.strokeRect(-y/2-2,-m/2-2,y+4,m+4),t.fillStyle="#3a7bc8",[[-y/2,-m/2],[y/2,-m/2],[y/2,m/2],[-y/2,m/2]].forEach(([$,oe])=>{t.fillRect($-4/i.scale,oe-4/i.scale,8/i.scale,8/i.scale)})}if(i.mask_size>0){t.strokeStyle="#3ac88e",t.lineWidth=2/i.scale,t.setLineDash([5/i.scale,5/i.scale]);const y=s.img?s.img.width:512,m=s.img?s.img.height:512,R=y*i.mask_size,$=m*i.mask_size;t.strokeRect(-R/2,-$/2,R,$),t.setLineDash([])}t.restore()}function ne(){return T.value?M.value||null:n.value||null}function re(t){const s=ne();if(!s)return{x:0,y:0};const u=s.getBoundingClientRect(),i=a.project.width/u.width,f=a.project.height/u.height;return{x:(t.clientX-u.left)*i,y:(t.clientY-u.top)*f}}let W=!1,X=null,r=!1,e=-1;function d(t){var i;if((i=ne())==null||i.focus(),t.shiftKey,t.altKey,!a.currentLayer)return;const s=re(t);if(a.maskMode.enabled){W=!0,h(),v(s.x,s.y);return}if(a.pathMode.enabled){x(s);return}S=!0,F=s.x,J=s.y;const u=B(a.currentLayer);O=u.x,D=u.y}function c(t){const s=re(t);if(W&&a.maskMode.enabled){v(s.x,s.y);return}if(r&&e>=0){fe(s);return}if(!S||!a.currentLayer)return;let u=s.x-F,i=s.y-J;t.shiftKey&&(Math.abs(u)>Math.abs(i)?i=0:u=0),a.updateLayer(a.currentLayerIndex,{x:O+u,y:D+i})}function h(){const t=a.currentLayer;!t||!t.img||(t.maskCanvas?X=t.maskCanvas.getContext("2d"):(t.maskCanvas=document.createElement("canvas"),t.maskCanvas.width=t.img.width,t.maskCanvas.height=t.img.height,X=t.maskCanvas.getContext("2d"),X&&(X.fillStyle="white",X.fillRect(0,0,t.maskCanvas.width,t.maskCanvas.height))))}function v(t,s){const u=a.currentLayer;if(!u||!u.img||!X||!u.maskCanvas)return;const i=B(u),f=a.project.width/2+i.x,p=a.project.height/2+i.y,g=(t-f)/i.scale+u.img.width/2,b=(s-p)/i.scale+u.img.height/2,y=a.maskMode.brush||20;X.beginPath(),X.arc(g,b,y,0,Math.PI*2),X.fillStyle=a.maskMode.erase?"black":"white",X.fill(),I()}function x(t,s){const u=a.currentLayer;if(!u)return;u.bezierPath||(u.bezierPath=[]);const i=U(t);if(i>=0)e=i,r=!0;else{const f=a.project.width/2,p=a.project.height/2;u.bezierPath.push({x:t.x-f,y:t.y-p}),u.bezierPath.length>=2&&(u.usePathAnimation=!0),I()}}function U(t){const s=a.currentLayer;if(!s||!s.bezierPath)return-1;const u=a.project.width/2,i=a.project.height/2,f=10;for(let p=0;p<s.bezierPath.length;p++){const g=s.bezierPath[p],b=g.x+u-t.x,y=g.y+i-t.y;if(Math.sqrt(b*b+y*y)<f)return p}return-1}function fe(t){const s=a.currentLayer;if(!s||!s.bezierPath||e<0)return;const u=a.project.width/2,i=a.project.height/2;s.bezierPath[e].x=t.x-u,s.bezierPath[e].y=t.y-i,I()}function ae(){S=!1,W=!1,r=!1,e=-1}function ke(t){if(!a.currentLayer)return;const s=t.deltaY>0?-.05:.05;if(t.shiftKey){const u=(a.currentLayer.rotation||0)+(s>0?5:-5);a.updateLayer(a.currentLayerIndex,{rotation:u})}else if(t.altKey){const u=Math.max(0,Math.min(1,(a.currentLayer.opacity||1)+s));a.updateLayer(a.currentLayerIndex,{opacity:u})}else{const u=Math.max(.1,Math.min(5,(a.currentLayer.scale||1)+s));a.updateLayer(a.currentLayerIndex,{scale:u})}}function Le(t){if(!a.currentLayer)return;const s=t.shiftKey?10:1;switch(t.key){case"ArrowLeft":a.updateLayer(a.currentLayerIndex,{x:a.currentLayer.x-s}),t.preventDefault();break;case"ArrowRight":a.updateLayer(a.currentLayerIndex,{x:a.currentLayer.x+s}),t.preventDefault();break;case"ArrowUp":a.updateLayer(a.currentLayerIndex,{y:a.currentLayer.y-s}),t.preventDefault();break;case"ArrowDown":a.updateLayer(a.currentLayerIndex,{y:a.currentLayer.y+s}),t.preventDefault();break;case"r":case"R":a.updateLayer(a.currentLayerIndex,{x:0,y:0,scale:1,rotation:0,opacity:1}),t.preventDefault();break;case"Delete":case"Backspace":confirm("删除当前图层?")&&a.removeLayer(a.currentLayerIndex),t.preventDefault();break}}return(t,s)=>(w(),L("div",{class:"canvas-preview",ref_key:"containerRef",ref:A},[k(o("canvas",{ref_key:"gpuCanvasRef",ref:M,width:l(a).project.width,height:l(a).project.height,onMousedown:d,onMousemove:c,onMouseup:ae,onMouseleave:ae,onWheel:G(ke,["prevent"]),onContextmenu:s[0]||(s[0]=G(()=>{},["prevent"])),tabindex:"0",onKeydown:Le},null,40,Ve),[[Pe,T.value]]),k(o("canvas",{ref_key:"canvasRef",ref:n,width:l(a).project.width,height:l(a).project.height,onMousedown:d,onMousemove:c,onMouseup:ae,onMouseleave:ae,onWheel:G(ke,["prevent"]),onContextmenu:s[1]||(s[1]=G(()=>{},["prevent"])),tabindex:"0",onKeydown:Le},null,40,Ke),[[Pe,!T.value]]),o("div",Fe,[l(a).currentLayer?(w(),L("span",Be,[T.value?(w(),L("span",We,"GPU")):ie("",!0),_e(" Layer "+_(l(a).currentLayerIndex+1)+" | X:"+_(Math.round(l(a).currentLayer.x||0))+" Y:"+_(Math.round(l(a).currentLayer.y||0))+" S:"+_((l(a).currentLayer.scale||1).toFixed(2))+" R:"+_(Math.round(l(a).currentLayer.rotation||0))+"° ",1)])):(w(),L("span",$e,"No layer selected"))])],512))}}),Ge=Te(Ee,[["__scopeId","data-v-2bc42b12"]]),Oe={class:"root"},Ze={class:"header"},Ne={class:"header-left"},qe={class:"meta"},He={class:"header-center"},Je={class:"time"},Qe={class:"left"},et=["disabled"],tt=["disabled"],nt={class:"center"},rt={class:"right"},at={class:"panel-title"},ot={class:"prop-group"},st={class:"prop-label"},it={key:0,class:"prop-row"},lt={class:"prop-row"},ut={class:"prop-row"},ct={class:"prop-group"},dt={class:"prop-row"},pt={class:"prop-row"},ft={class:"prop-row"},yt={key:0,class:"prop-group"},mt={class:"prop-row"},vt={class:"prop-row"},ht={class:"prop-row"},gt={key:1,class:"prop-group"},bt={class:"prop-row"},kt={class:"prop-row"},Lt={key:2,class:"prop-group"},wt={class:"prop-row"},Mt={key:0,class:"prop-row"},Pt={style:{color:"#888"}},xt={class:"footer"},Ct={class:"layers"},_t={class:"layers-body"},zt=["onClick"],jt={class:"layer-name"},St=["onClick"],Xt={class:"ruler"},Tt={class:"tracks-body"},Yt=["onClick"],At=["onClick","onContextmenu","title"],It={class:"time-indicator"},Ut=xe({__name:"TimelineApp",props:{node:{}},setup(j){const a=j,n=ze(),M=z(),A=z();let S="foreground",F=!1;const J=ve(()=>Math.ceil(n.project.duration)+1);function O(r){const e=Math.floor(r/60),d=Math.floor(r%60),c=Math.floor(r%1*n.project.fps);return String(e).padStart(2,"0")+":"+String(d).padStart(2,"0")+":"+String(c).padStart(2,"0")}function D(r){var c;const e=[],d=["x","y","scale","rotation","opacity","mask_size"];for(const h of d){const v=((c=r.keyframes)==null?void 0:c[h])||[];for(const x of v)e.push({t:x.time,p:h,v:x.value})}return e}function T(r){if(!A.value)return 0;const e=A.value.getBoundingClientRect();return Math.max(0,Math.min(1,(r.clientX-e.left)/e.width))*n.project.duration}function Z(r){F=!0,n.setCurrentTime(T(r))}function Y(r){F&&n.setCurrentTime(T(r))}function V(){F=!1}function Q(r,e){n.selectLayer(r),n.setCurrentTime(T(e))}function le(r){n.currentLayer&&(n.setCurrentTime(T(r)),n.addKeyframe())}function ue(r){n.setCurrentTime(r)}function I(r,e){r.keyframes&&r.keyframes[e.p]&&(r.keyframes[e.p]=r.keyframes[e.p].filter(d=>d.time!==e.t))}function K(){var U;if(!((U=a.node)!=null&&U.widgets))return;const r=fe=>a.node.widgets.find(ae=>ae.name===fe),e=n.exportAnimation(),d=r("layers_keyframes");d&&(d.value=JSON.stringify(e.layers));const c=r("width");c&&(c.value=n.project.width);const h=r("height");h&&(h.value=n.project.height);const v=r("fps");v&&(v.value=n.project.fps);const x=r("total_frames");x&&(x.value=n.project.total_frames)}function ee(){K();const r=document.querySelector(".ae-timeline-dialog");r&&r.close()}function P(){n.addKeyframe()}function N(){n.deleteKeyframe()}function B(){n.maskMode.enabled=!n.maskMode.enabled}function ce(){n.pathMode.enabled=!n.pathMode.enabled}function q(){n.currentLayer&&(n.currentLayer.bezierPath=[],n.currentLayer.usePathAnimation=!1)}function te(){var r;S="foreground",(r=M.value)==null||r.click()}function de(){var r;S="background",(r=M.value)==null||r.click()}function pe(r){const e=r.target.files;e&&(Array.from(e).forEach((d,c)=>{const h=new FileReader;h.onload=v=>{var U;const x=(U=v.target)==null?void 0:U.result;n.addLayer({id:"uploaded_"+Date.now()+"_"+c,name:d.name.replace(/\.[^/.]+$/,""),type:S,image_data:x,x:0,y:0,scale:1,rotation:0,opacity:1,mask_size:0,keyframes:{},bg_mode:"fit"})},h.readAsDataURL(d)}),M.value&&(M.value.value=""))}function ne(){W(-1)}function re(){W(1)}function W(r){const e=n.currentLayerIndex;if(e<0)return;const d=e+r;if(d>=0&&d<n.layers.length){const c=n.layers[e];n.layers.splice(e,1),n.layers.splice(d,0,c),n.selectLayer(d)}}function X(){n.currentLayer&&n.updateLayer(n.currentLayerIndex,{x:0,y:0,scale:1,rotation:0,opacity:1})}return Ce(()=>{var d,c,h,v;if(!a.node)return;n.clearLayers();const r=x=>{var U;return(U=a.node.widgets)==null?void 0:U.find(fe=>fe.name===x)},e=r("layers_keyframes");if(e!=null&&e.value)try{const x=JSON.parse(e.value);Array.isArray(x)&&x.length>0&&n.loadAnimation({layers:x})}catch(x){console.error("[Timeline] Failed to load layers:",x)}n.setProject({width:((d=r("width"))==null?void 0:d.value)||1280,height:((c=r("height"))==null?void 0:c.value)||720,fps:((h=r("fps"))==null?void 0:h.value)||30,total_frames:((v=r("total_frames"))==null?void 0:v.value)||150})}),Ye(()=>{K()}),(r,e)=>{var d;return w(),L("div",Oe,[o("div",Ze,[o("div",Ne,[e[22]||(e[22]=o("span",{class:"title"},"AE Timeline",-1)),o("span",qe,_(l(n).project.width)+"x"+_(l(n).project.height)+" | "+_(l(n).project.fps)+"fps",1)]),o("div",He,[o("button",{class:"btn",onClick:e[0]||(e[0]=(...c)=>l(n).togglePlayback&&l(n).togglePlayback(...c))},_(l(n).isPlaying?"II":">"),1),o("button",{class:"btn",onClick:e[1]||(e[1]=(...c)=>l(n).stopPlayback&&l(n).stopPlayback(...c))},"[]"),o("span",Je,_(O(l(n).currentTime)),1),o("button",{class:"btn green",onClick:P},"+K"),o("button",{class:"btn",onClick:N},"-K"),o("button",{class:ye(["btn",{active:l(n).maskMode.enabled}]),onClick:B},"Mask",2),o("button",{class:ye(["btn",{active:l(n).pathMode.enabled}]),onClick:ce},"Path",2)]),o("div",{class:"header-right"},[o("button",{class:"btn blue",onClick:K},"Save"),o("button",{class:"btn red",onClick:ee},"X")])]),o("div",Qe,[o("button",{class:"tool",onClick:te,title:"Add Foreground"},"+"),o("button",{class:"tool",onClick:de,title:"Add Background"},"BG"),e[23]||(e[23]=o("div",{class:"tool-sep"},null,-1)),o("button",{class:"tool",onClick:ne,disabled:!l(n).currentLayer},"Up",8,et),o("button",{class:"tool",onClick:re,disabled:!l(n).currentLayer},"Dn",8,tt)]),o("div",nt,[Ae(Ge)]),o("div",rt,[l(n).currentLayer?(w(),L(se,{key:0},[o("div",at,[_e(" Layer "+_(l(n).currentLayerIndex+1)+" ",1),o("button",{class:"reset-btn",onClick:X,title:"Reset transform"},"R")]),o("div",ot,[o("div",st,_(l(n).currentLayer.type==="background"?"Background":"Position"),1),l(n).currentLayer.type==="background"?(w(),L("div",it,[e[25]||(e[25]=o("label",null,"Mode",-1)),k(o("select",{"onUpdate:modelValue":e[2]||(e[2]=c=>l(n).currentLayer.bg_mode=c)},[...e[24]||(e[24]=[o("option",{value:"fit"},"Fit",-1),o("option",{value:"fill"},"Fill",-1),o("option",{value:"stretch"},"Stretch",-1)])],512),[[Ie,l(n).currentLayer.bg_mode]])])):ie("",!0),o("div",lt,[e[26]||(e[26]=o("label",null,"X",-1)),k(o("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=c=>l(n).currentLayer.x=c),step:"1"},null,512),[[C,l(n).currentLayer.x,void 0,{number:!0}]])]),o("div",ut,[e[27]||(e[27]=o("label",null,"Y",-1)),k(o("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=c=>l(n).currentLayer.y=c),step:"1"},null,512),[[C,l(n).currentLayer.y,void 0,{number:!0}]])])]),o("div",ct,[e[31]||(e[31]=o("div",{class:"prop-label"},"Transform",-1)),o("div",dt,[e[28]||(e[28]=o("label",null,"Scale",-1)),k(o("input",{type:"range",min:"0.1",max:"3",step:"0.01","onUpdate:modelValue":e[5]||(e[5]=c=>l(n).currentLayer.scale=c)},null,512),[[C,l(n).currentLayer.scale,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=c=>l(n).currentLayer.scale=c),step:"0.01",class:"small"},null,512),[[C,l(n).currentLayer.scale,void 0,{number:!0}]])]),o("div",pt,[e[29]||(e[29]=o("label",null,"Rotation",-1)),k(o("input",{type:"range",min:"-180",max:"180",step:"1","onUpdate:modelValue":e[7]||(e[7]=c=>l(n).currentLayer.rotation=c)},null,512),[[C,l(n).currentLayer.rotation,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=c=>l(n).currentLayer.rotation=c),step:"1",class:"small"},null,512),[[C,l(n).currentLayer.rotation,void 0,{number:!0}]])]),o("div",ft,[e[30]||(e[30]=o("label",null,"Opacity",-1)),k(o("input",{type:"range",min:"0",max:"1",step:"0.01","onUpdate:modelValue":e[9]||(e[9]=c=>l(n).currentLayer.opacity=c)},null,512),[[C,l(n).currentLayer.opacity,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[10]||(e[10]=c=>l(n).currentLayer.opacity=c),step:"0.01",min:"0",max:"1",class:"small"},null,512),[[C,l(n).currentLayer.opacity,void 0,{number:!0}]])])]),l(n).currentLayer.type!=="background"?(w(),L("div",yt,[e[35]||(e[35]=o("div",{class:"prop-label"},"3D Transform",-1)),o("div",mt,[e[32]||(e[32]=o("label",null,"RotX",-1)),k(o("input",{type:"range",min:"-90",max:"90",step:"1","onUpdate:modelValue":e[11]||(e[11]=c=>l(n).currentLayer.rotationX=c)},null,512),[[C,l(n).currentLayer.rotationX,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[12]||(e[12]=c=>l(n).currentLayer.rotationX=c),step:"1",class:"small"},null,512),[[C,l(n).currentLayer.rotationX,void 0,{number:!0}]])]),o("div",vt,[e[33]||(e[33]=o("label",null,"RotY",-1)),k(o("input",{type:"range",min:"-90",max:"90",step:"1","onUpdate:modelValue":e[13]||(e[13]=c=>l(n).currentLayer.rotationY=c)},null,512),[[C,l(n).currentLayer.rotationY,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[14]||(e[14]=c=>l(n).currentLayer.rotationY=c),step:"1",class:"small"},null,512),[[C,l(n).currentLayer.rotationY,void 0,{number:!0}]])]),o("div",ht,[e[34]||(e[34]=o("label",null,"Persp",-1)),k(o("input",{type:"range",min:"100",max:"2000",step:"50","onUpdate:modelValue":e[15]||(e[15]=c=>l(n).currentLayer.perspective=c)},null,512),[[C,l(n).currentLayer.perspective,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[16]||(e[16]=c=>l(n).currentLayer.perspective=c),step:"50",class:"small"},null,512),[[C,l(n).currentLayer.perspective,void 0,{number:!0}]])])])):ie("",!0),l(n).currentLayer.type!=="background"?(w(),L("div",gt,[e[38]||(e[38]=o("div",{class:"prop-label"},"Mask",-1)),o("div",bt,[e[36]||(e[36]=o("label",null,"Size",-1)),k(o("input",{type:"range",min:"0",max:"1",step:"0.01","onUpdate:modelValue":e[17]||(e[17]=c=>l(n).currentLayer.mask_size=c)},null,512),[[C,l(n).currentLayer.mask_size,void 0,{number:!0}]]),k(o("input",{type:"number","onUpdate:modelValue":e[18]||(e[18]=c=>l(n).currentLayer.mask_size=c),step:"0.01",min:"0",max:"1",class:"small"},null,512),[[C,l(n).currentLayer.mask_size,void 0,{number:!0}]])]),o("div",kt,[e[37]||(e[37]=o("label",null,"Brush",-1)),k(o("input",{type:"range",min:"5",max:"100",step:"1","onUpdate:modelValue":e[19]||(e[19]=c=>l(n).maskMode.brush=c)},null,512),[[C,l(n).maskMode.brush,void 0,{number:!0}]]),o("button",{class:ye(["small-btn",{active:l(n).maskMode.erase}]),onClick:e[20]||(e[20]=c=>l(n).maskMode.erase=!l(n).maskMode.erase)},"Erase",2)])])):ie("",!0),l(n).currentLayer.type!=="background"?(w(),L("div",Lt,[e[40]||(e[40]=o("div",{class:"prop-label"},"Path Animation",-1)),o("div",wt,[e[39]||(e[39]=o("label",null,"Enable",-1)),k(o("input",{type:"checkbox","onUpdate:modelValue":e[21]||(e[21]=c=>l(n).currentLayer.usePathAnimation=c)},null,512),[[Ue,l(n).currentLayer.usePathAnimation]]),o("button",{class:"small-btn",onClick:q},"Clear Path")]),l(n).currentLayer.bezierPath?(w(),L("div",Mt,[o("span",Pt,_(((d=l(n).currentLayer.bezierPath)==null?void 0:d.length)||0)+" points",1)])):ie("",!0)])):ie("",!0),e[41]||(e[41]=o("div",{class:"help-text"},[o("div",null,"Drag: Move layer"),o("div",null,"Wheel: Scale"),o("div",null,"Shift+Wheel: Rotate"),o("div",null,"Alt+Wheel: Opacity"),o("div",null,"R: Reset transform")],-1))],64)):(w(),L(se,{key:1},[e[42]||(e[42]=o("div",{class:"panel-title"},"Properties",-1)),e[43]||(e[43]=o("div",{class:"no-selection"},"Select a layer to edit",-1))],64))]),o("div",xt,[o("div",Ct,[e[44]||(e[44]=o("div",{class:"layers-head"},"Layers",-1)),o("div",_t,[(w(!0),L(se,null,me(l(n).layers,(c,h)=>(w(),L("div",{key:c.id,class:ye(["layer",{active:h===l(n).currentLayerIndex}]),onClick:v=>l(n).selectLayer(h)},[o("span",null,_(c.type==="background"?"BG":"FG"),1),o("span",jt,"Layer "+_(h+1),1),o("button",{class:"layer-del",onClick:G(v=>l(n).removeLayer(h),["stop"])},"x",8,St)],10,zt))),128))])]),o("div",{class:"tracks",ref_key:"tracksRef",ref:A,onMousedown:Z,onMousemove:Y,onMouseup:V,onMouseleave:V,onDblclick:le},[o("div",Xt,[(w(!0),L(se,null,me(J.value,c=>(w(),L("div",{key:c,class:"tick",style:be({left:(c-1)/l(n).project.duration*100+"%"})},_(c-1)+"s",5))),128))]),o("div",Tt,[(w(!0),L(se,null,me(l(n).layers,(c,h)=>(w(),L("div",{key:c.id,class:ye(["track",{active:h===l(n).currentLayerIndex}]),onClick:G(v=>Q(h,v),["stop"])},[(w(!0),L(se,null,me(D(c),v=>(w(),L("div",{key:v.t+v.p,class:"kf",style:be({left:v.t/l(n).project.duration*100+"%"}),onClick:G(x=>ue(v.t),["stop"]),onContextmenu:G(x=>I(c,v),["prevent"]),title:v.p+": "+v.v.toFixed(2)},null,44,At))),128))],10,Yt))),128))]),o("div",{class:"playhead",style:be({left:l(n).currentTime/l(n).project.duration*100+"%"})},null,4),o("div",It,_(O(l(n).currentTime)),1)],544)]),o("input",{ref_key:"fileInput",ref:M,type:"file",accept:"image/*",multiple:"",style:{display:"none"},onChange:pe},null,544)])}}});function Rt(j,a){const n=Re(Ut,{node:a.node}),M=De();return n.use(M),n.mount(j),n}window.createTimelineApp=Rt;
